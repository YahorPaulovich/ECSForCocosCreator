/*! *****************************************************************************
 *
 * miski
 * v0.3.0
 *
 * MIT License
 * 
 * Copyright (C) 2021 Peter Hughes<https://www.phugh.es>, all rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
***************************************************************************** */
"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=function(t){return t&&t.Math==Math&&t},r=e("object"==typeof globalThis&&globalThis)||e("object"==typeof window&&window)||e("object"==typeof self&&self)||e("object"==typeof t&&t)||function(){return this}()||Function("return this")(),n={},o=function(t){try{return!!t()}catch(t){return!0}},i=!o((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),a={},u={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,c=s&&!u.call({1:2},1);a.f=c?function(t){var e=s(this,t);return!!e&&e.enumerable}:u;var f=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},l={}.toString,h=function(t){return l.call(t).slice(8,-1)},p=h,d="".split,y=o((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==p(t)?d.call(t,""):Object(t)}:Object,g=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},v=y,m=g,w=function(t){return v(m(t))},_=function(t){return"object"==typeof t?null!==t:"function"==typeof t},E=_,S=function(t,e){if(!E(t))return t;var r,n;if(e&&"function"==typeof(r=t.toString)&&!E(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!E(n=r.call(t)))return n;if(!e&&"function"==typeof(r=t.toString)&&!E(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")},b=g,T=function(t){return Object(b(t))},O=T,R={}.hasOwnProperty,I=function(t,e){return R.call(O(t),e)},A=_,j=r.document,P=A(j)&&A(j.createElement),N=function(t){return P?j.createElement(t):{}},x=!i&&!o((function(){return 7!=Object.defineProperty(N("div"),"a",{get:function(){return 7}}).a})),k=i,M=a,C=f,D=w,z=S,U=I,$=x,B=Object.getOwnPropertyDescriptor;n.f=k?B:function(t,e){if(t=D(t),e=z(e,!0),$)try{return B(t,e)}catch(t){}if(U(t,e))return C(!M.f.call(t,e),t[e])};var F={},G=_,L=function(t){if(!G(t))throw TypeError(String(t)+" is not an object");return t},W=i,q=x,Q=L,K=S,V=Object.defineProperty;F.f=W?V:function(t,e,r){if(Q(t),e=K(e,!0),Q(r),q)try{return V(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(t[e]=r.value),t};var Y=F,Z=f,H=i?function(t,e,r){return Y.f(t,e,Z(1,r))}:function(t,e,r){return t[e]=r,t},J={exports:{}},X=r,tt=H,et=function(t,e){try{tt(X,t,e)}catch(r){X[t]=e}return e},rt=et,nt=r["__core-js_shared__"]||rt("__core-js_shared__",{}),ot=nt,it=Function.toString;"function"!=typeof ot.inspectSource&&(ot.inspectSource=function(t){return it.call(t)});var at=ot.inspectSource,ut=at,st=r.WeakMap,ct="function"==typeof st&&/native code/.test(ut(st)),ft={exports:{}},lt=nt;(ft.exports=function(t,e){return lt[t]||(lt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var ht,pt,dt,yt=0,gt=Math.random(),vt=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++yt+gt).toString(36)},mt=ft.exports,wt=vt,_t=mt("keys"),Et={},St=ct,bt=_,Tt=H,Ot=I,Rt=nt,It=function(t){return _t[t]||(_t[t]=wt(t))},At=Et,jt=r.WeakMap;if(St||Rt.state){var Pt=Rt.state||(Rt.state=new jt),Nt=Pt.get,xt=Pt.has,kt=Pt.set;ht=function(t,e){if(xt.call(Pt,t))throw new TypeError("Object already initialized");return e.facade=t,kt.call(Pt,t,e),e},pt=function(t){return Nt.call(Pt,t)||{}},dt=function(t){return xt.call(Pt,t)}}else{var Mt=It("state");At[Mt]=!0,ht=function(t,e){if(Ot(t,Mt))throw new TypeError("Object already initialized");return e.facade=t,Tt(t,Mt,e),e},pt=function(t){return Ot(t,Mt)?t[Mt]:{}},dt=function(t){return Ot(t,Mt)}}var Ct={set:ht,get:pt,has:dt,enforce:function(t){return dt(t)?pt(t):ht(t,{})},getterFor:function(t){return function(e){var r;if(!bt(e)||(r=pt(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return r}}},Dt=r,zt=H,Ut=I,$t=et,Bt=at,Ft=Ct.get,Gt=Ct.enforce,Lt=String(String).split("String");(J.exports=function(t,e,r,n){var o,i=!!n&&!!n.unsafe,a=!!n&&!!n.enumerable,u=!!n&&!!n.noTargetGet;"function"==typeof r&&("string"!=typeof e||Ut(r,"name")||zt(r,"name",e),(o=Gt(r)).source||(o.source=Lt.join("string"==typeof e?e:""))),t!==Dt?(i?!u&&t[e]&&(a=!0):delete t[e],a?t[e]=r:zt(t,e,r)):a?t[e]=r:$t(e,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&Ft(this).source||Bt(this)}));var Wt=r,qt=r,Qt=function(t){return"function"==typeof t?t:void 0},Kt=function(t,e){return arguments.length<2?Qt(Wt[t])||Qt(qt[t]):Wt[t]&&Wt[t][e]||qt[t]&&qt[t][e]},Vt={},Yt=Math.ceil,Zt=Math.floor,Ht=function(t){return isNaN(t=+t)?0:(t>0?Zt:Yt)(t)},Jt=Ht,Xt=Math.min,te=function(t){return t>0?Xt(Jt(t),9007199254740991):0},ee=Ht,re=Math.max,ne=Math.min,oe=w,ie=te,ae=function(t,e){var r=ee(t);return r<0?re(r+e,0):ne(r,e)},ue=function(t){return function(e,r,n){var o,i=oe(e),a=ie(i.length),u=ae(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},se={includes:ue(!0),indexOf:ue(!1)},ce=I,fe=w,le=se.indexOf,he=Et,pe=function(t,e){var r,n=fe(t),o=0,i=[];for(r in n)!ce(he,r)&&ce(n,r)&&i.push(r);for(;e.length>o;)ce(n,r=e[o++])&&(~le(i,r)||i.push(r));return i},de=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype");Vt.f=Object.getOwnPropertyNames||function(t){return pe(t,de)};var ye={};ye.f=Object.getOwnPropertySymbols;var ge=Vt,ve=ye,me=L,we=Kt("Reflect","ownKeys")||function(t){var e=ge.f(me(t)),r=ve.f;return r?e.concat(r(t)):e},_e=I,Ee=we,Se=n,be=F,Te=o,Oe=/#|\.prototype\./,Re=function(t,e){var r=Ae[Ie(t)];return r==Pe||r!=je&&("function"==typeof e?Te(e):!!e)},Ie=Re.normalize=function(t){return String(t).replace(Oe,".").toLowerCase()},Ae=Re.data={},je=Re.NATIVE="N",Pe=Re.POLYFILL="P",Ne=Re,xe=r,ke=n.f,Me=H,Ce=J.exports,De=et,ze=function(t,e){for(var r=Ee(e),n=be.f,o=Se.f,i=0;i<r.length;i++){var a=r[i];_e(t,a)||n(t,a,o(e,a))}},Ue=Ne,$e=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?xe:c?xe[u]||De(u,{}):(xe[u]||{}).prototype)for(n in e){if(i=e[n],o=t.noTargetGet?(a=ke(r,n))&&a.value:r[n],!Ue(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;ze(i,o)}(t.sham||o&&o.sham)&&Me(i,"sham",!0),Ce(r,n,i,t)}},Be=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Fe=L,Ge=Be,Le=function(){for(var t=Fe(this),e=Ge(t.add),r=0,n=arguments.length;r<n;r++)e.call(t,arguments[r]);return t},We=Le;$e({target:"Set",proto:!0,real:!0,forced:false},{addAll:function(){return We.apply(this,arguments)}});var qe=L,Qe=Be,Ke=function(){for(var t,e=qe(this),r=Qe(e.delete),n=!0,o=0,i=arguments.length;o<i;o++)t=r.call(e,arguments[o]),n=n&&t;return!!n},Ve=Ke;$e({target:"Set",proto:!0,real:!0,forced:false},{deleteAll:function(){return Ve.apply(this,arguments)}});var Ye,Ze,He=Kt("navigator","userAgent")||"",Je=r.process,Xe=Je&&Je.versions,tr=Xe&&Xe.v8;tr?Ze=(Ye=tr.split("."))[0]<4?1:Ye[0]+Ye[1]:He&&(!(Ye=He.match(/Edge\/(\d+)/))||Ye[1]>=74)&&(Ye=He.match(/Chrome\/(\d+)/))&&(Ze=Ye[1]);var er=Ze&&+Ze,rr=er,nr=o,or=!!Object.getOwnPropertySymbols&&!nr((function(){return!String(Symbol())||!Symbol.sham&&rr&&rr<41})),ir=or&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ar=r,ur=ft.exports,sr=I,cr=vt,fr=or,lr=ir,hr=ur("wks"),pr=ar.Symbol,dr=lr?pr:pr&&pr.withoutSetter||cr,yr=function(t){return sr(hr,t)&&(fr||"string"==typeof hr[t])||(fr&&sr(pr,t)?hr[t]=pr[t]:hr[t]=dr("Symbol."+t)),hr[t]},gr=L,vr=Be,mr=yr("species"),wr=function(t,e){var r,n=gr(t).constructor;return void 0===n||null==(r=gr(n)[mr])?e:vr(r)},_r={},Er=_r,Sr=yr("iterator"),br=Array.prototype,Tr=Be,Or=function(t,e,r){if(Tr(t),void 0===e)return t;switch(r){case 0:return function(){return t.call(e)};case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,o){return t.call(e,r,n,o)}}return function(){return t.apply(e,arguments)}},Rr={};Rr[yr("toStringTag")]="z";var Ir="[object z]"===String(Rr),Ar=h,jr=yr("toStringTag"),Pr="Arguments"==Ar(function(){return arguments}()),Nr=Ir?Ar:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),jr))?r:Pr?Ar(e):"Object"==(n=Ar(e))&&"function"==typeof e.callee?"Arguments":n},xr=_r,kr=yr("iterator"),Mr=function(t){if(null!=t)return t[kr]||t["@@iterator"]||xr[Nr(t)]},Cr=L,Dr=L,zr=function(t){return void 0!==t&&(Er.Array===t||br[Sr]===t)},Ur=te,$r=Or,Br=Mr,Fr=function(t){var e=t.return;if(void 0!==e)return Cr(e.call(t)).value},Gr=function(t,e){this.stopped=t,this.result=e},Lr=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_ITERATOR),p=!(!r||!r.INTERRUPTED),d=$r(e,f,1+l+p),y=function(t){return n&&Fr(n),new Gr(!0,t)},g=function(t){return l?(Dr(t),p?d(t[0],t[1],y):d(t[0],t[1])):p?d(t,y):d(t)};if(h)n=t;else{if("function"!=typeof(o=Br(t)))throw TypeError("Target is not iterable");if(zr(o)){for(i=0,a=Ur(t.length);a>i;i++)if((u=g(t[i]))&&u instanceof Gr)return u;return new Gr(!1)}n=o.call(t)}for(s=n.next;!(c=s.call(n)).done;){try{u=g(c.value)}catch(t){throw Fr(n),t}if("object"==typeof u&&u&&u instanceof Gr)return u}return new Gr(!1)},Wr=Kt,qr=L,Qr=Be,Kr=wr,Vr=Lr;$e({target:"Set",proto:!0,real:!0,forced:false},{difference:function(t){var e=qr(this),r=new(Kr(e,Wr("Set")))(e),n=Qr(r.delete);return Vr(t,(function(t){n.call(r,t)})),r}});var Yr=L,Zr=Mr,Hr=function(t){return Set.prototype.values.call(t)},Jr=L,Xr=Or,tn=Hr,en=Lr;$e({target:"Set",proto:!0,real:!0,forced:false},{every:function(t){var e=Jr(this),r=tn(e),n=Xr(t,arguments.length>1?arguments[1]:void 0,3);return!en(r,(function(t,r){if(!n(t,t,e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var rn=Kt,nn=L,on=Be,an=Or,un=wr,sn=Hr,cn=Lr;$e({target:"Set",proto:!0,real:!0,forced:false},{filter:function(t){var e=nn(this),r=sn(e),n=an(t,arguments.length>1?arguments[1]:void 0,3),o=new(un(e,rn("Set"))),i=on(o.add);return cn(r,(function(t){n(t,t,e)&&i.call(o,t)}),{IS_ITERATOR:!0}),o}});var fn=L,ln=Or,hn=Hr,pn=Lr;$e({target:"Set",proto:!0,real:!0,forced:false},{find:function(t){var e=fn(this),r=hn(e),n=ln(t,arguments.length>1?arguments[1]:void 0,3);return pn(r,(function(t,r){if(n(t,t,e))return r(t)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var dn=Kt,yn=L,gn=Be,vn=wr,mn=Lr;$e({target:"Set",proto:!0,real:!0,forced:false},{intersection:function(t){var e=yn(this),r=new(vn(e,dn("Set"))),n=gn(e.has),o=gn(r.add);return mn(t,(function(t){n.call(e,t)&&o.call(r,t)})),r}});var wn=L,_n=Be,En=Lr;$e({target:"Set",proto:!0,real:!0,forced:false},{isDisjointFrom:function(t){var e=wn(this),r=_n(e.has);return!En(t,(function(t,n){if(!0===r.call(e,t))return n()}),{INTERRUPTED:!0}).stopped}});var Sn=Kt,bn=L,Tn=Be,On=function(t){var e=Zr(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return Yr(e.call(t))},Rn=Lr;$e({target:"Set",proto:!0,real:!0,forced:false},{isSubsetOf:function(t){var e=On(this),r=bn(t),n=r.has;return"function"!=typeof n&&(r=new(Sn("Set"))(t),n=Tn(r.has)),!Rn(e,(function(t,e){if(!1===n.call(r,t))return e()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var In=L,An=Be,jn=Lr;$e({target:"Set",proto:!0,real:!0,forced:false},{isSupersetOf:function(t){var e=In(this),r=An(e.has);return!jn(t,(function(t,n){if(!1===r.call(e,t))return n()}),{INTERRUPTED:!0}).stopped}});var Pn=L,Nn=Hr,xn=Lr;$e({target:"Set",proto:!0,real:!0,forced:false},{join:function(t){var e=Pn(this),r=Nn(e),n=void 0===t?",":String(t),o=[];return xn(r,o.push,{that:o,IS_ITERATOR:!0}),o.join(n)}});var kn=Kt,Mn=L,Cn=Be,Dn=Or,zn=wr,Un=Hr,$n=Lr;$e({target:"Set",proto:!0,real:!0,forced:false},{map:function(t){var e=Mn(this),r=Un(e),n=Dn(t,arguments.length>1?arguments[1]:void 0,3),o=new(zn(e,kn("Set"))),i=Cn(o.add);return $n(r,(function(t){i.call(o,n(t,t,e))}),{IS_ITERATOR:!0}),o}});var Bn=L,Fn=Be,Gn=Hr,Ln=Lr;$e({target:"Set",proto:!0,real:!0,forced:false},{reduce:function(t){var e=Bn(this),r=Gn(e),n=arguments.length<2,o=n?void 0:arguments[1];if(Fn(t),Ln(r,(function(r){n?(n=!1,o=r):o=t(o,r,r,e)}),{IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty set with no initial value");return o}});var Wn=L,qn=Or,Qn=Hr,Kn=Lr;$e({target:"Set",proto:!0,real:!0,forced:false},{some:function(t){var e=Wn(this),r=Qn(e),n=qn(t,arguments.length>1?arguments[1]:void 0,3);return Kn(r,(function(t,r){if(n(t,t,e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Vn=Kt,Yn=L,Zn=Be,Hn=wr,Jn=Lr;$e({target:"Set",proto:!0,real:!0,forced:false},{symmetricDifference:function(t){var e=Yn(this),r=new(Hn(e,Vn("Set")))(e),n=Zn(r.delete),o=Zn(r.add);return Jn(t,(function(t){n.call(r,t)||o.call(r,t)})),r}});var Xn=Kt,to=L,eo=Be,ro=wr,no=Lr;$e({target:"Set",proto:!0,real:!0,forced:false},{union:function(t){var e=to(this),r=new(ro(e,Xn("Set")))(e);return no(t,eo(r.add),{that:r}),r}});var oo=Ke;$e({target:"Map",proto:!0,real:!0,forced:false},{deleteAll:function(){return oo.apply(this,arguments)}});var io=function(t){return Map.prototype.entries.call(t)},ao=L,uo=Or,so=io,co=Lr;$e({target:"Map",proto:!0,real:!0,forced:false},{every:function(t){var e=ao(this),r=so(e),n=uo(t,arguments.length>1?arguments[1]:void 0,3);return!co(r,(function(t,r,o){if(!n(r,t,e))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var fo=Kt,lo=L,ho=Be,po=Or,yo=wr,go=io,vo=Lr;$e({target:"Map",proto:!0,real:!0,forced:false},{filter:function(t){var e=lo(this),r=go(e),n=po(t,arguments.length>1?arguments[1]:void 0,3),o=new(yo(e,fo("Map"))),i=ho(o.set);return vo(r,(function(t,r){n(r,t,e)&&i.call(o,t,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var mo=L,wo=Or,_o=io,Eo=Lr;$e({target:"Map",proto:!0,real:!0,forced:false},{find:function(t){var e=mo(this),r=_o(e),n=wo(t,arguments.length>1?arguments[1]:void 0,3);return Eo(r,(function(t,r,o){if(n(r,t,e))return o(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var So=L,bo=Or,To=io,Oo=Lr;$e({target:"Map",proto:!0,real:!0,forced:false},{findKey:function(t){var e=So(this),r=To(e),n=bo(t,arguments.length>1?arguments[1]:void 0,3);return Oo(r,(function(t,r,o){if(n(r,t,e))return o(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Ro=L,Io=io,Ao=function(t,e){return t===e||t!=t&&e!=e},jo=Lr;$e({target:"Map",proto:!0,real:!0,forced:false},{includes:function(t){return jo(Io(Ro(this)),(function(e,r,n){if(Ao(r,t))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Po=L,No=io,xo=Lr;$e({target:"Map",proto:!0,real:!0,forced:false},{keyOf:function(t){return xo(No(Po(this)),(function(e,r,n){if(r===t)return n(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var ko=Kt,Mo=L,Co=Be,Do=Or,zo=wr,Uo=io,$o=Lr;$e({target:"Map",proto:!0,real:!0,forced:false},{mapKeys:function(t){var e=Mo(this),r=Uo(e),n=Do(t,arguments.length>1?arguments[1]:void 0,3),o=new(zo(e,ko("Map"))),i=Co(o.set);return $o(r,(function(t,r){i.call(o,n(r,t,e),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var Bo=Kt,Fo=L,Go=Be,Lo=Or,Wo=wr,qo=io,Qo=Lr;$e({target:"Map",proto:!0,real:!0,forced:false},{mapValues:function(t){var e=Fo(this),r=qo(e),n=Lo(t,arguments.length>1?arguments[1]:void 0,3),o=new(Wo(e,Bo("Map"))),i=Go(o.set);return Qo(r,(function(t,r){i.call(o,t,n(r,t,e))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var Ko=L,Vo=Be,Yo=Lr;$e({target:"Map",proto:!0,real:!0,forced:false},{merge:function(t){for(var e=Ko(this),r=Vo(e.set),n=0;n<arguments.length;)Yo(arguments[n++],r,{that:e,AS_ENTRIES:!0});return e}});var Zo=L,Ho=Be,Jo=io,Xo=Lr;$e({target:"Map",proto:!0,real:!0,forced:false},{reduce:function(t){var e=Zo(this),r=Jo(e),n=arguments.length<2,o=n?void 0:arguments[1];if(Ho(t),Xo(r,(function(r,i){n?(n=!1,o=i):o=t(o,i,r,e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty map with no initial value");return o}});var ti=L,ei=Or,ri=io,ni=Lr;$e({target:"Map",proto:!0,real:!0,forced:false},{some:function(t){var e=ti(this),r=ri(e),n=ei(t,arguments.length>1?arguments[1]:void 0,3);return ni(r,(function(t,r,o){if(n(r,t,e))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var oi=L,ii=Be;function ai(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ui(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ai(Object(r),!0).forEach((function(e){si(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ai(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function si(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}$e({target:"Map",proto:!0,real:!0,forced:false},{update:function(t,e){var r=oi(this),n=arguments.length;ii(e);var o=r.has(t);if(!o&&n<3)throw TypeError("Updating absent value");var i=o?r.get(t):ii(n>2?arguments[2]:void 0)(t,r);return r.set(t,e(i,t,r)),r}});const ci=Object.freeze(["_world","defaults","id","name","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","prototype","toLocaleString","toString","valueOf","__defineGetter__","__defineSetter__","__lookupGetter__","__lookupGetter__","__proto__"]);function fi(t,e){return t&e}function li(t,e,r){return null!=e&&t<e?e:null!=r&&t>r?r:t}function hi(t){return/^(?![0-9])[a-zA-Z0-9$_]+$/.test(t)&&!ci.includes(t)}function pi(t){return Boolean(t&&"object"==typeof t&&!Array.isArray(t))}function di(t,...e){if(!e||!e.length)return t;const r={},n=e.shift();return pi(t)&&pi(n)&&(Object.keys(n).forEach((t=>{const e=Object.getOwnPropertyDescriptor(n,t);void 0!==e&&(r[t]=ui({},e),pi(e.value)?di(e.value,n[t]):Array.isArray(e.value)&&(e.value=[...n[t]]))})),Object.getOwnPropertySymbols(n).forEach((t=>{const e=Object.getOwnPropertyDescriptor(n,t);void 0!==e&&e.enumerable&&(r[t]=ui({},e),pi(e.value)?di(e.value,n[t]):Array.isArray(e.value)&&(e.value=[...n[t]]))})),Object.defineProperties(t,r)),di(t,...e)}class yi{constructor(t,e=[]){this.id=t,this._registry=new Set(e)}get entities(){return[...this._registry]}addEntity(t){this._registry.add(t)}isEmpty(){return 0===this._registry.size}removeEntity(t){this._registry.delete(t)}}function gi(t){return function(e){return t.get(e)}}function vi(t){return function(){return[...t.values()]}}function mi(t){return function(...e){const r=new Set;return e.forEach((e=>{t.forEach(((t,n)=>{fi(e.id,n)>0&&t.entities.forEach((t=>r.add(t)))}))})),[...r]}}function wi(t){return function(e){return t.has(e.id)||[...t.values()].includes(e)}}function _i(t,e){return function(r,n){if(void 0!==n){const e=t.get(n);e&&(e.removeEntity(r),e.isEmpty()&&t.delete(n))}const o=r.archetype;var i;t.has(o)?null===(i=t.get(o))||void 0===i||i.addEntity(r):t.set(o,new yi(o,[r]));return e}}class Ei{constructor(t,e,r){const{name:n}=r;this.id=e,this.name=n,this._world=t,this.defaults=di({},r.defaults),Object.keys(this.defaults).forEach((t=>{Object.defineProperty(this,t,Object.getOwnPropertyDescriptor(this.defaults,t))}))}get entities(){return this._world.getEntitiesByComponents(this)}get isRegistered(){return this._world.isComponentRegistered(this)}}function Si(t){return function(){return[...t.values()]}}function bi(t){return function(e){return[...t.values()].find((t=>t.id===e))}}function Ti(t){return function(e){return t.get(e)}}function Oi(t){return function(e){return t.has(e.name)||[...t.values()].includes(e)}}function Ri(t,e,r,n){return function(o){if(t.size>=r)throw new Error("Maximum number of components reached.");if(!hi(o.name))throw new SyntaxError(`"${o.name}" is not a valid component name.`);if(t.has(o.name))throw new Error(`Component with name "${o.name}" already registered.`);const i=e.pop();if(void 0===i)throw new Error("No available component ids.");const a=new Ei(n,i,o);return t.set(a.name,a),a}}function Ii(t,e,r){return function(n){if(!t.has(n.name))throw new Error(`Component "${n.name}" is not registered.`);return n.entities.forEach((t=>t.removeComponent(n))),t.delete(n.name),e.unshift(n.id),r}}class Ai{constructor(t){const{create:e,destroy:r,initialSize:n,growthFactor:o,maxSize:i,world:a}=t;this.initialSize=n,this.growthFactor=o,this.maxSize=i,this._create=e,this._destroy=r,this._firstAvailable=null,this._pool=new Array(n),this._world=a,this.add(n)}add(t=1){for(let e=0;e<t;e++){if(this._pool.length>=this.maxSize)throw new Error("The pool is full!");const t=this._create(this._world);t.next=this._firstAvailable,this._firstAvailable=t,this._pool.push(t)}}clear(){this._pool.length=0,this._firstAvailable=null,this.add(this.initialSize)}get(){this._firstAvailable||this.add(this.initialSize*this.growthFactor);const t=this._firstAvailable;return this._firstAvailable=t.next,t}release(t){this._destroy(t),t.next=this._firstAvailable,this._firstAvailable=t}}class ji{constructor(t=0n){this.mask=0n,this.mask=t}get value(){return this.mask}clear(){this.mask=0n}hasAll(t){return Boolean((t&this.mask)===this.mask)}hasAny(t){return Boolean(0n===this.mask||(t&this.mask)>0)}hasNone(t){return Boolean(0n===(t&this.mask))}off(t){return this.mask&=~(1n<<BigInt(t)),this.mask}on(t){return this.mask|=1n<<BigInt(t),this.mask}}class Pi{constructor(t){this.id=`${Date.now().toString(36)}_${Math.random().toString(36).substr(2,9)}`,this._archetype=new ji,this._enabled=!1,this._next=null,this._properties=new Map,this._world=t}get archetype(){return this._archetype.value}get enabled(){return this._enabled}get next(){return this._next}set next(t){this._next=t}addComponent(t,e){if("string"==typeof t){const e=this._world.getComponentByName(t);if(!e)throw new Error(`Component "${t}" not found!`);t=e}if(t instanceof Ei){if(this._properties.has(t))throw new Error(`Entity already has component "${t.name}".`);this._properties.set(t,di({},t.defaults,null!=e?e:{})),Object.defineProperty(this,t.name,{get:()=>this._properties.get(t),set:e=>{const r=this._properties.get(t);if(Object.isFrozen(r))throw new Error(`Properties in component "${t.name}" cannot be modified.`);if(!r)throw new Error(`Component "${t.name}" does not exist in entity.`);Object.entries(e).forEach((([e,n])=>{if(!(e in r))throw new Error(`Property "${e}" does not exist in component "${t.name}".`);r[e]=n}))},enumerable:!0,configurable:!0});const r=this._archetype.value;return this._archetype.on(t.id),this._world.updateArchetype(this,r),!0}throw new SyntaxError("Invalid or unregistered component.")}clear(){Object.keys(this._properties).forEach((t=>delete this[t])),this._properties.clear();const t=this._archetype.value;this._archetype.clear(),this._world.updateArchetype(this,t)}disable(){this._enabled=!1}enable(){this._enabled=!0}hasComponent(t){const e="string"==typeof t?t:t.name;return Boolean(Reflect.has(this._properties,e))}removeComponent(t){if("string"==typeof t){const e=this._world.getComponentByName(t);if(!e)throw new Error(`Component "${t}" not found!`);t=e}if(!this._properties.has(t))throw new Error(`Entity ${this.id} has no component "${t.name}".`);this._properties.delete(t);try{delete this[t.name]}catch(e){console.warn(`Could not remove property ${t.name} from entity.`)}const e=this._archetype.value;return this._archetype.off(t.id),this._world.updateArchetype(this,e),!0}}function Ni(t,e,r){return function(){const n=t.get();if(!(n&&n instanceof Pi))throw new Error("No entities left! Pool is empty.");return e.set(n.id,n),r.updateArchetype(n),n}}function xi(t,e,r){return function(n){var o;return!!e.has(n.id)&&(null===(o=r.getArchetype(n.archetype))||void 0===o||o.removeEntity(n),e.delete(n.id),t.release(n),!0)}}function ki(t){return function(){return[...t.values()]}}function Mi(t){return function(e){return t.get(e)}}function Ci(t){return function(e){return t.has(e.id)||[...t.values()].includes(e)}}var Di=Le;$e({target:"WeakSet",proto:!0,real:!0,forced:false},{addAll:function(){return Di.apply(this,arguments)}});var zi=Ke;$e({target:"WeakSet",proto:!0,real:!0,forced:false},{deleteAll:function(){return zi.apply(this,arguments)}});var Ui=Be,$i=T,Bi=y,Fi=te,Gi=function(t){return function(e,r,n,o){Ui(r);var i=$i(e),a=Bi(i),u=Fi(i.length),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw TypeError("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},Li={left:Gi(!1),right:Gi(!0)},Wi=o,qi="process"==h(r.process),Qi=Li.left,Ki=er,Vi=qi;$e({target:"Array",proto:!0,forced:!function(t,e){var r=[][t];return!!r&&Wi((function(){r.call(null,e||function(){throw 1},1)}))}("reduce")||!Vi&&Ki>79&&Ki<83},{reduce:function(t){return Qi(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}});class Yi{constructor(t,e){var r,n,o,i,a,u;this._cache=new WeakSet,this._registry=new Set,this._world=t,this._all=new Set,this._any=new Set,this._none=new Set,this._mskAll=null!==(r=null===(n=e.all)||void 0===n?void 0:n.reduce(((t,e)=>(this._all.add(e),t.on(e.id),t)),new ji))&&void 0!==r?r:new ji,this._mskAny=null!==(o=null===(i=e.any)||void 0===i?void 0:i.reduce(((t,e)=>(this._any.add(e),t.on(e.id),t)),new ji))&&void 0!==o?o:new ji,this._mskNone=null!==(a=null===(u=e.none)||void 0===u?void 0:u.reduce(((t,e)=>(this._none.add(e),t.on(e.id),t)),new ji))&&void 0!==a?a:new ji}get entities(){return[...this._registry]}get size(){return this._registry.size}hasEntity(t){return this._registry.has(t)}matches(t){const e=0n===this._mskAny.value||fi(t,this._mskAny.value)>0,r=fi(t,this._mskAll.value)===this._mskAll.value,n=0n===fi(t,this._mskNone.value);return e&&r&&n}update(){this._registry.clear(),this._world.getArchetypes().forEach((t=>{(this._cache.has(t)||this.matches(t.id))&&(t.entities.forEach((t=>this._registry.add(t))),this._cache.add(t))}))}}function Zi(t){return function(e){return t.has(e)}}function Hi(t,e){return function(r){const n=new Yi(e,r);return t.add(n),n}}function Ji(t,e){return function(r){return t.delete(r),e}}function Xi(t,e){return function(){return t.forEach((t=>t.update())),e}}function ta(t){return function(){return t.getPreSystems().forEach((e=>e.pre(e.entities,t.global))),t}}function ea(t){return function(e=0){return t.getPostSystems().forEach((r=>r.post(r.entities,t.global,e))),t.updateQueries(),t}}function ra(t,e,r){let n=null,o=0;const i=e;return function(a=0){if(null!==n){o+=.001*(a-n);let e=0;for(r.pre();o>i;){if(e>=t){o=1;break}r.update(i),o-=i,e++}}return n=a,r.post(o/e),r}}function na(t){return function(e=0){return t.getUpdateSystems().forEach((r=>r.update(r.entities,t.global,e))),t}}function oa(t,e){}function ia(t,e,r){}function aa(t,e,r){}class ua{constructor(t,e){const{name:r,query:n=null,pre:o=oa,post:i=ia,update:a=aa}=e;this.name=r,this.query=n,this.pre=o,this.post=i,this.update=a,this._enabled=!1,this._world=t}get enabled(){return this._enabled}get entities(){return null===this.query?this._world.getEntities():this.query.entities}disable(){this._enabled=!1}enable(){this._enabled=!0}}function sa(t){return function(){return[...t]}}function ca(t){return function(){return t.filter((t=>t.post&&t.post!==ia&&t.enabled))}}function fa(t){return function(){return t.filter((t=>t.pre&&t.pre!==oa&&t.enabled))}}function la(t){return function(){return t.filter((t=>t.update&&t.update!==aa&&t.enabled))}}function ha(t){return function(e){return t[e]}}function pa(t){return function(e){return t.get(e)}}function da(t){return function(e){return t.has(e.name)||[...t.values()].includes(e)}}function ya(t){return function(e,r){const n=t.indexOf(e);if(-1===n)return-1;const o=li(r,0,t.length);return t.splice(o,1),t.splice(n,0,e),o}}function ga(t,e,r){return function(n,o){if(!hi(n.name))throw new SyntaxError(`"${n.name}" is not a valid system name.`);if(e.has(n.name))throw new Error(`System "${n.name}" is already registered!`);const i=new ua(r,n);return void 0!==o?t.splice(li(o,0,t.length),0,i):t.push(i),e.set(i.name,i),i}}function va(t,e,r){return function(n){if(!e.has(n.name))throw new Error(`System "${n.name}" is not registered!`);e.delete(n.name);const o=t.indexOf(n);return o>-1&&t.splice(o,1),r}}exports.createWorld=function(t={}){const{entityPoolGrowthFactor:e=.25,initialEntityPoolSize:r=128,maxComponents:n=256,maxEntities:o=Number.POSITIVE_INFINITY,maxUpdates:i=240,tempo:a=1/60}=t,u=Object.create(null);return Object.assign(u,function(t,e){const r=new Map;return{getArchetype:gi(r),getArchetypes:vi(r),getEntitiesByComponents:mi(r),isArchetypeRegistered:wi(r),updateArchetype:_i(r,t)}}(u),function(t,e){const{maxComponents:r}=e,n=new Array(r),o=new Map;for(let t=r,e=0n;t>=0;t--)n[t]=e++;return{getComponentById:bi(o),getComponentByName:Ti(o),getComponents:Si(o),isComponentRegistered:Oi(o),registerComponent:Ri(o,n,r,t),unregisterComponent:Ii(o,n,t)}}(u,{maxComponents:n}),function(t,e){const{entityPoolGrowthFactor:r,initialEntityPoolSize:n,maxEntities:o}=e,i=new Ai({create:function(){return new Pi(t)},destroy:function(t){t.clear()},initialSize:n,growthFactor:r,maxSize:o,world:t}),a=new Map;return{createEntity:Ni(i,a,t),destroyEntity:xi(i,a,t),getEntities:ki(a),getEntityById:Mi(a),isEntityRegistered:Ci(a)}}(u,{entityPoolGrowthFactor:e,initialEntityPoolSize:r,maxEntities:o}),function(t,e){const r=new Set;return{isQueryRegistered:Zi(r),registerQuery:Hi(r,t),unregisterQuery:Ji(r,t),updateQueries:Xi(r,t)}}(u),function(t,e){const{maxUpdates:r,tempo:n}=e;return{post:ea(t),pre:ta(t),step:ra(r,n,t),update:na(t)}}(u,{maxUpdates:i,tempo:a}),function(t,e){const r=[],n=new Map;return{getSystems:sa(r),getPostSystems:ca(r),getPreSystems:fa(r),getUpdateSystems:la(r),getSystemByIdx:ha(r),getSystemByName:pa(n),isSystemRegistered:da(n),moveSystem:ya(r),registerSystem:ga(r,n,t),unregisterSystem:va(r,n,t)}}(u)),u.global=u.createEntity(),u.FORBIDDEN_NAMES=[...ci],u};
//# sourceMappingURL=index.min.js.map
