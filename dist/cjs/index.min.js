/*! *****************************************************************************
 *
 * miski
 * v0.3.0
 *
 * MIT License
 * 
 * Copyright (C) 2021 Peter Hughes<https://www.phugh.es>, all rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
***************************************************************************** */
"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=function(t){return t&&t.Math==Math&&t},r=e("object"==typeof globalThis&&globalThis)||e("object"==typeof window&&window)||e("object"==typeof self&&self)||e("object"==typeof t&&t)||function(){return this}()||Function("return this")(),n={},o=function(t){try{return!!t()}catch(t){return!0}},i=!o((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),a={},s={}.propertyIsEnumerable,u=Object.getOwnPropertyDescriptor,c=u&&!s.call({1:2},1);a.f=c?function(t){var e=u(this,t);return!!e&&e.enumerable}:s;var f=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},l={}.toString,h=function(t){return l.call(t).slice(8,-1)},p=h,d="".split,y=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},g=o((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==p(t)?d.call(t,""):Object(t)}:Object,m=y,v=function(t){return g(m(t))},E=function(t){return"object"==typeof t?null!==t:"function"==typeof t},_=E,w=function(t,e){if(!_(t))return t;var r,n;if(e&&"function"==typeof(r=t.toString)&&!_(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!_(n=r.call(t)))return n;if(!e&&"function"==typeof(r=t.toString)&&!_(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")},S=y,b=function(t){return Object(S(t))},T={}.hasOwnProperty,O=function(t,e){return T.call(b(t),e)},R=E,A=r.document,I=R(A)&&R(A.createElement),j=function(t){return I?A.createElement(t):{}},P=!i&&!o((function(){return 7!=Object.defineProperty(j("div"),"a",{get:function(){return 7}}).a})),N=i,x=a,k=f,M=v,D=w,C=O,z=P,$=Object.getOwnPropertyDescriptor;n.f=N?$:function(t,e){if(t=M(t),e=D(e,!0),z)try{return $(t,e)}catch(t){}if(C(t,e))return k(!x.f.call(t,e),t[e])};var U={},B=E,F=function(t){if(!B(t))throw TypeError(String(t)+" is not an object");return t},G=i,Q=P,L=F,q=w,K=Object.defineProperty;U.f=G?K:function(t,e,r){if(L(t),e=q(e,!0),L(r),Q)try{return K(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(t[e]=r.value),t};var V=U,W=f,Y=i?function(t,e,r){return V.f(t,e,W(1,r))}:function(t,e,r){return t[e]=r,t},Z={exports:{}},H=r,J=Y,X=function(t,e){try{J(H,t,e)}catch(r){H[t]=e}return e},tt=X,et=r["__core-js_shared__"]||tt("__core-js_shared__",{}),rt=et,nt=Function.toString;"function"!=typeof rt.inspectSource&&(rt.inspectSource=function(t){return nt.call(t)});var ot=rt.inspectSource,it=ot,at=r.WeakMap,st="function"==typeof at&&/native code/.test(it(at)),ut={exports:{}},ct=et;(ut.exports=function(t,e){return ct[t]||(ct[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var ft,lt,ht,pt=0,dt=Math.random(),yt=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++pt+dt).toString(36)},gt=ut.exports,mt=yt,vt=gt("keys"),Et={},_t=st,wt=E,St=Y,bt=O,Tt=et,Ot=function(t){return vt[t]||(vt[t]=mt(t))},Rt=Et,At=r.WeakMap;if(_t||Tt.state){var It=Tt.state||(Tt.state=new At),jt=It.get,Pt=It.has,Nt=It.set;ft=function(t,e){if(Pt.call(It,t))throw new TypeError("Object already initialized");return e.facade=t,Nt.call(It,t,e),e},lt=function(t){return jt.call(It,t)||{}},ht=function(t){return Pt.call(It,t)}}else{var xt=Ot("state");Rt[xt]=!0,ft=function(t,e){if(bt(t,xt))throw new TypeError("Object already initialized");return e.facade=t,St(t,xt,e),e},lt=function(t){return bt(t,xt)?t[xt]:{}},ht=function(t){return bt(t,xt)}}var kt={set:ft,get:lt,has:ht,enforce:function(t){return ht(t)?lt(t):ft(t,{})},getterFor:function(t){return function(e){var r;if(!wt(e)||(r=lt(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return r}}},Mt=r,Dt=Y,Ct=O,zt=X,$t=ot,Ut=kt.get,Bt=kt.enforce,Ft=String(String).split("String");(Z.exports=function(t,e,r,n){var o,i=!!n&&!!n.unsafe,a=!!n&&!!n.enumerable,s=!!n&&!!n.noTargetGet;"function"==typeof r&&("string"!=typeof e||Ct(r,"name")||Dt(r,"name",e),(o=Bt(r)).source||(o.source=Ft.join("string"==typeof e?e:""))),t!==Mt?(i?!s&&t[e]&&(a=!0):delete t[e],a?t[e]=r:Dt(t,e,r)):a?t[e]=r:zt(e,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&Ut(this).source||$t(this)}));var Gt=r,Qt=r,Lt=function(t){return"function"==typeof t?t:void 0},qt=function(t,e){return arguments.length<2?Lt(Gt[t])||Lt(Qt[t]):Gt[t]&&Gt[t][e]||Qt[t]&&Qt[t][e]},Kt={},Vt=Math.ceil,Wt=Math.floor,Yt=function(t){return isNaN(t=+t)?0:(t>0?Wt:Vt)(t)},Zt=Yt,Ht=Math.min,Jt=function(t){return t>0?Ht(Zt(t),9007199254740991):0},Xt=Yt,te=Math.max,ee=Math.min,re=v,ne=Jt,oe=function(t,e){var r=Xt(t);return r<0?te(r+e,0):ee(r,e)},ie=function(t){return function(e,r,n){var o,i=re(e),a=ne(i.length),s=oe(n,a);if(t&&r!=r){for(;a>s;)if((o=i[s++])!=o)return!0}else for(;a>s;s++)if((t||s in i)&&i[s]===r)return t||s||0;return!t&&-1}},ae={includes:ie(!0),indexOf:ie(!1)},se=O,ue=v,ce=ae.indexOf,fe=Et,le=function(t,e){var r,n=ue(t),o=0,i=[];for(r in n)!se(fe,r)&&se(n,r)&&i.push(r);for(;e.length>o;)se(n,r=e[o++])&&(~ce(i,r)||i.push(r));return i},he=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype");Kt.f=Object.getOwnPropertyNames||function(t){return le(t,he)};var pe={};pe.f=Object.getOwnPropertySymbols;var de=Kt,ye=pe,ge=F,me=qt("Reflect","ownKeys")||function(t){var e=de.f(ge(t)),r=ye.f;return r?e.concat(r(t)):e},ve=O,Ee=me,_e=n,we=U,Se=o,be=/#|\.prototype\./,Te=function(t,e){var r=Re[Oe(t)];return r==Ie||r!=Ae&&("function"==typeof e?Se(e):!!e)},Oe=Te.normalize=function(t){return String(t).replace(be,".").toLowerCase()},Re=Te.data={},Ae=Te.NATIVE="N",Ie=Te.POLYFILL="P",je=Te,Pe=r,Ne=n.f,xe=Y,ke=Z.exports,Me=X,De=function(t,e){for(var r=Ee(e),n=we.f,o=_e.f,i=0;i<r.length;i++){var a=r[i];ve(t,a)||n(t,a,o(e,a))}},Ce=je,ze=function(t,e){var r,n,o,i,a,s=t.target,u=t.global,c=t.stat;if(r=u?Pe:c?Pe[s]||Me(s,{}):(Pe[s]||{}).prototype)for(n in e){if(i=e[n],o=t.noTargetGet?(a=Ne(r,n))&&a.value:r[n],!Ce(u?n:s+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;De(i,o)}(t.sham||o&&o.sham)&&xe(i,"sham",!0),ke(r,n,i,t)}},$e=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Ue=F,Be=$e,Fe=function(){for(var t=Ue(this),e=Be(t.add),r=0,n=arguments.length;r<n;r++)e.call(t,arguments[r]);return t};ze({target:"Set",proto:!0,real:!0,forced:false},{addAll:function(){return Fe.apply(this,arguments)}});var Ge=F,Qe=$e,Le=function(){for(var t,e=Ge(this),r=Qe(e.delete),n=!0,o=0,i=arguments.length;o<i;o++)t=r.call(e,arguments[o]),n=n&&t;return!!n},qe=Le;ze({target:"Set",proto:!0,real:!0,forced:false},{deleteAll:function(){return qe.apply(this,arguments)}});var Ke,Ve,We=qt("navigator","userAgent")||"",Ye=r.process,Ze=Ye&&Ye.versions,He=Ze&&Ze.v8;He?Ve=(Ke=He.split("."))[0]<4?1:Ke[0]+Ke[1]:We&&(!(Ke=We.match(/Edge\/(\d+)/))||Ke[1]>=74)&&(Ke=We.match(/Chrome\/(\d+)/))&&(Ve=Ke[1]);var Je=Ve&&+Ve,Xe=o,tr=!!Object.getOwnPropertySymbols&&!Xe((function(){return!String(Symbol())||!Symbol.sham&&Je&&Je<41})),er=tr&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,rr=r,nr=ut.exports,or=O,ir=yt,ar=tr,sr=er,ur=nr("wks"),cr=rr.Symbol,fr=sr?cr:cr&&cr.withoutSetter||ir,lr=function(t){return or(ur,t)&&(ar||"string"==typeof ur[t])||(ar&&or(cr,t)?ur[t]=cr[t]:ur[t]=fr("Symbol."+t)),ur[t]},hr=F,pr=$e,dr=lr("species"),yr=function(t,e){var r,n=hr(t).constructor;return void 0===n||null==(r=hr(n)[dr])?e:pr(r)},gr={},mr=gr,vr=lr("iterator"),Er=Array.prototype,_r=$e,wr=function(t,e,r){if(_r(t),void 0===e)return t;switch(r){case 0:return function(){return t.call(e)};case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,o){return t.call(e,r,n,o)}}return function(){return t.apply(e,arguments)}},Sr={};Sr[lr("toStringTag")]="z";var br="[object z]"===String(Sr),Tr=h,Or=lr("toStringTag"),Rr="Arguments"==Tr(function(){return arguments}()),Ar=br?Tr:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Or))?r:Rr?Tr(e):"Object"==(n=Tr(e))&&"function"==typeof e.callee?"Arguments":n},Ir=gr,jr=lr("iterator"),Pr=function(t){if(null!=t)return t[jr]||t["@@iterator"]||Ir[Ar(t)]},Nr=F,xr=F,kr=function(t){return void 0!==t&&(mr.Array===t||Er[vr]===t)},Mr=Jt,Dr=wr,Cr=Pr,zr=function(t){var e=t.return;if(void 0!==e)return Nr(e.call(t)).value},$r=function(t,e){this.stopped=t,this.result=e},Ur=function(t,e,r){var n,o,i,a,s,u,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_ITERATOR),p=!(!r||!r.INTERRUPTED),d=Dr(e,f,1+l+p),y=function(t){return n&&zr(n),new $r(!0,t)},g=function(t){return l?(xr(t),p?d(t[0],t[1],y):d(t[0],t[1])):p?d(t,y):d(t)};if(h)n=t;else{if("function"!=typeof(o=Cr(t)))throw TypeError("Target is not iterable");if(kr(o)){for(i=0,a=Mr(t.length);a>i;i++)if((s=g(t[i]))&&s instanceof $r)return s;return new $r(!1)}n=o.call(t)}for(u=n.next;!(c=u.call(n)).done;){try{s=g(c.value)}catch(t){throw zr(n),t}if("object"==typeof s&&s&&s instanceof $r)return s}return new $r(!1)},Br=qt,Fr=F,Gr=$e,Qr=yr,Lr=Ur;ze({target:"Set",proto:!0,real:!0,forced:false},{difference:function(t){var e=Fr(this),r=new(Qr(e,Br("Set")))(e),n=Gr(r.delete);return Lr(t,(function(t){n.call(r,t)})),r}});var qr=F,Kr=Pr,Vr=function(t){return Set.prototype.values.call(t)},Wr=F,Yr=wr,Zr=Vr,Hr=Ur;ze({target:"Set",proto:!0,real:!0,forced:false},{every:function(t){var e=Wr(this),r=Zr(e),n=Yr(t,arguments.length>1?arguments[1]:void 0,3);return!Hr(r,(function(t,r){if(!n(t,t,e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Jr=qt,Xr=F,tn=$e,en=wr,rn=yr,nn=Vr,on=Ur;ze({target:"Set",proto:!0,real:!0,forced:false},{filter:function(t){var e=Xr(this),r=nn(e),n=en(t,arguments.length>1?arguments[1]:void 0,3),o=new(rn(e,Jr("Set"))),i=tn(o.add);return on(r,(function(t){n(t,t,e)&&i.call(o,t)}),{IS_ITERATOR:!0}),o}});var an=F,sn=wr,un=Vr,cn=Ur;ze({target:"Set",proto:!0,real:!0,forced:false},{find:function(t){var e=an(this),r=un(e),n=sn(t,arguments.length>1?arguments[1]:void 0,3);return cn(r,(function(t,r){if(n(t,t,e))return r(t)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var fn=qt,ln=F,hn=$e,pn=yr,dn=Ur;ze({target:"Set",proto:!0,real:!0,forced:false},{intersection:function(t){var e=ln(this),r=new(pn(e,fn("Set"))),n=hn(e.has),o=hn(r.add);return dn(t,(function(t){n.call(e,t)&&o.call(r,t)})),r}});var yn=F,gn=$e,mn=Ur;ze({target:"Set",proto:!0,real:!0,forced:false},{isDisjointFrom:function(t){var e=yn(this),r=gn(e.has);return!mn(t,(function(t,n){if(!0===r.call(e,t))return n()}),{INTERRUPTED:!0}).stopped}});var vn=qt,En=F,_n=$e,wn=function(t){var e=Kr(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return qr(e.call(t))},Sn=Ur;ze({target:"Set",proto:!0,real:!0,forced:false},{isSubsetOf:function(t){var e=wn(this),r=En(t),n=r.has;return"function"!=typeof n&&(r=new(vn("Set"))(t),n=_n(r.has)),!Sn(e,(function(t,e){if(!1===n.call(r,t))return e()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var bn=F,Tn=$e,On=Ur;ze({target:"Set",proto:!0,real:!0,forced:false},{isSupersetOf:function(t){var e=bn(this),r=Tn(e.has);return!On(t,(function(t,n){if(!1===r.call(e,t))return n()}),{INTERRUPTED:!0}).stopped}});var Rn=F,An=Vr,In=Ur;ze({target:"Set",proto:!0,real:!0,forced:false},{join:function(t){var e=Rn(this),r=An(e),n=void 0===t?",":String(t),o=[];return In(r,o.push,{that:o,IS_ITERATOR:!0}),o.join(n)}});var jn=qt,Pn=F,Nn=$e,xn=wr,kn=yr,Mn=Vr,Dn=Ur;ze({target:"Set",proto:!0,real:!0,forced:false},{map:function(t){var e=Pn(this),r=Mn(e),n=xn(t,arguments.length>1?arguments[1]:void 0,3),o=new(kn(e,jn("Set"))),i=Nn(o.add);return Dn(r,(function(t){i.call(o,n(t,t,e))}),{IS_ITERATOR:!0}),o}});var Cn=F,zn=$e,$n=Vr,Un=Ur;ze({target:"Set",proto:!0,real:!0,forced:false},{reduce:function(t){var e=Cn(this),r=$n(e),n=arguments.length<2,o=n?void 0:arguments[1];if(zn(t),Un(r,(function(r){n?(n=!1,o=r):o=t(o,r,r,e)}),{IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty set with no initial value");return o}});var Bn=F,Fn=wr,Gn=Vr,Qn=Ur;ze({target:"Set",proto:!0,real:!0,forced:false},{some:function(t){var e=Bn(this),r=Gn(e),n=Fn(t,arguments.length>1?arguments[1]:void 0,3);return Qn(r,(function(t,r){if(n(t,t,e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Ln=qt,qn=F,Kn=$e,Vn=yr,Wn=Ur;ze({target:"Set",proto:!0,real:!0,forced:false},{symmetricDifference:function(t){var e=qn(this),r=new(Vn(e,Ln("Set")))(e),n=Kn(r.delete),o=Kn(r.add);return Wn(t,(function(t){n.call(r,t)||o.call(r,t)})),r}});var Yn=qt,Zn=F,Hn=$e,Jn=yr,Xn=Ur;ze({target:"Set",proto:!0,real:!0,forced:false},{union:function(t){var e=Zn(this),r=new(Jn(e,Yn("Set")))(e);return Xn(t,Hn(r.add),{that:r}),r}});var to=Le;ze({target:"Map",proto:!0,real:!0,forced:false},{deleteAll:function(){return to.apply(this,arguments)}});var eo=function(t){return Map.prototype.entries.call(t)},ro=F,no=wr,oo=eo,io=Ur;ze({target:"Map",proto:!0,real:!0,forced:false},{every:function(t){var e=ro(this),r=oo(e),n=no(t,arguments.length>1?arguments[1]:void 0,3);return!io(r,(function(t,r,o){if(!n(r,t,e))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var ao=qt,so=F,uo=$e,co=wr,fo=yr,lo=eo,ho=Ur;ze({target:"Map",proto:!0,real:!0,forced:false},{filter:function(t){var e=so(this),r=lo(e),n=co(t,arguments.length>1?arguments[1]:void 0,3),o=new(fo(e,ao("Map"))),i=uo(o.set);return ho(r,(function(t,r){n(r,t,e)&&i.call(o,t,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var po=F,yo=wr,go=eo,mo=Ur;ze({target:"Map",proto:!0,real:!0,forced:false},{find:function(t){var e=po(this),r=go(e),n=yo(t,arguments.length>1?arguments[1]:void 0,3);return mo(r,(function(t,r,o){if(n(r,t,e))return o(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var vo=F,Eo=wr,_o=eo,wo=Ur;ze({target:"Map",proto:!0,real:!0,forced:false},{findKey:function(t){var e=vo(this),r=_o(e),n=Eo(t,arguments.length>1?arguments[1]:void 0,3);return wo(r,(function(t,r,o){if(n(r,t,e))return o(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var So=F,bo=eo,To=function(t,e){return t===e||t!=t&&e!=e},Oo=Ur;ze({target:"Map",proto:!0,real:!0,forced:false},{includes:function(t){return Oo(bo(So(this)),(function(e,r,n){if(To(r,t))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Ro=F,Ao=eo,Io=Ur;ze({target:"Map",proto:!0,real:!0,forced:false},{keyOf:function(t){return Io(Ao(Ro(this)),(function(e,r,n){if(r===t)return n(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var jo=qt,Po=F,No=$e,xo=wr,ko=yr,Mo=eo,Do=Ur;ze({target:"Map",proto:!0,real:!0,forced:false},{mapKeys:function(t){var e=Po(this),r=Mo(e),n=xo(t,arguments.length>1?arguments[1]:void 0,3),o=new(ko(e,jo("Map"))),i=No(o.set);return Do(r,(function(t,r){i.call(o,n(r,t,e),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var Co=qt,zo=F,$o=$e,Uo=wr,Bo=yr,Fo=eo,Go=Ur;ze({target:"Map",proto:!0,real:!0,forced:false},{mapValues:function(t){var e=zo(this),r=Fo(e),n=Uo(t,arguments.length>1?arguments[1]:void 0,3),o=new(Bo(e,Co("Map"))),i=$o(o.set);return Go(r,(function(t,r){i.call(o,t,n(r,t,e))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var Qo=F,Lo=$e,qo=Ur;ze({target:"Map",proto:!0,real:!0,forced:false},{merge:function(t){for(var e=Qo(this),r=Lo(e.set),n=0;n<arguments.length;)qo(arguments[n++],r,{that:e,AS_ENTRIES:!0});return e}});var Ko=F,Vo=$e,Wo=eo,Yo=Ur;ze({target:"Map",proto:!0,real:!0,forced:false},{reduce:function(t){var e=Ko(this),r=Wo(e),n=arguments.length<2,o=n?void 0:arguments[1];if(Vo(t),Yo(r,(function(r,i){n?(n=!1,o=i):o=t(o,i,r,e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty map with no initial value");return o}});var Zo=F,Ho=wr,Jo=eo,Xo=Ur;ze({target:"Map",proto:!0,real:!0,forced:false},{some:function(t){var e=Zo(this),r=Jo(e),n=Ho(t,arguments.length>1?arguments[1]:void 0,3);return Xo(r,(function(t,r,o){if(n(r,t,e))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var ti=F,ei=$e;function ri(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ni(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ri(Object(r),!0).forEach((function(e){oi(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ri(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function oi(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}ze({target:"Map",proto:!0,real:!0,forced:false},{update:function(t,e){var r=ti(this),n=arguments.length;ei(e);var o=r.has(t);if(!o&&n<3)throw TypeError("Updating absent value");var i=o?r.get(t):ei(n>2?arguments[2]:void 0)(t,r);return r.set(t,e(i,t,r)),r}});const ii=Object.freeze(["_world","defaults","id","name","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","prototype","toLocaleString","toString","valueOf","__defineGetter__","__defineSetter__","__lookupGetter__","__lookupGetter__","__proto__"]);function ai(t,e){return t&e}function si(t,e,r){return null!=e&&t<e?e:null!=r&&t>r?r:t}function ui(t){return/^(?![0-9])[a-zA-Z0-9$_]+$/.test(t)&&!ii.includes(t)}function ci(t){return Boolean(t&&"object"==typeof t&&!Array.isArray(t))}function fi(t,...e){if(!e||!e.length)return t;const r={},n=e.shift();return ci(t)&&ci(n)&&(Object.keys(n).forEach((t=>{const e=Object.getOwnPropertyDescriptor(n,t);void 0!==e&&(r[t]=ni({},e),ci(e.value)?fi(e.value,n[t]):Array.isArray(e.value)&&(e.value=[...n[t]]))})),Object.getOwnPropertySymbols(n).forEach((t=>{const e=Object.getOwnPropertyDescriptor(n,t);void 0!==e&&e.enumerable&&(r[t]=ni({},e),ci(e.value)?fi(e.value,n[t]):Array.isArray(e.value)&&(e.value=[...n[t]]))})),Object.defineProperties(t,r)),fi(t,...e)}class li{constructor(t,e=[]){this.id=t,this._registry=new Set(e)}addEntity(t){this._registry.add(t)}getEntities(){return[...this._registry]}isEmpty(){return 0===this._registry.size}removeEntity(t){this._registry.delete(t)}}function hi(t){return function(e){return t.get(e)}}function pi(t){return function(){return[...t.values()]}}function di(t){return function(...e){const r=new Set;return e.forEach((e=>{t.forEach(((t,n)=>{ai(e.id,n)>0&&t.getEntities().forEach((t=>r.add(t)))}))})),[...r]}}function yi(t){return function(e){return t.has(e.id)||[...t.values()].includes(e)}}function gi(t,e){return function(r,n){if(void 0!==n){const e=t.get(n);e&&(e.removeEntity(r),e.isEmpty()&&t.delete(n))}const o=r.getArchetype();var i;t.has(o)?null===(i=t.get(o))||void 0===i||i.addEntity(r):t.set(o,new li(o,[r]));return e}}class mi{constructor(t,e,r){const{name:n}=r;this.id=e,this.name=n,this._world=t,this.defaults=fi({},r.defaults),Object.keys(this.defaults).forEach((t=>{Object.defineProperty(this,t,Object.getOwnPropertyDescriptor(this.defaults,t))}))}getEntities(){return this._world.getEntitiesByComponents(this)}isRegistered(){return this._world.isComponentRegistered(this)}}function vi(t){return function(){return[...t.values()]}}function Ei(t){return function(e){return[...t.values()].find((t=>t.id===e))}}function _i(t){return function(e){return t.get(e)}}function wi(t){return function(e){return t.has(e.name)||[...t.values()].includes(e)}}function Si(t,e,r,n){return function(o){if(t.size>=r)throw new Error("Maximum number of components reached.");if(!ui(o.name))throw new SyntaxError(`"${o.name}" is not a valid component name.`);if(t.has(o.name))throw new Error(`Component with name "${o.name}" already registered.`);e.value+=1n;const i=new mi(n,e.value,o);return t.set(i.name,i),i}}function bi(t,e){return function(r){if(!t.has(r.name))throw new Error(`Component "${r.name}" is not registered.`);return r.getEntities().forEach((t=>t.removeComponent(r))),t.delete(r.name),e}}class Ti{constructor(t){const{create:e,destroy:r,initialSize:n,growthFactor:o,maxSize:i,world:a}=t;this.initialSize=n,this.growthFactor=o,this.maxSize=i,this._create=e,this._destroy=r,this._firstAvailable=null,this._pool=new Array(n),this._world=a,this.add(n)}add(t=1){for(let e=0;e<t;e++){if(this._pool.length>=this.maxSize)throw new Error("The pool is full!");const t=this._create(this._world);t.next=this._firstAvailable,this._firstAvailable=t,this._pool.push(t)}}clear(){this._pool.length=0,this._firstAvailable=null,this.add(this.initialSize)}get(){this._firstAvailable||this.add(this.initialSize*this.growthFactor);const t=this._firstAvailable;return this._firstAvailable=t.next,t}release(t){this._destroy(t),t.next=this._firstAvailable,this._firstAvailable=t}}class Oi{constructor(t=0n){this.mask=0n,this.mask=t}get value(){return this.mask}clear(){this.mask=0n}hasAll(t){return Boolean((t&this.mask)===this.mask)}hasAny(t){return Boolean(0n===this.mask||(t&this.mask)>0)}hasNone(t){return Boolean(0n===(t&this.mask))}off(t){return this.mask&=~(1n<<BigInt(t)),this.mask}on(t){return this.mask|=1n<<BigInt(t),this.mask}}class Ri{constructor(t){this.id=`${Date.now().toString(36)}_${Math.random().toString(36).substr(2,9)}`,this._archetype=new Oi,this._enabled=!1,this._next=null,this._properties=new Map,this._world=t}get enabled(){return this._enabled}get next(){return this._next}set next(t){this._next=t}addComponent(t,e){if("string"==typeof t){const e=this._world.getComponentByName(t);if(!e)throw new Error(`Component "${t}" not found!`);t=e}if(t instanceof mi){if(this._properties.has(t))throw new Error(`Entity already has component "${t.name}".`);this._properties.set(t,fi({},t.defaults,null!=e?e:{})),Object.defineProperty(this,t.name,{get:()=>this._properties.get(t),set:e=>{const r=this._properties.get(t);if(Object.isFrozen(r))throw new Error(`Properties in component "${t.name}" cannot be modified.`);if(!r)throw new Error(`Component "${t.name}" does not exist in entity.`);Object.entries(e).forEach((([e,n])=>{if(!(e in r))throw new Error(`Property "${e}" does not exist in component "${t.name}".`);r[e]=n}))},enumerable:!0,configurable:!0});const r=this._archetype.value;return this._archetype.on(t.id),this._world.updateArchetype(this,r),!0}throw new SyntaxError("Invalid or unregistered component.")}clear(){Object.keys(this._properties).forEach((t=>delete this[t])),this._properties.clear();const t=this._archetype.value;this._archetype.clear(),this._world.updateArchetype(this,t)}disable(){this._enabled=!1}enable(){this._enabled=!0}getArchetype(){return this._archetype.value}hasComponent(t){const e="string"==typeof t?t:t.name;return Boolean(Reflect.has(this._properties,e))}removeComponent(t){if("string"==typeof t){const e=this._world.getComponentByName(t);if(!e)throw new Error(`Component "${t}" not found!`);t=e}if(!this._properties.has(t))throw new Error(`Entity ${this.id} has no component "${t.name}".`);this._properties.delete(t);try{delete this[t.name]}catch(e){console.warn(`Could not remove property ${t.name} from entity.`)}const e=this._archetype.value;return this._archetype.off(t.id),this._world.updateArchetype(this,e),!0}}function Ai(t,e,r){return function(){const n=t.get();if(!(n&&n instanceof Ri))throw new Error("No entities left! Pool is empty.");return e.set(n.id,n),r.updateArchetype(n),n}}function Ii(t,e,r){return function(n){if(n===r.global)throw new Error("Destroying the global entity is forbidden.");var o;return!!e.has(n.id)&&(null===(o=r.getArchetype(n.getArchetype()))||void 0===o||o.removeEntity(n),e.delete(n.id),t.release(n),!0)}}function ji(t){return function(){return[...t.values()]}}function Pi(t){return function(e){return t.get(e)}}function Ni(t){return function(e){return t.has(e.id)||[...t.values()].includes(e)}}class xi{constructor(t,e){this._registry=new Set,this._world=t,this._all=new Set(e.all),this._any=new Set(e.any),this._none=new Set(e.none),this._mskAll=new Oi,this._mskAny=new Oi,this._mskNone=new Oi,this._refresh()}get size(){return this._registry.size}getEntities(){return[...this._registry]}hasEntity(t){return this._registry.has(t)}matches(t){const e=0n===this._mskAny.value||ai(t,this._mskAny.value)>0,r=ai(t,this._mskAll.value)===this._mskAll.value,n=0n===ai(t,this._mskNone.value);return e&&r&&n}_refresh(){this._all.forEach((t=>{this._mskAll.on(t.id),!1===t.isRegistered()&&console.warn(`Query has unregistered component ("${t.id}") in _all.`,this)})),this._any.forEach((t=>{this._mskAny.on(t.id),!0===t.isRegistered()&&console.warn(`Query has unregistered component ("${t.id}") in _any.`,this)})),this._none.forEach((t=>{this._mskNone.on(t.id),!0===t.isRegistered()&&console.warn(`Query has unregistered component ("${t.id}") in _none.`,this)}))}update(){this._refresh(),this._registry.clear(),this._world.getArchetypes().forEach((t=>{this.matches(t.id)&&t.getEntities().forEach((t=>this._registry.add(t)))}))}}function ki(t){return function(e){return t.has(e)}}function Mi(t,e){return function(r){const n=new xi(e,r);return t.add(n),n}}function Di(t,e){return function(){return t.forEach((t=>t.update())),e}}function Ci(t,e){return function(r){return t.delete(r),e}}function zi(t){return function(){return t.getPreSystems().forEach((e=>e.pre(e.entities,t.global))),t}}function $i(t){return function(e=0){return t.getPostSystems().forEach((r=>r.post(r.entities,t.global,e))),t.refreshQueries(),t}}function Ui(t,e,r){let n=null,o=0;const i=e;return function(a=0){if(null!==n){o+=.001*(a-n);let e=0;for(r.pre();o>i;){if(e>=t){o=1;break}r.update(i),o-=i,e++}}return n=a,r.post(o/e),r}}function Bi(t){return function(e=0){return t.getUpdateSystems().forEach((r=>r.update(r.entities,t.global,e))),t}}function Fi(t,e){}function Gi(t,e,r){}function Qi(t,e,r){}class Li{constructor(t,e){const{name:r,query:n=null,pre:o=Fi,post:i=Gi,update:a=Qi}=e;this.name=r,this.query=n,this.pre=o,this.post=i,this.update=a,this._enabled=!1,this._world=t}get enabled(){return this._enabled}get entities(){return null===this.query?this._world.getEntities():this.query.getEntities()}disable(){this._enabled=!1}enable(){this._enabled=!0}}function qi(t){return function(){return[...t]}}function Ki(t){return function(){return t.filter((t=>t.post&&t.post!==Gi&&t.enabled))}}function Vi(t){return function(){return t.filter((t=>t.pre&&t.pre!==Fi&&t.enabled))}}function Wi(t){return function(){return t.filter((t=>t.update&&t.update!==Qi&&t.enabled))}}function Yi(t){return function(e){return t[e]}}function Zi(t){return function(e){return t.get(e)}}function Hi(t){return function(e){return t.has(e.name)||[...t.values()].includes(e)}}function Ji(t){return function(e,r){const n=t.indexOf(e);if(-1===n)return-1;const o=si(r,0,t.length);return t.splice(o,1),t.splice(n,0,e),o}}function Xi(t,e,r){return function(n,o){if(!ui(n.name))throw new SyntaxError(`"${n.name}" is not a valid system name.`);if(e.has(n.name))throw new Error(`System "${n.name}" is already registered!`);const i=new Li(r,n);return void 0!==o?t.splice(si(o,0,t.length),0,i):t.push(i),e.set(i.name,i),i}}function ta(t,e,r){return function(n){if(!e.has(n.name))throw new Error(`System "${n.name}" is not registered!`);e.delete(n.name);const o=t.indexOf(n);return o>-1&&t.splice(o,1),r}}exports.createWorld=function(t={}){const{entityPoolGrowthFactor:e=.25,initialEntityPoolSize:r=128,maxComponents:n=256,maxEntities:o=Number.POSITIVE_INFINITY,maxUpdates:i=240,tempo:a=1/60}=t,s=Object.create(null);return Object.assign(s,function(t,e){const r=new Map;return{getArchetype:hi(r),getArchetypes:pi(r),getEntitiesByComponents:di(r),isArchetypeRegistered:yi(r),updateArchetype:gi(r,t)}}(s),function(t,e){const{maxComponents:r}=e,n=new Map;return{getComponentById:Ei(n),getComponentByName:_i(n),getComponents:vi(n),isComponentRegistered:wi(n),registerComponent:Si(n,{value:0n},r,t),unregisterComponent:bi(n,t)}}(s,{maxComponents:n}),function(t,e){const{entityPoolGrowthFactor:r,initialEntityPoolSize:n,maxEntities:o}=e,i=new Ti({create:function(){return new Ri(t)},destroy:function(t){t.clear()},initialSize:n,growthFactor:r,maxSize:o,world:t}),a=new Map;return{createEntity:Ai(i,a,t),destroyEntity:Ii(i,a,t),getEntities:ji(a),getEntityById:Pi(a),isEntityRegistered:Ni(a)}}(s,{entityPoolGrowthFactor:e,initialEntityPoolSize:r,maxEntities:o}),function(t,e){const r=new Set;return{isQueryRegistered:ki(r),registerQuery:Mi(r,t),refreshQueries:Di(r,t),unregisterQuery:Ci(r,t)}}(s),function(t,e){const{maxUpdates:r,tempo:n}=e;return{post:$i(t),pre:zi(t),step:Ui(r,n,t),update:Bi(t)}}(s,{maxUpdates:i,tempo:a}),function(t,e){const r=[],n=new Map;return{getSystems:qi(r),getPostSystems:Ki(r),getPreSystems:Vi(r),getUpdateSystems:Wi(r),getSystemByIdx:Yi(r),getSystemByName:Zi(n),isSystemRegistered:Hi(n),moveSystem:Ji(r),registerSystem:Xi(r,n,t),unregisterSystem:ta(r,n,t)}}(s)),s.global=s.createEntity(),s.FORBIDDEN_NAMES=[...ii],s};
//# sourceMappingURL=index.min.js.map
