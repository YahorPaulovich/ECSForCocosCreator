/*! *****************************************************************************
 *
 * miski
 * v0.4.0
 *
 * MIT License
 * 
 * Copyright (C) 2021 Peter Hughes<https://www.phugh.es>, all rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
***************************************************************************** */
"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach((function(e){r(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,i=function(e){try{return!!e()}catch(e){return!0}},a=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),u=function(e){return e&&e.Math==Math&&e},c=u("object"==typeof globalThis&&globalThis)||u("object"==typeof window&&window)||u("object"==typeof self&&self)||u("object"==typeof n&&n)||function(){return this}()||Function("return this")(),f=function(e){return"object"==typeof e?null!==e:"function"==typeof e},s=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},l=s,p=function(e){return Object(l(e))},y=p,d={}.hasOwnProperty,h=Object.hasOwn||function(e,t){return d.call(y(e),t)},m={exports:{}},g={},v=f,b=c.document,w=v(b)&&v(b.createElement),E=function(e){return w?b.createElement(e):{}},S=!a&&!i((function(){return 7!=Object.defineProperty(E("div"),"a",{get:function(){return 7}}).a})),T=f,O=function(e){if(!T(e))throw TypeError(String(e)+" is not an object");return e},A=f,j=function(e,t){if(!A(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!A(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!A(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!A(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")},I=a,R=S,_=O,P=j,x=Object.defineProperty;g.f=I?x:function(e,t,r){if(_(e),t=P(t,!0),_(r),R)try{return x(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var M=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},C=g,N=M,U=a?function(e,t,r){return C.f(e,t,N(1,r))}:function(e,t,r){return e[t]=r,e},D=c,$=U,B=function(e,t){try{$(D,e,t)}catch(r){D[e]=t}return t},k=B,F=c["__core-js_shared__"]||k("__core-js_shared__",{}),Q=F;(m.exports=function(e,t){return Q[e]||(Q[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.15.2",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var q,z,L=0,Y=Math.random(),V=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++L+Y).toString(36)},G=c,W=c,K=function(e){return"function"==typeof e?e:void 0},H=function(e,t){return arguments.length<2?K(G[e])||K(W[e]):G[e]&&G[e][t]||W[e]&&W[e][t]},J=H("navigator","userAgent")||"",Z=J,X=c.process,ee=X&&X.versions,te=ee&&ee.v8;te?z=(q=te.split("."))[0]<4?1:q[0]+q[1]:Z&&(!(q=Z.match(/Edge\/(\d+)/))||q[1]>=74)&&(q=Z.match(/Chrome\/(\d+)/))&&(z=q[1]);var re=z&&+z,ne=re,oe=i,ie=!!Object.getOwnPropertySymbols&&!oe((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ne&&ne<41})),ae=ie&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ue=c,ce=m.exports,fe=h,se=V,le=ie,pe=ae,ye=ce("wks"),de=ue.Symbol,he=pe?de:de&&de.withoutSetter||se,me=function(e){return fe(ye,e)&&(le||"string"==typeof ye[e])||(le&&fe(de,e)?ye[e]=de[e]:ye[e]=he("Symbol."+e)),ye[e]},ge={};ge[me("toStringTag")]="z";var ve="[object z]"===String(ge),be={}.toString,we=function(e){return be.call(e).slice(8,-1)},Ee=ve,Se=we,Te=me("toStringTag"),Oe="Arguments"==Se(function(){return arguments}()),Ae=Ee?Se:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Te))?r:Oe?Se(t):"Object"==(n=Se(t))&&"function"==typeof t.callee?"Arguments":n},je={exports:{}},Ie=F,Re=Function.toString;"function"!=typeof Ie.inspectSource&&(Ie.inspectSource=function(e){return Re.call(e)});var _e,Pe,xe,Me=Ie.inspectSource,Ce=Me,Ne=c.WeakMap,Ue="function"==typeof Ne&&/native code/.test(Ce(Ne)),De=m.exports,$e=V,Be=De("keys"),ke=function(e){return Be[e]||(Be[e]=$e(e))},Fe={},Qe=Ue,qe=f,ze=U,Le=h,Ye=F,Ve=ke,Ge=Fe,We=c.WeakMap;if(Qe||Ye.state){var Ke=Ye.state||(Ye.state=new We),He=Ke.get,Je=Ke.has,Ze=Ke.set;_e=function(e,t){if(Je.call(Ke,e))throw new TypeError("Object already initialized");return t.facade=e,Ze.call(Ke,e,t),t},Pe=function(e){return He.call(Ke,e)||{}},xe=function(e){return Je.call(Ke,e)}}else{var Xe=Ve("state");Ge[Xe]=!0,_e=function(e,t){if(Le(e,Xe))throw new TypeError("Object already initialized");return t.facade=e,ze(e,Xe,t),t},Pe=function(e){return Le(e,Xe)?e[Xe]:{}},xe=function(e){return Le(e,Xe)}}var et={set:_e,get:Pe,has:xe,enforce:function(e){return xe(e)?Pe(e):_e(e,{})},getterFor:function(e){return function(t){var r;if(!qe(t)||(r=Pe(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}},tt=c,rt=U,nt=h,ot=B,it=Me,at=et.get,ut=et.enforce,ct=String(String).split("String");(je.exports=function(e,t,r,n){var o,i=!!n&&!!n.unsafe,a=!!n&&!!n.enumerable,u=!!n&&!!n.noTargetGet;"function"==typeof r&&("string"!=typeof t||nt(r,"name")||rt(r,"name",t),(o=ut(r)).source||(o.source=ct.join("string"==typeof t?t:""))),e!==tt?(i?!u&&e[t]&&(a=!0):delete e[t],a?e[t]=r:rt(e,t,r)):a?e[t]=r:ot(t,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&at(this).source||it(this)}));var ft,st=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),lt=h,pt=p,yt=st,dt=ke("IE_PROTO"),ht=Object.prototype,mt=yt?Object.getPrototypeOf:function(e){return e=pt(e),lt(e,dt)?e[dt]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?ht:null},gt=f,vt=O,bt=function(e){if(!gt(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e},wt=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return vt(r),bt(n),t?e.call(r,n):r.__proto__=n,r}}():void 0),Et=o,St=a,Tt=c,Ot=f,At=h,jt=Ae,It=U,Rt=je.exports,_t=g.f,Pt=mt,xt=wt,Mt=me,Ct=V,Nt=Tt.Int8Array,Ut=Nt&&Nt.prototype,Dt=Tt.Uint8ClampedArray,$t=Dt&&Dt.prototype,Bt=Nt&&Pt(Nt),kt=Ut&&Pt(Ut),Ft=Object.prototype,Qt=Ft.isPrototypeOf,qt=Mt("toStringTag"),zt=Ct("TYPED_ARRAY_TAG"),Lt=Et&&!!xt&&"Opera"!==jt(Tt.opera),Yt=!1,Vt={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Gt={BigInt64Array:8,BigUint64Array:8},Wt=function(e){if(!Ot(e))return!1;var t=jt(e);return At(Vt,t)||At(Gt,t)};for(ft in Vt)Tt[ft]||(Lt=!1);if((!Lt||"function"!=typeof Bt||Bt===Function.prototype)&&(Bt=function(){throw TypeError("Incorrect invocation")},Lt))for(ft in Vt)Tt[ft]&&xt(Tt[ft],Bt);if((!Lt||!kt||kt===Ft)&&(kt=Bt.prototype,Lt))for(ft in Vt)Tt[ft]&&xt(Tt[ft].prototype,kt);if(Lt&&Pt($t)!==kt&&xt($t,kt),St&&!At(kt,qt))for(ft in Yt=!0,_t(kt,qt,{get:function(){return Ot(this)?this[zt]:void 0}}),Vt)Tt[ft]&&It(Tt[ft],zt,ft);var Kt={NATIVE_ARRAY_BUFFER_VIEWS:Lt,TYPED_ARRAY_TAG:Yt&&zt,aTypedArray:function(e){if(Wt(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(xt){if(Qt.call(Bt,e))return e}else for(var t in Vt)if(At(Vt,ft)){var r=Tt[t];if(r&&(e===r||Qt.call(r,e)))return e}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r){if(St){if(r)for(var n in Vt){var o=Tt[n];if(o&&At(o.prototype,e))try{delete o.prototype[e]}catch(e){}}kt[e]&&!r||Rt(kt,e,r?t:Lt&&Ut[e]||t)}},exportTypedArrayStaticMethod:function(e,t,r){var n,o;if(St){if(xt){if(r)for(n in Vt)if((o=Tt[n])&&At(o,e))try{delete o[e]}catch(e){}if(Bt[e]&&!r)return;try{return Rt(Bt,e,r?t:Lt&&Bt[e]||t)}catch(e){}}for(n in Vt)!(o=Tt[n])||o[e]&&!r||Rt(o,e,t)}},isView:function(e){if(!Ot(e))return!1;var t=jt(e);return"DataView"===t||At(Vt,t)||At(Gt,t)},isTypedArray:Wt,TypedArray:Bt,TypedArrayPrototype:kt},Ht=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Jt=Math.ceil,Zt=Math.floor,Xt=function(e){return isNaN(e=+e)?0:(e>0?Zt:Jt)(e)},er=Xt,tr=Math.min,rr=function(e){return e>0?tr(er(e),9007199254740991):0},nr=Math.floor,or=function(e,t){var r=e.length,n=nr(r/2);return r<8?ir(e,t):ar(or(e.slice(0,n),t),or(e.slice(n),t),t)},ir=function(e,t){for(var r,n,o=e.length,i=1;i<o;){for(n=i,r=e[i];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==i++&&(e[n]=r)}return e},ar=function(e,t,r){for(var n=e.length,o=t.length,i=0,a=0,u=[];i<n||a<o;)i<n&&a<o?u.push(r(e[i],t[a])<=0?e[i++]:t[a++]):u.push(i<n?e[i++]:t[a++]);return u},ur=or,cr=J.match(/firefox\/(\d+)/i),fr=!!cr&&+cr[1],sr=/MSIE|Trident/.test(J),lr=J.match(/AppleWebKit\/(\d+)\./),pr=!!lr&&+lr[1],yr=i,dr=Ht,hr=rr,mr=ur,gr=fr,vr=sr,br=re,wr=pr,Er=Kt.aTypedArray,Sr=Kt.exportTypedArrayMethod,Tr=c.Uint16Array,Or=Tr&&Tr.prototype.sort,Ar=!!Or&&!yr((function(){var e=new Tr(2);e.sort(null),e.sort({})})),jr=!!Or&&!yr((function(){if(br)return br<74;if(gr)return gr<67;if(vr)return!0;if(wr)return wr<602;var e,t,r=new Tr(516),n=Array(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,n[e]=e-2*t+3;for(r.sort((function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==n[e])return!0}));
/**
 * @name        Bitmask
 * @description Utilities for handling and manipulating bitmask arrays
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 */
function Ir(e,t){const r=8*e.BYTES_PER_ELEMENT;return e[Math.floor(t/r)]|=1<<t%r,e}function Rr(e,t){const r=8*e.BYTES_PER_ELEMENT;return e[Math.floor(t/r)]&=~(1<<t%r),e}function _r(e,t){const r=8*e.BYTES_PER_ELEMENT;return Boolean(e[Math.floor(t/r)]&1<<t%r)}function Pr(e){const t=function(e){return e.BYTES_PER_ELEMENT*e.length*8}(e);for(let r=0;r<t;r++)if(!_r(e,r))return r}function xr(e=32){return new Uint32Array(e/32)}
/**
 * @description Utilities for handling and manipulating objects
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 */function Mr(e){return Boolean(null!=e&&"object"==typeof e&&!Array.isArray(e))}function Cr(e,...t){if(!t||!t.length)return e;const r=t.shift(),n=Object.getOwnPropertyDescriptors(r);return Object.entries(n).forEach((([t,r])=>{void 0!==r.value&&(Mr(r.value)?r.value=Cr({},r.value):Array.isArray(r.value)&&(r.value=r.value.slice())),Object.defineProperty(e,t,r)})),Cr(e,...t)}
/**
 * @description Utilities for handling and manipulating strings
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 */Sr("sort",(function(e){var t=this;if(void 0!==e&&dr(e),jr)return Or.call(t,e);Er(t);var r,n=hr(t.length),o=Array(n);for(r=0;r<n;r++)o[r]=t[r];for(o=mr(t,function(e){return function(t,r){return void 0!==e?+e(t,r)||0:r!=r?-1:t!=t?1:0===t&&0===r?1/t>0&&1/r<0?1:-1:t>r}}(e)),r=0;r<n;r++)t[r]=o[r];return t}),!jr||Ar);const Nr=["defaults","id","name","entities","schema","world","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","prototype","toLocaleString","toString","valueOf","__defineGetter__","__defineSetter__","__lookupGetter__","__lookupGetter__","__proto__"];function Ur(e){if("string"!=typeof e)throw new TypeError(`Expected name to be of type "string", found ${typeof e}.`);return(e=e.trim()).length>0&&/^(?![0-9])[a-zA-Z0-9$_]+$/.test(e)&&!Nr.includes(e)}var Dr={},$r={},Br={}.propertyIsEnumerable,kr=Object.getOwnPropertyDescriptor,Fr=kr&&!Br.call({1:2},1);$r.f=Fr?function(e){var t=kr(this,e);return!!t&&t.enumerable}:Br;var Qr=we,qr="".split,zr=i((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==Qr(e)?qr.call(e,""):Object(e)}:Object,Lr=s,Yr=function(e){return zr(Lr(e))},Vr=a,Gr=$r,Wr=M,Kr=Yr,Hr=j,Jr=h,Zr=S,Xr=Object.getOwnPropertyDescriptor;Dr.f=Vr?Xr:function(e,t){if(e=Kr(e),t=Hr(t,!0),Zr)try{return Xr(e,t)}catch(e){}if(Jr(e,t))return Wr(!Gr.f.call(e,t),e[t])};var en={},tn=Xt,rn=Math.max,nn=Math.min,on=Yr,an=rr,un=function(e,t){var r=tn(e);return r<0?rn(r+t,0):nn(r,t)},cn=function(e){return function(t,r,n){var o,i=on(t),a=an(i.length),u=un(n,a);if(e&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((e||u in i)&&i[u]===r)return e||u||0;return!e&&-1}},fn={includes:cn(!0),indexOf:cn(!1)},sn=h,ln=Yr,pn=fn.indexOf,yn=Fe,dn=function(e,t){var r,n=ln(e),o=0,i=[];for(r in n)!sn(yn,r)&&sn(n,r)&&i.push(r);for(;t.length>o;)sn(n,r=t[o++])&&(~pn(i,r)||i.push(r));return i},hn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype");en.f=Object.getOwnPropertyNames||function(e){return dn(e,hn)};var mn={};mn.f=Object.getOwnPropertySymbols;var gn=en,vn=mn,bn=O,wn=H("Reflect","ownKeys")||function(e){var t=gn.f(bn(e)),r=vn.f;return r?t.concat(r(e)):t},En=h,Sn=wn,Tn=Dr,On=g,An=i,jn=/#|\.prototype\./,In=function(e,t){var r=_n[Rn(e)];return r==xn||r!=Pn&&("function"==typeof t?An(t):!!t)},Rn=In.normalize=function(e){return String(e).replace(jn,".").toLowerCase()},_n=In.data={},Pn=In.NATIVE="N",xn=In.POLYFILL="P",Mn=In,Cn=c,Nn=Dr.f,Un=U,Dn=je.exports,$n=B,Bn=function(e,t){for(var r=Sn(t),n=On.f,o=Tn.f,i=0;i<r.length;i++){var a=r[i];En(e,a)||n(e,a,o(t,a))}},kn=Mn,Fn=function(e,t){var r,n,o,i,a,u=e.target,c=e.global,f=e.stat;if(r=c?Cn:f?Cn[u]||$n(u,{}):(Cn[u]||{}).prototype)for(n in t){if(i=t[n],o=e.noTargetGet?(a=Nn(r,n))&&a.value:r[n],!kn(c?n:u+(f?".":"#")+n,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;Bn(i,o)}(e.sham||o&&o.sham)&&Un(i,"sham",!0),Dn(r,n,i,e)}},Qn=O,qn=Ht,zn=function(){for(var e,t=Qn(this),r=qn(t.delete),n=!0,o=0,i=arguments.length;o<i;o++)e=r.call(t,arguments[o]),n=n&&e;return!!n},Ln=zn;Fn({target:"Map",proto:!0,real:!0,forced:false},{deleteAll:function(){return Ln.apply(this,arguments)}});var Yn=Ht,Vn=function(e,t,r){if(Yn(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,o){return e.call(t,r,n,o)}}return function(){return e.apply(t,arguments)}},Gn={},Wn=Ae,Kn=Gn,Hn=me("iterator"),Jn=function(e){if(null!=e)return e[Hn]||e["@@iterator"]||Kn[Wn(e)]},Zn=O,Xn=Jn,eo=function(e){return Map.prototype.entries.call(e)},to=Gn,ro=me("iterator"),no=Array.prototype,oo=O,io=O,ao=function(e){return void 0!==e&&(to.Array===e||no[ro]===e)},uo=rr,co=Vn,fo=Jn,so=function(e){var t=e.return;if(void 0!==t)return oo(t.call(e)).value},lo=function(e,t){this.stopped=e,this.result=t},po=function(e,t,r){var n,o,i,a,u,c,f,s=r&&r.that,l=!(!r||!r.AS_ENTRIES),p=!(!r||!r.IS_ITERATOR),y=!(!r||!r.INTERRUPTED),d=co(t,s,1+l+y),h=function(e){return n&&so(n),new lo(!0,e)},m=function(e){return l?(io(e),y?d(e[0],e[1],h):d(e[0],e[1])):y?d(e,h):d(e)};if(p)n=e;else{if("function"!=typeof(o=fo(e)))throw TypeError("Target is not iterable");if(ao(o)){for(i=0,a=uo(e.length);a>i;i++)if((u=m(e[i]))&&u instanceof lo)return u;return new lo(!1)}n=o.call(e)}for(c=n.next;!(f=c.call(n)).done;){try{u=m(f.value)}catch(e){throw so(n),e}if("object"==typeof u&&u&&u instanceof lo)return u}return new lo(!1)},yo=O,ho=Vn,mo=eo,go=po;Fn({target:"Map",proto:!0,real:!0,forced:false},{every:function(e){var t=yo(this),r=mo(t),n=ho(e,arguments.length>1?arguments[1]:void 0,3);return!go(r,(function(e,r,o){if(!n(r,e,t))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var vo=O,bo=Ht,wo=me("species"),Eo=function(e,t){var r,n=vo(e).constructor;return void 0===n||null==(r=vo(n)[wo])?t:bo(r)},So=H,To=O,Oo=Ht,Ao=Vn,jo=Eo,Io=eo,Ro=po;Fn({target:"Map",proto:!0,real:!0,forced:false},{filter:function(e){var t=To(this),r=Io(t),n=Ao(e,arguments.length>1?arguments[1]:void 0,3),o=new(jo(t,So("Map"))),i=Oo(o.set);return Ro(r,(function(e,r){n(r,e,t)&&i.call(o,e,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var _o=O,Po=Vn,xo=eo,Mo=po;Fn({target:"Map",proto:!0,real:!0,forced:false},{find:function(e){var t=_o(this),r=xo(t),n=Po(e,arguments.length>1?arguments[1]:void 0,3);return Mo(r,(function(e,r,o){if(n(r,e,t))return o(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Co=O,No=Vn,Uo=eo,Do=po;Fn({target:"Map",proto:!0,real:!0,forced:false},{findKey:function(e){var t=Co(this),r=Uo(t),n=No(e,arguments.length>1?arguments[1]:void 0,3);return Do(r,(function(e,r,o){if(n(r,e,t))return o(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var $o=O,Bo=eo,ko=function(e,t){return e===t||e!=e&&t!=t},Fo=po;Fn({target:"Map",proto:!0,real:!0,forced:false},{includes:function(e){return Fo(Bo($o(this)),(function(t,r,n){if(ko(r,e))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Qo=O,qo=eo,zo=po;Fn({target:"Map",proto:!0,real:!0,forced:false},{keyOf:function(e){return zo(qo(Qo(this)),(function(t,r,n){if(r===e)return n(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Lo=H,Yo=O,Vo=Ht,Go=Vn,Wo=Eo,Ko=eo,Ho=po;Fn({target:"Map",proto:!0,real:!0,forced:false},{mapKeys:function(e){var t=Yo(this),r=Ko(t),n=Go(e,arguments.length>1?arguments[1]:void 0,3),o=new(Wo(t,Lo("Map"))),i=Vo(o.set);return Ho(r,(function(e,r){i.call(o,n(r,e,t),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var Jo=H,Zo=O,Xo=Ht,ei=Vn,ti=Eo,ri=eo,ni=po;Fn({target:"Map",proto:!0,real:!0,forced:false},{mapValues:function(e){var t=Zo(this),r=ri(t),n=ei(e,arguments.length>1?arguments[1]:void 0,3),o=new(ti(t,Jo("Map"))),i=Xo(o.set);return ni(r,(function(e,r){i.call(o,e,n(r,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var oi=O,ii=Ht,ai=po;Fn({target:"Map",proto:!0,real:!0,forced:false},{merge:function(e){for(var t=oi(this),r=ii(t.set),n=0;n<arguments.length;)ai(arguments[n++],r,{that:t,AS_ENTRIES:!0});return t}});var ui=O,ci=Ht,fi=eo,si=po;Fn({target:"Map",proto:!0,real:!0,forced:false},{reduce:function(e){var t=ui(this),r=fi(t),n=arguments.length<2,o=n?void 0:arguments[1];if(ci(e),si(r,(function(r,i){n?(n=!1,o=i):o=e(o,i,r,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty map with no initial value");return o}});var li=O,pi=Vn,yi=eo,di=po;Fn({target:"Map",proto:!0,real:!0,forced:false},{some:function(e){var t=li(this),r=yi(t),n=pi(e,arguments.length>1?arguments[1]:void 0,3);return di(r,(function(e,r,o){if(n(r,e,t))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var hi=O,mi=Ht;Fn({target:"Map",proto:!0,real:!0,forced:false},{update:function(e,t){var r=hi(this),n=arguments.length;mi(t);var o=r.has(e);if(!o&&n<3)throw TypeError("Updating absent value");var i=o?r.get(e):mi(n>2?arguments[2]:void 0)(e,r);return r.set(e,t(i,e,r)),r}});var gi=O,vi=Ht,bi=function(){for(var e=gi(this),t=vi(e.add),r=0,n=arguments.length;r<n;r++)t.call(e,arguments[r]);return e};Fn({target:"Set",proto:!0,real:!0,forced:false},{addAll:function(){return bi.apply(this,arguments)}});var wi=zn;Fn({target:"Set",proto:!0,real:!0,forced:false},{deleteAll:function(){return wi.apply(this,arguments)}});var Ei=H,Si=O,Ti=Ht,Oi=Eo,Ai=po;Fn({target:"Set",proto:!0,real:!0,forced:false},{difference:function(e){var t=Si(this),r=new(Oi(t,Ei("Set")))(t),n=Ti(r.delete);return Ai(e,(function(e){n.call(r,e)})),r}});var ji=function(e){return Set.prototype.values.call(e)},Ii=O,Ri=Vn,_i=ji,Pi=po;Fn({target:"Set",proto:!0,real:!0,forced:false},{every:function(e){var t=Ii(this),r=_i(t),n=Ri(e,arguments.length>1?arguments[1]:void 0,3);return!Pi(r,(function(e,r){if(!n(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var xi=H,Mi=O,Ci=Ht,Ni=Vn,Ui=Eo,Di=ji,$i=po;Fn({target:"Set",proto:!0,real:!0,forced:false},{filter:function(e){var t=Mi(this),r=Di(t),n=Ni(e,arguments.length>1?arguments[1]:void 0,3),o=new(Ui(t,xi("Set"))),i=Ci(o.add);return $i(r,(function(e){n(e,e,t)&&i.call(o,e)}),{IS_ITERATOR:!0}),o}});var Bi=O,ki=Vn,Fi=ji,Qi=po;Fn({target:"Set",proto:!0,real:!0,forced:false},{find:function(e){var t=Bi(this),r=Fi(t),n=ki(e,arguments.length>1?arguments[1]:void 0,3);return Qi(r,(function(e,r){if(n(e,e,t))return r(e)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var qi=H,zi=O,Li=Ht,Yi=Eo,Vi=po;Fn({target:"Set",proto:!0,real:!0,forced:false},{intersection:function(e){var t=zi(this),r=new(Yi(t,qi("Set"))),n=Li(t.has),o=Li(r.add);return Vi(e,(function(e){n.call(t,e)&&o.call(r,e)})),r}});var Gi=O,Wi=Ht,Ki=po;Fn({target:"Set",proto:!0,real:!0,forced:false},{isDisjointFrom:function(e){var t=Gi(this),r=Wi(t.has);return!Ki(e,(function(e,n){if(!0===r.call(t,e))return n()}),{INTERRUPTED:!0}).stopped}});var Hi=H,Ji=O,Zi=Ht,Xi=function(e){var t=Xn(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return Zn(t.call(e))},ea=po;Fn({target:"Set",proto:!0,real:!0,forced:false},{isSubsetOf:function(e){var t=Xi(this),r=Ji(e),n=r.has;return"function"!=typeof n&&(r=new(Hi("Set"))(e),n=Zi(r.has)),!ea(t,(function(e,t){if(!1===n.call(r,e))return t()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var ta=O,ra=Ht,na=po;Fn({target:"Set",proto:!0,real:!0,forced:false},{isSupersetOf:function(e){var t=ta(this),r=ra(t.has);return!na(e,(function(e,n){if(!1===r.call(t,e))return n()}),{INTERRUPTED:!0}).stopped}});var oa=O,ia=ji,aa=po;Fn({target:"Set",proto:!0,real:!0,forced:false},{join:function(e){var t=oa(this),r=ia(t),n=void 0===e?",":String(e),o=[];return aa(r,o.push,{that:o,IS_ITERATOR:!0}),o.join(n)}});var ua=H,ca=O,fa=Ht,sa=Vn,la=Eo,pa=ji,ya=po;Fn({target:"Set",proto:!0,real:!0,forced:false},{map:function(e){var t=ca(this),r=pa(t),n=sa(e,arguments.length>1?arguments[1]:void 0,3),o=new(la(t,ua("Set"))),i=fa(o.add);return ya(r,(function(e){i.call(o,n(e,e,t))}),{IS_ITERATOR:!0}),o}});var da=O,ha=Ht,ma=ji,ga=po;Fn({target:"Set",proto:!0,real:!0,forced:false},{reduce:function(e){var t=da(this),r=ma(t),n=arguments.length<2,o=n?void 0:arguments[1];if(ha(e),ga(r,(function(r){n?(n=!1,o=r):o=e(o,r,r,t)}),{IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty set with no initial value");return o}});var va=O,ba=Vn,wa=ji,Ea=po;Fn({target:"Set",proto:!0,real:!0,forced:false},{some:function(e){var t=va(this),r=wa(t),n=ba(e,arguments.length>1?arguments[1]:void 0,3);return Ea(r,(function(e,r){if(n(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Sa=H,Ta=O,Oa=Ht,Aa=Eo,ja=po;Fn({target:"Set",proto:!0,real:!0,forced:false},{symmetricDifference:function(e){var t=Ta(this),r=new(Aa(t,Sa("Set")))(t),n=Oa(r.delete),o=Oa(r.add);return ja(e,(function(e){n.call(r,e)||o.call(r,e)})),r}});var Ia=H,Ra=O,_a=Ht,Pa=Eo,xa=po;
/**
 * @description Utilities for handling and manipulating schema types
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 *
 * Heavily inspired by ECSY
 */
function Ma(e){return Boolean(e&&ArrayBuffer.isView(e)&&!(e instanceof DataView))}function Ca(e,t){return e}function Na(e){return e}function Ua(e,t){if(!1===Mr(e))throw new TypeError(`copyObject: Invalid source object, found ${typeof e}.`);if(!1===Mr(t))throw new TypeError(`copyObject: Invalid destination object, found ${typeof t}.`);return Cr(t,e),t}function Da(e,t,r=0){if(!1===Ma(e))throw new TypeError("copyTypedArray: Expected source to be a typed array.");if(!1===Ma(t))throw new TypeError("copyTypedArray: Expected destination to be a typed array.");if(isNaN(r)||r<0)throw new TypeError("copyTypedArray: Offset must be a positive integer of type Number.");return t.set(e,r),t}function $a(e){if(!1===Ma(e))throw new TypeError("cloneTypedArray: Expected source to be a typed array.");return e.slice()}
/**
 * @name        Schema
 * @description Schemas determine the acceptable shape of component properties
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 * @example
 *              import { Schema, Types } from './schema';
 *
 *              // first, define the shape of the schema:
 *
 *              interface Point {
 *                x: Int32Array,
 *                y: Int32Array,
 *              }
 *
 *              // then, define the schema object:
 *
 *              const Vec2: Schema<Point> = {
 *                // properties can be a SchemaProperty object from the `Types` object:
 *                x: Types.i32,
 *
 *                // or properties can p
 *                x: {
 *                  type: Types.i32,  // get the type from the Types object to avoid undefined behavior
 *                  init: 0,       // define a default property to initialize entities with,
 *                                    // if no default is provided, the default from the type is used
 *                },
 *              }
 *
 *              // the schema can then be used in component creation:
 *
 *              const position = createComponent({
 *                name: "position",
 *                schema: Vec2,
 *              });
 *
 *              const velocity = createComponent({
 *                name: "velocity",
 *                schema: Vec2,
 *              });
 */Fn({target:"Set",proto:!0,real:!0,forced:false},{union:function(e){var t=Ra(this),r=new(Pa(t,Ia("Set")))(t);return xa(e,_a(r.add),{that:r}),r}});const Ba={Array:{copy:function(e,t){if(!Array.isArray(e))throw new TypeError(`copyArray: Source must be an array, found ${typeof e}.`);if(!Array.isArray(t))throw new TypeError(`copyArray: Destination must be an array, found ${typeof t}.`);return t.length=0,e.forEach((e=>t.push(e))),t},clone:function(e){if(!Array.isArray(e))throw new TypeError(`cloneArray: Source must be an array, found ${typeof e}.`);return[...e]},init:[],create:function(e){return new Array(e)}},Boolean:{copy:Ca,clone:Na,init:!1,create:function(e){return Boolean(e)}},JSON:{copy:Ca,clone:Na,init:null,create:function(e,t){return JSON.parse(e,t)}},Map:{copy:function(e,t){if(!(e instanceof Map))throw new TypeError("copyMap: Expected source to be a Map object.");if(!(t instanceof Map))throw new TypeError("copyMap: Expected destination to be a Map object.");return t.clear(),e.forEach(((e,r)=>t.set(r,e))),t},clone:function(e){if(!(e instanceof Map))throw new TypeError("cloneMap: Expected source to be a Map object.");return new Map(e.entries())},init:new Map,create:function(e){return new Map(e)}},Number:{copy:Ca,clone:Na,init:0,create:function(e){return Number(e||this.init)}},Object:{copy:Ua,clone:function(e){return Ua(e,{})},init:{},create:function(e=Object.prototype,t){return Object.create(e,t??{})}},Ref:{copy:Ca,clone:Na,init:void 0,create:function(e){return e}},Set:{copy:function(e,t){if(!(e instanceof Set))throw new TypeError("copySet: Expected source to be a Set object.");if(!(t instanceof Set))throw new TypeError("copySet: Expected destination to be a Set object.");return t.clear(),e.forEach((e=>t.add(e))),t},clone:function(e){if(!(e instanceof Set))throw new TypeError("cloneSet: Expected source to be a Set object.");return new Set(e)},init:new Set,create:function(e){return new Set(e)}},String:{copy:Ca,clone:Na,init:"",create:function(e){return String(e)}},i8:{copy:Da,clone:$a,init:new Int8Array,create:function(e,t,r){return new Int8Array(e,t,r)}},u8:{copy:Da,clone:$a,init:new Uint8Array,create:function(e,t,r){return new Uint8Array(e,t,r)}},u8c:{copy:Da,clone:$a,init:new Uint8ClampedArray,create:function(e,t,r){return new Uint8ClampedArray(e,t,r)}},i16:{copy:Da,clone:$a,init:new Int16Array,create:function(e,t,r){return new Int16Array(e,t,r)}},u16:{copy:Da,clone:$a,init:new Uint16Array,create:function(e,t,r){return new Uint16Array(e,t,r)}},i32:{copy:Da,clone:$a,init:new Int32Array,create:function(e,t,r){return new Int32Array(e,t,r)}},u32:{copy:Da,clone:$a,init:new Uint32Array,create:function(e,t,r){return new Uint32Array(e,t,r)}},f32:{copy:Da,clone:$a,init:new Float32Array,create:function(e,t,r){return new Float32Array(e,t,r)}},f64:{copy:Da,clone:$a,init:new Float64Array,create:function(e,t,r){return new Float64Array(e,t,r)}},i64:{copy:Da,clone:$a,init:new BigInt64Array,create:function(e,t,r){return new BigInt64Array(e,t,r)}},u64:{copy:Da,clone:$a,init:new BigUint64Array,create:function(e,t,r){return new BigUint64Array(e,t,r)}}},ka=Symbol(),Fa=Symbol(),Qa=Object.create(Object.prototype,{[ka]:{value:!0,enumerable:!0,configurable:!1,writable:!1}}),qa={[Fa]:{value:!0,enumerable:!0,configurable:!1,writable:!1}};function za(e){return Mr(e)&&Object.is(Qa,Object.getPrototypeOf(e))}function La(e){return Mr(e)&&!0===e[Fa]}
/**
 * @name        Archetype
 * @description Archetypes are unique groups of components
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 */
const Ya=Symbol(),Va={add:function(e){return this.has(e)||(this.entities.add(e),this[Ya]=!0),this},has:function(e){return this.entities.has(e)},remove:function(e){return this.has(e)?(this.entities.delete(e),this[Ya]=!0,this):this},reset:function(){return this.entities.clear(),this[Ya]=!0,this}};function Ga(e){return Object.create(Va,{[Ya]:{value:!0,configurable:!1,enumerable:!0,writable:!0},entities:{value:new Set,configurable:!1,enumerable:!0,writable:!1},mask:{value:e,configurable:!1,enumerable:!0,writable:!1},name:{value:e.toString(),configurable:!1,enumerable:!0,writable:!1}})}
/**
 * @name        ArchetypeManager
 * @description The archetype manager creates, destroys & assigns archetypes
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 */function Wa(e,t,r){return function(n){const o=t[n];return void 0!==o&&(o.remove(n),0===o.entities.size&&delete e[o.name]),r.add(n),t[n]=r,r}}function Ka(e,t,r){return function(n,o){const i=t[n];if(void 0!==i&&(i.remove(n),0===i.entities.size&&(r.getQueries().forEach((e=>e.remove(i))),delete e[i.name])),void 0===o?.id)throw new TypeError("updateEntityArchetype: Expected component to be an instance!");const a=t[n]?.mask??xr(r.config.maxComponents);!function(e,t){_r(e,t)?Rr(e,t):Ir(e,t)}(a,o.id);const u=a.toString();let c;return u in e?c=e[u]:(c=Ga(a),r.getQueries().forEach((e=>e.isMatch(c))),e[u]=c),c.add(n),t[n]=c,c}}
/**
 * @name        ComponentManager
 * @description The component manager brokers the relationship between components and entities.
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 */
function Ha(e,...t){if(!e)throw new SyntaxError("componentsToMask: a world object is required.");const r=xr(e.config.maxComponents);return t&&t.length?(t.forEach((t=>{if(t.world.id!==e.id)throw new SyntaxError("componentsToMask: all components must be from the same world.");Ir(r,t.id)})),r):r}function Ja(e,t,r){return function(n){if(Object.keys(t).length>=r.config.maxComponents)throw new Error("registerComponent: maximum components reached.");if(!1===za(n))throw new TypeError(`registerComponent: expected Component, found "${typeof n}".`);if(n.name in t)throw new Error(`registerComponent: component "${n.name}" is already registered.`);const o=Pr(e);if(void 0===o)throw new Error("registerComponent: no ids available!");const i=function(e,t){if(!1===za(e))throw new TypeError("createComponentInstance: Invalid component provided.");const{schema:r}=e,{id:n,world:o}=t,i=Object.create(e,qa),a=Object.create(i,{entities:{value:xr(o.config.maxEntities),enumerable:!0,configurable:!1,writable:!1},id:{value:n,enumerable:!0,writable:!1,configurable:!1},world:{value:o,enumerable:!0,writable:!1,configurable:!1},getPropertyArrays:{value:function(){const e=Object.keys(this.schema);return Object.entries(this).filter((([t,r])=>e.includes(t)))},enumerable:!0,writable:!1,configurable:!1}});return Object.entries(r).forEach((([e,t])=>{const{clone:r,create:n,init:i}=t;let u;u=Ma(i)?n(new ArrayBuffer(i.BYTES_PER_ELEMENT*o.config.maxEntities)):new Array(o.config.maxEntities).fill(r(i)),Object.defineProperty(a,e,{value:u,enumerable:!0,configurable:!1,writable:!1})})),a}(n,{id:o,world:r});return Ir(e,o),t[n.name]=i,i}}function Za(e,t,r){return function(n,o=!1){if(!za(n))throw new TypeError(`unregisterComponent: expected Component, found "${typeof n}".`);const i=t[n.name];if(!i)throw new Error(`unregisterComponent: component "${n.name}" is not registered.`);const a=i.entities;return!1!==o&&0!==a.length||(a.forEach((e=>r.removeComponentFromEntity(e,n))),Rr(e,i.id),delete t[n.name]),r}}function Xa(e,t){return function(r,n,o){if(1!==t.getEntityState(r))throw new Error(`addComponentToEntity: Entity "${r}" does not exist in this world.`);if(!1===za(n)&&!1===La(n)&&"string"!=typeof n)throw new TypeError("addComponentToEntity: Invalid component provided.");const i="string"==typeof n?n:n.name,a=e[i];if(!a)throw new Error(`addComponentToEntity: Component "${i}" is not registered in this world.`);if(_r(a.entities,r))throw new Error(`addComponentToEntity: Entity "${r}" already has component "${i}".`);return void 0!==o&&Mr(o)&&Object.keys(o).forEach((e=>{e in a?a[e][r]=o[e]:console.warn(`addComponentToEntity: Key "${e}" does not exist in component "${a.name}".`)})),Ir(a.entities,r),t.updateEntityArchetype(r,a),t}}function eu(e,t){return function(r,n){if(!t.getEntityState(r))throw new Error(`removeComponentFromEntity: entity "${r}" is not active in this world.`);if(!1===za(n)&&!1===La(n)&&"string"!=typeof n)throw new TypeError("removeComponentFromEntity: invalid component provided.");const o="string"==typeof n?n:n.name,i=e[o];if(!i)throw new Error(`removeComponentFromEntity: component "${o}" is not registered in this world.`);if(!1===_r(i.entities,r))throw new Error(`removeComponentFromEntity: entity "${r}" does not have component "${o}" to remove.`);return Rr(i.entities,r),t.updateEntityArchetype(r,i),t}}function tu(e){return function(t,r){const n="string"==typeof r?r:r.name,o=e[n];return void 0!==o&&_r(o.entities,t)}}function ru(e){return function(t,r){const n=e["string"==typeof r?r:r.name];if(void 0===n)throw new Error("getProperty: component not registered.");if(!1!==_r(n.entities,t))return n.getPropertyArrays().reduce(((e,[r,n])=>(e[r]=n[t],e)),{})}}function nu(e){return function(t){return[...Object.values(e)].find((e=>e.id===t))}}function ou(e){return function(t){return e[t]}}function iu(e){return function(){return[...Object.values(e)]}}function au(e){return function(t){return("string"==typeof t?t:t.name)in e}}function uu(e){return function(t){const r=e["string"==typeof t?t:t.name];return r?[...r.entities]:[]}}function cu(e){const t=ru(e);return function(r){return Object.keys(e).reduce(((e,n)=>(e[n]=t(r,n),e)),{})}}function fu(e){return function(t){return e["string"==typeof t?t:t.name]?.id}}function su(e,t){return function(r){t.resetEntityArchetype(r),Object.values(e).forEach((e=>Rr(e.entities,r)))}}
/**
 * @name        EntityManager
 * @description The entity manager creates, destroys and manages the state of entities in the world.
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 */
function lu(e){return function(){const t=Pr(e);if(void 0===t)throw new Error("createEntity: No available entities. Maximum entities reached.");return Ir(e,t),t}}function pu(e,t){return function(r){return _r(e,r)&&(t.stripEntity(r),Rr(e,r)),t}}function yu(e){return function(t){return _r(e,t)}}function du(e){return function(t){return!0===_r(e,t)?1:0}}const hu=Object.create(Object.prototype,{add:{value:function(e){return this.archetypes.includes(e)||this.archetypes.push(e),this},configurable:!1,enumerable:!0,writable:!1},getEntities:{value:function(){if(!Object.keys(this.archetypes)?.length)return[];const e=Object.values(this.archetypes).flatMap((e=>[...e.entities]));return[...new Set(e)]},configurable:!1,enumerable:!0,writable:!1},isMatch:{value:function(e){if(!this.query||!e)return!1;const t=
/**
 * @name        Query
 * @description Queries group Archetypes
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 */
function(e,t){const{mask:r}=t;if(!r)return!1;const n=e[0],o=e[1],i=e[2];for(let e=0,t=i.length;e<t;e++)if(0!=(i[e]&r[e]))return!1;for(let e=0,t=n.length;e<t;e++)if((n[e]&r[e])!==r[e])return!1;for(let e=0,t=o.length;e<t;e++)if((o[e]&r[e])>0)return!1;return!0}(this.query,e);return t&&this.add(e),t},configurable:!1,enumerable:!0,writable:!1},isQuery:{value:!0,configurable:!1,enumerable:!0,writable:!1},remove:{value:function(e){return this.archetypes.includes(e)?(this.archetypes.splice(this.archetypes.indexOf(e),1),this):this},configurable:!1,enumerable:!0,writable:!1}});
/**
 * @name        QueryManager
 * @description Handles the creation, destruction of Queries
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 */
function mu(e){return function(){return[...Object.values(e)]}}function gu(e){return function(t){return Boolean(t.name in e)}}function vu(e,t){const r=bu(t);return function(n){if(!Ur(n.name))throw new Error("Invalid name provided for query.");if(n.name in e)throw new Error(`Query with name "${n.name}" is already registered in this world.`);const o=function(e,t){const{all:r=[],any:n=[],none:o=[],name:i}=t,a=r.every((e=>void 0!==e.id)),u=n.every((e=>void 0!==e.id)),c=o.every((e=>void 0!==e.id));if(!a||!u||!c)throw new TypeError("createQuery: query spec must contain component instances only, not components or strings.");const f=Ha(e,...r),s=Ha(e,...n),l=Ha(e,...o);return Object.create(hu,{archetypes:{value:[],configurable:!1,enumerable:!0,writable:!1},name:{value:i,configurable:!1,enumerable:!0,writable:!1},query:{value:[f,s,l],configurable:!1,enumerable:!0,writable:!1}})}(t,n);return e[o.name]=o,r(o),o}}function bu(e){return function(t){if(!("archetypes"in t))throw new TypeError("invalid query provided.");return e.getArchetypes().forEach((e=>{!0===e[Ya]&&t.isMatch(e)})),t}}function wu(e,t){const r=bu(t);return function(){return Object.values(e).forEach((e=>r(e))),t.getArchetypes().forEach((e=>e[Ya]=!1)),t}}function Eu(e,t){return function(r){return delete e[r.name],t}}
/**
 * @name        StepManager
 * @description Manages the game loop/time step functions
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 */
function Su(e){return function(){return e.getPreSystems().forEach((e=>e.pre(e.entities))),e}}function Tu(e){return function(t=0){return e.getPostSystems().forEach((e=>e.post(e.entities,t))),e.refreshQueries(),e}}function Ou(e,t,r){let n=0,o=null,i=0;const a=Su(r),u=Tu(r),c=Au(r);return function(r=0,f=t){if(null!==o)for(n+=.001*(r-o),i=0,a();n>f;){if(i>=e){n=1;break}c(f),n-=f,i++}o=r,u(n/t)}}function Au(e){return function(t=0){return e.getUpdateSystems().forEach((e=>e.update(e.entities,t))),e}}
/**
 * @description Utilities for handling and manipulating number types
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 */
function ju(e,t,r){return null!=t&&e<t?t:null!=r&&e>r?r:e}
/**
 * @name        System
 * @description Systems provide the functionality for sets of archetypes
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 */const Iu=Object.create(Object.prototype,{isSystem:{value:!0,enumerable:!0,configurable:!1,writable:!1},enabled:{value:!1,enumerable:!0,configurable:!1,writable:!0},disable:{value:function(){return!1===this.enabled},enumerable:!0,configurable:!1,writable:!1},enable:{value:function(){return!0===this.enabled},enumerable:!0,configurable:!1,writable:!1},pre:{value:function(e){},enumerable:!0,configurable:!1,writable:!0},post:{value:function(e,t){},enumerable:!0,configurable:!1,writable:!0},update:{value:function(e,t){},enumerable:!0,configurable:!1,writable:!0}});
/**
 * @name        SystemManager
 * @description Manages the creation, destruction of Systems
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 */
function Ru(e){return function(){return[...e]}}function _u(e){return function(){return e.filter((e=>"post"in e))}}function Pu(e){return function(){return e.filter((e=>"pre"in e))}}function xu(e){return function(){return e.filter((e=>"update"in e))}}function Mu(e){return function(t){return e[t]}}function Cu(e){return function(t){return e[t]}}function Nu(e){return function(t){return t.name in e}}function Uu(e){return function(t,r){const n=e.indexOf(t);if(-1===n)return-1;const o=ju(r,0,e.length);return e.splice(o,1),e.splice(n,0,t),o}}function Du(e,t){return function(r,n){if(!Ur(r.name))throw new SyntaxError(`"${r.name}" is not a valid system name.`);if(r.name in t)throw new Error(`System "${r.name}" is already registered!`);if(!r.pre&&!r.post&&!r.update)throw new SyntaxError('No functions provided for system. Please provide a "pre"');const o=function(e){const{name:t,query:r,pre:n,post:o,update:i}=e,a=Object.create(Iu,{name:{value:t,enumerable:!0,configurable:!1,writable:!1},query:{value:r,enumerable:!0,configurable:!1,writable:!1},entities:{get(){return this.query?.getEntities()??[]},enumerable:!0,configurable:!1}});return n&&(a.pre=n),o&&(a.post=o),i&&(a.update=i),a}(r);return void 0!==n?e.splice(ju(n,0,e.length),0,o):e.push(o),t[o.name]=o,o}}function $u(e,t,r){return function(n){if(!(n.name in t))throw new Error(`System "${n.name}" is not registered!`);delete t[n.name];const o=e.indexOf(n);return o>-1&&e.splice(o,1),r}}exports.Types=Ba,exports.createComponent=function(e){const{name:r,schema:n}=e;if(!Ur(r))throw new SyntaxError("createComponent: supplied name is invalid.");if(!function(e){return Boolean(Mr(e)&&Object.keys(e).length>0)}(n))throw new TypeError(`createComponent: Schema for "${r}" is invalid.`);return Object.create(Qa,{name:{value:r,enumerable:!0,configurable:!1,writable:!1},schema:{value:t({},n),enumerable:!0,configurable:!1,writable:!1}})},exports.createWorld=
/**
 * @name        World
 * @description The primary context for the ECS.
 * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
 * @copyright   2021 P. Hughes. All rights reserved.
 * @license     MIT
 */
function(e={}){const{maxComponents:t=256,maxEntities:r=1e5,maxUpdates:n=240,tempo:o=1/60}=e,i={config:Object.freeze({maxComponents:t,maxEntities:r,maxUpdates:n,tempo:o}),id:`${Date.now().toString(36)}_${Math.random().toString(36).substr(2,9)}`};return Object.assign(i,function(e){const{maxComponents:t,maxEntities:r}=e.config,n=Ga(xr(t)),o={},i=new Array(r).fill(n);return{archetypeHasComponent:function(e,t){return _r(e.mask,t.id)},getArchetypes:(u=o,function(){return[...Object.values(u)]}),getEntityArchetype:(a=i,function(e){return a[e]}),resetEntityArchetype:Wa(o,i,n),updateEntityArchetype:Ka(o,i,e)};var a,u}(i),function(e){const{maxComponents:t}=e.config,r=xr(t),n={};return{addComponentToEntity:Xa(n,e),collateEntityProperties:cu(n),entityHasComponent:tu(n),getComponentById:nu(n),getComponentByName:ou(n),getComponentId:fu(n),getComponents:iu(n),getEntitiesWithComponent:uu(n),getProperties:ru(n),isComponentRegistered:au(n),registerComponent:Ja(r,n,e),removeComponentFromEntity:eu(n,e),stripEntity:su(n,e),unregisterComponent:Za(r,n,e)}}(i),function(e){const{maxEntities:t}=e.config,r=xr(t);return{createEntity:lu(r),destroyEntity:pu(r,e),getEntityState:du(r),isEntityRegistered:yu(r)}}(i),function(e){const t={};return{getQueries:mu(t),isQueryRegistered:gu(t),registerQuery:vu(t,e),refreshQuery:bu(e),refreshQueries:wu(t,e),unregisterQuery:Eu(t,e)}}(i),function(e){const{maxUpdates:t,tempo:r}=e.config;return{pre:Su(e),post:Tu(e),step:Ou(t,r,e),update:Au(e)}}(i),function(e){const t=[],r={};return{getSystems:Ru(t),getPostSystems:_u(t),getPreSystems:Pu(t),getUpdateSystems:xu(t),getSystemByIdx:Mu(t),getSystemByName:Cu(r),isSystemRegistered:Nu(r),moveSystem:Uu(t),registerSystem:Du(t,r),unregisterSystem:$u(t,r,e)}}(i)),i};
//# sourceMappingURL=index.min.js.map
