{"version":3,"file":"index.min.js","sources":["../../src/mask.ts","../../src/entity.ts","../../src/pool.ts","../../src/world.ts","../../src/component.ts","../../src/system.ts"],"sourcesContent":["// Copyright (c) 2021 P. Hughes. All rights reserved. MIT license.\n\"use strict\";\n\nexport type Mask = Readonly<{\n  value: bigint;\n  has(n: bigint): boolean;\n  set(n: bigint): void;\n  test(n: bigint): boolean;\n  toggle(n: bigint): void;\n  toString(): string;\n  unset(n: bigint): void;\n}>;\n\nexport function combineMasks(...masks: Mask[]): Mask {\n  let n = 0n;\n  masks.forEach((mask) => n |= mask.value);\n  return createMask(n);\n}\n\nexport function createMask(n: bigint): Mask {\n  if (typeof n === 'number') n = BigInt(n);\n\n  let { mask } = { mask: 1n << n };\n\n  const getters = {\n    get value(): bigint {\n      return mask;\n    }\n  };\n\n  const has = function(n: bigint): boolean {\n    if (typeof n === 'number') {\n      n = BigInt(n);\n    }\n    return Boolean((mask & n) === mask);\n  };\n\n  const set = function(n: bigint): void {\n    if (typeof n === 'number') {\n      n = BigInt(n);\n    }\n    mask |= (1n << n);\n  };\n\n  const test = function(n: bigint): boolean {\n    if (typeof n === 'number') {\n      n = BigInt(n);\n    }\n    return Boolean((mask & (1n << n)) !== 0n);\n  };\n\n  const toggle = function(n: bigint): void {\n    if (typeof n === 'number') {\n      n = BigInt(n);\n    }\n    mask ^= (1n << n);\n  };\n\n  const toString = function(): string {\n    return mask.toString(2);\n  };\n\n  const unset = function(n: bigint): void {\n    if (typeof n === 'number') {\n      n = BigInt(n);\n    }\n    mask &= ~(1n << n);\n  };\n\n  return Object.freeze(\n    Object.assign(\n      getters,\n      {\n        has,\n        set,\n        test,\n        toggle,\n        toString,\n        unset,\n      }\n    )\n  );\n}\n","// Copyright (c) 2021 P. Hughes. All rights reserved. MIT license.\n\"use strict\";\n\nimport { Component } from './component';\nimport { createMask } from './mask';\n\nexport type Entity = Readonly<{\n  /** The entity's archetype */\n  archetype: bigint,\n  /** Array of components associated with the entity */\n  allComponents: Component<unknown>[],\n  /** The entity's id */\n  id: bigint,\n  /** Check if a component is present in an entity */\n  hasComponent(component: Component<unknown>): boolean,\n  /** @hidden */\n  _setId(id: bigint): Entity,\n  /** @hidden */\n  _addComponent(component: Component<unknown>): Entity,\n  /** @hidden */\n  _removeComponent(component: Component<unknown>): Entity,\n}>\n\n/** Create an new entity */\nexport function _createEntity(): Entity {\n  const {\n    archetype,\n    components,\n    componentObjects,\n  } = {\n    archetype: createMask(0n),\n    components: {} as Record<string, unknown>,\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n    componentObjects: new Set() as Set<Component<unknown>>,\n  };\n\n  let { _id } = { _id: 0n };\n\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n  const data = Object.create(\n    { components },\n    {\n      /** @returns the entity's archetype */\n      archetype: {\n        get: function(): bigint {\n          return archetype.value;\n        }\n      },\n\n      allComponents: {\n        get: function(): Component<unknown>[] {\n          return Array.from(componentObjects);\n        }\n      },\n\n      /** @returns the entity's id */\n      id: {\n        get: function(): bigint {\n          return _id;\n        }\n      }\n    }\n  );\n\n  /** @hidden */\n  const _setId = function(id: bigint): void {\n    _id = id;\n  };\n\n  /** @hidden */\n  const _addComponent = function<T>(component: Component<T>): void {\n    if (!components[component.name]) {\n      components[component.name] = {...component.properties};\n      archetype.set(component.id);\n      componentObjects.add(component);\n    }\n  };\n\n  /** @hidden */\n  const _removeComponent = function<T>(component: Component<T>): void {\n    if (components[component.name]) {\n      delete components[component.name];\n      archetype.unset(component.id);\n      componentObjects.delete(component);\n    }\n  };\n\n  /**\n   * Check if a component is present in the entity\n   * @param component the component or component name to test for\n   */\n  const hasComponent = function<T>(component: Component<T> | string): boolean {\n    const name = (typeof component === 'string') ? component : component.name;\n    return Boolean(components[name]);\n  };\n\n  return Object.freeze(\n    Object.assign(\n      data,\n      {\n        _setId,\n        _addComponent,\n        _removeComponent,\n        hasComponent,\n      }\n    )\n  ) as Entity;\n}","// Copyright (c) 2021 P. Hughes. All rights reserved. MIT license.\n\"use strict\";\n\nexport interface PoolSpec<T> {\n  initialSize?: number | bigint,\n  create: (() => T),\n  destroy: ((obj: T) => T),\n}\n\nexport interface Pool<T> {\n  get(): T,\n  release(obj: T): void,\n}\n\nexport function _createPool<T>(spec: PoolSpec<T>): Pool<T> {\n  const {\n    initialSize = 2,\n    create,\n    destroy\n  } = { ...spec };\n\n  const pool = [] as T[];\n\n  // populate pool to initial size\n  for (let i = 0; i < initialSize; i++) {\n    pool.push(create());\n  }\n\n  const get = function(): T {\n    return pool.pop() ?? create();\n  };\n\n  const release = function(obj: T): void {\n    pool.push(destroy(obj));\n  };\n\n  return Object.freeze({\n    get,\n    release,\n  });\n}","// Copyright (c) 2021 P. Hughes. All rights reserved. MIT license.\n\"use strict\";\n\nimport { Component, ComponentSpec, _createComponent } from './component';\nimport { Entity, _createEntity } from './entity';\nimport { _createPool } from './pool';\nimport { System, SystemSpec, _createSystem } from './system';\n\ninterface WorldSpec {\n  initialPoolSize?: number | bigint;\n  maxComponents?: number | bigint;\n}\n\ninterface World {\n  archetypes: [bigint, Entity[]][],\n  components: Component<unknown>[],\n  entities: Entity[],\n  systems: System[],\n  createEntity(): Entity,\n  removeEntity(entity: Entity): boolean,\n  createComponent<T>(spec: ComponentSpec<T>): Component<T>,\n  removeComponent<T>(component: Component<T>): boolean,\n  addComponentsToEntity(entity: Entity, ...components: Component<unknown>[]): Entity,\n  removeComponentsFromEntity(entity: Entity, ...components: Component<unknown>[]): Entity,\n  createSystem(spec: SystemSpec, idx?: number): System,\n  removeSystem(system: System): boolean,\n  update(dt: number): void,\n  render(int: number): void,\n}\n\nexport function createWorld(spec: WorldSpec): World {\n  // world config\n  const {\n    initialPoolSize = 10,\n    maxComponents = 1024n,\n  } = { ...spec };\n\n  // constants\n  const {\n    archetypes,\n    components,\n    entities,\n    systems,\n    entityPool,\n  } = {\n    archetypes: new Map() as Map<bigint, Entity[]>,\n    components: new Map() as Map<string, Component<unknown>>,\n    entities: new Map() as Map<bigint, Entity>,\n    systems: [] as System[],\n    entityPool: _createPool({create: _createEntity, destroy: _destroyEntity, initialSize: initialPoolSize}),\n  };\n\n  // variables\n  let {\n    componentCount,\n    entityCount,\n    systemCount,\n  } = {\n    componentCount: 0n,\n    entityCount: 0n,\n    systemCount: 0n,\n  };\n\n  /** @private **/\n  const addEntityToArchetypeArray = (entity: Entity) => {\n    const archetype = archetypes.get(entity.archetype);\n    if (!archetype) {\n      archetypes.set(entity.archetype, [entity]);\n    } else {\n      if (!archetype.includes(entity)) {\n        archetype.push(entity);\n      }\n    }\n  };\n\n  /** @private */\n  const removeEntityFromArchetypeArray = (entity: Entity) => {\n    const archetype = archetypes.get(entity.archetype);\n    const idx = archetype?.indexOf(entity);\n    if (idx !== undefined && idx > -1) {\n      archetype?.splice(idx, 1);\n    }\n  };\n\n  /** @private */\n  function _destroyEntity(entity: Entity): Entity {\n    entity._setId(-1n);\n    removeComponentsFromEntity(entity, ...entity.allComponents);\n    removeEntityFromArchetypeArray(entity);\n    return entity;\n  }\n\n  const getters = {\n    get archetypes() {\n      return Array.from(archetypes.entries());\n    },\n\n    /** @returns an array of components in the world */\n    get components() {\n      return Array.from(components.values());\n    },\n\n    /** @returns an array of entities in the world */\n    get entities() {\n      return Array.from(entities.values());\n    },\n\n    /** @returns an array of systems in the world */\n    get systems() {\n      return Array.from(systems);\n    },\n  };\n\n  /**\n   * Create a new entity\n   * @returns a new entity\n   */\n  const createEntity = function(): Entity {\n    const entity = entityPool.get();\n    const id = ++entityCount;\n    entity._setId(id);\n    entities.set(id, entity);\n    addEntityToArchetypeArray(entity);\n    return entity;\n  };\n\n  /**\n   * Remove an entity from the world\n   * and disassociate it from any components in the world\n   * @param entity the entity to remove\n   * @returns true if removed, false if entity not found\n   */\n  const removeEntity = function(entity: Entity): boolean {\n    const b = entities.delete(entity.id);\n    if (b) {\n      entityPool.release(entity);\n    }\n    return b;\n  };\n\n  /**\n   * Create a new component\n   * @param spec the component's specification object\n   * @returns the created component\n   */\n  const createComponent = function<T>(spec: ComponentSpec<T>): Component<T> {\n    if (maxComponents && componentCount > maxComponents) {\n      throw new Error('Maximum component count reached.');\n    }\n    const id = ++componentCount;\n    const component = _createComponent({...spec, id});\n    components.set(component.name, component);\n    return component;\n  };\n\n  /**\n   * Remove a component from the world\n   * and disassociate it from any entities\n   * @param component the component to remove\n   * @returns true if removed, false if component not found\n   */\n  const removeComponent = function<T>(component: Component<T>): boolean {\n    const b = components.delete(component.name);\n    if (b) {\n      component.entities.forEach((entity) => entity._removeComponent(component));\n    }\n    return b;\n  };\n\n  /**\n   * Associate components with an entity\n   * @param entity the entity to add components to\n   * @param components one or more component objects\n   */\n  const addComponentsToEntity = function(entity: Entity, ...components: Component<unknown>[]): Entity {\n    removeEntityFromArchetypeArray(entity);\n    components.forEach((component) => {\n      entity._addComponent(component);\n      component._addEntity(entity);\n    });\n    addEntityToArchetypeArray(entity);\n    return entity;\n  };\n\n  /**\n   * Disassociate components from an entity\n   * @param entity the entity to remove components from\n   * @param components one or more component objects\n   */\n  const removeComponentsFromEntity = function(entity: Entity, ...components: Component<unknown>[]): Entity {\n    removeEntityFromArchetypeArray(entity);\n    components.forEach((component) => {\n      entity._removeComponent(component);\n      component._removeEntity(entity);\n    });\n    addEntityToArchetypeArray(entity);\n    return entity;\n  };\n\n  /**\n   * Create an new system\n   * @param spec the system's specification object\n   * @param idx optional execution index (i.e. 0 gets called first);\n   * @returns the created system\n   */\n  const createSystem = function(spec: SystemSpec, idx?: number): System {\n    const id = ++systemCount;\n    const system = _createSystem({...spec, id});\n    if (idx !== undefined) {\n      systems.splice(idx, 0, system);\n    } else {\n      systems.push(system);\n    }\n    return system;\n  };\n\n  /**\n   * Remove a system from the world\n   * @param system the system to remove\n   * @returns true if remove, false if system not found\n   */\n  const removeSystem = function(system: System): boolean {\n    const idx = systems.indexOf(system);\n    if (idx > -1) {\n      systems.splice(idx, 1);\n      return true;\n    }\n    return false;\n  };\n\n  /**\n   * Call update on all systems\n   * @param dt frame delta time\n   */\n  const update = function(dt: number): void {\n    systems.forEach((system) => {\n      if (system.enabled) {\n        /** @todo make this more efficient */\n        const entities = Array.from(archetypes.entries()).reduce((arr, [archetype, ents]) => {\n          if ((system.archetype & archetype) === system.archetype) {\n            arr.push(...ents);\n          }\n          return arr;\n        }, [] as Entity[]);\n        system.update(dt, entities);\n      }\n    });\n  };\n\n  /**\n   * Call render on all systems\n   * @param int frame interpolation\n   */\n  const render = function(int: number): void {\n    systems.forEach((system) => {\n      if (system.enabled) {\n        /** @todo make this more efficient */\n        const entities = Array.from(archetypes.entries()).reduce((arr, [archetype, ents]) => {\n          if ((system.archetype & archetype) === system.archetype) {\n            arr.push(...ents);\n          }\n          return arr;\n        }, [] as Entity[]);\n        system.render(int, entities);\n      }\n    });\n  };\n\n\n\n  return Object.freeze(\n    Object.assign(\n      getters,\n      {\n        createEntity,\n        removeEntity,\n        createComponent,\n        removeComponent,\n        addComponentsToEntity,\n        removeComponentsFromEntity,\n        createSystem,\n        removeSystem,\n        update,\n        render,\n      }\n    )\n  );\n}\n\n\n","// Copyright (c) 2021 P. Hughes. All rights reserved. MIT license.\n\"use strict\";\n\nimport { Entity } from './entity';\n\n/** Component specification object */\nexport type ComponentSpec<T> = Omit<InternalComponentSpec<T>, \"id\">;\n\n/** Internal component specification object */\ninterface InternalComponentSpec<T> {\n  id: bigint,\n  name: string,\n  properties: T,\n}\n\nexport interface Component<T> {\n  id: Readonly<bigint>,\n  name: Readonly<string>,\n  entities: Readonly<Entity[]>,\n  properties: T,\n  /** Check if an entity is associated with this category */\n  hasEntity(entity: Entity): boolean\n  /** @hidden */\n  _addEntity(entity: Entity): void,\n  /** @hidden */\n  _removeEntity(entity: Entity): void,\n}\n\n/**\n * Creates a new component object\n * @param spec the components specification object\n */\nexport function _createComponent<T>(spec: InternalComponentSpec<T>): Component<T> {\n  const { id, name, properties } = { ...spec };\n\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n  const { entities } = { entities: new Set() as Set<Entity> };\n\n  const getters = {\n    get id(): bigint {\n      return id;\n    },\n\n    get name(): string {\n      return name;\n    },\n\n    /** @returns an array of entities associated with this component */\n    get entities(): Entity[] {\n      return Array.from(entities);\n    },\n\n    /** @returns the default properties of this component */\n    get properties(): T {\n      return properties;\n    }\n  };\n\n  /**\n   * @hidden\n   * Associate an entity with this component\n   * @param entity the entity to associate\n   * @returns this component\n   */\n  const _addEntity = function(entity: Entity): void {\n    entities.add(entity);\n  };\n\n  /**\n   * @hidden\n   * Disassociate an entity from this component\n   * @param entity the entity to disassociate\n   * @returns this component\n   */\n  const _removeEntity = function(entity: Entity): void {\n    entities.delete(entity);\n  };\n\n  const hasEntity = function(entity: Entity): boolean {\n    return entities.has(entity);\n  };\n\n  return Object.freeze(\n    Object.assign(\n      getters,\n      {\n        hasEntity,\n        _addEntity,\n        _removeEntity,\n      }\n    )\n  );\n}\n\n","// Copyright (c) 2021 P. Hughes. All rights reserved. MIT license.\n\"use strict\";\n\nimport { Component } from './component';\nimport { Entity } from './entity';\nimport { createMask } from './mask';\n\nexport type SystemSpec = Omit<InternalSystemSpec, \"id\">;\n\ninterface InternalSystemSpec {\n  id: bigint,\n  updateFn?: (dt: number, entities: Entity[]) => void,\n  renderFn?: (int: number, entities: Entity[]) => void,\n  components: Component<unknown>[],\n}\n\nexport type System = Readonly<{\n  archetype: bigint,\n  enabled: boolean,\n  id: bigint,\n  enable(): void,\n  disable(): void,\n  update(dt: number, entities: Entity[]): void,\n  render(int: number, entities: Entity[]): void,\n}>;\n\nexport function _createSystem(spec: InternalSystemSpec): System {\n  const {\n    id,\n    components = [],\n    updateFn = (() => void 0),\n    renderFn = (() => void 0),\n  } = { ...spec };\n\n  const { archetype } = { archetype: createMask(0n) };\n  let { enabled } = { enabled: false };\n\n  components.forEach((component) => archetype.set(component.id));\n\n  const getters = {\n    get id(): bigint {\n      return id;\n    },\n\n    get archetype(): bigint {\n      return archetype.value;\n    },\n\n    get enabled(): boolean {\n      return enabled;\n    },\n  };\n\n  const enable = function(): void {\n    enabled = true;\n  };\n\n  const disable = function(): void {\n    enabled = false;\n  };\n\n  const update = function(dt: number, entities: Entity[]): void {\n    updateFn(dt, entities);\n  };\n\n  const render = function(int: number, entities: Entity[]): void {\n    renderFn(int, entities);\n  };\n\n  return Object.freeze(\n    Object.assign(\n      getters,\n      {\n        enable,\n        disable,\n        update,\n        render,\n      }\n    )\n  );\n}\n"],"names":["createMask","n","BigInt","mask","getters","value","Object","freeze","assign","has","Boolean","set","test","toggle","toString","unset","_createEntity","archetype","components","componentObjects","Set","_id","data","create","get","allComponents","Array","from","id","_setId","_addComponent","component","name","properties","add","_removeComponent","delete","hasComponent","_createPool","spec","initialSize","destroy","pool","i","push","pop","release","obj","createWorld","initialPoolSize","maxComponents","archetypes","entities","systems","entityPool","Map","_destroyEntity","entity","removeComponentsFromEntity","removeEntityFromArchetypeArray","componentCount","entityCount","systemCount","addEntityToArchetypeArray","includes","idx","indexOf","undefined","splice","entries","values","forEach","_removeEntity","createEntity","removeEntity","b","createComponent","Error","_createComponent","hasEntity","_addEntity","removeComponent","addComponentsToEntity","createSystem","system","_createSystem","updateFn","renderFn","enabled","enable","disable","update","dt","render","int","removeSystem","reduce","arr","ents"],"mappings":"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"}