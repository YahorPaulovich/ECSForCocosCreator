/*! *****************************************************************************
 *
 * miski
 * v0.3.0
 *
 * MIT License
 * 
 * Copyright (C) 2021 Peter Hughes<https://www.phugh.es>, all rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
***************************************************************************** */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):(t="undefined"!=typeof globalThis?globalThis:t||self,function(){var r=t.miski,n=t.miski={};e(n),n.noConflict=function(){return t.miski=r,n}}())}(this,(function(t){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=function(t){return t&&t.Math==Math&&t},n=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof e&&e)||function(){return this}()||Function("return this")(),o={},i=function(t){try{return!!t()}catch(t){return!0}},a=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),s={},u={}.propertyIsEnumerable,c=Object.getOwnPropertyDescriptor,f=c&&!u.call({1:2},1);s.f=f?function(t){var e=c(this,t);return!!e&&e.enumerable}:u;var l=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},h={}.toString,p=function(t){return h.call(t).slice(8,-1)},d=p,y="".split,g=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},m=i((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==d(t)?y.call(t,""):Object(t)}:Object,v=g,E=function(t){return m(v(t))},_=function(t){return"object"==typeof t?null!==t:"function"==typeof t},w=_,S=function(t,e){if(!w(t))return t;var r,n;if(e&&"function"==typeof(r=t.toString)&&!w(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!w(n=r.call(t)))return n;if(!e&&"function"==typeof(r=t.toString)&&!w(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")},b=g,T=function(t){return Object(b(t))},O={}.hasOwnProperty,R=function(t,e){return O.call(T(t),e)},A=_,I=n.document,P=A(I)&&A(I.createElement),j=function(t){return P?I.createElement(t):{}},N=!a&&!i((function(){return 7!=Object.defineProperty(j("div"),"a",{get:function(){return 7}}).a})),x=a,k=s,M=l,C=E,D=S,z=R,$=N,U=Object.getOwnPropertyDescriptor;o.f=x?U:function(t,e){if(t=C(t),e=D(e,!0),$)try{return U(t,e)}catch(t){}if(z(t,e))return M(!k.f.call(t,e),t[e])};var B={},F=_,G=function(t){if(!F(t))throw TypeError(String(t)+" is not an object");return t},Q=a,L=N,q=G,K=S,V=Object.defineProperty;B.f=Q?V:function(t,e,r){if(q(t),e=K(e,!0),q(r),L)try{return V(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(t[e]=r.value),t};var W=B,Y=l,Z=a?function(t,e,r){return W.f(t,e,Y(1,r))}:function(t,e,r){return t[e]=r,t},H={exports:{}},J=n,X=Z,tt=function(t,e){try{X(J,t,e)}catch(r){J[t]=e}return e},et=tt,rt="__core-js_shared__",nt=n[rt]||et(rt,{}),ot=nt,it=Function.toString;"function"!=typeof ot.inspectSource&&(ot.inspectSource=function(t){return it.call(t)});var at=ot.inspectSource,st=at,ut=n.WeakMap,ct="function"==typeof ut&&/native code/.test(st(ut)),ft={exports:{}},lt=nt;(ft.exports=function(t,e){return lt[t]||(lt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var ht,pt,dt,yt=0,gt=Math.random(),mt=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++yt+gt).toString(36)},vt=ft.exports,Et=mt,_t=vt("keys"),wt={},St=ct,bt=_,Tt=Z,Ot=R,Rt=nt,At=function(t){return _t[t]||(_t[t]=Et(t))},It=wt,Pt="Object already initialized",jt=n.WeakMap;if(St||Rt.state){var Nt=Rt.state||(Rt.state=new jt),xt=Nt.get,kt=Nt.has,Mt=Nt.set;ht=function(t,e){if(kt.call(Nt,t))throw new TypeError(Pt);return e.facade=t,Mt.call(Nt,t,e),e},pt=function(t){return xt.call(Nt,t)||{}},dt=function(t){return kt.call(Nt,t)}}else{var Ct=At("state");It[Ct]=!0,ht=function(t,e){if(Ot(t,Ct))throw new TypeError(Pt);return e.facade=t,Tt(t,Ct,e),e},pt=function(t){return Ot(t,Ct)?t[Ct]:{}},dt=function(t){return Ot(t,Ct)}}var Dt={set:ht,get:pt,has:dt,enforce:function(t){return dt(t)?pt(t):ht(t,{})},getterFor:function(t){return function(e){var r;if(!bt(e)||(r=pt(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return r}}},zt=n,$t=Z,Ut=R,Bt=tt,Ft=at,Gt=Dt.get,Qt=Dt.enforce,Lt=String(String).split("String");(H.exports=function(t,e,r,n){var o,i=!!n&&!!n.unsafe,a=!!n&&!!n.enumerable,s=!!n&&!!n.noTargetGet;"function"==typeof r&&("string"!=typeof e||Ut(r,"name")||$t(r,"name",e),(o=Qt(r)).source||(o.source=Lt.join("string"==typeof e?e:""))),t!==zt?(i?!s&&t[e]&&(a=!0):delete t[e],a?t[e]=r:$t(t,e,r)):a?t[e]=r:Bt(e,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&Gt(this).source||Ft(this)}));var qt=n,Kt=n,Vt=function(t){return"function"==typeof t?t:void 0},Wt=function(t,e){return arguments.length<2?Vt(qt[t])||Vt(Kt[t]):qt[t]&&qt[t][e]||Kt[t]&&Kt[t][e]},Yt={},Zt=Math.ceil,Ht=Math.floor,Jt=function(t){return isNaN(t=+t)?0:(t>0?Ht:Zt)(t)},Xt=Jt,te=Math.min,ee=function(t){return t>0?te(Xt(t),9007199254740991):0},re=Jt,ne=Math.max,oe=Math.min,ie=E,ae=ee,se=function(t,e){var r=re(t);return r<0?ne(r+e,0):oe(r,e)},ue=function(t){return function(e,r,n){var o,i=ie(e),a=ae(i.length),s=se(n,a);if(t&&r!=r){for(;a>s;)if((o=i[s++])!=o)return!0}else for(;a>s;s++)if((t||s in i)&&i[s]===r)return t||s||0;return!t&&-1}},ce={includes:ue(!0),indexOf:ue(!1)},fe=R,le=E,he=ce.indexOf,pe=wt,de=function(t,e){var r,n=le(t),o=0,i=[];for(r in n)!fe(pe,r)&&fe(n,r)&&i.push(r);for(;e.length>o;)fe(n,r=e[o++])&&(~he(i,r)||i.push(r));return i},ye=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype");Yt.f=Object.getOwnPropertyNames||function(t){return de(t,ye)};var ge={};ge.f=Object.getOwnPropertySymbols;var me=Yt,ve=ge,Ee=G,_e=Wt("Reflect","ownKeys")||function(t){var e=me.f(Ee(t)),r=ve.f;return r?e.concat(r(t)):e},we=R,Se=_e,be=o,Te=B,Oe=i,Re=/#|\.prototype\./,Ae=function(t,e){var r=Pe[Ie(t)];return r==Ne||r!=je&&("function"==typeof e?Oe(e):!!e)},Ie=Ae.normalize=function(t){return String(t).replace(Re,".").toLowerCase()},Pe=Ae.data={},je=Ae.NATIVE="N",Ne=Ae.POLYFILL="P",xe=Ae,ke=n,Me=o.f,Ce=Z,De=H.exports,ze=tt,$e=function(t,e){for(var r=Se(e),n=Te.f,o=be.f,i=0;i<r.length;i++){var a=r[i];we(t,a)||n(t,a,o(e,a))}},Ue=xe,Be=function(t,e){var r,n,o,i,a,s=t.target,u=t.global,c=t.stat;if(r=u?ke:c?ke[s]||ze(s,{}):(ke[s]||{}).prototype)for(n in e){if(i=e[n],o=t.noTargetGet?(a=Me(r,n))&&a.value:r[n],!Ue(u?n:s+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;$e(i,o)}(t.sham||o&&o.sham)&&Ce(i,"sham",!0),De(r,n,i,t)}},Fe=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Ge=G,Qe=Fe,Le=function(){for(var t=Ge(this),e=Qe(t.add),r=0,n=arguments.length;r<n;r++)e.call(t,arguments[r]);return t};Be({target:"Set",proto:!0,real:!0,forced:false},{addAll:function(){return Le.apply(this,arguments)}});var qe=G,Ke=Fe,Ve=function(){for(var t,e=qe(this),r=Ke(e.delete),n=!0,o=0,i=arguments.length;o<i;o++)t=r.call(e,arguments[o]),n=n&&t;return!!n},We=Ve;Be({target:"Set",proto:!0,real:!0,forced:false},{deleteAll:function(){return We.apply(this,arguments)}});var Ye,Ze,He=Wt("navigator","userAgent")||"",Je=n.process,Xe=Je&&Je.versions,tr=Xe&&Xe.v8;tr?Ze=(Ye=tr.split("."))[0]<4?1:Ye[0]+Ye[1]:He&&(!(Ye=He.match(/Edge\/(\d+)/))||Ye[1]>=74)&&(Ye=He.match(/Chrome\/(\d+)/))&&(Ze=Ye[1]);var er=Ze&&+Ze,rr=i,nr=!!Object.getOwnPropertySymbols&&!rr((function(){return!String(Symbol())||!Symbol.sham&&er&&er<41})),or=nr&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ir=n,ar=ft.exports,sr=R,ur=mt,cr=nr,fr=or,lr=ar("wks"),hr=ir.Symbol,pr=fr?hr:hr&&hr.withoutSetter||ur,dr=function(t){return sr(lr,t)&&(cr||"string"==typeof lr[t])||(cr&&sr(hr,t)?lr[t]=hr[t]:lr[t]=pr("Symbol."+t)),lr[t]},yr=G,gr=Fe,mr=dr("species"),vr=function(t,e){var r,n=yr(t).constructor;return void 0===n||null==(r=yr(n)[mr])?e:gr(r)},Er={},_r=Er,wr=dr("iterator"),Sr=Array.prototype,br=Fe,Tr=function(t,e,r){if(br(t),void 0===e)return t;switch(r){case 0:return function(){return t.call(e)};case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,o){return t.call(e,r,n,o)}}return function(){return t.apply(e,arguments)}},Or={};Or[dr("toStringTag")]="z";var Rr="[object z]"===String(Or),Ar=p,Ir=dr("toStringTag"),Pr="Arguments"==Ar(function(){return arguments}()),jr=Rr?Ar:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Ir))?r:Pr?Ar(e):"Object"==(n=Ar(e))&&"function"==typeof e.callee?"Arguments":n},Nr=Er,xr=dr("iterator"),kr=function(t){if(null!=t)return t[xr]||t["@@iterator"]||Nr[jr(t)]},Mr=G,Cr=G,Dr=function(t){return void 0!==t&&(_r.Array===t||Sr[wr]===t)},zr=ee,$r=Tr,Ur=kr,Br=function(t){var e=t.return;if(void 0!==e)return Mr(e.call(t)).value},Fr=function(t,e){this.stopped=t,this.result=e},Gr=function(t,e,r){var n,o,i,a,s,u,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_ITERATOR),p=!(!r||!r.INTERRUPTED),d=$r(e,f,1+l+p),y=function(t){return n&&Br(n),new Fr(!0,t)},g=function(t){return l?(Cr(t),p?d(t[0],t[1],y):d(t[0],t[1])):p?d(t,y):d(t)};if(h)n=t;else{if("function"!=typeof(o=Ur(t)))throw TypeError("Target is not iterable");if(Dr(o)){for(i=0,a=zr(t.length);a>i;i++)if((s=g(t[i]))&&s instanceof Fr)return s;return new Fr(!1)}n=o.call(t)}for(u=n.next;!(c=u.call(n)).done;){try{s=g(c.value)}catch(t){throw Br(n),t}if("object"==typeof s&&s&&s instanceof Fr)return s}return new Fr(!1)},Qr=Wt,Lr=G,qr=Fe,Kr=vr,Vr=Gr;Be({target:"Set",proto:!0,real:!0,forced:false},{difference:function(t){var e=Lr(this),r=new(Kr(e,Qr("Set")))(e),n=qr(r.delete);return Vr(t,(function(t){n.call(r,t)})),r}});var Wr=G,Yr=kr,Zr=function(t){return Set.prototype.values.call(t)},Hr=G,Jr=Tr,Xr=Zr,tn=Gr;Be({target:"Set",proto:!0,real:!0,forced:false},{every:function(t){var e=Hr(this),r=Xr(e),n=Jr(t,arguments.length>1?arguments[1]:void 0,3);return!tn(r,(function(t,r){if(!n(t,t,e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var en=Wt,rn=G,nn=Fe,on=Tr,an=vr,sn=Zr,un=Gr;Be({target:"Set",proto:!0,real:!0,forced:false},{filter:function(t){var e=rn(this),r=sn(e),n=on(t,arguments.length>1?arguments[1]:void 0,3),o=new(an(e,en("Set"))),i=nn(o.add);return un(r,(function(t){n(t,t,e)&&i.call(o,t)}),{IS_ITERATOR:!0}),o}});var cn=G,fn=Tr,ln=Zr,hn=Gr;Be({target:"Set",proto:!0,real:!0,forced:false},{find:function(t){var e=cn(this),r=ln(e),n=fn(t,arguments.length>1?arguments[1]:void 0,3);return hn(r,(function(t,r){if(n(t,t,e))return r(t)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var pn=Wt,dn=G,yn=Fe,gn=vr,mn=Gr;Be({target:"Set",proto:!0,real:!0,forced:false},{intersection:function(t){var e=dn(this),r=new(gn(e,pn("Set"))),n=yn(e.has),o=yn(r.add);return mn(t,(function(t){n.call(e,t)&&o.call(r,t)})),r}});var vn=G,En=Fe,_n=Gr;Be({target:"Set",proto:!0,real:!0,forced:false},{isDisjointFrom:function(t){var e=vn(this),r=En(e.has);return!_n(t,(function(t,n){if(!0===r.call(e,t))return n()}),{INTERRUPTED:!0}).stopped}});var wn=Wt,Sn=G,bn=Fe,Tn=function(t){var e=Yr(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return Wr(e.call(t))},On=Gr;Be({target:"Set",proto:!0,real:!0,forced:false},{isSubsetOf:function(t){var e=Tn(this),r=Sn(t),n=r.has;return"function"!=typeof n&&(r=new(wn("Set"))(t),n=bn(r.has)),!On(e,(function(t,e){if(!1===n.call(r,t))return e()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Rn=G,An=Fe,In=Gr;Be({target:"Set",proto:!0,real:!0,forced:false},{isSupersetOf:function(t){var e=Rn(this),r=An(e.has);return!In(t,(function(t,n){if(!1===r.call(e,t))return n()}),{INTERRUPTED:!0}).stopped}});var Pn=G,jn=Zr,Nn=Gr;Be({target:"Set",proto:!0,real:!0,forced:false},{join:function(t){var e=Pn(this),r=jn(e),n=void 0===t?",":String(t),o=[];return Nn(r,o.push,{that:o,IS_ITERATOR:!0}),o.join(n)}});var xn=Wt,kn=G,Mn=Fe,Cn=Tr,Dn=vr,zn=Zr,$n=Gr;Be({target:"Set",proto:!0,real:!0,forced:false},{map:function(t){var e=kn(this),r=zn(e),n=Cn(t,arguments.length>1?arguments[1]:void 0,3),o=new(Dn(e,xn("Set"))),i=Mn(o.add);return $n(r,(function(t){i.call(o,n(t,t,e))}),{IS_ITERATOR:!0}),o}});var Un=G,Bn=Fe,Fn=Zr,Gn=Gr;Be({target:"Set",proto:!0,real:!0,forced:false},{reduce:function(t){var e=Un(this),r=Fn(e),n=arguments.length<2,o=n?void 0:arguments[1];if(Bn(t),Gn(r,(function(r){n?(n=!1,o=r):o=t(o,r,r,e)}),{IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty set with no initial value");return o}});var Qn=G,Ln=Tr,qn=Zr,Kn=Gr;Be({target:"Set",proto:!0,real:!0,forced:false},{some:function(t){var e=Qn(this),r=qn(e),n=Ln(t,arguments.length>1?arguments[1]:void 0,3);return Kn(r,(function(t,r){if(n(t,t,e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Vn=Wt,Wn=G,Yn=Fe,Zn=vr,Hn=Gr;Be({target:"Set",proto:!0,real:!0,forced:false},{symmetricDifference:function(t){var e=Wn(this),r=new(Zn(e,Vn("Set")))(e),n=Yn(r.delete),o=Yn(r.add);return Hn(t,(function(t){n.call(r,t)||o.call(r,t)})),r}});var Jn=Wt,Xn=G,to=Fe,eo=vr,ro=Gr;Be({target:"Set",proto:!0,real:!0,forced:false},{union:function(t){var e=Xn(this),r=new(eo(e,Jn("Set")))(e);return ro(t,to(r.add),{that:r}),r}});var no=Ve;Be({target:"Map",proto:!0,real:!0,forced:false},{deleteAll:function(){return no.apply(this,arguments)}});var oo=function(t){return Map.prototype.entries.call(t)},io=G,ao=Tr,so=oo,uo=Gr;Be({target:"Map",proto:!0,real:!0,forced:false},{every:function(t){var e=io(this),r=so(e),n=ao(t,arguments.length>1?arguments[1]:void 0,3);return!uo(r,(function(t,r,o){if(!n(r,t,e))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var co=Wt,fo=G,lo=Fe,ho=Tr,po=vr,yo=oo,go=Gr;Be({target:"Map",proto:!0,real:!0,forced:false},{filter:function(t){var e=fo(this),r=yo(e),n=ho(t,arguments.length>1?arguments[1]:void 0,3),o=new(po(e,co("Map"))),i=lo(o.set);return go(r,(function(t,r){n(r,t,e)&&i.call(o,t,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var mo=G,vo=Tr,Eo=oo,_o=Gr;Be({target:"Map",proto:!0,real:!0,forced:false},{find:function(t){var e=mo(this),r=Eo(e),n=vo(t,arguments.length>1?arguments[1]:void 0,3);return _o(r,(function(t,r,o){if(n(r,t,e))return o(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var wo=G,So=Tr,bo=oo,To=Gr;Be({target:"Map",proto:!0,real:!0,forced:false},{findKey:function(t){var e=wo(this),r=bo(e),n=So(t,arguments.length>1?arguments[1]:void 0,3);return To(r,(function(t,r,o){if(n(r,t,e))return o(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Oo=G,Ro=oo,Ao=function(t,e){return t===e||t!=t&&e!=e},Io=Gr;Be({target:"Map",proto:!0,real:!0,forced:false},{includes:function(t){return Io(Ro(Oo(this)),(function(e,r,n){if(Ao(r,t))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Po=G,jo=oo,No=Gr;Be({target:"Map",proto:!0,real:!0,forced:false},{keyOf:function(t){return No(jo(Po(this)),(function(e,r,n){if(r===t)return n(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var xo=Wt,ko=G,Mo=Fe,Co=Tr,Do=vr,zo=oo,$o=Gr;Be({target:"Map",proto:!0,real:!0,forced:false},{mapKeys:function(t){var e=ko(this),r=zo(e),n=Co(t,arguments.length>1?arguments[1]:void 0,3),o=new(Do(e,xo("Map"))),i=Mo(o.set);return $o(r,(function(t,r){i.call(o,n(r,t,e),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var Uo=Wt,Bo=G,Fo=Fe,Go=Tr,Qo=vr,Lo=oo,qo=Gr;Be({target:"Map",proto:!0,real:!0,forced:false},{mapValues:function(t){var e=Bo(this),r=Lo(e),n=Go(t,arguments.length>1?arguments[1]:void 0,3),o=new(Qo(e,Uo("Map"))),i=Fo(o.set);return qo(r,(function(t,r){i.call(o,t,n(r,t,e))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var Ko=G,Vo=Fe,Wo=Gr;Be({target:"Map",proto:!0,real:!0,forced:false},{merge:function(t){for(var e=Ko(this),r=Vo(e.set),n=0;n<arguments.length;)Wo(arguments[n++],r,{that:e,AS_ENTRIES:!0});return e}});var Yo=G,Zo=Fe,Ho=oo,Jo=Gr;Be({target:"Map",proto:!0,real:!0,forced:false},{reduce:function(t){var e=Yo(this),r=Ho(e),n=arguments.length<2,o=n?void 0:arguments[1];if(Zo(t),Jo(r,(function(r,i){n?(n=!1,o=i):o=t(o,i,r,e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty map with no initial value");return o}});var Xo=G,ti=Tr,ei=oo,ri=Gr;Be({target:"Map",proto:!0,real:!0,forced:false},{some:function(t){var e=Xo(this),r=ei(e),n=ti(t,arguments.length>1?arguments[1]:void 0,3);return ri(r,(function(t,r,o){if(n(r,t,e))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var ni=G,oi=Fe;function ii(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ai(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ii(Object(r),!0).forEach((function(e){si(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ii(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function si(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}Be({target:"Map",proto:!0,real:!0,forced:false},{update:function(t,e){var r=ni(this),n=arguments.length;oi(e);var o=r.has(t);if(!o&&n<3)throw TypeError("Updating absent value");var i=o?r.get(t):oi(n>2?arguments[2]:void 0)(t,r);return r.set(t,e(i,t,r)),r}});const ui=Object.freeze(["_world","defaults","id","name","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","prototype","toLocaleString","toString","valueOf","__defineGetter__","__defineSetter__","__lookupGetter__","__lookupGetter__","__proto__"]);function ci(t,e){return t&e}function fi(t,e,r){return null!=e&&t<e?e:null!=r&&t>r?r:t}function li(t){return/^(?![0-9])[a-zA-Z0-9$_]+$/.test(t)&&!ui.includes(t)}function hi(t){return Boolean(t&&"object"==typeof t&&!Array.isArray(t))}function pi(t,...e){if(!e||!e.length)return t;const r={},n=e.shift();return hi(t)&&hi(n)&&(Object.keys(n).forEach((t=>{const e=Object.getOwnPropertyDescriptor(n,t);void 0!==e&&(r[t]=ai({},e),hi(e.value)?pi(e.value,n[t]):Array.isArray(e.value)&&(e.value=[...n[t]]))})),Object.getOwnPropertySymbols(n).forEach((t=>{const e=Object.getOwnPropertyDescriptor(n,t);void 0!==e&&e.enumerable&&(r[t]=ai({},e),hi(e.value)?pi(e.value,n[t]):Array.isArray(e.value)&&(e.value=[...n[t]]))})),Object.defineProperties(t,r)),pi(t,...e)}class di{constructor(t,e=[]){this.id=t,this._registry=new Set(e)}addEntity(t){this._registry.add(t)}getEntities(){return[...this._registry]}isEmpty(){return 0===this._registry.size}removeEntity(t){this._registry.delete(t)}}function yi(t){return function(e){return t.get(e)}}function gi(t){return function(){return[...t.values()]}}function mi(t){return function(...e){const r=new Set;return e.forEach((e=>{t.forEach(((t,n)=>{ci(e.id,n)>0&&t.getEntities().forEach((t=>r.add(t)))}))})),[...r]}}function vi(t){return function(e){return t.has(e.id)||[...t.values()].includes(e)}}function Ei(t,e){return function(r,n){if(void 0!==n){const e=t.get(n);e&&(e.removeEntity(r),e.isEmpty()&&t.delete(n))}const o=r.getArchetype();var i;t.has(o)?null===(i=t.get(o))||void 0===i||i.addEntity(r):t.set(o,new di(o,[r]));return e}}class _i{constructor(t,e,r){const{name:n}=r;this.id=e,this.name=n,this._world=t,this.defaults=pi({},r.defaults),Object.keys(this.defaults).forEach((t=>{Object.defineProperty(this,t,Object.getOwnPropertyDescriptor(this.defaults,t))}))}getEntities(){return this._world.getEntitiesByComponents(this)}isRegistered(){return this._world.isComponentRegistered(this)}}function wi(t){return function(){return[...t.values()]}}function Si(t){return function(e){return[...t.values()].find((t=>t.id===e))}}function bi(t){return function(e){return t.get(e)}}function Ti(t){return function(e){return t.has(e.name)||[...t.values()].includes(e)}}function Oi(t,e,r,n){return function(o){if(t.size>=r)throw new Error("Maximum number of components reached.");if(!li(o.name))throw new SyntaxError(`"${o.name}" is not a valid component name.`);if(t.has(o.name))throw new Error(`Component with name "${o.name}" already registered.`);e.value+=1n;const i=new _i(n,e.value,o);return t.set(i.name,i),i}}function Ri(t,e){return function(r){if(!t.has(r.name))throw new Error(`Component "${r.name}" is not registered.`);return r.getEntities().forEach((t=>t.removeComponent(r))),t.delete(r.name),e}}class Ai{constructor(t){const{create:e,destroy:r,initialSize:n,growthFactor:o,maxSize:i,world:a}=t;this.initialSize=n,this.growthFactor=o,this.maxSize=i,this._create=e,this._destroy=r,this._firstAvailable=null,this._pool=new Array(n),this._world=a,this.add(n)}add(t=1){for(let e=0;e<t;e++){if(this._pool.length>=this.maxSize)throw new Error("The pool is full!");const t=this._create(this._world);t.next=this._firstAvailable,this._firstAvailable=t,this._pool.push(t)}}clear(){this._pool.length=0,this._firstAvailable=null,this.add(this.initialSize)}get(){this._firstAvailable||this.add(this.initialSize*this.growthFactor);const t=this._firstAvailable;return this._firstAvailable=t.next,t}release(t){this._destroy(t),t.next=this._firstAvailable,this._firstAvailable=t}}class Ii{constructor(t=0n){this.mask=0n,this.mask=t}get value(){return this.mask}clear(){this.mask=0n}hasAll(t){return Boolean((t&this.mask)===this.mask)}hasAny(t){return Boolean(0n===this.mask||(t&this.mask)>0)}hasNone(t){return Boolean(0n===(t&this.mask))}off(t){return this.mask&=~(1n<<BigInt(t)),this.mask}on(t){return this.mask|=1n<<BigInt(t),this.mask}}class Pi{constructor(t){this.id=`${Date.now().toString(36)}_${Math.random().toString(36).substr(2,9)}`,this._archetype=new Ii,this._enabled=!1,this._next=null,this._properties=new Map,this._world=t}get enabled(){return this._enabled}get next(){return this._next}set next(t){this._next=t}addComponent(t,e){if("string"==typeof t){const e=this._world.getComponentByName(t);if(!e)throw new Error(`Component "${t}" not found!`);t=e}if(t instanceof _i){if(this._properties.has(t))throw new Error(`Entity already has component "${t.name}".`);this._properties.set(t,pi({},t.defaults,null!=e?e:{})),Object.defineProperty(this,t.name,{get:()=>this._properties.get(t),set:e=>{const r=this._properties.get(t);if(Object.isFrozen(r))throw new Error(`Properties in component "${t.name}" cannot be modified.`);if(!r)throw new Error(`Component "${t.name}" does not exist in entity.`);Object.entries(e).forEach((([e,n])=>{if(!(e in r))throw new Error(`Property "${e}" does not exist in component "${t.name}".`);r[e]=n}))},enumerable:!0,configurable:!0});const r=this._archetype.value;return this._archetype.on(t.id),this._world.updateArchetype(this,r),!0}throw new SyntaxError("Invalid or unregistered component.")}clear(){Object.keys(this._properties).forEach((t=>delete this[t])),this._properties.clear();const t=this._archetype.value;this._archetype.clear(),this._world.updateArchetype(this,t)}disable(){this._enabled=!1}enable(){this._enabled=!0}getArchetype(){return this._archetype.value}hasComponent(t){const e="string"==typeof t?t:t.name;return Boolean(Reflect.has(this._properties,e))}removeComponent(t){if("string"==typeof t){const e=this._world.getComponentByName(t);if(!e)throw new Error(`Component "${t}" not found!`);t=e}if(!this._properties.has(t))throw new Error(`Entity ${this.id} has no component "${t.name}".`);this._properties.delete(t);try{delete this[t.name]}catch(e){console.warn(`Could not remove property ${t.name} from entity.`)}const e=this._archetype.value;return this._archetype.off(t.id),this._world.updateArchetype(this,e),!0}}function ji(t,e,r){return function(){const n=t.get();if(!(n&&n instanceof Pi))throw new Error("No entities left! Pool is empty.");return e.set(n.id,n),r.updateArchetype(n),n}}function Ni(t,e,r){return function(n){if(n===r.global)throw new Error("Destroying the global entity is forbidden.");var o;return!!e.has(n.id)&&(null===(o=r.getArchetype(n.getArchetype()))||void 0===o||o.removeEntity(n),e.delete(n.id),t.release(n),!0)}}function xi(t){return function(){return[...t.values()]}}function ki(t){return function(e){return t.get(e)}}function Mi(t){return function(e){return t.has(e.id)||[...t.values()].includes(e)}}class Ci{constructor(t,e){this._registry=new Set,this._world=t,this._all=new Set(e.all),this._any=new Set(e.any),this._none=new Set(e.none),this._mskAll=new Ii,this._mskAny=new Ii,this._mskNone=new Ii,this._refresh()}get size(){return this._registry.size}getEntities(){return[...this._registry]}hasEntity(t){return this._registry.has(t)}matches(t){const e=0n===this._mskAny.value||ci(t,this._mskAny.value)>0,r=ci(t,this._mskAll.value)===this._mskAll.value,n=0n===ci(t,this._mskNone.value);return e&&r&&n}_refresh(){this._all.forEach((t=>{this._mskAll.on(t.id),!1===t.isRegistered()&&console.warn(`Query has unregistered component ("${t.id}") in _all.`,this)})),this._any.forEach((t=>{this._mskAny.on(t.id),!0===t.isRegistered()&&console.warn(`Query has unregistered component ("${t.id}") in _any.`,this)})),this._none.forEach((t=>{this._mskNone.on(t.id),!0===t.isRegistered()&&console.warn(`Query has unregistered component ("${t.id}") in _none.`,this)}))}update(){this._refresh(),this._registry.clear(),this._world.getArchetypes().forEach((t=>{this.matches(t.id)&&t.getEntities().forEach((t=>this._registry.add(t)))}))}}function Di(t){return function(e){return t.has(e)}}function zi(t,e){return function(r){const n=new Ci(e,r);return t.add(n),n}}function $i(t,e){return function(){return t.forEach((t=>t.update())),e}}function Ui(t,e){return function(r){return t.delete(r),e}}function Bi(t){return function(){return t.getPreSystems().forEach((e=>e.pre(e.entities,t.global))),t}}function Fi(t){return function(e=0){return t.getPostSystems().forEach((r=>r.post(r.entities,t.global,e))),t.refreshQueries(),t}}function Gi(t,e,r){let n=null,o=0;const i=e;return function(a=0){if(null!==n){o+=.001*(a-n);let e=0;for(r.pre();o>i;){if(e>=t){o=1;break}r.update(i),o-=i,e++}}return n=a,r.post(o/e),r}}function Qi(t){return function(e=0){return t.getUpdateSystems().forEach((r=>r.update(r.entities,t.global,e))),t}}function Li(t,e){}function qi(t,e,r){}function Ki(t,e,r){}class Vi{constructor(t,e){const{name:r,query:n=null,pre:o=Li,post:i=qi,update:a=Ki}=e;this.name=r,this.query=n,this.pre=o,this.post=i,this.update=a,this._enabled=!1,this._world=t}get enabled(){return this._enabled}get entities(){return null===this.query?this._world.getEntities():this.query.getEntities()}disable(){this._enabled=!1}enable(){this._enabled=!0}}function Wi(t){return function(){return[...t]}}function Yi(t){return function(){return t.filter((t=>t.post&&t.post!==qi&&t.enabled))}}function Zi(t){return function(){return t.filter((t=>t.pre&&t.pre!==Li&&t.enabled))}}function Hi(t){return function(){return t.filter((t=>t.update&&t.update!==Ki&&t.enabled))}}function Ji(t){return function(e){return t[e]}}function Xi(t){return function(e){return t.get(e)}}function ta(t){return function(e){return t.has(e.name)||[...t.values()].includes(e)}}function ea(t){return function(e,r){const n=t.indexOf(e);if(-1===n)return-1;const o=fi(r,0,t.length);return t.splice(o,1),t.splice(n,0,e),o}}function ra(t,e,r){return function(n,o){if(!li(n.name))throw new SyntaxError(`"${n.name}" is not a valid system name.`);if(e.has(n.name))throw new Error(`System "${n.name}" is already registered!`);const i=new Vi(r,n);return void 0!==o?t.splice(fi(o,0,t.length),0,i):t.push(i),e.set(i.name,i),i}}function na(t,e,r){return function(n){if(!e.has(n.name))throw new Error(`System "${n.name}" is not registered!`);e.delete(n.name);const o=t.indexOf(n);return o>-1&&t.splice(o,1),r}}t.createWorld=function(t={}){const{entityPoolGrowthFactor:e=.25,initialEntityPoolSize:r=128,maxComponents:n=256,maxEntities:o=Number.POSITIVE_INFINITY,maxUpdates:i=240,tempo:a=1/60}=t,s=Object.create(null);return Object.assign(s,function(t,e){const r=new Map;return{getArchetype:yi(r),getArchetypes:gi(r),getEntitiesByComponents:mi(r),isArchetypeRegistered:vi(r),updateArchetype:Ei(r,t)}}(s),function(t,e){const{maxComponents:r}=e,n=new Map;return{getComponentById:Si(n),getComponentByName:bi(n),getComponents:wi(n),isComponentRegistered:Ti(n),registerComponent:Oi(n,{value:0n},r,t),unregisterComponent:Ri(n,t)}}(s,{maxComponents:n}),function(t,e){const{entityPoolGrowthFactor:r,initialEntityPoolSize:n,maxEntities:o}=e,i=new Ai({create:function(){return new Pi(t)},destroy:function(t){t.clear()},initialSize:n,growthFactor:r,maxSize:o,world:t}),a=new Map;return{createEntity:ji(i,a,t),destroyEntity:Ni(i,a,t),getEntities:xi(a),getEntityById:ki(a),isEntityRegistered:Mi(a)}}(s,{entityPoolGrowthFactor:e,initialEntityPoolSize:r,maxEntities:o}),function(t,e){const r=new Set;return{isQueryRegistered:Di(r),registerQuery:zi(r,t),refreshQueries:$i(r,t),unregisterQuery:Ui(r,t)}}(s),function(t,e){const{maxUpdates:r,tempo:n}=e;return{post:Fi(t),pre:Bi(t),step:Gi(r,n,t),update:Qi(t)}}(s,{maxUpdates:i,tempo:a}),function(t,e){const r=[],n=new Map;return{getSystems:Wi(r),getPostSystems:Yi(r),getPreSystems:Zi(r),getUpdateSystems:Hi(r),getSystemByIdx:Ji(r),getSystemByName:Xi(n),isSystemRegistered:ta(n),moveSystem:ea(r),registerSystem:ra(r,n,t),unregisterSystem:na(r,n,t)}}(s)),s.global=s.createEntity(),s.FORBIDDEN_NAMES=[...ui],s}}));
//# sourceMappingURL=index.min.js.map
