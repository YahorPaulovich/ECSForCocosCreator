/*! *****************************************************************************
 *
 * miski
 * v0.3.1
 *
 * MIT License
 * 
 * Copyright (C) 2021 Peter Hughes<https://www.phugh.es>, all rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
***************************************************************************** */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):(t="undefined"!=typeof globalThis?globalThis:t||self,function(){var r=t.miski,n=t.miski={};e(n),n.noConflict=function(){return t.miski=r,n}}())}(this,(function(t){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=function(t){return t&&t.Math==Math&&t},n=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof e&&e)||function(){return this}()||Function("return this")(),o={},i=function(t){try{return!!t()}catch(t){return!0}},a=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),u={},s={}.propertyIsEnumerable,c=Object.getOwnPropertyDescriptor,f=c&&!s.call({1:2},1);u.f=f?function(t){var e=c(this,t);return!!e&&e.enumerable}:s;var l=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},p={}.toString,h=function(t){return p.call(t).slice(8,-1)},d=h,y="".split,g=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},m=i((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==d(t)?y.call(t,""):Object(t)}:Object,v=g,E=function(t){return m(v(t))},S=function(t){return"object"==typeof t?null!==t:"function"==typeof t},w=S,_=function(t,e){if(!w(t))return t;var r,n;if(e&&"function"==typeof(r=t.toString)&&!w(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!w(n=r.call(t)))return n;if(!e&&"function"==typeof(r=t.toString)&&!w(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")},b=g,T=function(t){return Object(b(t))},O={}.hasOwnProperty,R=function(t,e){return O.call(T(t),e)},A=S,I=n.document,P=A(I)&&A(I.createElement),j=function(t){return P?I.createElement(t):{}},x=!a&&!i((function(){return 7!=Object.defineProperty(j("div"),"a",{get:function(){return 7}}).a})),N=a,M=u,C=l,D=E,z=_,k=R,$=x,U=Object.getOwnPropertyDescriptor;o.f=N?U:function(t,e){if(t=D(t),e=z(e,!0),$)try{return U(t,e)}catch(t){}if(k(t,e))return C(!M.f.call(t,e),t[e])};var F={},B=S,G=function(t){if(!B(t))throw TypeError(String(t)+" is not an object");return t},L=a,q=x,Q=G,K=_,V=Object.defineProperty;F.f=L?V:function(t,e,r){if(Q(t),e=K(e,!0),Q(r),q)try{return V(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(t[e]=r.value),t};var W=F,Y=l,Z=a?function(t,e,r){return W.f(t,e,Y(1,r))}:function(t,e,r){return t[e]=r,t},H={exports:{}},J=n,X=Z,tt=function(t,e){try{X(J,t,e)}catch(r){J[t]=e}return e},et=tt,rt="__core-js_shared__",nt=n[rt]||et(rt,{}),ot=nt,it=Function.toString;"function"!=typeof ot.inspectSource&&(ot.inspectSource=function(t){return it.call(t)});var at=ot.inspectSource,ut=at,st=n.WeakMap,ct="function"==typeof st&&/native code/.test(ut(st)),ft={exports:{}},lt=nt;(ft.exports=function(t,e){return lt[t]||(lt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var pt,ht,dt,yt=0,gt=Math.random(),mt=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++yt+gt).toString(36)},vt=ft.exports,Et=mt,St=vt("keys"),wt={},_t=ct,bt=S,Tt=Z,Ot=R,Rt=nt,At=function(t){return St[t]||(St[t]=Et(t))},It=wt,Pt="Object already initialized",jt=n.WeakMap;if(_t||Rt.state){var xt=Rt.state||(Rt.state=new jt),Nt=xt.get,Mt=xt.has,Ct=xt.set;pt=function(t,e){if(Mt.call(xt,t))throw new TypeError(Pt);return e.facade=t,Ct.call(xt,t,e),e},ht=function(t){return Nt.call(xt,t)||{}},dt=function(t){return Mt.call(xt,t)}}else{var Dt=At("state");It[Dt]=!0,pt=function(t,e){if(Ot(t,Dt))throw new TypeError(Pt);return e.facade=t,Tt(t,Dt,e),e},ht=function(t){return Ot(t,Dt)?t[Dt]:{}},dt=function(t){return Ot(t,Dt)}}var zt={set:pt,get:ht,has:dt,enforce:function(t){return dt(t)?ht(t):pt(t,{})},getterFor:function(t){return function(e){var r;if(!bt(e)||(r=ht(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return r}}},kt=n,$t=Z,Ut=R,Ft=tt,Bt=at,Gt=zt.get,Lt=zt.enforce,qt=String(String).split("String");(H.exports=function(t,e,r,n){var o,i=!!n&&!!n.unsafe,a=!!n&&!!n.enumerable,u=!!n&&!!n.noTargetGet;"function"==typeof r&&("string"!=typeof e||Ut(r,"name")||$t(r,"name",e),(o=Lt(r)).source||(o.source=qt.join("string"==typeof e?e:""))),t!==kt?(i?!u&&t[e]&&(a=!0):delete t[e],a?t[e]=r:$t(t,e,r)):a?t[e]=r:Ft(e,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&Gt(this).source||Bt(this)}));var Qt=n,Kt=n,Vt=function(t){return"function"==typeof t?t:void 0},Wt=function(t,e){return arguments.length<2?Vt(Qt[t])||Vt(Kt[t]):Qt[t]&&Qt[t][e]||Kt[t]&&Kt[t][e]},Yt={},Zt=Math.ceil,Ht=Math.floor,Jt=function(t){return isNaN(t=+t)?0:(t>0?Ht:Zt)(t)},Xt=Jt,te=Math.min,ee=function(t){return t>0?te(Xt(t),9007199254740991):0},re=Jt,ne=Math.max,oe=Math.min,ie=E,ae=ee,ue=function(t,e){var r=re(t);return r<0?ne(r+e,0):oe(r,e)},se=function(t){return function(e,r,n){var o,i=ie(e),a=ae(i.length),u=ue(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},ce={includes:se(!0),indexOf:se(!1)},fe=R,le=E,pe=ce.indexOf,he=wt,de=function(t,e){var r,n=le(t),o=0,i=[];for(r in n)!fe(he,r)&&fe(n,r)&&i.push(r);for(;e.length>o;)fe(n,r=e[o++])&&(~pe(i,r)||i.push(r));return i},ye=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype");Yt.f=Object.getOwnPropertyNames||function(t){return de(t,ye)};var ge={};ge.f=Object.getOwnPropertySymbols;var me=Yt,ve=ge,Ee=G,Se=Wt("Reflect","ownKeys")||function(t){var e=me.f(Ee(t)),r=ve.f;return r?e.concat(r(t)):e},we=R,_e=Se,be=o,Te=F,Oe=i,Re=/#|\.prototype\./,Ae=function(t,e){var r=Pe[Ie(t)];return r==xe||r!=je&&("function"==typeof e?Oe(e):!!e)},Ie=Ae.normalize=function(t){return String(t).replace(Re,".").toLowerCase()},Pe=Ae.data={},je=Ae.NATIVE="N",xe=Ae.POLYFILL="P",Ne=Ae,Me=n,Ce=o.f,De=Z,ze=H.exports,ke=tt,$e=function(t,e){for(var r=_e(e),n=Te.f,o=be.f,i=0;i<r.length;i++){var a=r[i];we(t,a)||n(t,a,o(e,a))}},Ue=Ne,Fe=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?Me:c?Me[u]||ke(u,{}):(Me[u]||{}).prototype)for(n in e){if(i=e[n],o=t.noTargetGet?(a=Ce(r,n))&&a.value:r[n],!Ue(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;$e(i,o)}(t.sham||o&&o.sham)&&De(i,"sham",!0),ze(r,n,i,t)}},Be=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Ge=G,Le=Be,qe=function(){for(var t=Ge(this),e=Le(t.add),r=0,n=arguments.length;r<n;r++)e.call(t,arguments[r]);return t};Fe({target:"Set",proto:!0,real:!0,forced:false},{addAll:function(){return qe.apply(this,arguments)}});var Qe=G,Ke=Be,Ve=function(){for(var t,e=Qe(this),r=Ke(e.delete),n=!0,o=0,i=arguments.length;o<i;o++)t=r.call(e,arguments[o]),n=n&&t;return!!n},We=Ve;Fe({target:"Set",proto:!0,real:!0,forced:false},{deleteAll:function(){return We.apply(this,arguments)}});var Ye,Ze,He=Wt("navigator","userAgent")||"",Je=n.process,Xe=Je&&Je.versions,tr=Xe&&Xe.v8;tr?Ze=(Ye=tr.split("."))[0]<4?1:Ye[0]+Ye[1]:He&&(!(Ye=He.match(/Edge\/(\d+)/))||Ye[1]>=74)&&(Ye=He.match(/Chrome\/(\d+)/))&&(Ze=Ye[1]);var er=Ze&&+Ze,rr=i,nr=!!Object.getOwnPropertySymbols&&!rr((function(){return!String(Symbol())||!Symbol.sham&&er&&er<41})),or=nr&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ir=n,ar=ft.exports,ur=R,sr=mt,cr=nr,fr=or,lr=ar("wks"),pr=ir.Symbol,hr=fr?pr:pr&&pr.withoutSetter||sr,dr=function(t){return ur(lr,t)&&(cr||"string"==typeof lr[t])||(cr&&ur(pr,t)?lr[t]=pr[t]:lr[t]=hr("Symbol."+t)),lr[t]},yr=G,gr=Be,mr=dr("species"),vr=function(t,e){var r,n=yr(t).constructor;return void 0===n||null==(r=yr(n)[mr])?e:gr(r)},Er={},Sr=Er,wr=dr("iterator"),_r=Array.prototype,br=Be,Tr=function(t,e,r){if(br(t),void 0===e)return t;switch(r){case 0:return function(){return t.call(e)};case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,o){return t.call(e,r,n,o)}}return function(){return t.apply(e,arguments)}},Or={};Or[dr("toStringTag")]="z";var Rr="[object z]"===String(Or),Ar=h,Ir=dr("toStringTag"),Pr="Arguments"==Ar(function(){return arguments}()),jr=Rr?Ar:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Ir))?r:Pr?Ar(e):"Object"==(n=Ar(e))&&"function"==typeof e.callee?"Arguments":n},xr=Er,Nr=dr("iterator"),Mr=function(t){if(null!=t)return t[Nr]||t["@@iterator"]||xr[jr(t)]},Cr=G,Dr=G,zr=function(t){return void 0!==t&&(Sr.Array===t||_r[wr]===t)},kr=ee,$r=Tr,Ur=Mr,Fr=function(t){var e=t.return;if(void 0!==e)return Cr(e.call(t)).value},Br=function(t,e){this.stopped=t,this.result=e},Gr=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),p=!(!r||!r.IS_ITERATOR),h=!(!r||!r.INTERRUPTED),d=$r(e,f,1+l+h),y=function(t){return n&&Fr(n),new Br(!0,t)},g=function(t){return l?(Dr(t),h?d(t[0],t[1],y):d(t[0],t[1])):h?d(t,y):d(t)};if(p)n=t;else{if("function"!=typeof(o=Ur(t)))throw TypeError("Target is not iterable");if(zr(o)){for(i=0,a=kr(t.length);a>i;i++)if((u=g(t[i]))&&u instanceof Br)return u;return new Br(!1)}n=o.call(t)}for(s=n.next;!(c=s.call(n)).done;){try{u=g(c.value)}catch(t){throw Fr(n),t}if("object"==typeof u&&u&&u instanceof Br)return u}return new Br(!1)},Lr=Wt,qr=G,Qr=Be,Kr=vr,Vr=Gr;Fe({target:"Set",proto:!0,real:!0,forced:false},{difference:function(t){var e=qr(this),r=new(Kr(e,Lr("Set")))(e),n=Qr(r.delete);return Vr(t,(function(t){n.call(r,t)})),r}});var Wr=G,Yr=Mr,Zr=function(t){return Set.prototype.values.call(t)},Hr=G,Jr=Tr,Xr=Zr,tn=Gr;Fe({target:"Set",proto:!0,real:!0,forced:false},{every:function(t){var e=Hr(this),r=Xr(e),n=Jr(t,arguments.length>1?arguments[1]:void 0,3);return!tn(r,(function(t,r){if(!n(t,t,e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var en=Wt,rn=G,nn=Be,on=Tr,an=vr,un=Zr,sn=Gr;Fe({target:"Set",proto:!0,real:!0,forced:false},{filter:function(t){var e=rn(this),r=un(e),n=on(t,arguments.length>1?arguments[1]:void 0,3),o=new(an(e,en("Set"))),i=nn(o.add);return sn(r,(function(t){n(t,t,e)&&i.call(o,t)}),{IS_ITERATOR:!0}),o}});var cn=G,fn=Tr,ln=Zr,pn=Gr;Fe({target:"Set",proto:!0,real:!0,forced:false},{find:function(t){var e=cn(this),r=ln(e),n=fn(t,arguments.length>1?arguments[1]:void 0,3);return pn(r,(function(t,r){if(n(t,t,e))return r(t)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var hn=Wt,dn=G,yn=Be,gn=vr,mn=Gr;Fe({target:"Set",proto:!0,real:!0,forced:false},{intersection:function(t){var e=dn(this),r=new(gn(e,hn("Set"))),n=yn(e.has),o=yn(r.add);return mn(t,(function(t){n.call(e,t)&&o.call(r,t)})),r}});var vn=G,En=Be,Sn=Gr;Fe({target:"Set",proto:!0,real:!0,forced:false},{isDisjointFrom:function(t){var e=vn(this),r=En(e.has);return!Sn(t,(function(t,n){if(!0===r.call(e,t))return n()}),{INTERRUPTED:!0}).stopped}});var wn=Wt,_n=G,bn=Be,Tn=function(t){var e=Yr(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return Wr(e.call(t))},On=Gr;Fe({target:"Set",proto:!0,real:!0,forced:false},{isSubsetOf:function(t){var e=Tn(this),r=_n(t),n=r.has;return"function"!=typeof n&&(r=new(wn("Set"))(t),n=bn(r.has)),!On(e,(function(t,e){if(!1===n.call(r,t))return e()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Rn=G,An=Be,In=Gr;Fe({target:"Set",proto:!0,real:!0,forced:false},{isSupersetOf:function(t){var e=Rn(this),r=An(e.has);return!In(t,(function(t,n){if(!1===r.call(e,t))return n()}),{INTERRUPTED:!0}).stopped}});var Pn=G,jn=Zr,xn=Gr;Fe({target:"Set",proto:!0,real:!0,forced:false},{join:function(t){var e=Pn(this),r=jn(e),n=void 0===t?",":String(t),o=[];return xn(r,o.push,{that:o,IS_ITERATOR:!0}),o.join(n)}});var Nn=Wt,Mn=G,Cn=Be,Dn=Tr,zn=vr,kn=Zr,$n=Gr;Fe({target:"Set",proto:!0,real:!0,forced:false},{map:function(t){var e=Mn(this),r=kn(e),n=Dn(t,arguments.length>1?arguments[1]:void 0,3),o=new(zn(e,Nn("Set"))),i=Cn(o.add);return $n(r,(function(t){i.call(o,n(t,t,e))}),{IS_ITERATOR:!0}),o}});var Un=G,Fn=Be,Bn=Zr,Gn=Gr;Fe({target:"Set",proto:!0,real:!0,forced:false},{reduce:function(t){var e=Un(this),r=Bn(e),n=arguments.length<2,o=n?void 0:arguments[1];if(Fn(t),Gn(r,(function(r){n?(n=!1,o=r):o=t(o,r,r,e)}),{IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty set with no initial value");return o}});var Ln=G,qn=Tr,Qn=Zr,Kn=Gr;Fe({target:"Set",proto:!0,real:!0,forced:false},{some:function(t){var e=Ln(this),r=Qn(e),n=qn(t,arguments.length>1?arguments[1]:void 0,3);return Kn(r,(function(t,r){if(n(t,t,e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Vn=Wt,Wn=G,Yn=Be,Zn=vr,Hn=Gr;Fe({target:"Set",proto:!0,real:!0,forced:false},{symmetricDifference:function(t){var e=Wn(this),r=new(Zn(e,Vn("Set")))(e),n=Yn(r.delete),o=Yn(r.add);return Hn(t,(function(t){n.call(r,t)||o.call(r,t)})),r}});var Jn=Wt,Xn=G,to=Be,eo=vr,ro=Gr;Fe({target:"Set",proto:!0,real:!0,forced:false},{union:function(t){var e=Xn(this),r=new(eo(e,Jn("Set")))(e);return ro(t,to(r.add),{that:r}),r}});var no=Ve;Fe({target:"Map",proto:!0,real:!0,forced:false},{deleteAll:function(){return no.apply(this,arguments)}});var oo=function(t){return Map.prototype.entries.call(t)},io=G,ao=Tr,uo=oo,so=Gr;Fe({target:"Map",proto:!0,real:!0,forced:false},{every:function(t){var e=io(this),r=uo(e),n=ao(t,arguments.length>1?arguments[1]:void 0,3);return!so(r,(function(t,r,o){if(!n(r,t,e))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var co=Wt,fo=G,lo=Be,po=Tr,ho=vr,yo=oo,go=Gr;Fe({target:"Map",proto:!0,real:!0,forced:false},{filter:function(t){var e=fo(this),r=yo(e),n=po(t,arguments.length>1?arguments[1]:void 0,3),o=new(ho(e,co("Map"))),i=lo(o.set);return go(r,(function(t,r){n(r,t,e)&&i.call(o,t,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var mo=G,vo=Tr,Eo=oo,So=Gr;Fe({target:"Map",proto:!0,real:!0,forced:false},{find:function(t){var e=mo(this),r=Eo(e),n=vo(t,arguments.length>1?arguments[1]:void 0,3);return So(r,(function(t,r,o){if(n(r,t,e))return o(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var wo=G,_o=Tr,bo=oo,To=Gr;Fe({target:"Map",proto:!0,real:!0,forced:false},{findKey:function(t){var e=wo(this),r=bo(e),n=_o(t,arguments.length>1?arguments[1]:void 0,3);return To(r,(function(t,r,o){if(n(r,t,e))return o(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Oo=G,Ro=oo,Ao=function(t,e){return t===e||t!=t&&e!=e},Io=Gr;Fe({target:"Map",proto:!0,real:!0,forced:false},{includes:function(t){return Io(Ro(Oo(this)),(function(e,r,n){if(Ao(r,t))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Po=G,jo=oo,xo=Gr;Fe({target:"Map",proto:!0,real:!0,forced:false},{keyOf:function(t){return xo(jo(Po(this)),(function(e,r,n){if(r===t)return n(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var No=Wt,Mo=G,Co=Be,Do=Tr,zo=vr,ko=oo,$o=Gr;Fe({target:"Map",proto:!0,real:!0,forced:false},{mapKeys:function(t){var e=Mo(this),r=ko(e),n=Do(t,arguments.length>1?arguments[1]:void 0,3),o=new(zo(e,No("Map"))),i=Co(o.set);return $o(r,(function(t,r){i.call(o,n(r,t,e),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var Uo=Wt,Fo=G,Bo=Be,Go=Tr,Lo=vr,qo=oo,Qo=Gr;Fe({target:"Map",proto:!0,real:!0,forced:false},{mapValues:function(t){var e=Fo(this),r=qo(e),n=Go(t,arguments.length>1?arguments[1]:void 0,3),o=new(Lo(e,Uo("Map"))),i=Bo(o.set);return Qo(r,(function(t,r){i.call(o,t,n(r,t,e))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var Ko=G,Vo=Be,Wo=Gr;Fe({target:"Map",proto:!0,real:!0,forced:false},{merge:function(t){for(var e=Ko(this),r=Vo(e.set),n=0;n<arguments.length;)Wo(arguments[n++],r,{that:e,AS_ENTRIES:!0});return e}});var Yo=G,Zo=Be,Ho=oo,Jo=Gr;Fe({target:"Map",proto:!0,real:!0,forced:false},{reduce:function(t){var e=Yo(this),r=Ho(e),n=arguments.length<2,o=n?void 0:arguments[1];if(Zo(t),Jo(r,(function(r,i){n?(n=!1,o=i):o=t(o,i,r,e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty map with no initial value");return o}});var Xo=G,ti=Tr,ei=oo,ri=Gr;Fe({target:"Map",proto:!0,real:!0,forced:false},{some:function(t){var e=Xo(this),r=ei(e),n=ti(t,arguments.length>1?arguments[1]:void 0,3);return ri(r,(function(t,r,o){if(n(r,t,e))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var ni=G,oi=Be;function ii(t,e){return function(r,...n){if(t.has(r)){const o=t.get(r);return n.forEach((t=>o.add(t))),e}throw new SyntaxError(`Archetype "${r}" does not exist.`)}}function ai(t){return function(){return[...t.entries()]}}function ui(t){return function(e){return t.get(e)}}function si(t){return function(...e){const r=new Set;return e.forEach((e=>{t.forEach(((t,n)=>{(e.id&n)>0&&t.forEach((t=>r.add(t)))}))})),[...r]}}function ci(t){return function(e){return Boolean(0===t.get(e)?.size)}}function fi(t,e){return function(r,...n){if(t.has(r)){const o=t.get(r);return n.forEach((t=>o.delete(t))),e}throw new SyntaxError(`Archetype "${r}" does not exist.`)}}function li(t,e){return function(r,n){if(void 0!==n){const e=t.get(n);e&&(e.delete(r),0===e.size&&t.delete(n))}const o=r.getArchetype();return t.has(o)?t.get(o).add(r):t.set(o,new Set([r])),e}}function pi(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function hi(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?pi(Object(r),!0).forEach((function(e){di(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):pi(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function di(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}Fe({target:"Map",proto:!0,real:!0,forced:false},{update:function(t,e){var r=ni(this),n=arguments.length;oi(e);var o=r.has(t);if(!o&&n<3)throw TypeError("Updating absent value");var i=o?r.get(t):oi(n>2?arguments[2]:void 0)(t,r);return r.set(t,e(i,t,r)),r}});const yi=Object.freeze(["_world","defaults","id","name","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","prototype","toLocaleString","toString","valueOf","__defineGetter__","__defineSetter__","__lookupGetter__","__lookupGetter__","__proto__"]);function gi(t,e,r){return null!=e&&t<e?e:null!=r&&t>r?r:t}function mi(t){return/^(?![0-9])[a-zA-Z0-9$_]+$/.test(t)&&!yi.includes(t)}function vi(t){return Boolean(t&&"object"==typeof t&&!Array.isArray(t))}function Ei(t,...e){if(!e||!e.length)return t;const r={},n=e.shift();return vi(t)&&vi(n)&&(Object.keys(n).forEach((t=>{const e=Object.getOwnPropertyDescriptor(n,t);void 0!==e&&(r[t]=hi({},e),vi(e.value)?Ei(e.value,n[t]):Array.isArray(e.value)&&(e.value=[...n[t]]))})),Object.getOwnPropertySymbols(n).forEach((t=>{const e=Object.getOwnPropertyDescriptor(n,t);void 0!==e&&e.enumerable&&(r[t]=hi({},e),vi(e.value)?Ei(e.value,n[t]):Array.isArray(e.value)&&(e.value=[...n[t]]))})),Object.defineProperties(t,r)),Ei(t,...e)}class Si{constructor(t,e,r){const{name:n}=r;this.id=e,this.name=n,this._world=t,this.defaults=Ei({},r.defaults),Object.keys(this.defaults).forEach((t=>{Object.defineProperty(this,t,Object.getOwnPropertyDescriptor(this.defaults,t))}))}getEntities(){return this._world.getEntitiesByComponents(this)}isRegistered(){return this._world.isComponentRegistered(this)}}function wi(t){return function(){return[...t.values()]}}function _i(t){return function(e){return[...t.values()].find((t=>t.id===e))}}function bi(t){return function(e){return t.get(e)}}function Ti(t){return function(e){return t.has(e.name)||[...t.values()].includes(e)}}function Oi(t,e,r,n){return function(o){if(t.size>=r)throw new Error("Maximum number of components reached.");if(!mi(o.name))throw new SyntaxError(`"${o.name}" is not a valid component name.`);if(t.has(o.name))throw new Error(`Component with name "${o.name}" already registered.`);e.value+=1n;const i=new Si(n,e.value,o);return t.set(i.name,i),i}}function Ri(t,e){return function(r){if(!t.has(r.name))throw new Error(`Component "${r.name}" is not registered.`);return r.getEntities().forEach((t=>t.removeComponent(r))),t.delete(r.name),e}}class Ai{constructor(t){const{create:e,destroy:r,initialSize:n,growthFactor:o,maxSize:i,world:a}=t;this.initialSize=n,this.growthFactor=o,this.maxSize=i,this._create=e,this._destroy=r,this._firstAvailable=null,this._pool=new Array(n),this._world=a,this.add(n)}add(t=1){for(let e=0;e<t;e++){if(this._pool.length>=this.maxSize)throw new Error("The pool is full!");const t=this._create(this._world);t.next=this._firstAvailable,this._firstAvailable=t,this._pool.push(t)}}clear(){this._pool.length=0,this._firstAvailable=null,this.add(this.initialSize)}get(){this._firstAvailable||this.add(this.initialSize*this.growthFactor);const t=this._firstAvailable;return this._firstAvailable=t.next,t}release(t){this._destroy(t),t.next=this._firstAvailable,this._firstAvailable=t}}class Ii{constructor(t){this.id=`${Date.now().toString(36)}_${Math.random().toString(36).substr(2,9)}`,this._archetype=0n,this._enabled=!1,this._next=null,this._properties=new Map,this._world=t}get enabled(){return this._enabled}get next(){return this._next}set next(t){this._next=t}addComponent(t,e){if("string"==typeof t){const e=this._world.getComponentByName(t);if(!e)throw new Error(`Component "${t}" not found!`);t=e}if(t instanceof Si){if(this._properties.has(t))throw new Error(`Entity already has component "${t.name}".`);this._properties.set(t,Ei({},t.defaults,e??{})),Object.defineProperty(this,t.name,{get:()=>this._properties.get(t),set:e=>{const r=this._properties.get(t);if(Object.isFrozen(r))throw new Error(`Properties in component "${t.name}" cannot be modified.`);if(!r)throw new Error(`Component "${t.name}" does not exist in entity.`);Object.entries(e).forEach((([e,n])=>{if(!(e in r))throw new Error(`Property "${e}" does not exist in component "${t.name}".`);r[e]=n}))},enumerable:!0,configurable:!0});const r=this._archetype;return this._archetype|=1n<<t.id,this._world.updateArchetype(this,r),this}throw new SyntaxError("Invalid or unregistered component.")}clear(){const t=this._archetype;return this._archetype=0n,this._world.updateArchetype(this,t),Object.keys(this._properties).forEach((t=>delete this[t])),this._properties.clear(),this}disable(){return this._enabled=!1,this}enable(){return this._enabled=!0,this}getArchetype(){return this._archetype}hasComponent(t){const e="string"==typeof t?t:t.name;return Boolean(Reflect.has(this._properties,e))}removeComponent(t){if("string"==typeof t){const e=this._world.getComponentByName(t);if(!e)throw new Error(`Component "${t}" not found!`);t=e}if(!this._properties.has(t))throw new Error(`Entity ${this.id} has no component "${t.name}".`);this._properties.delete(t);try{delete this[t.name]}catch(e){console.warn(`Could not remove property ${t.name} from entity.`)}const e=this._archetype;return this._archetype&=~(1n<<t.id),this._world.updateArchetype(this,e),this}}function Pi(t,e,r){return function(){const n=t.get();if(!(n&&n instanceof Ii))throw new Error("No entities left! Pool is empty.");return e.set(n.id,n),r.updateArchetype(n),n}}function ji(t,e,r){return function(n){if(n===r.global)throw new Error("Destroying the global entity is forbidden.");return!!e.has(n.id)&&(r.removeEntitiesFromArchetype(n.getArchetype(),n),e.delete(n.id),t.release(n),!0)}}function xi(t){return function(){return[...t.values()]}}function Ni(t){return function(e){return t.get(e)}}function Mi(t){return function(e){return t.has(e.id)||[...t.values()].includes(e)}}function Ci(t){return t.reduce(((t,e)=>t|=1n<<e.id),0n)}class Di{constructor(t,e){const{all:r=[],any:n=[],none:o=[]}=e;this._mskAll=Ci(r),this._mskAny=Ci(n),this._mskNone=Ci(o),this._registry=new Set,this._world=t}get size(){return this._registry.size}getEntities(){return[...this._registry]}hasEntity(t){return this._registry.has(t)}matches(t){const e=0n===this._mskAny||(t&this._mskAny)>0,r=(t&this._mskAll)===this._mskAll,n=0n===(t&this._mskNone);return e&&r&&n}update(){this._registry.clear(),this._world.getArchetypes().forEach((([t,e])=>{this.matches(t)&&e.forEach((t=>this._registry.add(t)))}))}}function zi(t){return function(e){return t.has(e)}}function ki(t,e){return function(r){const n=new Di(e,r);return t.add(n),n}}function $i(t,e){return function(){return t.forEach((t=>t.update())),e}}function Ui(t,e){return function(r){return t.delete(r),e}}function Fi(t,e,r){let n=0,o=null,i=0;const a=e,u=function(t){return function(){return t.getPreSystems().forEach((e=>e.pre(e.entities,t.global))),t}}(r),s=function(t){return function(e=0){return t.getPostSystems().forEach((r=>r.post(r.entities,t.global,e))),t.refreshQueries(),t}}(r),c=function(t){return function(e=0){return t.getUpdateSystems().forEach((r=>r.update(r.entities,t.global,e))),t}}(r);return function(r=0){if(null!==o)for(n+=.001*(r-o),i=0,u();n>a;){if(i>=t){n=1;break}c(a),n-=a,i++}o=r,s(n/e)}}function Bi(t,e){}function Gi(t,e,r){}function Li(t,e,r){}class qi{constructor(t,e){const{name:r,query:n=null,pre:o=Bi,post:i=Gi,update:a=Li}=e;this.name=r,this.query=n,this.pre=o,this.post=i,this.update=a,this._enabled=!1,this._world=t}get enabled(){return this._enabled}get entities(){return null===this.query?this._world.getEntities():this.query.getEntities()}disable(){this._enabled=!1}enable(){this._enabled=!0}}function Qi(t){return function(){return[...t]}}function Ki(t){return function(){return t.filter((t=>t.post&&t.post!==Gi&&t.enabled))}}function Vi(t){return function(){return t.filter((t=>t.pre&&t.pre!==Bi&&t.enabled))}}function Wi(t){return function(){return t.filter((t=>t.update&&t.update!==Li&&t.enabled))}}function Yi(t){return function(e){return t[e]}}function Zi(t){return function(e){return t.get(e)}}function Hi(t){return function(e){return t.has(e.name)||[...t.values()].includes(e)}}function Ji(t){return function(e,r){const n=t.indexOf(e);if(-1===n)return-1;const o=gi(r,0,t.length);return t.splice(o,1),t.splice(n,0,e),o}}function Xi(t,e,r){return function(n,o){if(!mi(n.name))throw new SyntaxError(`"${n.name}" is not a valid system name.`);if(e.has(n.name))throw new Error(`System "${n.name}" is already registered!`);const i=new qi(r,n);return void 0!==o?t.splice(gi(o,0,t.length),0,i):t.push(i),e.set(i.name,i),i}}function ta(t,e,r){return function(n){if(!e.has(n.name))throw new Error(`System "${n.name}" is not registered!`);e.delete(n.name);const o=t.indexOf(n);return o>-1&&t.splice(o,1),r}}t.createWorld=function(t={}){const{entityPoolGrowthFactor:e=.25,initialEntityPoolSize:r=128,maxComponents:n=256,maxEntities:o=Number.POSITIVE_INFINITY,maxUpdates:i=240,tempo:a=1/60}=t,u=Object.create(null);return Object.assign(u,function(t,e){const r=new Map;return{addEntitiesToArchetype:ii(r,t),getArchetypes:ai(r),getEntitiesFromArchetype:ui(r),getEntitiesByComponents:si(r),isArchetypeEmpty:ci(r),removeEntitiesFromArchetype:fi(r,t),updateArchetype:li(r,t)}}(u),function(t,e){const{maxComponents:r}=e,n=new Map;return{getComponentById:_i(n),getComponentByName:bi(n),getComponents:wi(n),isComponentRegistered:Ti(n),registerComponent:Oi(n,{value:0n},r,t),unregisterComponent:Ri(n,t)}}(u,{maxComponents:n}),function(t,e){const{entityPoolGrowthFactor:r,initialEntityPoolSize:n,maxEntities:o}=e,i=new Ai({create:function(){return new Ii(t)},destroy:function(t){t.clear()},initialSize:n,growthFactor:r,maxSize:o,world:t}),a=new Map;return{createEntity:Pi(i,a,t),destroyEntity:ji(i,a,t),getEntities:xi(a),getEntityById:Ni(a),isEntityRegistered:Mi(a)}}(u,{entityPoolGrowthFactor:e,initialEntityPoolSize:r,maxEntities:o}),function(t,e){const r=new Set;return{isQueryRegistered:zi(r),registerQuery:ki(r,t),refreshQueries:$i(r,t),unregisterQuery:Ui(r,t)}}(u),function(t,e){const{maxUpdates:r,tempo:n}=e;return{step:Fi(r,n,t)}}(u,{maxUpdates:i,tempo:a}),function(t,e){const r=[],n=new Map;return{getSystems:Qi(r),getPostSystems:Ki(r),getPreSystems:Vi(r),getUpdateSystems:Wi(r),getSystemByIdx:Yi(r),getSystemByName:Zi(n),isSystemRegistered:Hi(n),moveSystem:Ji(r),registerSystem:Xi(r,n,t),unregisterSystem:ta(r,n,t)}}(u)),u.global=u.createEntity(),u.FORBIDDEN_NAMES=[...yi],u}}));
//# sourceMappingURL=index.min.js.map
