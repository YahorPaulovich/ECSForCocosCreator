/*! *****************************************************************************
 *
 * miski
 * v0.1.3
 *
 * MIT License
 * 
 * Copyright (C) 2021 Peter Hughes<https://www.phugh.es>, all rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
***************************************************************************** */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).miski={})}(this,(function(t){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(t){var e={exports:{}};return t(e,e.exports),e.exports}var r=function(t){return t&&t.Math==Math&&t},o=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof e&&e)||function(){return this}()||Function("return this")(),i=function(t){try{return!!t()}catch(t){return!0}},u=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),c={}.propertyIsEnumerable,a=Object.getOwnPropertyDescriptor,f={f:a&&!c.call({1:2},1)?function(t){var e=a(this,t);return!!e&&e.enumerable}:c},l=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},s={}.toString,p=function(t){return s.call(t).slice(8,-1)},d="".split,h=i((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==p(t)?d.call(t,""):Object(t)}:Object,g=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},y=function(t){return h(g(t))},v=function(t){return"object"==typeof t?null!==t:"function"==typeof t},m=function(t,e){if(!v(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!v(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!v(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!v(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},S={}.hasOwnProperty,E=function(t,e){return S.call(t,e)},T=o.document,b=v(T)&&v(T.createElement),R=!u&&!i((function(){return 7!=Object.defineProperty((t="div",b?T.createElement(t):{}),"a",{get:function(){return 7}}).a;var t})),I=Object.getOwnPropertyDescriptor,O={f:u?I:function(t,e){if(t=y(t),e=m(e,!0),R)try{return I(t,e)}catch(t){}if(E(t,e))return l(!f.f.call(t,e),t[e])}},w=function(t){if(!v(t))throw TypeError(String(t)+" is not an object");return t},A=Object.defineProperty,_={f:u?A:function(t,e,n){if(w(t),e=m(e,!0),w(n),R)try{return A(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},j=u?function(t,e,n){return _.f(t,e,l(1,n))}:function(t,e,n){return t[e]=n,t},P=function(t,e){try{j(o,t,e)}catch(n){o[t]=e}return e},M="__core-js_shared__",N=o[M]||P(M,{}),C=Function.toString;"function"!=typeof N.inspectSource&&(N.inspectSource=function(t){return C.call(t)});var D,x,z,U,k=N.inspectSource,B=o.WeakMap,F="function"==typeof B&&/native code/.test(k(B)),L=!1,K=n((function(t){(t.exports=function(t,e){return N[t]||(N[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.8.1",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})})),W=0,$=Math.random(),G=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++W+$).toString(36)},V=K("keys"),q={},Y=o.WeakMap;if(F){var H=N.state||(N.state=new Y),J=H.get,Q=H.has,X=H.set;D=function(t,e){return e.facade=t,X.call(H,t,e),e},x=function(t){return J.call(H,t)||{}},z=function(t){return Q.call(H,t)}}else{var Z=V[U="state"]||(V[U]=G(U));q[Z]=!0,D=function(t,e){return e.facade=t,j(t,Z,e),e},x=function(t){return E(t,Z)?t[Z]:{}},z=function(t){return E(t,Z)}}var tt={set:D,get:x,has:z,enforce:function(t){return z(t)?x(t):D(t,{})},getterFor:function(t){return function(e){var n;if(!v(e)||(n=x(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},et=n((function(t){var e=tt.get,n=tt.enforce,r=String(String).split("String");(t.exports=function(t,e,i,u){var c,a=!!u&&!!u.unsafe,f=!!u&&!!u.enumerable,l=!!u&&!!u.noTargetGet;"function"==typeof i&&("string"!=typeof e||E(i,"name")||j(i,"name",e),(c=n(i)).source||(c.source=r.join("string"==typeof e?e:""))),t!==o?(a?!l&&t[e]&&(f=!0):delete t[e],f?t[e]=i:j(t,e,i)):f?t[e]=i:P(e,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&e(this).source||k(this)}))})),nt=o,rt=function(t){return"function"==typeof t?t:void 0},ot=function(t,e){return arguments.length<2?rt(nt[t])||rt(o[t]):nt[t]&&nt[t][e]||o[t]&&o[t][e]},it=Math.ceil,ut=Math.floor,ct=function(t){return isNaN(t=+t)?0:(t>0?ut:it)(t)},at=Math.min,ft=function(t){return t>0?at(ct(t),9007199254740991):0},lt=Math.max,st=Math.min,pt=function(t){return function(e,n,r){var o,i=y(e),u=ft(i.length),c=function(t,e){var n=ct(t);return n<0?lt(n+e,0):st(n,e)}(r,u);if(t&&n!=n){for(;u>c;)if((o=i[c++])!=o)return!0}else for(;u>c;c++)if((t||c in i)&&i[c]===n)return t||c||0;return!t&&-1}},dt={includes:pt(!0),indexOf:pt(!1)}.indexOf,ht=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype"),gt={f:Object.getOwnPropertyNames||function(t){return function(t,e){var n,r=y(t),o=0,i=[];for(n in r)!E(q,n)&&E(r,n)&&i.push(n);for(;e.length>o;)E(r,n=e[o++])&&(~dt(i,n)||i.push(n));return i}(t,ht)}},yt={f:Object.getOwnPropertySymbols},vt=ot("Reflect","ownKeys")||function(t){var e=gt.f(w(t)),n=yt.f;return n?e.concat(n(t)):e},mt=function(t,e){for(var n=vt(e),r=_.f,o=O.f,i=0;i<n.length;i++){var u=n[i];E(t,u)||r(t,u,o(e,u))}},St=/#|\.prototype\./,Et=function(t,e){var n=bt[Tt(t)];return n==It||n!=Rt&&("function"==typeof e?i(e):!!e)},Tt=Et.normalize=function(t){return String(t).replace(St,".").toLowerCase()},bt=Et.data={},Rt=Et.NATIVE="N",It=Et.POLYFILL="P",Ot=Et,wt=O.f,At=function(t,e){var n,r,i,u,c,a=t.target,f=t.global,l=t.stat;if(n=f?o:l?o[a]||P(a,{}):(o[a]||{}).prototype)for(r in e){if(u=e[r],i=t.noTargetGet?(c=wt(n,r))&&c.value:n[r],!Ot(f?r:a+(l?".":"#")+r,t.forced)&&void 0!==i){if(typeof u==typeof i)continue;mt(u,i)}(t.sham||i&&i.sham)&&j(u,"sham",!0),et(n,r,u,t)}},_t=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},jt=function(){for(var t,e=w(this),n=_t(e.delete),r=!0,o=0,i=arguments.length;o<i;o++)t=n.call(e,arguments[o]),r=r&&t;return!!r};At({target:"Map",proto:!0,real:!0,forced:L},{deleteAll:function(){return jt.apply(this,arguments)}});var Pt=function(t,e,n){if(_t(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}},Mt=!!Object.getOwnPropertySymbols&&!i((function(){return!String(Symbol())})),Nt=Mt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ct=K("wks"),Dt=o.Symbol,xt=Nt?Dt:Dt&&Dt.withoutSetter||G,zt=function(t){return E(Ct,t)||(Mt&&E(Dt,t)?Ct[t]=Dt[t]:Ct[t]=xt("Symbol."+t)),Ct[t]},Ut={};Ut[zt("toStringTag")]="z";var kt="[object z]"===String(Ut),Bt=zt("toStringTag"),Ft="Arguments"==p(function(){return arguments}()),Lt=kt?p:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Bt))?n:Ft?p(e):"Object"==(r=p(e))&&"function"==typeof e.callee?"Arguments":r},Kt={},Wt=zt("iterator"),$t=function(t){if(null!=t)return t[Wt]||t["@@iterator"]||Kt[Lt(t)]},Gt=function(t){return Map.prototype.entries.call(t)},Vt=zt("iterator"),qt=Array.prototype,Yt=function(t){var e=t.return;if(void 0!==e)return w(e.call(t)).value},Ht=function(t,e){this.stopped=t,this.result=e},Jt=function(t,e,n){var r,o,i,u,c,a,f,l,s=n&&n.that,p=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),h=!(!n||!n.INTERRUPTED),g=Pt(e,s,1+p+h),y=function(t){return r&&Yt(r),new Ht(!0,t)},v=function(t){return p?(w(t),h?g(t[0],t[1],y):g(t[0],t[1])):h?g(t,y):g(t)};if(d)r=t;else{if("function"!=typeof(o=$t(t)))throw TypeError("Target is not iterable");if(void 0!==(l=o)&&(Kt.Array===l||qt[Vt]===l)){for(i=0,u=ft(t.length);u>i;i++)if((c=v(t[i]))&&c instanceof Ht)return c;return new Ht(!1)}r=o.call(t)}for(a=r.next;!(f=a.call(r)).done;){try{c=v(f.value)}catch(t){throw Yt(r),t}if("object"==typeof c&&c&&c instanceof Ht)return c}return new Ht(!1)};At({target:"Map",proto:!0,real:!0,forced:L},{every:function(t){var e=w(this),n=Gt(e),r=Pt(t,arguments.length>1?arguments[1]:void 0,3);return!Jt(n,(function(t,n,o){if(!r(n,t,e))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Qt=zt("species"),Xt=function(t,e){var n,r=w(t).constructor;return void 0===r||null==(n=w(r)[Qt])?e:_t(n)};At({target:"Map",proto:!0,real:!0,forced:L},{filter:function(t){var e=w(this),n=Gt(e),r=Pt(t,arguments.length>1?arguments[1]:void 0,3),o=new(Xt(e,ot("Map"))),i=_t(o.set);return Jt(n,(function(t,n){r(n,t,e)&&i.call(o,t,n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}}),At({target:"Map",proto:!0,real:!0,forced:L},{find:function(t){var e=w(this),n=Gt(e),r=Pt(t,arguments.length>1?arguments[1]:void 0,3);return Jt(n,(function(t,n,o){if(r(n,t,e))return o(n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),At({target:"Map",proto:!0,real:!0,forced:L},{findKey:function(t){var e=w(this),n=Gt(e),r=Pt(t,arguments.length>1?arguments[1]:void 0,3);return Jt(n,(function(t,n,o){if(r(n,t,e))return o(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});At({target:"Map",proto:!0,real:!0,forced:L},{includes:function(t){return Jt(Gt(w(this)),(function(e,n,r){if((o=n)===(i=t)||o!=o&&i!=i)return r();var o,i}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),At({target:"Map",proto:!0,real:!0,forced:L},{keyOf:function(t){return Jt(Gt(w(this)),(function(e,n,r){if(n===t)return r(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),At({target:"Map",proto:!0,real:!0,forced:L},{mapKeys:function(t){var e=w(this),n=Gt(e),r=Pt(t,arguments.length>1?arguments[1]:void 0,3),o=new(Xt(e,ot("Map"))),i=_t(o.set);return Jt(n,(function(t,n){i.call(o,r(n,t,e),n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}}),At({target:"Map",proto:!0,real:!0,forced:L},{mapValues:function(t){var e=w(this),n=Gt(e),r=Pt(t,arguments.length>1?arguments[1]:void 0,3),o=new(Xt(e,ot("Map"))),i=_t(o.set);return Jt(n,(function(t,n){i.call(o,t,r(n,t,e))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}}),At({target:"Map",proto:!0,real:!0,forced:L},{merge:function(t){for(var e=w(this),n=_t(e.set),r=0;r<arguments.length;)Jt(arguments[r++],n,{that:e,AS_ENTRIES:!0});return e}}),At({target:"Map",proto:!0,real:!0,forced:L},{reduce:function(t){var e=w(this),n=Gt(e),r=arguments.length<2,o=r?void 0:arguments[1];if(_t(t),Jt(n,(function(n,i){r?(r=!1,o=i):o=t(o,i,n,e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),r)throw TypeError("Reduce of empty map with no initial value");return o}}),At({target:"Map",proto:!0,real:!0,forced:L},{some:function(t){var e=w(this),n=Gt(e),r=Pt(t,arguments.length>1?arguments[1]:void 0,3);return Jt(n,(function(t,n,o){if(r(n,t,e))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),At({target:"Map",proto:!0,real:!0,forced:L},{update:function(t,e){var n=w(this),r=arguments.length;_t(e);var o=n.has(t);if(!o&&r<3)throw TypeError("Updating absent value");var i=o?n.get(t):_t(r>2?arguments[2]:void 0)(t,n);return n.set(t,e(i,t,n)),n}});var Zt=function(){for(var t=w(this),e=_t(t.add),n=0,r=arguments.length;n<r;n++)e.call(t,arguments[n]);return t};At({target:"Set",proto:!0,real:!0,forced:L},{addAll:function(){return Zt.apply(this,arguments)}}),At({target:"Set",proto:!0,real:!0,forced:L},{deleteAll:function(){return jt.apply(this,arguments)}}),At({target:"Set",proto:!0,real:!0,forced:L},{difference:function(t){var e=w(this),n=new(Xt(e,ot("Set")))(e),r=_t(n.delete);return Jt(t,(function(t){r.call(n,t)})),n}});var te=function(t){return Set.prototype.values.call(t)};At({target:"Set",proto:!0,real:!0,forced:L},{every:function(t){var e=w(this),n=te(e),r=Pt(t,arguments.length>1?arguments[1]:void 0,3);return!Jt(n,(function(t,n){if(!r(t,t,e))return n()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),At({target:"Set",proto:!0,real:!0,forced:L},{filter:function(t){var e=w(this),n=te(e),r=Pt(t,arguments.length>1?arguments[1]:void 0,3),o=new(Xt(e,ot("Set"))),i=_t(o.add);return Jt(n,(function(t){r(t,t,e)&&i.call(o,t)}),{IS_ITERATOR:!0}),o}}),At({target:"Set",proto:!0,real:!0,forced:L},{find:function(t){var e=w(this),n=te(e),r=Pt(t,arguments.length>1?arguments[1]:void 0,3);return Jt(n,(function(t,n){if(r(t,t,e))return n(t)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),At({target:"Set",proto:!0,real:!0,forced:L},{intersection:function(t){var e=w(this),n=new(Xt(e,ot("Set"))),r=_t(e.has),o=_t(n.add);return Jt(t,(function(t){r.call(e,t)&&o.call(n,t)})),n}}),At({target:"Set",proto:!0,real:!0,forced:L},{isDisjointFrom:function(t){var e=w(this),n=_t(e.has);return!Jt(t,(function(t,r){if(!0===n.call(e,t))return r()}),{INTERRUPTED:!0}).stopped}}),At({target:"Set",proto:!0,real:!0,forced:L},{isSubsetOf:function(t){var e=function(t){var e=$t(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return w(e.call(t))}(this),n=w(t),r=n.has;return"function"!=typeof r&&(n=new(ot("Set"))(t),r=_t(n.has)),!Jt(e,(function(t,e){if(!1===r.call(n,t))return e()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),At({target:"Set",proto:!0,real:!0,forced:L},{isSupersetOf:function(t){var e=w(this),n=_t(e.has);return!Jt(t,(function(t,r){if(!1===n.call(e,t))return r()}),{INTERRUPTED:!0}).stopped}}),At({target:"Set",proto:!0,real:!0,forced:L},{join:function(t){var e=w(this),n=te(e),r=void 0===t?",":String(t),o=[];return Jt(n,o.push,{that:o,IS_ITERATOR:!0}),o.join(r)}}),At({target:"Set",proto:!0,real:!0,forced:L},{map:function(t){var e=w(this),n=te(e),r=Pt(t,arguments.length>1?arguments[1]:void 0,3),o=new(Xt(e,ot("Set"))),i=_t(o.add);return Jt(n,(function(t){i.call(o,r(t,t,e))}),{IS_ITERATOR:!0}),o}}),At({target:"Set",proto:!0,real:!0,forced:L},{reduce:function(t){var e=w(this),n=te(e),r=arguments.length<2,o=r?void 0:arguments[1];if(_t(t),Jt(n,(function(n){r?(r=!1,o=n):o=t(o,n,n,e)}),{IS_ITERATOR:!0}),r)throw TypeError("Reduce of empty set with no initial value");return o}}),At({target:"Set",proto:!0,real:!0,forced:L},{some:function(t){var e=w(this),n=te(e),r=Pt(t,arguments.length>1?arguments[1]:void 0,3);return Jt(n,(function(t,n){if(r(t,t,e))return n()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),At({target:"Set",proto:!0,real:!0,forced:L},{symmetricDifference:function(t){var e=w(this),n=new(Xt(e,ot("Set")))(e),r=_t(n.delete),o=_t(n.add);return Jt(t,(function(t){r.call(n,t)||o.call(n,t)})),n}}),At({target:"Set",proto:!0,real:!0,forced:L},{union:function(t){var e=w(this),n=new(Xt(e,ot("Set")))(e);return Jt(t,_t(n.add),{that:n}),n}});var ee,ne,re=function(t){return function(e,n,r,o){_t(n);var i=Object(g(e)),u=h(i),c=ft(i.length),a=t?c-1:0,f=t?-1:1;if(r<2)for(;;){if(a in u){o=u[a],a+=f;break}if(a+=f,t?a<0:c<=a)throw TypeError("Reduce of empty array with no initial value")}for(;t?a>=0:c>a;a+=f)a in u&&(o=n(o,u[a],a,i));return o}},oe={left:re(!1),right:re(!0)},ie=Object.defineProperty,ue={},ce=function(t){throw t},ae=ot("navigator","userAgent")||"",fe=o.process,le=fe&&fe.versions,se=le&&le.v8;se?ne=(ee=se.split("."))[0]+ee[1]:ae&&(!(ee=ae.match(/Edge\/(\d+)/))||ee[1]>=74)&&(ee=ae.match(/Chrome\/(\d+)/))&&(ne=ee[1]);var pe,de,he=ne&&+ne,ge="process"==p(o.process),ye=oe.left,ve=!!(de=[]["reduce"])&&i((function(){de.call(null,pe||function(){throw 1},1)})),me=function(t,e){if(E(ue,t))return ue[t];e||(e={});var n=[][t],r=!!E(e,"ACCESSORS")&&e.ACCESSORS,o=E(e,0)?e[0]:ce,c=E(e,1)?e[1]:void 0;return ue[t]=!!n&&!i((function(){if(r&&!u)return!0;var t={length:-1};r?ie(t,1,{enumerable:!0,get:ce}):t[1]=1,n.call(t,o,c)}))}("reduce",{1:0});function Se(t){const{id:e,name:n}={...t},r=function(t,...e){return e.forEach((e=>{const n=Object.keys(e).reduce(((t,n)=>{const r=Object.getOwnPropertyDescriptor(e,n);return void 0!==r&&(t[n]=r),t}),{});Object.getOwnPropertySymbols(e).forEach((t=>{const r=Object.getOwnPropertyDescriptor(e,t);null!=r&&r.enumerable&&(n[t]=r)})),Object.defineProperties(t,n)})),t}({},t.properties);let{entityLimit:o=null,removable:i=!0}={...t};const{entities:u}={entities:new Set},c={get id(){return e},get name(){return n},get entities(){return Array.from(u)},get entityLimit(){return o},get properties(){return r},get removable(){return i}};return Object.freeze(Object.assign(c,{hasEntity:function(t){return u.has(t)},setEntityLimit:function(t){o=t},setRemovable:function(t){i=t},_addEntity:function(t){if(null!=o&&u.size>=o)throw new Error(`component "${n}" has reached its entity limit of ${o}.`);u.add(t)},_removeEntity:function(t){if(!i)throw new Error(`component ${n} is not removable.`);u.delete(t)}}))}function Ee(t){"number"==typeof t&&(t=BigInt(t));let{mask:e}={mask:1n<<t};const n={get value(){return e}};return Object.freeze(Object.assign(n,{has:function(t){return"number"==typeof t&&(t=BigInt(t)),Boolean((e&t)===e)},set:function(t){"number"==typeof t&&(t=BigInt(t)),e|=1n<<t},test:function(t){return"number"==typeof t&&(t=BigInt(t)),Boolean(0n!==(e&1n<<t))},toggle:function(t){"number"==typeof t&&(t=BigInt(t)),e^=1n<<t},toString:function(){return e.toString(2)},unset:function(t){"number"==typeof t&&(t=BigInt(t)),e&=~(1n<<t)}}))}function Te(){const{archetype:t,components:e,componentObjects:n}={archetype:Ee(0n),components:{},componentObjects:new Set};let{_id:r}={_id:0n};const o=Object.create({components:e},{archetype:{get:function(){return t.value}},allComponents:{get:function(){return Array.from(n)}},id:{get:function(){return r}}});return Object.freeze(Object.assign(o,{_setId:function(t){r=t},_addComponent:function(r){e[r.name]||(e[r.name]={...r.properties},t.set(r.id),n.add(r))},_removeComponent:function(r){e[r.name]&&(delete e[r.name],t.unset(r.id),n.delete(r))},hasComponent:function(t){const n="string"==typeof t?t:t.name;return Boolean(e[n])}}))}function be(t){const{initialSize:e=2,create:n,destroy:r}={...t},o=[];for(let t=0;t<e;t++)o.push(n());return Object.freeze({get:function(){var t;return null!==(t=o.pop())&&void 0!==t?t:n()},release:function(t){o.push(r(t))}})}At({target:"Array",proto:!0,forced:!ve||!me||!ge&&he>79&&he<83},{reduce:function(t){return ye(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}}),t.createWorld=function(t){const{initialPoolSize:e=10,maxComponents:n=1024n}={...t},{archetypes:r,components:o,entities:i,systems:u,entityPool:c}={archetypes:new Map,components:new Map,entities:new Map,systems:[],entityPool:be({create:Te,destroy:function(t){return t._setId(-1n),S(t,...t.allComponents),h(t),t},initialSize:e})};let{componentCount:a,entityCount:f,systemCount:l,worldComponent:s,worldEntity:p}={componentCount:0n,entityCount:0n,systemCount:0n,worldComponent:{},worldEntity:{}};const d=t=>{var e;void 0===r.get(t.archetype)&&r.set(t.archetype,new Set),null===(e=r.get(t.archetype))||void 0===e||e.add(t)},h=t=>{var e;null===(e=r.get(t.archetype))||void 0===e||e.delete(t)},g={get archetypes(){return Array.from(r.entries())},get components(){return Array.from(o.values())},get component(){return s},get entities(){return Array.from(i.values())},get entity(){return p},get systems(){return Array.from(u)}},y=function(){const t=c.get();return t._setId(f),i.set(f,t),d(t),++f,t},v=function(t){if(n&&a>n)throw new Error("Maximum component count reached.");const e=Se({...t,id:a});return o.set(e.name,e),++a,e},m=function(t,...e){return h(t),e.forEach((e=>{e._addEntity(t),t._addComponent(e)})),d(t),t},S=function(t,...e){return h(t),e.forEach((e=>{e._removeEntity(t),t._removeComponent(e)})),d(t),t};p=y();const E=Object.freeze(Object.assign(g,{createEntity:y,removeEntity:function(t){const e=i.delete(t.id);return e&&c.release(t),e},createComponent:v,removeComponent:function(t){const e=o.delete(t.name);return e&&t.entities.forEach((e=>S(e,t))),e},addComponentsToEntity:m,removeComponentsFromEntity:S,createSystem:function(t,e){const n=function(t){const{id:e,components:n=[],updateFn:r=(()=>{}),renderFn:o=(()=>{})}={...t},{archetype:i}={archetype:Ee(0n)};n.forEach((t=>i.set(t.id)));let{enabled:u}={enabled:!1};const c={get archetype(){return i.value},get enabled(){return u},get id(){return e}};return Object.freeze(Object.assign(c,{enable:function(){u=!0},disable:function(){u=!1},update:function(t,e){r(t,e)},render:function(t,e){o(t,e)}}))}({...t,id:l});return void 0!==e?u.splice(e,0,n):u.push(n),++l,n},removeSystem:function(t){const e=u.indexOf(t);return e>-1&&(u.splice(e,1),!0)},update:function(t){const e=Array.from(r.entries()),n=e.length-1,o=[];for(let r=u.length-1;r>=0;r--){const i=u[r];if(!1!==i.enabled){for(let t=n;t>=0;t--){const[n,r]=e[t];(i.archetype&n)===i.archetype&&o.push(...r)}i.update(t,o),o.length=0}}},render:function(t){const e=Array.from(r.entries()),n=e.length-1,o=[];for(let r=u.length-1;r>=0;r--){const i=u[r];if(!1!==i.enabled){for(let t=n;t>=0;t--){const[n,r]=e[t];(i.archetype&n)===i.archetype&&o.push(...r)}i.render(t,o),o.length=0}}}}));return s=v({name:"world",entityLimit:1,removable:!1,properties:{world:E}}),m(p,s),E}}));
//# sourceMappingURL=index.min.js.map
