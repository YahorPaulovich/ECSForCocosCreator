/*! *****************************************************************************
 *
 * miski
 * v0.2.1
 *
 * MIT License
 * 
 * Copyright (C) 2021 Peter Hughes<https://www.phugh.es>, all rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
***************************************************************************** */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).miski={})}(this,(function(e){"use strict";function t(e=0n){"number"==typeof e&&(e=BigInt(e));let t=1n<<e;const n=e=>("number"==typeof e&&(e=BigInt(e)),t&=~(1n<<e),t),r=e=>("number"==typeof e&&(e=BigInt(e)),t|=1n<<e,t);return Object.freeze({clear:()=>t=1n<<0n,has:function(e){return"number"==typeof e&&(e=BigInt(e)),(t&e)===t},isOn:e=>("number"==typeof e&&(e=BigInt(e)),0n!==(t&1n<<e)),off:n,on:r,set:(e,t)=>!0===t?r(e):n(e),toArray:()=>t.toString(2).split("").map((e=>parseInt(e,10))),toggle:e=>("number"==typeof e&&(e=BigInt(e)),t^=1n<<e,t),toNumber:()=>Number(t),toString:()=>t.toString(2),value:()=>t})}function n(e,...t){const n=t.length;if(!t||!n)return e;const r={};for(let e=0;e<n;e++){const n=t[e],o=Object.keys(n),i=o.length;for(let e=0;e<i;e++){const t=o[e],i=Object.getOwnPropertyDescriptor(n,t);i&&i.enumerable&&(r[t]=i)}const a=Object.getOwnPropertySymbols(n);for(let e=0;e<a.length;e++){const t=a[e],o=Object.getOwnPropertyDescriptor(n,t);o&&o.enumerable&&(r[t]=o)}}return Object.defineProperties(e,r),e}function r(e){const{maxComponents:t}={...e},r={},o=[];let i=0,a=0;for(let e=t;e>=0;e--)o[e]=a++;return Object.freeze({getComponentById:e=>("number"==typeof e&&(e=BigInt(e)),Object.values(r).find((t=>t.id===e))),getComponentByName:e=>r[e],getComponents:()=>Object.values(r),isComponentRegistered:e=>e.name in r,registerComponent:e=>{if(i>=t)throw new Error("maximum components reached!");if(e.name in r)throw new Error(`component with name "${e.name}" already registered!`);const a=o.pop();if(void 0===a)throw new Error("no available ids!");const u=function(e){const{entityLimit:t=null,id:r,name:o,properties:i,removable:a=!0}={...e};if(!o||!i||"object"!=typeof i||null==r)throw new Error("malformed component.");return n(i,e.properties),Object.seal(i),Object.freeze(Object.create({},{entityLimit:{value:t,enumerable:!0},id:{value:r,enumerable:!0},name:{value:o,enumerable:!0},properties:{value:i,enumerable:!0},removable:{value:a,enumerable:!0}}))}({...e,id:a});return r[u.name]=u,i++,u},unregisterComponent:e=>{if(!(e.name in r))throw new Error(`component "${e.name}" is not registered.`);delete r[e.name],o.unshift(e.id);const t=Object.create(e);return delete t.id,i--,t}})}var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e){var t={exports:{}};return e(t,t.exports),t.exports}var a=function(e){return e&&e.Math==Math&&e},u=a("object"==typeof globalThis&&globalThis)||a("object"==typeof window&&window)||a("object"==typeof self&&self)||a("object"==typeof o&&o)||function(){return this}()||Function("return this")(),c=function(e){try{return!!e()}catch(e){return!0}},f=!c((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),l={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,p={f:s&&!l.call({1:2},1)?function(e){var t=s(this,e);return!!t&&t.enumerable}:l},d=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},g={}.toString,y=function(e){return g.call(e).slice(8,-1)},m="".split,h=c((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==y(e)?m.call(e,""):Object(e)}:Object,v=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},S=function(e){return h(v(e))},E=function(e){return"object"==typeof e?null!==e:"function"==typeof e},b=function(e,t){if(!E(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!E(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!E(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!E(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},T={}.hasOwnProperty,w=function(e,t){return T.call(e,t)},R=u.document,I=E(R)&&E(R.createElement),O=!f&&!c((function(){return 7!=Object.defineProperty((e="div",I?R.createElement(e):{}),"a",{get:function(){return 7}}).a;var e})),A=Object.getOwnPropertyDescriptor,j={f:f?A:function(e,t){if(e=S(e),t=b(t,!0),O)try{return A(e,t)}catch(e){}if(w(e,t))return d(!p.f.call(e,t),e[t])}},C=function(e){if(!E(e))throw TypeError(String(e)+" is not an object");return e},N=Object.defineProperty,_={f:f?N:function(e,t,n){if(C(e),t=b(t,!0),C(n),O)try{return N(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},P=f?function(e,t,n){return _.f(e,t,d(1,n))}:function(e,t,n){return e[t]=n,e},x=function(e,t){try{P(u,e,t)}catch(n){u[e]=t}return t},M="__core-js_shared__",B=u[M]||x(M,{}),U=Function.toString;"function"!=typeof B.inspectSource&&(B.inspectSource=function(e){return U.call(e)});var D,z,k,$,F=B.inspectSource,L=u.WeakMap,W="function"==typeof L&&/native code/.test(F(L)),K=!1,G=i((function(e){(e.exports=function(e,t){return B[e]||(B[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.8.3",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})})),V=0,q=Math.random(),Y=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++V+q).toString(36)},H=G("keys"),J={},Q=u.WeakMap;if(W){var X=B.state||(B.state=new Q),Z=X.get,ee=X.has,te=X.set;D=function(e,t){return t.facade=e,te.call(X,e,t),t},z=function(e){return Z.call(X,e)||{}},k=function(e){return ee.call(X,e)}}else{var ne=H[$="state"]||(H[$]=Y($));J[ne]=!0,D=function(e,t){return t.facade=e,P(e,ne,t),t},z=function(e){return w(e,ne)?e[ne]:{}},k=function(e){return w(e,ne)}}var re,oe,ie={set:D,get:z,has:k,enforce:function(e){return k(e)?z(e):D(e,{})},getterFor:function(e){return function(t){var n;if(!E(t)||(n=z(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},ae=i((function(e){var t=ie.get,n=ie.enforce,r=String(String).split("String");(e.exports=function(e,t,o,i){var a,c=!!i&&!!i.unsafe,f=!!i&&!!i.enumerable,l=!!i&&!!i.noTargetGet;"function"==typeof o&&("string"!=typeof t||w(o,"name")||P(o,"name",t),(a=n(o)).source||(a.source=r.join("string"==typeof t?t:""))),e!==u?(c?!l&&e[t]&&(f=!0):delete e[t],f?e[t]=o:P(e,t,o)):f?e[t]=o:x(t,o)})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||F(this)}))})),ue=u,ce=function(e){return"function"==typeof e?e:void 0},fe=function(e,t){return arguments.length<2?ce(ue[e])||ce(u[e]):ue[e]&&ue[e][t]||u[e]&&u[e][t]},le=Math.ceil,se=Math.floor,pe=function(e){return isNaN(e=+e)?0:(e>0?se:le)(e)},de=Math.min,ge=function(e){return e>0?de(pe(e),9007199254740991):0},ye=Math.max,me=Math.min,he=function(e){return function(t,n,r){var o,i=S(t),a=ge(i.length),u=function(e,t){var n=pe(e);return n<0?ye(n+t,0):me(n,t)}(r,a);if(e&&n!=n){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((e||u in i)&&i[u]===n)return e||u||0;return!e&&-1}},ve={includes:he(!0),indexOf:he(!1)}.indexOf,Se=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype"),Ee={f:Object.getOwnPropertyNames||function(e){return function(e,t){var n,r=S(e),o=0,i=[];for(n in r)!w(J,n)&&w(r,n)&&i.push(n);for(;t.length>o;)w(r,n=t[o++])&&(~ve(i,n)||i.push(n));return i}(e,Se)}},be={f:Object.getOwnPropertySymbols},Te=fe("Reflect","ownKeys")||function(e){var t=Ee.f(C(e)),n=be.f;return n?t.concat(n(e)):t},we=function(e,t){for(var n=Te(t),r=_.f,o=j.f,i=0;i<n.length;i++){var a=n[i];w(e,a)||r(e,a,o(t,a))}},Re=/#|\.prototype\./,Ie=function(e,t){var n=Ae[Oe(e)];return n==Ce||n!=je&&("function"==typeof t?c(t):!!t)},Oe=Ie.normalize=function(e){return String(e).replace(Re,".").toLowerCase()},Ae=Ie.data={},je=Ie.NATIVE="N",Ce=Ie.POLYFILL="P",Ne=Ie,_e=j.f,Pe=function(e,t){var n,r,o,i,a,c=e.target,f=e.global,l=e.stat;if(n=f?u:l?u[c]||x(c,{}):(u[c]||{}).prototype)for(r in t){if(i=t[r],o=e.noTargetGet?(a=_e(n,r))&&a.value:n[r],!Ne(f?r:c+(l?".":"#")+r,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;we(i,o)}(e.sham||o&&o.sham)&&P(i,"sham",!0),ae(n,r,i,e)}},xe=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Me=function(e){return function(t,n,r,o){xe(n);var i=Object(v(t)),a=h(i),u=ge(i.length),c=e?u-1:0,f=e?-1:1;if(r<2)for(;;){if(c in a){o=a[c],c+=f;break}if(c+=f,e?c<0:u<=c)throw TypeError("Reduce of empty array with no initial value")}for(;e?c>=0:u>c;c+=f)c in a&&(o=n(o,a[c],c,i));return o}},Be={left:Me(!1),right:Me(!0)},Ue=Object.defineProperty,De={},ze=function(e){throw e},ke=fe("navigator","userAgent")||"",$e=u.process,Fe=$e&&$e.versions,Le=Fe&&Fe.v8;Le?oe=(re=Le.split("."))[0]+re[1]:ke&&(!(re=ke.match(/Edge\/(\d+)/))||re[1]>=74)&&(re=ke.match(/Chrome\/(\d+)/))&&(oe=re[1]);var We,Ke,Ge=oe&&+oe,Ve="process"==y(u.process),qe=Be.left,Ye=!!(Ke=[]["reduce"])&&c((function(){Ke.call(null,We||function(){throw 1},1)})),He=function(e,t){if(w(De,e))return De[e];t||(t={});var n=[][e],r=!!w(t,"ACCESSORS")&&t.ACCESSORS,o=w(t,0)?t[0]:ze,i=w(t,1)?t[1]:void 0;return De[e]=!!n&&!c((function(){if(r&&!f)return!0;var e={length:-1};r?Ue(e,1,{enumerable:!0,get:ze}):e[1]=1,n.call(e,o,i)}))}("reduce",{1:0});Pe({target:"Array",proto:!0,forced:!Ye||!He||!Ve&&Ge>79&&Ge<83},{reduce:function(e){return qe(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}});var Je=function(){for(var e,t=C(this),n=xe(t.delete),r=!0,o=0,i=arguments.length;o<i;o++)e=n.call(t,arguments[o]),r=r&&e;return!!r};Pe({target:"Map",proto:!0,real:!0,forced:K},{deleteAll:function(){return Je.apply(this,arguments)}});var Qe=function(e,t,n){if(xe(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}},Xe=!!Object.getOwnPropertySymbols&&!c((function(){return!String(Symbol())})),Ze=Xe&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,et=G("wks"),tt=u.Symbol,nt=Ze?tt:tt&&tt.withoutSetter||Y,rt=function(e){return w(et,e)||(Xe&&w(tt,e)?et[e]=tt[e]:et[e]=nt("Symbol."+e)),et[e]},ot={};ot[rt("toStringTag")]="z";var it="[object z]"===String(ot),at=rt("toStringTag"),ut="Arguments"==y(function(){return arguments}()),ct=it?y:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),at))?n:ut?y(t):"Object"==(r=y(t))&&"function"==typeof t.callee?"Arguments":r},ft={},lt=rt("iterator"),st=function(e){if(null!=e)return e[lt]||e["@@iterator"]||ft[ct(e)]},pt=function(e){return Map.prototype.entries.call(e)},dt=rt("iterator"),gt=Array.prototype,yt=function(e){var t=e.return;if(void 0!==t)return C(t.call(e)).value},mt=function(e,t){this.stopped=e,this.result=t},ht=function(e,t,n){var r,o,i,a,u,c,f,l,s=n&&n.that,p=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),g=!(!n||!n.INTERRUPTED),y=Qe(t,s,1+p+g),m=function(e){return r&&yt(r),new mt(!0,e)},h=function(e){return p?(C(e),g?y(e[0],e[1],m):y(e[0],e[1])):g?y(e,m):y(e)};if(d)r=e;else{if("function"!=typeof(o=st(e)))throw TypeError("Target is not iterable");if(void 0!==(l=o)&&(ft.Array===l||gt[dt]===l)){for(i=0,a=ge(e.length);a>i;i++)if((u=h(e[i]))&&u instanceof mt)return u;return new mt(!1)}r=o.call(e)}for(c=r.next;!(f=c.call(r)).done;){try{u=h(f.value)}catch(e){throw yt(r),e}if("object"==typeof u&&u&&u instanceof mt)return u}return new mt(!1)};Pe({target:"Map",proto:!0,real:!0,forced:K},{every:function(e){var t=C(this),n=pt(t),r=Qe(e,arguments.length>1?arguments[1]:void 0,3);return!ht(n,(function(e,n,o){if(!r(n,e,t))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var vt=rt("species"),St=function(e,t){var n,r=C(e).constructor;return void 0===r||null==(n=C(r)[vt])?t:xe(n)};Pe({target:"Map",proto:!0,real:!0,forced:K},{filter:function(e){var t=C(this),n=pt(t),r=Qe(e,arguments.length>1?arguments[1]:void 0,3),o=new(St(t,fe("Map"))),i=xe(o.set);return ht(n,(function(e,n){r(n,e,t)&&i.call(o,e,n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}}),Pe({target:"Map",proto:!0,real:!0,forced:K},{find:function(e){var t=C(this),n=pt(t),r=Qe(e,arguments.length>1?arguments[1]:void 0,3);return ht(n,(function(e,n,o){if(r(n,e,t))return o(n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),Pe({target:"Map",proto:!0,real:!0,forced:K},{findKey:function(e){var t=C(this),n=pt(t),r=Qe(e,arguments.length>1?arguments[1]:void 0,3);return ht(n,(function(e,n,o){if(r(n,e,t))return o(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});Pe({target:"Map",proto:!0,real:!0,forced:K},{includes:function(e){return ht(pt(C(this)),(function(t,n,r){if((o=n)===(i=e)||o!=o&&i!=i)return r();var o,i}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),Pe({target:"Map",proto:!0,real:!0,forced:K},{keyOf:function(e){return ht(pt(C(this)),(function(t,n,r){if(n===e)return r(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),Pe({target:"Map",proto:!0,real:!0,forced:K},{mapKeys:function(e){var t=C(this),n=pt(t),r=Qe(e,arguments.length>1?arguments[1]:void 0,3),o=new(St(t,fe("Map"))),i=xe(o.set);return ht(n,(function(e,n){i.call(o,r(n,e,t),n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}}),Pe({target:"Map",proto:!0,real:!0,forced:K},{mapValues:function(e){var t=C(this),n=pt(t),r=Qe(e,arguments.length>1?arguments[1]:void 0,3),o=new(St(t,fe("Map"))),i=xe(o.set);return ht(n,(function(e,n){i.call(o,e,r(n,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}}),Pe({target:"Map",proto:!0,real:!0,forced:K},{merge:function(e){for(var t=C(this),n=xe(t.set),r=0;r<arguments.length;)ht(arguments[r++],n,{that:t,AS_ENTRIES:!0});return t}}),Pe({target:"Map",proto:!0,real:!0,forced:K},{reduce:function(e){var t=C(this),n=pt(t),r=arguments.length<2,o=r?void 0:arguments[1];if(xe(e),ht(n,(function(n,i){r?(r=!1,o=i):o=e(o,i,n,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),r)throw TypeError("Reduce of empty map with no initial value");return o}}),Pe({target:"Map",proto:!0,real:!0,forced:K},{some:function(e){var t=C(this),n=pt(t),r=Qe(e,arguments.length>1?arguments[1]:void 0,3);return ht(n,(function(e,n,o){if(r(n,e,t))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),Pe({target:"Map",proto:!0,real:!0,forced:K},{update:function(e,t){var n=C(this),r=arguments.length;xe(t);var o=n.has(e);if(!o&&r<3)throw TypeError("Updating absent value");var i=o?n.get(e):xe(r>2?arguments[2]:void 0)(e,n);return n.set(e,t(i,e,n)),n}});var Et=function(){for(var e=C(this),t=xe(e.add),n=0,r=arguments.length;n<r;n++)t.call(e,arguments[n]);return e};Pe({target:"Set",proto:!0,real:!0,forced:K},{addAll:function(){return Et.apply(this,arguments)}}),Pe({target:"Set",proto:!0,real:!0,forced:K},{deleteAll:function(){return Je.apply(this,arguments)}}),Pe({target:"Set",proto:!0,real:!0,forced:K},{difference:function(e){var t=C(this),n=new(St(t,fe("Set")))(t),r=xe(n.delete);return ht(e,(function(e){r.call(n,e)})),n}});var bt=function(e){return Set.prototype.values.call(e)};function Tt(){const e=t(),r=`${Date.now().toString(36)}_${Math.random().toString(36).substr(2,9)}`,o={};let i=!0,a=null;const u=Object.create({},{_:{value:o,enumerable:!0},addComponent:{value:t=>{if(t.name in o)return console.warn(`Entity "${r}" already has component "${t.name}".`),!1;try{o[t.name]=n({},t.properties),e.on(t.id)}catch(e){return console.warn(`Error adding component "${t.name}" to entity "${r}".`,e),!1}return!0}},getArchetype:{value:()=>e.value()},hasComponent:{value:e=>{var t;return null!==(t="string"==typeof e?e in o:e.name in o)&&void 0!==t&&t}},isAwake:{value:()=>i},id:{value:r,enumerable:!0},next:{value:e=>(void 0!==e&&(a=e),a)},purge:{value:()=>{var t;t=o,Object.keys(t).forEach((e=>delete t[e])),e.clear()}},removeComponent:{value:t=>t.name in o&&(delete o[t.name],e.off(t.id),!0)},sleep:{value:()=>i=!1},wake:{value:()=>i=!0}});return Object.freeze(u)}function wt(e){const{initialPoolSize:t,maxEntities:n}={...e},r=[];let o;const i=(e=1)=>{for(let t=0;t<e;t++){if(r.length>=n)throw new Error("The entity pool is full.");const e=Tt();e.next(o),o=e,r.push(e)}},a=()=>{r.length=0,o=null,i(t)};return a(),Object.freeze({flush:a,get:()=>{o||i(.25*t);const e=o;return o=e.next(),e},release:e=>{e.purge(),e.next(o),o=e}})}function Rt(e){const{initialPoolSize:n,maxEntities:r}={...e},o=wt({initialPoolSize:n,maxEntities:r}),i={},a=new Map;let u=!0;const c=()=>Object.values(i),f=(e,t=!1)=>{if(t){var n;const t=null!==(n=a.get(e))&&void 0!==n?n:[];return[[e],[...t]]}{const t=new Set,n=new Set;return a.forEach(((n,r)=>{(r&e)===e&&n.forEach((e=>t.add(e)))})),[[...n],[...t]]}},l=(e,t)=>{var n;null!=t&&(null===(n=a.get(t))||void 0===n||n.delete(e));const r=e.getArchetype();var o;a.has(r)?null===(o=a.get(r))||void 0===o||o.add(e):(a.set(r,new Set([e])),u=!0);return e};return Object.freeze({areArchetypesDirty:()=>u,cleanedArchetypes:()=>u=!1,createEntity:()=>{const e=o.get();if(!e)throw new Error("no entities left!");return i[e.id]=e,l(e),e},destroyEntity:e=>{const t=e.id in i;if(!0===t){var n,r;delete i[e.id];const t=e.getArchetype();null===(n=a.get(t))||void 0===n||n.delete(e),0===(null===(r=a.get(t))||void 0===r?void 0:r.size)&&(a.delete(t),u=!0),o.release(e)}return t},getEntities:c,getEntitiesByComponents:(...e)=>{const n=function(...e){const n=t();return e.forEach((e=>n.on(e.id))),n.value()}(...e);return f(n)[1]},getEntitiesByMask:f,getEntitiesFromMasks:e=>[...e.reduce(((e,t)=>{var n;const r=null!==(n=a.get(t))&&void 0!==n?n:[];return e.push(...r),e}),[])],getEntityById:e=>i[e],rebuildArchetypes:()=>{a.clear();const e=c();for(let t=0;t<e.length;t++)l(e[t]);u=!1},updateArchetype:l})}Pe({target:"Set",proto:!0,real:!0,forced:K},{every:function(e){var t=C(this),n=bt(t),r=Qe(e,arguments.length>1?arguments[1]:void 0,3);return!ht(n,(function(e,n){if(!r(e,e,t))return n()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),Pe({target:"Set",proto:!0,real:!0,forced:K},{filter:function(e){var t=C(this),n=bt(t),r=Qe(e,arguments.length>1?arguments[1]:void 0,3),o=new(St(t,fe("Set"))),i=xe(o.add);return ht(n,(function(e){r(e,e,t)&&i.call(o,e)}),{IS_ITERATOR:!0}),o}}),Pe({target:"Set",proto:!0,real:!0,forced:K},{find:function(e){var t=C(this),n=bt(t),r=Qe(e,arguments.length>1?arguments[1]:void 0,3);return ht(n,(function(e,n){if(r(e,e,t))return n(e)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),Pe({target:"Set",proto:!0,real:!0,forced:K},{intersection:function(e){var t=C(this),n=new(St(t,fe("Set"))),r=xe(t.has),o=xe(n.add);return ht(e,(function(e){r.call(t,e)&&o.call(n,e)})),n}}),Pe({target:"Set",proto:!0,real:!0,forced:K},{isDisjointFrom:function(e){var t=C(this),n=xe(t.has);return!ht(e,(function(e,r){if(!0===n.call(t,e))return r()}),{INTERRUPTED:!0}).stopped}}),Pe({target:"Set",proto:!0,real:!0,forced:K},{isSubsetOf:function(e){var t=function(e){var t=st(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return C(t.call(e))}(this),n=C(e),r=n.has;return"function"!=typeof r&&(n=new(fe("Set"))(e),r=xe(n.has)),!ht(t,(function(e,t){if(!1===r.call(n,e))return t()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),Pe({target:"Set",proto:!0,real:!0,forced:K},{isSupersetOf:function(e){var t=C(this),n=xe(t.has);return!ht(e,(function(e,r){if(!1===n.call(t,e))return r()}),{INTERRUPTED:!0}).stopped}}),Pe({target:"Set",proto:!0,real:!0,forced:K},{join:function(e){var t=C(this),n=bt(t),r=void 0===e?",":String(e),o=[];return ht(n,o.push,{that:o,IS_ITERATOR:!0}),o.join(r)}}),Pe({target:"Set",proto:!0,real:!0,forced:K},{map:function(e){var t=C(this),n=bt(t),r=Qe(e,arguments.length>1?arguments[1]:void 0,3),o=new(St(t,fe("Set"))),i=xe(o.add);return ht(n,(function(e){i.call(o,r(e,e,t))}),{IS_ITERATOR:!0}),o}}),Pe({target:"Set",proto:!0,real:!0,forced:K},{reduce:function(e){var t=C(this),n=bt(t),r=arguments.length<2,o=r?void 0:arguments[1];if(xe(e),ht(n,(function(n){r?(r=!1,o=n):o=e(o,n,n,t)}),{IS_ITERATOR:!0}),r)throw TypeError("Reduce of empty set with no initial value");return o}}),Pe({target:"Set",proto:!0,real:!0,forced:K},{some:function(e){var t=C(this),n=bt(t),r=Qe(e,arguments.length>1?arguments[1]:void 0,3);return ht(n,(function(e,n){if(r(e,e,t))return n()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),Pe({target:"Set",proto:!0,real:!0,forced:K},{symmetricDifference:function(e){var t=C(this),n=new(St(t,fe("Set")))(t),r=xe(n.delete),o=xe(n.add);return ht(e,(function(e){r.call(n,e)||o.call(n,e)})),n}}),Pe({target:"Set",proto:!0,real:!0,forced:K},{union:function(e){var t=C(this),n=new(St(t,fe("Set")))(t);return ht(e,xe(n.add),{that:n}),n}});const It=function(){};function Ot(){const e={},n=[];return Object.freeze({getSystemByIndex:e=>{var t;return null!==(t=n[e])&&void 0!==t?t:void 0},getSystemByName:t=>e[t],getSystems:()=>[...n],isSystemRegistered:t=>t.name in e,moveSystem:(e,t)=>{const r=n.indexOf(e);return-1!==r&&(n.splice(r,1),n.splice(t,0,e),!0)},registerSystem:(r,o)=>{if(r.name in e)throw new Error(`system "${r.name}" is already registered!`);const i=function(e){const{components:n,exclusive:r=!1,name:o,postUpdate:i=It,preUpdate:a=It,update:u=It}={...e},c=n.reduce(((e,t)=>(e.on(t.id),e)),t()).value();let f=!1;return Object.freeze({get enabled(){return f},archetype:c,disable:()=>f=!1,enable:()=>f=!0,exclusive:r,name:o,postUpdate:i,preUpdate:a,update:u})}({...r});return void 0!==o?n.splice(o,0,i):n.push(i),e[i.name]=i,i},unregisterSystem:t=>{if(!(t.name in e))throw new Error(`system "${t.name}" is not registered!`);delete e[t.name],n.splice(n.indexOf(t),1)}})}e.createWorld=function(e){const{initialPoolSize:t=64,maxComponents:n=1024,maxEntities:o=1e5}={...e},{areArchetypesDirty:i,cleanedArchetypes:a,createEntity:u,destroyEntity:c,getEntities:f,getEntitiesByComponents:l,getEntitiesByMask:s,getEntitiesFromMasks:p,getEntityById:d,rebuildArchetypes:g,updateArchetype:y}=Rt({initialPoolSize:t,maxEntities:o}),{getComponentById:m,getComponentByName:h,getComponents:v,isComponentRegistered:S,registerComponent:E,unregisterComponent:b}=r({maxComponents:n}),{getSystemByIndex:T,getSystemByName:w,getSystems:R,isSystemRegistered:I,moveSystem:O,registerSystem:A,unregisterSystem:j}=Ot(),C=u(),N=E({name:"world",properties:{isWorld:!0},entityLimit:1,removable:!1}),_={},P=(e,...t)=>{if(!e)throw new Error("no entity provided.");if(null==t||!t.length)throw new Error("no components provided.");const n=t.length;let r;for(r=0;r<n;r++){let n;if(n="string"==typeof t[r]?h(t[r]):t[r],!n)throw new Error(`component ${t[r]} is not registered!.`);if(!e.hasComponent(n)){const t=e.getArchetype();e.addComponent(n),y(e,t)}}return e};return P(C,N),Object.freeze({addComponentsToEntity:P,createEntity:u,destroyEntity:c,entity:C,getComponentById:m,getComponentByName:h,getComponents:v,getEntities:f,getEntitiesByComponents:l,getEntitiesByMask:s,getEntityById:d,getSystemByIndex:T,getSystemByName:w,getSystems:R,isComponentRegistered:S,isSystemRegistered:I,moveSystem:O,postUpdate:e=>{const t=R();for(let n=0;n<t.length;n++){const r=t[n];if(!1!==r.enabled)if(!0===i()){const[t,n]=s(r.archetype,r.exclusive);_[r.name]=t,r.postUpdate(e,n,r)}else r.postUpdate(e,p(_[r.name]),r)}a()},preUpdate:()=>{const e=R();for(let t=0;t<e.length;t++){const n=e[t];if(!1!==n.enabled)if(!0===i()){const[e,t]=s(n.archetype,n.exclusive);_[n.name]=e,n.preUpdate(t,n)}else n.preUpdate(p(_[n.name]),n)}a()},registerComponent:E,registerSystem:A,removeComponentsFromEntity:(e,...t)=>{if(!e)throw new Error("no entity provided.");if(null==t||!t.length)throw new Error("no components provided.");const n=t.length;let r;for(r=0;r<n;r++){let n;if(n="string"==typeof t[r]?h(t[r]):t[r],!n)throw new Error(`component ${t[r]}  is not registered.`);if(e.hasComponent(n)){const t=e.getArchetype();e.removeComponent(n),y(e,t)}}return e},unregisterComponent:b,unregisterSystem:j,update:e=>{const t=R();for(let n=0;n<t.length;n++){const r=t[n];if(!1!==r.enabled)if(!0===i()){const[t,n]=s(r.archetype,r.exclusive);_[r.name]=t,r.update(e,n,r)}else r.update(e,p(_[r.name]),r)}a()}})}}));
//# sourceMappingURL=index.min.js.map
