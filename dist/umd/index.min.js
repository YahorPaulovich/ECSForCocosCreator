/*! *****************************************************************************
 *
 * miski
 * v0.2.2
 *
 * MIT License
 * 
 * Copyright (C) 2021 Peter Hughes<https://www.phugh.es>, all rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
***************************************************************************** */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).miski={})}(this,(function(e){"use strict";function t(e=0n){"number"==typeof e&&(e=BigInt(e));let t=1n<<e;const n=e=>("number"==typeof e&&(e=BigInt(e)),t&=~(1n<<e),t),r=e=>("number"==typeof e&&(e=BigInt(e)),t|=1n<<e,t);return Object.freeze({clear:()=>t=1n<<0n,has:function(e){return"number"==typeof e&&(e=BigInt(e)),(t&e)===t},isOn:e=>("number"==typeof e&&(e=BigInt(e)),0n!==(t&1n<<e)),off:n,on:r,set:(e,t)=>!0===t?r(e):n(e),toArray:()=>t.toString(2).split("").map((e=>parseInt(e,10))),toggle:e=>("number"==typeof e&&(e=BigInt(e)),t^=1n<<e,t),toNumber:()=>Number(t),toString:()=>t.toString(2),value:()=>t})}function n(e,...t){const n=t.length;if(!t||!n)return e;const r={};for(let e=0;e<n;e++){const n=t[e],o=Object.keys(n),i=o.length;for(let e=0;e<i;e++){const t=o[e],i=Object.getOwnPropertyDescriptor(n,t);i&&i.enumerable&&(r[t]=i)}const a=Object.getOwnPropertySymbols(n);for(let e=0;e<a.length;e++){const t=a[e],o=Object.getOwnPropertyDescriptor(n,t);o&&o.enumerable&&(r[t]=o)}}return Object.defineProperties(e,r),e}function r(e){const{maxComponents:t}={...e},r={},o=[];let i=0,a=0;for(let e=t;e>=0;e--)o[e]=a++;return Object.freeze({getComponentById:e=>("number"==typeof e&&(e=BigInt(e)),Object.values(r).find((t=>t.id===e))),getComponentByName:e=>r[e],getComponents:()=>Object.values(r),isComponentRegistered:e=>e.name in r,registerComponent:e=>{if(i>=t)throw new Error("maximum components reached!");if(e.name in r)throw new Error(`component with name "${e.name}" already registered!`);const a=o.pop();if(void 0===a)throw new Error("no available ids!");const u=function(e){const{entityLimit:t=null,id:r,name:o,properties:i,removable:a=!0}={...e};if(!o||!i||"object"!=typeof i||null==r)throw new Error("malformed component.");return n(i,e.properties),Object.seal(i),Object.freeze(Object.create({},{entityLimit:{value:t,enumerable:!0},id:{value:r,enumerable:!0},name:{value:o,enumerable:!0},properties:{value:i,enumerable:!0},removable:{value:a,enumerable:!0}}))}({...e,id:a});return r[u.name]=u,i++,u},unregisterComponent:e=>{if(!(e.name in r))throw new Error(`component "${e.name}" is not registered.`);delete r[e.name],o.unshift(e.id);const t=Object.create(e);return delete t.id,i--,t}})}var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e){var t={exports:{}};return e(t,t.exports),t.exports}var a=function(e){return e&&e.Math==Math&&e},u=a("object"==typeof globalThis&&globalThis)||a("object"==typeof window&&window)||a("object"==typeof self&&self)||a("object"==typeof o&&o)||function(){return this}()||Function("return this")(),c=function(e){try{return!!e()}catch(e){return!0}},f=!c((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),s={}.propertyIsEnumerable,l=Object.getOwnPropertyDescriptor,p={f:l&&!s.call({1:2},1)?function(e){var t=l(this,e);return!!t&&t.enumerable}:s},d=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},g={}.toString,m=function(e){return g.call(e).slice(8,-1)},y="".split,h=c((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==m(e)?y.call(e,""):Object(e)}:Object,v=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},S=function(e){return h(v(e))},E=function(e){return"object"==typeof e?null!==e:"function"==typeof e},b=function(e,t){if(!E(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!E(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!E(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!E(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},T={}.hasOwnProperty,w=function(e,t){return T.call(e,t)},I=u.document,R=E(I)&&E(I.createElement),O=!f&&!c((function(){return 7!=Object.defineProperty((e="div",R?I.createElement(e):{}),"a",{get:function(){return 7}}).a;var e})),A=Object.getOwnPropertyDescriptor,j={f:f?A:function(e,t){if(e=S(e),t=b(t,!0),O)try{return A(e,t)}catch(e){}if(w(e,t))return d(!p.f.call(e,t),e[t])}},N=function(e){if(!E(e))throw TypeError(String(e)+" is not an object");return e},_=Object.defineProperty,C={f:f?_:function(e,t,n){if(N(e),t=b(t,!0),N(n),O)try{return _(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},P=f?function(e,t,n){return C.f(e,t,d(1,n))}:function(e,t,n){return e[t]=n,e},x=function(e,t){try{P(u,e,t)}catch(n){u[e]=t}return t},M="__core-js_shared__",B=u[M]||x(M,{}),U=Function.toString;"function"!=typeof B.inspectSource&&(B.inspectSource=function(e){return U.call(e)});var D,z,k,$,F=B.inspectSource,L=u.WeakMap,W="function"==typeof L&&/native code/.test(F(L)),K=!1,G=i((function(e){(e.exports=function(e,t){return B[e]||(B[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.9.1",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})})),V=0,q=Math.random(),Y=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++V+q).toString(36)},H=G("keys"),J={},Q=u.WeakMap;if(W){var X=B.state||(B.state=new Q),Z=X.get,ee=X.has,te=X.set;D=function(e,t){return t.facade=e,te.call(X,e,t),t},z=function(e){return Z.call(X,e)||{}},k=function(e){return ee.call(X,e)}}else{var ne=H[$="state"]||(H[$]=Y($));J[ne]=!0,D=function(e,t){return t.facade=e,P(e,ne,t),t},z=function(e){return w(e,ne)?e[ne]:{}},k=function(e){return w(e,ne)}}var re={set:D,get:z,has:k,enforce:function(e){return k(e)?z(e):D(e,{})},getterFor:function(e){return function(t){var n;if(!E(t)||(n=z(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},oe=i((function(e){var t=re.get,n=re.enforce,r=String(String).split("String");(e.exports=function(e,t,o,i){var a,c=!!i&&!!i.unsafe,f=!!i&&!!i.enumerable,s=!!i&&!!i.noTargetGet;"function"==typeof o&&("string"!=typeof t||w(o,"name")||P(o,"name",t),(a=n(o)).source||(a.source=r.join("string"==typeof t?t:""))),e!==u?(c?!s&&e[t]&&(f=!0):delete e[t],f?e[t]=o:P(e,t,o)):f?e[t]=o:x(t,o)})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||F(this)}))})),ie=u,ae=function(e){return"function"==typeof e?e:void 0},ue=function(e,t){return arguments.length<2?ae(ie[e])||ae(u[e]):ie[e]&&ie[e][t]||u[e]&&u[e][t]},ce=Math.ceil,fe=Math.floor,se=function(e){return isNaN(e=+e)?0:(e>0?fe:ce)(e)},le=Math.min,pe=function(e){return e>0?le(se(e),9007199254740991):0},de=Math.max,ge=Math.min,me=function(e){return function(t,n,r){var o,i=S(t),a=pe(i.length),u=function(e,t){var n=se(e);return n<0?de(n+t,0):ge(n,t)}(r,a);if(e&&n!=n){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((e||u in i)&&i[u]===n)return e||u||0;return!e&&-1}},ye={includes:me(!0),indexOf:me(!1)}.indexOf,he=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype"),ve={f:Object.getOwnPropertyNames||function(e){return function(e,t){var n,r=S(e),o=0,i=[];for(n in r)!w(J,n)&&w(r,n)&&i.push(n);for(;t.length>o;)w(r,n=t[o++])&&(~ye(i,n)||i.push(n));return i}(e,he)}},Se={f:Object.getOwnPropertySymbols},Ee=ue("Reflect","ownKeys")||function(e){var t=ve.f(N(e)),n=Se.f;return n?t.concat(n(e)):t},be=function(e,t){for(var n=Ee(t),r=C.f,o=j.f,i=0;i<n.length;i++){var a=n[i];w(e,a)||r(e,a,o(t,a))}},Te=/#|\.prototype\./,we=function(e,t){var n=Re[Ie(e)];return n==Ae||n!=Oe&&("function"==typeof t?c(t):!!t)},Ie=we.normalize=function(e){return String(e).replace(Te,".").toLowerCase()},Re=we.data={},Oe=we.NATIVE="N",Ae=we.POLYFILL="P",je=we,Ne=j.f,_e=function(e,t){var n,r,o,i,a,c=e.target,f=e.global,s=e.stat;if(n=f?u:s?u[c]||x(c,{}):(u[c]||{}).prototype)for(r in t){if(i=t[r],o=e.noTargetGet?(a=Ne(n,r))&&a.value:n[r],!je(f?r:c+(s?".":"#")+r,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;be(i,o)}(e.sham||o&&o.sham)&&P(i,"sham",!0),oe(n,r,i,e)}},Ce=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Pe=function(){for(var e,t=N(this),n=Ce(t.delete),r=!0,o=0,i=arguments.length;o<i;o++)e=n.call(t,arguments[o]),r=r&&e;return!!r};_e({target:"Map",proto:!0,real:!0,forced:K},{deleteAll:function(){return Pe.apply(this,arguments)}});var xe,Me,Be=function(e,t,n){if(Ce(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}},Ue="process"==m(u.process),De=ue("navigator","userAgent")||"",ze=u.process,ke=ze&&ze.versions,$e=ke&&ke.v8;$e?Me=(xe=$e.split("."))[0]+xe[1]:De&&(!(xe=De.match(/Edge\/(\d+)/))||xe[1]>=74)&&(xe=De.match(/Chrome\/(\d+)/))&&(Me=xe[1]);var Fe=Me&&+Me,Le=!!Object.getOwnPropertySymbols&&!c((function(){return!Symbol.sham&&(Ue?38===Fe:Fe>37&&Fe<41)})),We=Le&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ke=G("wks"),Ge=u.Symbol,Ve=We?Ge:Ge&&Ge.withoutSetter||Y,qe=function(e){return w(Ke,e)&&(Le||"string"==typeof Ke[e])||(Le&&w(Ge,e)?Ke[e]=Ge[e]:Ke[e]=Ve("Symbol."+e)),Ke[e]},Ye={};Ye[qe("toStringTag")]="z";var He="[object z]"===String(Ye),Je=qe("toStringTag"),Qe="Arguments"==m(function(){return arguments}()),Xe=He?m:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Je))?n:Qe?m(t):"Object"==(r=m(t))&&"function"==typeof t.callee?"Arguments":r},Ze={},et=qe("iterator"),tt=function(e){if(null!=e)return e[et]||e["@@iterator"]||Ze[Xe(e)]},nt=function(e){return Map.prototype.entries.call(e)},rt=qe("iterator"),ot=Array.prototype,it=function(e){var t=e.return;if(void 0!==t)return N(t.call(e)).value},at=function(e,t){this.stopped=e,this.result=t},ut=function(e,t,n){var r,o,i,a,u,c,f,s,l=n&&n.that,p=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),g=!(!n||!n.INTERRUPTED),m=Be(t,l,1+p+g),y=function(e){return r&&it(r),new at(!0,e)},h=function(e){return p?(N(e),g?m(e[0],e[1],y):m(e[0],e[1])):g?m(e,y):m(e)};if(d)r=e;else{if("function"!=typeof(o=tt(e)))throw TypeError("Target is not iterable");if(void 0!==(s=o)&&(Ze.Array===s||ot[rt]===s)){for(i=0,a=pe(e.length);a>i;i++)if((u=h(e[i]))&&u instanceof at)return u;return new at(!1)}r=o.call(e)}for(c=r.next;!(f=c.call(r)).done;){try{u=h(f.value)}catch(e){throw it(r),e}if("object"==typeof u&&u&&u instanceof at)return u}return new at(!1)};_e({target:"Map",proto:!0,real:!0,forced:K},{every:function(e){var t=N(this),n=nt(t),r=Be(e,arguments.length>1?arguments[1]:void 0,3);return!ut(n,(function(e,n,o){if(!r(n,e,t))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var ct=qe("species"),ft=function(e,t){var n,r=N(e).constructor;return void 0===r||null==(n=N(r)[ct])?t:Ce(n)};_e({target:"Map",proto:!0,real:!0,forced:K},{filter:function(e){var t=N(this),n=nt(t),r=Be(e,arguments.length>1?arguments[1]:void 0,3),o=new(ft(t,ue("Map"))),i=Ce(o.set);return ut(n,(function(e,n){r(n,e,t)&&i.call(o,e,n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}}),_e({target:"Map",proto:!0,real:!0,forced:K},{find:function(e){var t=N(this),n=nt(t),r=Be(e,arguments.length>1?arguments[1]:void 0,3);return ut(n,(function(e,n,o){if(r(n,e,t))return o(n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_e({target:"Map",proto:!0,real:!0,forced:K},{findKey:function(e){var t=N(this),n=nt(t),r=Be(e,arguments.length>1?arguments[1]:void 0,3);return ut(n,(function(e,n,o){if(r(n,e,t))return o(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});_e({target:"Map",proto:!0,real:!0,forced:K},{includes:function(e){return ut(nt(N(this)),(function(t,n,r){if((o=n)===(i=e)||o!=o&&i!=i)return r();var o,i}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_e({target:"Map",proto:!0,real:!0,forced:K},{keyOf:function(e){return ut(nt(N(this)),(function(t,n,r){if(n===e)return r(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_e({target:"Map",proto:!0,real:!0,forced:K},{mapKeys:function(e){var t=N(this),n=nt(t),r=Be(e,arguments.length>1?arguments[1]:void 0,3),o=new(ft(t,ue("Map"))),i=Ce(o.set);return ut(n,(function(e,n){i.call(o,r(n,e,t),n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}}),_e({target:"Map",proto:!0,real:!0,forced:K},{mapValues:function(e){var t=N(this),n=nt(t),r=Be(e,arguments.length>1?arguments[1]:void 0,3),o=new(ft(t,ue("Map"))),i=Ce(o.set);return ut(n,(function(e,n){i.call(o,e,r(n,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}}),_e({target:"Map",proto:!0,real:!0,forced:K},{merge:function(e){for(var t=N(this),n=Ce(t.set),r=0;r<arguments.length;)ut(arguments[r++],n,{that:t,AS_ENTRIES:!0});return t}}),_e({target:"Map",proto:!0,real:!0,forced:K},{reduce:function(e){var t=N(this),n=nt(t),r=arguments.length<2,o=r?void 0:arguments[1];if(Ce(e),ut(n,(function(n,i){r?(r=!1,o=i):o=e(o,i,n,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),r)throw TypeError("Reduce of empty map with no initial value");return o}}),_e({target:"Map",proto:!0,real:!0,forced:K},{some:function(e){var t=N(this),n=nt(t),r=Be(e,arguments.length>1?arguments[1]:void 0,3);return ut(n,(function(e,n,o){if(r(n,e,t))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_e({target:"Map",proto:!0,real:!0,forced:K},{update:function(e,t){var n=N(this),r=arguments.length;Ce(t);var o=n.has(e);if(!o&&r<3)throw TypeError("Updating absent value");var i=o?n.get(e):Ce(r>2?arguments[2]:void 0)(e,n);return n.set(e,t(i,e,n)),n}});var st,lt,pt=function(e){return function(t,n,r,o){Ce(n);var i=Object(v(t)),a=h(i),u=pe(i.length),c=e?u-1:0,f=e?-1:1;if(r<2)for(;;){if(c in a){o=a[c],c+=f;break}if(c+=f,e?c<0:u<=c)throw TypeError("Reduce of empty array with no initial value")}for(;e?c>=0:u>c;c+=f)c in a&&(o=n(o,a[c],c,i));return o}},dt={left:pt(!1),right:pt(!0)}.left;_e({target:"Array",proto:!0,forced:!(!!(lt=[]["reduce"])&&c((function(){lt.call(null,st||function(){throw 1},1)})))||!Ue&&Fe>79&&Fe<83},{reduce:function(e){return dt(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}});var gt=function(){for(var e=N(this),t=Ce(e.add),n=0,r=arguments.length;n<r;n++)t.call(e,arguments[n]);return e};_e({target:"Set",proto:!0,real:!0,forced:K},{addAll:function(){return gt.apply(this,arguments)}}),_e({target:"Set",proto:!0,real:!0,forced:K},{deleteAll:function(){return Pe.apply(this,arguments)}}),_e({target:"Set",proto:!0,real:!0,forced:K},{difference:function(e){var t=N(this),n=new(ft(t,ue("Set")))(t),r=Ce(n.delete);return ut(e,(function(e){r.call(n,e)})),n}});var mt=function(e){return Set.prototype.values.call(e)};function yt(){const e=t(),r=`${Date.now().toString(36)}_${Math.random().toString(36).substr(2,9)}`,o={};let i=!0,a=null;const u=Object.create({},{_:{value:o,enumerable:!0},addComponent:{value:t=>{if(t.name in o)return console.warn(`Entity "${r}" already has component "${t.name}".`),!1;try{o[t.name]=n({},t.properties),e.on(t.id)}catch(e){return console.warn(`Error adding component "${t.name}" to entity "${r}".`,e),!1}return!0}},getArchetype:{value:()=>e.value()},hasComponent:{value:e=>{var t;return null!==(t="string"==typeof e?e in o:e.name in o)&&void 0!==t&&t}},isAwake:{value:()=>i},id:{value:r,enumerable:!0},next:{value:e=>(void 0!==e&&(a=e),a)},purge:{value:()=>{var t;t=o,Object.keys(t).forEach((e=>delete t[e])),e.clear()}},removeComponent:{value:t=>t.name in o&&(delete o[t.name],e.off(t.id),!0)},sleep:{value:()=>i=!1},wake:{value:()=>i=!0}});return Object.freeze(u)}function ht(e){const{initialPoolSize:t,maxEntities:n}={...e},r=[];let o;const i=(e=1)=>{for(let t=0;t<e;t++){if(r.length>=n)throw new Error("The entity pool is full.");const e=yt();e.next(o),o=e,r.push(e)}},a=()=>{r.length=0,o=null,i(t)};return a(),Object.freeze({flush:a,get:()=>{o||i(.25*t);const e=o;return o=e.next(),e},release:e=>{e.purge(),e.next(o),o=e}})}function vt(e){const{initialPoolSize:n,maxEntities:r}={...e},o=ht({initialPoolSize:n,maxEntities:r}),i={},a=new Map;let u=!0;const c=()=>Object.values(i),f=(e,t=!1)=>{if(t){var n;const t=null!==(n=a.get(e))&&void 0!==n?n:[];return[[e],[...t]]}{const t=new Set,n=new Set;return a.forEach(((r,o)=>{(o&e)===e&&(r.forEach((e=>t.add(e))),n.add(e))})),[[...n],[...t]]}},s=(e,t)=>{var n;null!=t&&(null===(n=a.get(t))||void 0===n||n.delete(e));const r=e.getArchetype();var o;a.has(r)?null===(o=a.get(r))||void 0===o||o.add(e):(a.set(r,new Set([e])),u=!0);return e};return Object.freeze({areArchetypesDirty:()=>u,cleanedArchetypes:()=>u=!1,createEntity:()=>{const e=o.get();if(!e)throw new Error("no entities left!");return i[e.id]=e,s(e),e},destroyEntity:e=>{const t=e.id in i;if(!0===t){var n,r;delete i[e.id];const t=e.getArchetype();null===(n=a.get(t))||void 0===n||n.delete(e),0===(null===(r=a.get(t))||void 0===r?void 0:r.size)&&(a.delete(t),u=!0),o.release(e)}return t},getEntities:c,getEntitiesByComponents:(...e)=>{const n=function(...e){const n=t();return e.forEach((e=>n.on(e.id))),n.value()}(...e);return f(n)[1]},getEntitiesByMask:f,getEntitiesFromMasks:e=>e.reduce(((e,t)=>{var n;const r=null!==(n=a.get(t))&&void 0!==n?n:[];return e.push(...r),e}),[]),getEntityById:e=>i[e],rebuildArchetypes:()=>{a.clear();const e=c();for(let t=0;t<e.length;t++)s(e[t]);u=!1},updateArchetype:s})}_e({target:"Set",proto:!0,real:!0,forced:K},{every:function(e){var t=N(this),n=mt(t),r=Be(e,arguments.length>1?arguments[1]:void 0,3);return!ut(n,(function(e,n){if(!r(e,e,t))return n()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_e({target:"Set",proto:!0,real:!0,forced:K},{filter:function(e){var t=N(this),n=mt(t),r=Be(e,arguments.length>1?arguments[1]:void 0,3),o=new(ft(t,ue("Set"))),i=Ce(o.add);return ut(n,(function(e){r(e,e,t)&&i.call(o,e)}),{IS_ITERATOR:!0}),o}}),_e({target:"Set",proto:!0,real:!0,forced:K},{find:function(e){var t=N(this),n=mt(t),r=Be(e,arguments.length>1?arguments[1]:void 0,3);return ut(n,(function(e,n){if(r(e,e,t))return n(e)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_e({target:"Set",proto:!0,real:!0,forced:K},{intersection:function(e){var t=N(this),n=new(ft(t,ue("Set"))),r=Ce(t.has),o=Ce(n.add);return ut(e,(function(e){r.call(t,e)&&o.call(n,e)})),n}}),_e({target:"Set",proto:!0,real:!0,forced:K},{isDisjointFrom:function(e){var t=N(this),n=Ce(t.has);return!ut(e,(function(e,r){if(!0===n.call(t,e))return r()}),{INTERRUPTED:!0}).stopped}}),_e({target:"Set",proto:!0,real:!0,forced:K},{isSubsetOf:function(e){var t=function(e){var t=tt(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return N(t.call(e))}(this),n=N(e),r=n.has;return"function"!=typeof r&&(n=new(ue("Set"))(e),r=Ce(n.has)),!ut(t,(function(e,t){if(!1===r.call(n,e))return t()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_e({target:"Set",proto:!0,real:!0,forced:K},{isSupersetOf:function(e){var t=N(this),n=Ce(t.has);return!ut(e,(function(e,r){if(!1===n.call(t,e))return r()}),{INTERRUPTED:!0}).stopped}}),_e({target:"Set",proto:!0,real:!0,forced:K},{join:function(e){var t=N(this),n=mt(t),r=void 0===e?",":String(e),o=[];return ut(n,o.push,{that:o,IS_ITERATOR:!0}),o.join(r)}}),_e({target:"Set",proto:!0,real:!0,forced:K},{map:function(e){var t=N(this),n=mt(t),r=Be(e,arguments.length>1?arguments[1]:void 0,3),o=new(ft(t,ue("Set"))),i=Ce(o.add);return ut(n,(function(e){i.call(o,r(e,e,t))}),{IS_ITERATOR:!0}),o}}),_e({target:"Set",proto:!0,real:!0,forced:K},{reduce:function(e){var t=N(this),n=mt(t),r=arguments.length<2,o=r?void 0:arguments[1];if(Ce(e),ut(n,(function(n){r?(r=!1,o=n):o=e(o,n,n,t)}),{IS_ITERATOR:!0}),r)throw TypeError("Reduce of empty set with no initial value");return o}}),_e({target:"Set",proto:!0,real:!0,forced:K},{some:function(e){var t=N(this),n=mt(t),r=Be(e,arguments.length>1?arguments[1]:void 0,3);return ut(n,(function(e,n){if(r(e,e,t))return n()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_e({target:"Set",proto:!0,real:!0,forced:K},{symmetricDifference:function(e){var t=N(this),n=new(ft(t,ue("Set")))(t),r=Ce(n.delete),o=Ce(n.add);return ut(e,(function(e){r.call(n,e)||o.call(n,e)})),n}}),_e({target:"Set",proto:!0,real:!0,forced:K},{union:function(e){var t=N(this),n=new(ft(t,ue("Set")))(t);return ut(e,Ce(n.add),{that:n}),n}});const St=function(){};function Et(){const e={},n=[];return Object.freeze({getSystemByIndex:e=>{var t;return null!==(t=n[e])&&void 0!==t?t:void 0},getSystemByName:t=>e[t],getSystems:()=>[...n],isSystemRegistered:t=>t.name in e,moveSystem:(e,t)=>{const r=n.indexOf(e);return-1!==r&&(n.splice(r,1),n.splice(t,0,e),!0)},registerSystem:(r,o)=>{if(r.name in e)throw new Error(`system "${r.name}" is already registered!`);const i=function(e){const{components:n,exclusive:r=!1,name:o,postUpdate:i=St,preUpdate:a=St,update:u=St}={...e},c=n.reduce(((e,t)=>(e.on(t.id),e)),t()).value();let f=!1;return Object.freeze({get enabled(){return f},archetype:c,disable:()=>f=!1,enable:()=>f=!0,exclusive:r,name:o,postUpdate:i,preUpdate:a,update:u})}({...r});return void 0!==o?n.splice(o,0,i):n.push(i),e[i.name]=i,i},unregisterSystem:t=>{if(!(t.name in e))throw new Error(`system "${t.name}" is not registered!`);delete e[t.name],n.splice(n.indexOf(t),1)}})}e.createWorld=function(e){const{initialPoolSize:t=64,maxComponents:n=1024,maxEntities:o=1e5}={...e},{areArchetypesDirty:i,cleanedArchetypes:a,createEntity:u,destroyEntity:c,getEntities:f,getEntitiesByComponents:s,getEntitiesByMask:l,getEntitiesFromMasks:p,getEntityById:d,rebuildArchetypes:g,updateArchetype:m}=vt({initialPoolSize:t,maxEntities:o}),{getComponentById:y,getComponentByName:h,getComponents:v,isComponentRegistered:S,registerComponent:E,unregisterComponent:b}=r({maxComponents:n}),{getSystemByIndex:T,getSystemByName:w,getSystems:I,isSystemRegistered:R,moveSystem:O,registerSystem:A,unregisterSystem:j}=Et(),N=u(),_=E({name:"world",properties:{isWorld:!0},entityLimit:1,removable:!1}),C={},P=(e,...t)=>{if(!e)throw new Error("no entity provided.");if(null==t||!t.length)throw new Error("no components provided.");const n=t.length;let r;for(r=0;r<n;r++){let n;if(n="string"==typeof t[r]?h(t[r]):t[r],!n)throw new Error(`component ${t[r]} is not registered!.`);if(!e.hasComponent(n)){const t=e.getArchetype();e.addComponent(n),m(e,t)}}return e};return P(N,_),Object.freeze({addComponentsToEntity:P,createEntity:u,destroyEntity:c,entity:N,getComponentById:y,getComponentByName:h,getComponents:v,getEntities:f,getEntitiesByComponents:s,getEntitiesByMask:l,getEntityById:d,getSystemByIndex:T,getSystemByName:w,getSystems:I,isComponentRegistered:S,isSystemRegistered:R,moveSystem:O,postUpdate:e=>{const t=I();for(let n=0;n<t.length;n++){const r=t[n];if(!1!==r.enabled)if(!0!==i()&&r.name in C){const t=C[r.name],n=p(t);r.postUpdate(e,n,r)}else{const[t,n]=l(r.archetype,r.exclusive);C[r.name]=t,r.postUpdate(e,n,r),a()}}},preUpdate:()=>{const e=I();for(let t=0;t<e.length;t++){const n=e[t];if(!1!==n.enabled)if(!0!==i()&&n.name in C){const e=C[n.name],t=p(e);n.preUpdate(t,n)}else{const[e,t]=l(n.archetype,n.exclusive);C[n.name]=e,n.preUpdate(t,n),a()}}},registerComponent:E,registerSystem:A,removeComponentsFromEntity:(e,...t)=>{if(!e)throw new Error("no entity provided.");if(null==t||!t.length)throw new Error("no components provided.");const n=t.length;let r;for(r=0;r<n;r++){let n;if(n="string"==typeof t[r]?h(t[r]):t[r],!n)throw new Error(`component ${t[r]}  is not registered.`);if(e.hasComponent(n)){const t=e.getArchetype();e.removeComponent(n),m(e,t)}}return e},unregisterComponent:b,unregisterSystem:j,update:e=>{const t=I();for(let n=0;n<t.length;n++){const r=t[n];if(!1!==r.enabled)if(!0!==i()&&r.name in C){const t=C[r.name],n=p(t);r.update(e,n,r)}else{const[t,n]=l(r.archetype,r.exclusive);C[r.name]=t,r.update(e,n,r),a()}}}})}}));
//# sourceMappingURL=index.min.js.map
