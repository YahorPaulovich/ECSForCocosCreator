/*! *****************************************************************************
 *
 * miski
 * v0.3.0
 *
 * MIT License
 * 
 * Copyright (C) 2021 Peter Hughes<https://www.phugh.es>, all rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
***************************************************************************** */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).miski={})}(this,(function(t){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=function(t){return t&&t.Math==Math&&t},n=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof e&&e)||function(){return this}()||Function("return this")(),o={},i=function(t){try{return!!t()}catch(t){return!0}},a=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),u={},s={}.propertyIsEnumerable,c=Object.getOwnPropertyDescriptor,f=c&&!s.call({1:2},1);u.f=f?function(t){var e=c(this,t);return!!e&&e.enumerable}:s;var l=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},h={}.toString,p=function(t){return h.call(t).slice(8,-1)},d=p,y="".split,g=i((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==d(t)?y.call(t,""):Object(t)}:Object,v=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},m=g,w=v,E=function(t){return m(w(t))},S=function(t){return"object"==typeof t?null!==t:"function"==typeof t},_=S,b=function(t,e){if(!_(t))return t;var r,n;if(e&&"function"==typeof(r=t.toString)&&!_(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!_(n=r.call(t)))return n;if(!e&&"function"==typeof(r=t.toString)&&!_(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")},T=v,O=function(t){return Object(T(t))},R=O,I={}.hasOwnProperty,A=function(t,e){return I.call(R(t),e)},P=S,j=n.document,N=P(j)&&P(j.createElement),x=function(t){return N?j.createElement(t):{}},k=!a&&!i((function(){return 7!=Object.defineProperty(x("div"),"a",{get:function(){return 7}}).a})),M=a,C=u,D=l,z=E,U=b,$=A,B=k,F=Object.getOwnPropertyDescriptor;o.f=M?F:function(t,e){if(t=z(t),e=U(e,!0),B)try{return F(t,e)}catch(t){}if($(t,e))return D(!C.f.call(t,e),t[e])};var G={},L=S,W=function(t){if(!L(t))throw TypeError(String(t)+" is not an object");return t},q=a,Q=k,K=W,V=b,Y=Object.defineProperty;G.f=q?Y:function(t,e,r){if(K(t),e=V(e,!0),K(r),Q)try{return Y(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(t[e]=r.value),t};var Z=G,H=l,J=a?function(t,e,r){return Z.f(t,e,H(1,r))}:function(t,e,r){return t[e]=r,t},X={exports:{}},tt=n,et=J,rt=function(t,e){try{et(tt,t,e)}catch(r){tt[t]=e}return e},nt=rt,ot="__core-js_shared__",it=n[ot]||nt(ot,{}),at=it,ut=Function.toString;"function"!=typeof at.inspectSource&&(at.inspectSource=function(t){return ut.call(t)});var st=at.inspectSource,ct=st,ft=n.WeakMap,lt="function"==typeof ft&&/native code/.test(ct(ft)),ht={exports:{}},pt=it;(ht.exports=function(t,e){return pt[t]||(pt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var dt,yt,gt,vt=0,mt=Math.random(),wt=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++vt+mt).toString(36)},Et=ht.exports,St=wt,_t=Et("keys"),bt={},Tt=lt,Ot=S,Rt=J,It=A,At=it,Pt=function(t){return _t[t]||(_t[t]=St(t))},jt=bt,Nt="Object already initialized",xt=n.WeakMap;if(Tt||At.state){var kt=At.state||(At.state=new xt),Mt=kt.get,Ct=kt.has,Dt=kt.set;dt=function(t,e){if(Ct.call(kt,t))throw new TypeError(Nt);return e.facade=t,Dt.call(kt,t,e),e},yt=function(t){return Mt.call(kt,t)||{}},gt=function(t){return Ct.call(kt,t)}}else{var zt=Pt("state");jt[zt]=!0,dt=function(t,e){if(It(t,zt))throw new TypeError(Nt);return e.facade=t,Rt(t,zt,e),e},yt=function(t){return It(t,zt)?t[zt]:{}},gt=function(t){return It(t,zt)}}var Ut={set:dt,get:yt,has:gt,enforce:function(t){return gt(t)?yt(t):dt(t,{})},getterFor:function(t){return function(e){var r;if(!Ot(e)||(r=yt(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return r}}},$t=n,Bt=J,Ft=A,Gt=rt,Lt=st,Wt=Ut.get,qt=Ut.enforce,Qt=String(String).split("String");(X.exports=function(t,e,r,n){var o,i=!!n&&!!n.unsafe,a=!!n&&!!n.enumerable,u=!!n&&!!n.noTargetGet;"function"==typeof r&&("string"!=typeof e||Ft(r,"name")||Bt(r,"name",e),(o=qt(r)).source||(o.source=Qt.join("string"==typeof e?e:""))),t!==$t?(i?!u&&t[e]&&(a=!0):delete t[e],a?t[e]=r:Bt(t,e,r)):a?t[e]=r:Gt(e,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&Wt(this).source||Lt(this)}));var Kt=n,Vt=n,Yt=function(t){return"function"==typeof t?t:void 0},Zt=function(t,e){return arguments.length<2?Yt(Kt[t])||Yt(Vt[t]):Kt[t]&&Kt[t][e]||Vt[t]&&Vt[t][e]},Ht={},Jt=Math.ceil,Xt=Math.floor,te=function(t){return isNaN(t=+t)?0:(t>0?Xt:Jt)(t)},ee=te,re=Math.min,ne=function(t){return t>0?re(ee(t),9007199254740991):0},oe=te,ie=Math.max,ae=Math.min,ue=E,se=ne,ce=function(t,e){var r=oe(t);return r<0?ie(r+e,0):ae(r,e)},fe=function(t){return function(e,r,n){var o,i=ue(e),a=se(i.length),u=ce(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},le={includes:fe(!0),indexOf:fe(!1)},he=A,pe=E,de=le.indexOf,ye=bt,ge=function(t,e){var r,n=pe(t),o=0,i=[];for(r in n)!he(ye,r)&&he(n,r)&&i.push(r);for(;e.length>o;)he(n,r=e[o++])&&(~de(i,r)||i.push(r));return i},ve=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype");Ht.f=Object.getOwnPropertyNames||function(t){return ge(t,ve)};var me={};me.f=Object.getOwnPropertySymbols;var we=Ht,Ee=me,Se=W,_e=Zt("Reflect","ownKeys")||function(t){var e=we.f(Se(t)),r=Ee.f;return r?e.concat(r(t)):e},be=A,Te=_e,Oe=o,Re=G,Ie=i,Ae=/#|\.prototype\./,Pe=function(t,e){var r=Ne[je(t)];return r==ke||r!=xe&&("function"==typeof e?Ie(e):!!e)},je=Pe.normalize=function(t){return String(t).replace(Ae,".").toLowerCase()},Ne=Pe.data={},xe=Pe.NATIVE="N",ke=Pe.POLYFILL="P",Me=Pe,Ce=n,De=o.f,ze=J,Ue=X.exports,$e=rt,Be=function(t,e){for(var r=Te(e),n=Re.f,o=Oe.f,i=0;i<r.length;i++){var a=r[i];be(t,a)||n(t,a,o(e,a))}},Fe=Me,Ge=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?Ce:c?Ce[u]||$e(u,{}):(Ce[u]||{}).prototype)for(n in e){if(i=e[n],o=t.noTargetGet?(a=De(r,n))&&a.value:r[n],!Fe(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Be(i,o)}(t.sham||o&&o.sham)&&ze(i,"sham",!0),Ue(r,n,i,t)}},Le=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},We=W,qe=Le,Qe=function(){for(var t=We(this),e=qe(t.add),r=0,n=arguments.length;r<n;r++)e.call(t,arguments[r]);return t},Ke=Qe;Ge({target:"Set",proto:!0,real:!0,forced:false},{addAll:function(){return Ke.apply(this,arguments)}});var Ve=W,Ye=Le,Ze=function(){for(var t,e=Ve(this),r=Ye(e.delete),n=!0,o=0,i=arguments.length;o<i;o++)t=r.call(e,arguments[o]),n=n&&t;return!!n},He=Ze;Ge({target:"Set",proto:!0,real:!0,forced:false},{deleteAll:function(){return He.apply(this,arguments)}});var Je,Xe,tr=Zt("navigator","userAgent")||"",er=n.process,rr=er&&er.versions,nr=rr&&rr.v8;nr?Xe=(Je=nr.split("."))[0]<4?1:Je[0]+Je[1]:tr&&(!(Je=tr.match(/Edge\/(\d+)/))||Je[1]>=74)&&(Je=tr.match(/Chrome\/(\d+)/))&&(Xe=Je[1]);var or=Xe&&+Xe,ir=or,ar=i,ur=!!Object.getOwnPropertySymbols&&!ar((function(){return!String(Symbol())||!Symbol.sham&&ir&&ir<41})),sr=ur&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,cr=n,fr=ht.exports,lr=A,hr=wt,pr=ur,dr=sr,yr=fr("wks"),gr=cr.Symbol,vr=dr?gr:gr&&gr.withoutSetter||hr,mr=function(t){return lr(yr,t)&&(pr||"string"==typeof yr[t])||(pr&&lr(gr,t)?yr[t]=gr[t]:yr[t]=vr("Symbol."+t)),yr[t]},wr=W,Er=Le,Sr=mr("species"),_r=function(t,e){var r,n=wr(t).constructor;return void 0===n||null==(r=wr(n)[Sr])?e:Er(r)},br={},Tr=br,Or=mr("iterator"),Rr=Array.prototype,Ir=Le,Ar=function(t,e,r){if(Ir(t),void 0===e)return t;switch(r){case 0:return function(){return t.call(e)};case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,o){return t.call(e,r,n,o)}}return function(){return t.apply(e,arguments)}},Pr={};Pr[mr("toStringTag")]="z";var jr="[object z]"===String(Pr),Nr=p,xr=mr("toStringTag"),kr="Arguments"==Nr(function(){return arguments}()),Mr=jr?Nr:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),xr))?r:kr?Nr(e):"Object"==(n=Nr(e))&&"function"==typeof e.callee?"Arguments":n},Cr=br,Dr=mr("iterator"),zr=function(t){if(null!=t)return t[Dr]||t["@@iterator"]||Cr[Mr(t)]},Ur=W,$r=W,Br=function(t){return void 0!==t&&(Tr.Array===t||Rr[Or]===t)},Fr=ne,Gr=Ar,Lr=zr,Wr=function(t){var e=t.return;if(void 0!==e)return Ur(e.call(t)).value},qr=function(t,e){this.stopped=t,this.result=e},Qr=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_ITERATOR),p=!(!r||!r.INTERRUPTED),d=Gr(e,f,1+l+p),y=function(t){return n&&Wr(n),new qr(!0,t)},g=function(t){return l?($r(t),p?d(t[0],t[1],y):d(t[0],t[1])):p?d(t,y):d(t)};if(h)n=t;else{if("function"!=typeof(o=Lr(t)))throw TypeError("Target is not iterable");if(Br(o)){for(i=0,a=Fr(t.length);a>i;i++)if((u=g(t[i]))&&u instanceof qr)return u;return new qr(!1)}n=o.call(t)}for(s=n.next;!(c=s.call(n)).done;){try{u=g(c.value)}catch(t){throw Wr(n),t}if("object"==typeof u&&u&&u instanceof qr)return u}return new qr(!1)},Kr=Zt,Vr=W,Yr=Le,Zr=_r,Hr=Qr;Ge({target:"Set",proto:!0,real:!0,forced:false},{difference:function(t){var e=Vr(this),r=new(Zr(e,Kr("Set")))(e),n=Yr(r.delete);return Hr(t,(function(t){n.call(r,t)})),r}});var Jr=W,Xr=zr,tn=function(t){return Set.prototype.values.call(t)},en=W,rn=Ar,nn=tn,on=Qr;Ge({target:"Set",proto:!0,real:!0,forced:false},{every:function(t){var e=en(this),r=nn(e),n=rn(t,arguments.length>1?arguments[1]:void 0,3);return!on(r,(function(t,r){if(!n(t,t,e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var an=Zt,un=W,sn=Le,cn=Ar,fn=_r,ln=tn,hn=Qr;Ge({target:"Set",proto:!0,real:!0,forced:false},{filter:function(t){var e=un(this),r=ln(e),n=cn(t,arguments.length>1?arguments[1]:void 0,3),o=new(fn(e,an("Set"))),i=sn(o.add);return hn(r,(function(t){n(t,t,e)&&i.call(o,t)}),{IS_ITERATOR:!0}),o}});var pn=W,dn=Ar,yn=tn,gn=Qr;Ge({target:"Set",proto:!0,real:!0,forced:false},{find:function(t){var e=pn(this),r=yn(e),n=dn(t,arguments.length>1?arguments[1]:void 0,3);return gn(r,(function(t,r){if(n(t,t,e))return r(t)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var vn=Zt,mn=W,wn=Le,En=_r,Sn=Qr;Ge({target:"Set",proto:!0,real:!0,forced:false},{intersection:function(t){var e=mn(this),r=new(En(e,vn("Set"))),n=wn(e.has),o=wn(r.add);return Sn(t,(function(t){n.call(e,t)&&o.call(r,t)})),r}});var _n=W,bn=Le,Tn=Qr;Ge({target:"Set",proto:!0,real:!0,forced:false},{isDisjointFrom:function(t){var e=_n(this),r=bn(e.has);return!Tn(t,(function(t,n){if(!0===r.call(e,t))return n()}),{INTERRUPTED:!0}).stopped}});var On=Zt,Rn=W,In=Le,An=function(t){var e=Xr(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return Jr(e.call(t))},Pn=Qr;Ge({target:"Set",proto:!0,real:!0,forced:false},{isSubsetOf:function(t){var e=An(this),r=Rn(t),n=r.has;return"function"!=typeof n&&(r=new(On("Set"))(t),n=In(r.has)),!Pn(e,(function(t,e){if(!1===n.call(r,t))return e()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var jn=W,Nn=Le,xn=Qr;Ge({target:"Set",proto:!0,real:!0,forced:false},{isSupersetOf:function(t){var e=jn(this),r=Nn(e.has);return!xn(t,(function(t,n){if(!1===r.call(e,t))return n()}),{INTERRUPTED:!0}).stopped}});var kn=W,Mn=tn,Cn=Qr;Ge({target:"Set",proto:!0,real:!0,forced:false},{join:function(t){var e=kn(this),r=Mn(e),n=void 0===t?",":String(t),o=[];return Cn(r,o.push,{that:o,IS_ITERATOR:!0}),o.join(n)}});var Dn=Zt,zn=W,Un=Le,$n=Ar,Bn=_r,Fn=tn,Gn=Qr;Ge({target:"Set",proto:!0,real:!0,forced:false},{map:function(t){var e=zn(this),r=Fn(e),n=$n(t,arguments.length>1?arguments[1]:void 0,3),o=new(Bn(e,Dn("Set"))),i=Un(o.add);return Gn(r,(function(t){i.call(o,n(t,t,e))}),{IS_ITERATOR:!0}),o}});var Ln=W,Wn=Le,qn=tn,Qn=Qr;Ge({target:"Set",proto:!0,real:!0,forced:false},{reduce:function(t){var e=Ln(this),r=qn(e),n=arguments.length<2,o=n?void 0:arguments[1];if(Wn(t),Qn(r,(function(r){n?(n=!1,o=r):o=t(o,r,r,e)}),{IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty set with no initial value");return o}});var Kn=W,Vn=Ar,Yn=tn,Zn=Qr;Ge({target:"Set",proto:!0,real:!0,forced:false},{some:function(t){var e=Kn(this),r=Yn(e),n=Vn(t,arguments.length>1?arguments[1]:void 0,3);return Zn(r,(function(t,r){if(n(t,t,e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Hn=Zt,Jn=W,Xn=Le,to=_r,eo=Qr;Ge({target:"Set",proto:!0,real:!0,forced:false},{symmetricDifference:function(t){var e=Jn(this),r=new(to(e,Hn("Set")))(e),n=Xn(r.delete),o=Xn(r.add);return eo(t,(function(t){n.call(r,t)||o.call(r,t)})),r}});var ro=Zt,no=W,oo=Le,io=_r,ao=Qr;Ge({target:"Set",proto:!0,real:!0,forced:false},{union:function(t){var e=no(this),r=new(io(e,ro("Set")))(e);return ao(t,oo(r.add),{that:r}),r}});var uo=Ze;Ge({target:"Map",proto:!0,real:!0,forced:false},{deleteAll:function(){return uo.apply(this,arguments)}});var so=function(t){return Map.prototype.entries.call(t)},co=W,fo=Ar,lo=so,ho=Qr;Ge({target:"Map",proto:!0,real:!0,forced:false},{every:function(t){var e=co(this),r=lo(e),n=fo(t,arguments.length>1?arguments[1]:void 0,3);return!ho(r,(function(t,r,o){if(!n(r,t,e))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var po=Zt,yo=W,go=Le,vo=Ar,mo=_r,wo=so,Eo=Qr;Ge({target:"Map",proto:!0,real:!0,forced:false},{filter:function(t){var e=yo(this),r=wo(e),n=vo(t,arguments.length>1?arguments[1]:void 0,3),o=new(mo(e,po("Map"))),i=go(o.set);return Eo(r,(function(t,r){n(r,t,e)&&i.call(o,t,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var So=W,_o=Ar,bo=so,To=Qr;Ge({target:"Map",proto:!0,real:!0,forced:false},{find:function(t){var e=So(this),r=bo(e),n=_o(t,arguments.length>1?arguments[1]:void 0,3);return To(r,(function(t,r,o){if(n(r,t,e))return o(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Oo=W,Ro=Ar,Io=so,Ao=Qr;Ge({target:"Map",proto:!0,real:!0,forced:false},{findKey:function(t){var e=Oo(this),r=Io(e),n=Ro(t,arguments.length>1?arguments[1]:void 0,3);return Ao(r,(function(t,r,o){if(n(r,t,e))return o(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Po=W,jo=so,No=function(t,e){return t===e||t!=t&&e!=e},xo=Qr;Ge({target:"Map",proto:!0,real:!0,forced:false},{includes:function(t){return xo(jo(Po(this)),(function(e,r,n){if(No(r,t))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var ko=W,Mo=so,Co=Qr;Ge({target:"Map",proto:!0,real:!0,forced:false},{keyOf:function(t){return Co(Mo(ko(this)),(function(e,r,n){if(r===t)return n(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Do=Zt,zo=W,Uo=Le,$o=Ar,Bo=_r,Fo=so,Go=Qr;Ge({target:"Map",proto:!0,real:!0,forced:false},{mapKeys:function(t){var e=zo(this),r=Fo(e),n=$o(t,arguments.length>1?arguments[1]:void 0,3),o=new(Bo(e,Do("Map"))),i=Uo(o.set);return Go(r,(function(t,r){i.call(o,n(r,t,e),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var Lo=Zt,Wo=W,qo=Le,Qo=Ar,Ko=_r,Vo=so,Yo=Qr;Ge({target:"Map",proto:!0,real:!0,forced:false},{mapValues:function(t){var e=Wo(this),r=Vo(e),n=Qo(t,arguments.length>1?arguments[1]:void 0,3),o=new(Ko(e,Lo("Map"))),i=qo(o.set);return Yo(r,(function(t,r){i.call(o,t,n(r,t,e))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var Zo=W,Ho=Le,Jo=Qr;Ge({target:"Map",proto:!0,real:!0,forced:false},{merge:function(t){for(var e=Zo(this),r=Ho(e.set),n=0;n<arguments.length;)Jo(arguments[n++],r,{that:e,AS_ENTRIES:!0});return e}});var Xo=W,ti=Le,ei=so,ri=Qr;Ge({target:"Map",proto:!0,real:!0,forced:false},{reduce:function(t){var e=Xo(this),r=ei(e),n=arguments.length<2,o=n?void 0:arguments[1];if(ti(t),ri(r,(function(r,i){n?(n=!1,o=i):o=t(o,i,r,e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty map with no initial value");return o}});var ni=W,oi=Ar,ii=so,ai=Qr;Ge({target:"Map",proto:!0,real:!0,forced:false},{some:function(t){var e=ni(this),r=ii(e),n=oi(t,arguments.length>1?arguments[1]:void 0,3);return ai(r,(function(t,r,o){if(n(r,t,e))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var ui=W,si=Le;function ci(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function fi(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ci(Object(r),!0).forEach((function(e){li(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ci(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function li(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}Ge({target:"Map",proto:!0,real:!0,forced:false},{update:function(t,e){var r=ui(this),n=arguments.length;si(e);var o=r.has(t);if(!o&&n<3)throw TypeError("Updating absent value");var i=o?r.get(t):si(n>2?arguments[2]:void 0)(t,r);return r.set(t,e(i,t,r)),r}});const hi=Object.freeze(["_world","defaults","id","name","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","prototype","toLocaleString","toString","valueOf","__defineGetter__","__defineSetter__","__lookupGetter__","__lookupGetter__","__proto__"]);function pi(t,e){return t&e}function di(t,e,r){return null!=e&&t<e?e:null!=r&&t>r?r:t}function yi(t){return/^(?![0-9])[a-zA-Z0-9$_]+$/.test(t)&&!hi.includes(t)}function gi(t){return Boolean(t&&"object"==typeof t&&!Array.isArray(t))}function vi(t,...e){if(!e||!e.length)return t;const r={},n=e.shift();return gi(t)&&gi(n)&&(Object.keys(n).forEach((t=>{const e=Object.getOwnPropertyDescriptor(n,t);void 0!==e&&(r[t]=fi({},e),gi(e.value)?vi(e.value,n[t]):Array.isArray(e.value)&&(e.value=[...n[t]]))})),Object.getOwnPropertySymbols(n).forEach((t=>{const e=Object.getOwnPropertyDescriptor(n,t);void 0!==e&&e.enumerable&&(r[t]=fi({},e),gi(e.value)?vi(e.value,n[t]):Array.isArray(e.value)&&(e.value=[...n[t]]))})),Object.defineProperties(t,r)),vi(t,...e)}class mi{constructor(t,e=[]){this.id=t,this._registry=new Set(e)}get entities(){return[...this._registry]}addEntity(t){this._registry.add(t)}isEmpty(){return 0===this._registry.size}removeEntity(t){this._registry.delete(t)}}function wi(t){return function(e){return t.get(e)}}function Ei(t){return function(){return[...t.values()]}}function Si(t){return function(...e){const r=new Set;return e.forEach((e=>{t.forEach(((t,n)=>{pi(e.id,n)>0&&t.entities.forEach((t=>r.add(t)))}))})),[...r]}}function _i(t){return function(e){return t.has(e.id)||[...t.values()].includes(e)}}function bi(t,e){return function(r,n){if(void 0!==n){const e=t.get(n);e&&(e.removeEntity(r),e.isEmpty()&&t.delete(n))}const o=r.archetype;var i;t.has(o)?null===(i=t.get(o))||void 0===i||i.addEntity(r):t.set(o,new mi(o,[r]));return e}}class Ti{constructor(t,e,r){const{name:n}=r;this.id=e,this.name=n,this._world=t,this.defaults=vi({},r.defaults),Object.keys(this.defaults).forEach((t=>{Object.defineProperty(this,t,Object.getOwnPropertyDescriptor(this.defaults,t))}))}get entities(){return this._world.getEntitiesByComponents(this)}get isRegistered(){return this._world.isComponentRegistered(this)}}function Oi(t){return function(){return[...t.values()]}}function Ri(t){return function(e){return[...t.values()].find((t=>t.id===e))}}function Ii(t){return function(e){return t.get(e)}}function Ai(t){return function(e){return t.has(e.name)||[...t.values()].includes(e)}}function Pi(t,e,r,n){return function(o){if(t.size>=r)throw new Error("Maximum number of components reached.");if(!yi(o.name))throw new SyntaxError(`"${o.name}" is not a valid component name.`);if(t.has(o.name))throw new Error(`Component with name "${o.name}" already registered.`);const i=e.pop();if(void 0===i)throw new Error("No available component ids.");const a=new Ti(n,i,o);return t.set(a.name,a),a}}function ji(t,e,r){return function(n){if(!t.has(n.name))throw new Error(`Component "${n.name}" is not registered.`);return n.entities.forEach((t=>t.removeComponent(n))),t.delete(n.name),e.unshift(n.id),r}}class Ni{constructor(t){const{create:e,destroy:r,initialSize:n,growthFactor:o,maxSize:i,world:a}=t;this.initialSize=n,this.growthFactor=o,this.maxSize=i,this._create=e,this._destroy=r,this._firstAvailable=null,this._pool=new Array(n),this._world=a,this.add(n)}add(t=1){for(let e=0;e<t;e++){if(this._pool.length>=this.maxSize)throw new Error("The pool is full!");const t=this._create(this._world);t.next=this._firstAvailable,this._firstAvailable=t,this._pool.push(t)}}clear(){this._pool.length=0,this._firstAvailable=null,this.add(this.initialSize)}get(){this._firstAvailable||this.add(this.initialSize*this.growthFactor);const t=this._firstAvailable;return this._firstAvailable=t.next,t}release(t){this._destroy(t),t.next=this._firstAvailable,this._firstAvailable=t}}class xi{constructor(t=0n){this.mask=0n,this.mask=t}get value(){return this.mask}clear(){this.mask=0n}hasAll(t){return Boolean((t&this.mask)===this.mask)}hasAny(t){return Boolean(0n===this.mask||(t&this.mask)>0)}hasNone(t){return Boolean(0n===(t&this.mask))}off(t){return this.mask&=~(1n<<BigInt(t)),this.mask}on(t){return this.mask|=1n<<BigInt(t),this.mask}}class ki{constructor(t){this.id=`${Date.now().toString(36)}_${Math.random().toString(36).substr(2,9)}`,this._archetype=new xi,this._enabled=!1,this._next=null,this._properties=new Map,this._world=t}get archetype(){return this._archetype.value}get enabled(){return this._enabled}get next(){return this._next}set next(t){this._next=t}addComponent(t,e){if("string"==typeof t){const e=this._world.getComponentByName(t);if(!e)throw new Error(`Component "${t}" not found!`);t=e}if(t instanceof Ti){if(this._properties.has(t))throw new Error(`Entity already has component "${t.name}".`);this._properties.set(t,vi({},t.defaults,null!=e?e:{})),Object.defineProperty(this,t.name,{get:()=>this._properties.get(t),set:e=>{const r=this._properties.get(t);if(Object.isFrozen(r))throw new Error(`Properties in component "${t.name}" cannot be modified.`);if(!r)throw new Error(`Component "${t.name}" does not exist in entity.`);Object.entries(e).forEach((([e,n])=>{if(!(e in r))throw new Error(`Property "${e}" does not exist in component "${t.name}".`);r[e]=n}))},enumerable:!0,configurable:!0});const r=this._archetype.value;return this._archetype.on(t.id),this._world.updateArchetype(this,r),!0}throw new SyntaxError("Invalid or unregistered component.")}clear(){Object.keys(this._properties).forEach((t=>delete this[t])),this._properties.clear();const t=this._archetype.value;this._archetype.clear(),this._world.updateArchetype(this,t)}disable(){this._enabled=!1}enable(){this._enabled=!0}hasComponent(t){const e="string"==typeof t?t:t.name;return Boolean(Reflect.has(this._properties,e))}removeComponent(t){if("string"==typeof t){const e=this._world.getComponentByName(t);if(!e)throw new Error(`Component "${t}" not found!`);t=e}if(!this._properties.has(t))throw new Error(`Entity ${this.id} has no component "${t.name}".`);this._properties.delete(t);try{delete this[t.name]}catch(e){console.warn(`Could not remove property ${t.name} from entity.`)}const e=this._archetype.value;return this._archetype.off(t.id),this._world.updateArchetype(this,e),!0}}function Mi(t,e,r){return function(){const n=t.get();if(!(n&&n instanceof ki))throw new Error("No entities left! Pool is empty.");return e.set(n.id,n),r.updateArchetype(n),n}}function Ci(t,e,r){return function(n){var o;return!!e.has(n.id)&&(null===(o=r.getArchetype(n.archetype))||void 0===o||o.removeEntity(n),e.delete(n.id),t.release(n),!0)}}function Di(t){return function(){return[...t.values()]}}function zi(t){return function(e){return t.get(e)}}function Ui(t){return function(e){return t.has(e.id)||[...t.values()].includes(e)}}var $i=Qe;Ge({target:"WeakSet",proto:!0,real:!0,forced:false},{addAll:function(){return $i.apply(this,arguments)}});var Bi=Ze;Ge({target:"WeakSet",proto:!0,real:!0,forced:false},{deleteAll:function(){return Bi.apply(this,arguments)}});var Fi=Le,Gi=O,Li=g,Wi=ne,qi=function(t){return function(e,r,n,o){Fi(r);var i=Gi(e),a=Li(i),u=Wi(i.length),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw TypeError("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},Qi={left:qi(!1),right:qi(!0)},Ki=i,Vi="process"==p(n.process),Yi=Qi.left,Zi=or,Hi=Vi;Ge({target:"Array",proto:!0,forced:!function(t,e){var r=[][t];return!!r&&Ki((function(){r.call(null,e||function(){throw 1},1)}))}("reduce")||!Hi&&Zi>79&&Zi<83},{reduce:function(t){return Yi(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}});class Ji{constructor(t,e){var r,n,o,i,a,u;this._cache=new WeakSet,this._registry=new Set,this._world=t,this._all=new Set,this._any=new Set,this._none=new Set,this._mskAll=null!==(r=null===(n=e.all)||void 0===n?void 0:n.reduce(((t,e)=>(this._all.add(e),t.on(e.id),t)),new xi))&&void 0!==r?r:new xi,this._mskAny=null!==(o=null===(i=e.any)||void 0===i?void 0:i.reduce(((t,e)=>(this._any.add(e),t.on(e.id),t)),new xi))&&void 0!==o?o:new xi,this._mskNone=null!==(a=null===(u=e.none)||void 0===u?void 0:u.reduce(((t,e)=>(this._none.add(e),t.on(e.id),t)),new xi))&&void 0!==a?a:new xi}get entities(){return[...this._registry]}get size(){return this._registry.size}hasEntity(t){return this._registry.has(t)}matches(t){const e=0n===this._mskAny.value||pi(t,this._mskAny.value)>0,r=pi(t,this._mskAll.value)===this._mskAll.value,n=0n===pi(t,this._mskNone.value);return e&&r&&n}update(){this._registry.clear(),this._world.getArchetypes().forEach((t=>{(this._cache.has(t)||this.matches(t.id))&&(t.entities.forEach((t=>this._registry.add(t))),this._cache.add(t))}))}}function Xi(t){return function(e){return t.has(e)}}function ta(t,e){return function(r){const n=new Ji(e,r);return t.add(n),n}}function ea(t,e){return function(r){return t.delete(r),e}}function ra(t,e){return function(){return t.forEach((t=>t.update())),e}}function na(t){return function(){return t.getPreSystems().forEach((e=>e.pre(e.entities,t.global))),t}}function oa(t){return function(e=0){return t.getPostSystems().forEach((r=>r.post(r.entities,t.global,e))),t.updateQueries(),t}}function ia(t,e,r){let n=null,o=0;const i=e;return function(a=0){if(null!==n){o+=.001*(a-n);let e=0;for(r.pre();o>i;){if(e>=t){o=1;break}r.update(i),o-=i,e++}}return n=a,r.post(o/e),r}}function aa(t){return function(e=0){return t.getUpdateSystems().forEach((r=>r.update(r.entities,t.global,e))),t}}function ua(t,e){}function sa(t,e,r){}function ca(t,e,r){}class fa{constructor(t,e){const{name:r,query:n=null,pre:o=ua,post:i=sa,update:a=ca}=e;this.name=r,this.query=n,this.pre=o,this.post=i,this.update=a,this._enabled=!1,this._world=t}get enabled(){return this._enabled}get entities(){return null===this.query?this._world.getEntities():this.query.entities}disable(){this._enabled=!1}enable(){this._enabled=!0}}function la(t){return function(){return[...t]}}function ha(t){return function(){return t.filter((t=>t.post&&t.post!==sa&&t.enabled))}}function pa(t){return function(){return t.filter((t=>t.pre&&t.pre!==ua&&t.enabled))}}function da(t){return function(){return t.filter((t=>t.update&&t.update!==ca&&t.enabled))}}function ya(t){return function(e){return t[e]}}function ga(t){return function(e){return t.get(e)}}function va(t){return function(e){return t.has(e.name)||[...t.values()].includes(e)}}function ma(t){return function(e,r){const n=t.indexOf(e);if(-1===n)return-1;const o=di(r,0,t.length);return t.splice(o,1),t.splice(n,0,e),o}}function wa(t,e,r){return function(n,o){if(!yi(n.name))throw new SyntaxError(`"${n.name}" is not a valid system name.`);if(e.has(n.name))throw new Error(`System "${n.name}" is already registered!`);const i=new fa(r,n);return void 0!==o?t.splice(di(o,0,t.length),0,i):t.push(i),e.set(i.name,i),i}}function Ea(t,e,r){return function(n){if(!e.has(n.name))throw new Error(`System "${n.name}" is not registered!`);e.delete(n.name);const o=t.indexOf(n);return o>-1&&t.splice(o,1),r}}t.createWorld=function(t={}){const{entityPoolGrowthFactor:e=.25,initialEntityPoolSize:r=128,maxComponents:n=256,maxEntities:o=Number.POSITIVE_INFINITY,maxUpdates:i=240,tempo:a=1/60}=t,u=Object.create(null);return Object.assign(u,function(t,e){const r=new Map;return{getArchetype:wi(r),getArchetypes:Ei(r),getEntitiesByComponents:Si(r),isArchetypeRegistered:_i(r),updateArchetype:bi(r,t)}}(u),function(t,e){const{maxComponents:r}=e,n=new Array(r),o=new Map;for(let t=r,e=0n;t>=0;t--)n[t]=e++;return{getComponentById:Ri(o),getComponentByName:Ii(o),getComponents:Oi(o),isComponentRegistered:Ai(o),registerComponent:Pi(o,n,r,t),unregisterComponent:ji(o,n,t)}}(u,{maxComponents:n}),function(t,e){const{entityPoolGrowthFactor:r,initialEntityPoolSize:n,maxEntities:o}=e,i=new Ni({create:function(){return new ki(t)},destroy:function(t){t.clear()},initialSize:n,growthFactor:r,maxSize:o,world:t}),a=new Map;return{createEntity:Mi(i,a,t),destroyEntity:Ci(i,a,t),getEntities:Di(a),getEntityById:zi(a),isEntityRegistered:Ui(a)}}(u,{entityPoolGrowthFactor:e,initialEntityPoolSize:r,maxEntities:o}),function(t,e){const r=new Set;return{isQueryRegistered:Xi(r),registerQuery:ta(r,t),unregisterQuery:ea(r,t),updateQueries:ra(r,t)}}(u),function(t,e){const{maxUpdates:r,tempo:n}=e;return{post:oa(t),pre:na(t),step:ia(r,n,t),update:aa(t)}}(u,{maxUpdates:i,tempo:a}),function(t,e){const r=[],n=new Map;return{getSystems:la(r),getPostSystems:ha(r),getPreSystems:pa(r),getUpdateSystems:da(r),getSystemByIdx:ya(r),getSystemByName:ga(n),isSystemRegistered:va(n),moveSystem:ma(r),registerSystem:wa(r,n,t),unregisterSystem:Ea(r,n,t)}}(u)),u.global=u.createEntity(),u.FORBIDDEN_NAMES=[...hi],u}}));
//# sourceMappingURL=index.min.js.map
