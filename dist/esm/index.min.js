/*! *****************************************************************************
 *
 * miski
 * v0.6.0
 *
 * MIT License
 * 
 * Copyright (C) 2021 Peter Hughes<https://www.phugh.es>, all rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
***************************************************************************** */
var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},check=function(t){return t&&t.Math==Math&&t},e=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof t&&t)||function(){return this}()||Function("return this")(),r={},fails$9=function(t){try{return!!t()}catch(t){return!0}},n=!fails$9((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),o={},i={}.propertyIsEnumerable,a=Object.getOwnPropertyDescriptor,u=a&&!i.call({1:2},1);o.f=u?function propertyIsEnumerable(t){var e=a(this,t);return!!e&&e.enumerable}:i;var f,c,createPropertyDescriptor$3=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},s={}.toString,classofRaw$1=function(t){return s.call(t).slice(8,-1)},l=classofRaw$1,p="".split,y=fails$9((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==l(t)?p.call(t,""):Object(t)}:Object,requireObjectCoercible$2=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},d=y,h=requireObjectCoercible$2,toIndexedObject$3=function(t){return d(h(t))},isObject$c=function(t){return"object"==typeof t?null!==t:"function"==typeof t},g=e,aFunction$m=function(t){return"function"==typeof t?t:void 0},getBuiltIn$f=function(t,e){return arguments.length<2?aFunction$m(g[t]):g[t]&&g[t][e]},m=getBuiltIn$f("navigator","userAgent")||"",v=e,w=m,E=v.process,b=v.Deno,S=E&&E.versions||b&&b.version,T=S&&S.v8;T?c=(f=T.split("."))[0]<4?1:f[0]+f[1]:w&&(!(f=w.match(/Edge\/(\d+)/))||f[1]>=74)&&(f=w.match(/Chrome\/(\d+)/))&&(c=f[1]);var A=c&&+c,O=A,I=fails$9,R=!!Object.getOwnPropertySymbols&&!I((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&O&&O<41})),_=R&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,j=getBuiltIn$f,x=_?function(t){return"symbol"==typeof t}:function(t){var e=j("Symbol");return"function"==typeof e&&Object(t)instanceof e},D=isObject$c,P={exports:{}},N=e,setGlobal$3=function(t,e){try{Object.defineProperty(N,t,{value:e,configurable:!0,writable:!0})}catch(r){N[t]=e}return e},C=setGlobal$3,M=e["__core-js_shared__"]||C("__core-js_shared__",{}),U=M;(P.exports=function(t,e){return U[t]||(U[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.16.0",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var B=requireObjectCoercible$2,toObject$5=function(t){return Object(B(t))},V=toObject$5,k={}.hasOwnProperty,Y=Object.hasOwn||function hasOwn(t,e){return k.call(V(t),e)},L=0,G=Math.random(),uid$3=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++L+G).toString(36)},W=e,q=P.exports,Q=Y,$=uid$3,Z=R,z=_,K=q("wks"),X=W.Symbol,H=z?X:X&&X.withoutSetter||$,wellKnownSymbol$b=function(t){return Q(K,t)&&(Z||"string"==typeof K[t])||(Z&&Q(X,t)?K[t]=X[t]:K[t]=H("Symbol."+t)),K[t]},J=isObject$c,tt=x,ordinaryToPrimitive=function(t,e){var r,n;if("string"===e&&"function"==typeof(r=t.toString)&&!D(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!D(n=r.call(t)))return n;if("string"!==e&&"function"==typeof(r=t.toString)&&!D(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")},et=wellKnownSymbol$b("toPrimitive"),toPrimitive=function(t,e){if(!J(t)||tt(t))return t;var r,n=t[et];if(void 0!==n){if(void 0===e&&(e="default"),r=n.call(t,e),!J(r)||tt(r))return r;throw TypeError("Can't convert object to primitive value")}return void 0===e&&(e="number"),ordinaryToPrimitive(t,e)},rt=x,toPropertyKey$3=function(t){var e=toPrimitive(t,"string");return rt(e)?e:String(e)},nt=isObject$c,ot=e.document,it=nt(ot)&&nt(ot.createElement),documentCreateElement$1=function(t){return it?ot.createElement(t):{}},at=documentCreateElement$1,ut=!n&&!fails$9((function(){return 7!=Object.defineProperty(at("div"),"a",{get:function(){return 7}}).a})),ft=n,ct=o,st=createPropertyDescriptor$3,lt=toIndexedObject$3,pt=toPropertyKey$3,yt=Y,dt=ut,ht=Object.getOwnPropertyDescriptor;r.f=ft?ht:function getOwnPropertyDescriptor(t,e){if(t=lt(t),e=pt(e),dt)try{return ht(t,e)}catch(t){}if(yt(t,e))return st(!ct.f.call(t,e),t[e])};var gt={},mt=isObject$c,anObject$B=function(t){if(!mt(t))throw TypeError(String(t)+" is not an object");return t},vt=n,wt=ut,Et=anObject$B,bt=toPropertyKey$3,St=Object.defineProperty;gt.f=vt?St:function defineProperty(t,e,r){if(Et(t),e=bt(e),Et(r),wt)try{return St(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(t[e]=r.value),t};var Tt=gt,At=createPropertyDescriptor$3,Ot=n?function(t,e,r){return Tt.f(t,e,At(1,r))}:function(t,e,r){return t[e]=r,t},It={exports:{}},Rt=M,_t=Function.toString;"function"!=typeof Rt.inspectSource&&(Rt.inspectSource=function(t){return _t.call(t)});var jt,xt,Dt,Pt=Rt.inspectSource,Nt=Pt,Ct=e.WeakMap,Mt="function"==typeof Ct&&/native code/.test(Nt(Ct)),Ut=P.exports,Ft=uid$3,Bt=Ut("keys"),sharedKey$3=function(t){return Bt[t]||(Bt[t]=Ft(t))},Vt={},kt=Mt,Yt=isObject$c,Lt=Ot,Gt=Y,Wt=M,qt=sharedKey$3,Qt=Vt,$t=e.WeakMap;if(kt||Wt.state){var Zt=Wt.state||(Wt.state=new $t),zt=Zt.get,Kt=Zt.has,Xt=Zt.set;jt=function(t,e){if(Kt.call(Zt,t))throw new TypeError("Object already initialized");return e.facade=t,Xt.call(Zt,t,e),e},xt=function(t){return zt.call(Zt,t)||{}},Dt=function(t){return Kt.call(Zt,t)}}else{var Ht=qt("state");Qt[Ht]=!0,jt=function(t,e){if(Gt(t,Ht))throw new TypeError("Object already initialized");return e.facade=t,Lt(t,Ht,e),e},xt=function(t){return Gt(t,Ht)?t[Ht]:{}},Dt=function(t){return Gt(t,Ht)}}var Jt={set:jt,get:xt,has:Dt,enforce:function(t){return Dt(t)?xt(t):jt(t,{})},getterFor:function(t){return function(e){var r;if(!Yt(e)||(r=xt(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return r}}},te=e,ee=Ot,re=Y,ne=setGlobal$3,oe=Pt,ie=Jt.get,ae=Jt.enforce,ue=String(String).split("String");(It.exports=function(t,e,r,n){var o,i=!!n&&!!n.unsafe,a=!!n&&!!n.enumerable,u=!!n&&!!n.noTargetGet;"function"==typeof r&&("string"!=typeof e||re(r,"name")||ee(r,"name",e),(o=ae(r)).source||(o.source=ue.join("string"==typeof e?e:""))),t!==te?(i?!u&&t[e]&&(a=!0):delete t[e],a?t[e]=r:ee(t,e,r)):a?t[e]=r:ne(e,r)})(Function.prototype,"toString",(function toString(){return"function"==typeof this&&ie(this).source||oe(this)}));var fe={},ce=Math.ceil,se=Math.floor,toInteger$5=function(t){return isNaN(t=+t)?0:(t>0?se:ce)(t)},le=toInteger$5,pe=Math.min,toLength$9=function(t){return t>0?pe(le(t),9007199254740991):0},ye=toInteger$5,de=Math.max,he=Math.min,toAbsoluteIndex$2=function(t,e){var r=ye(t);return r<0?de(r+e,0):he(r,e)},ge=toIndexedObject$3,me=toLength$9,ve=toAbsoluteIndex$2,createMethod$1=function(t){return function(e,r,n){var o,i=ge(e),a=me(i.length),u=ve(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},we={includes:createMethod$1(!0),indexOf:createMethod$1(!1)},Ee=Y,be=toIndexedObject$3,Se=we.indexOf,Te=Vt,objectKeysInternal=function(t,e){var r,n=be(t),o=0,i=[];for(r in n)!Ee(Te,r)&&Ee(n,r)&&i.push(r);for(;e.length>o;)Ee(n,r=e[o++])&&(~Se(i,r)||i.push(r));return i},Ae=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Oe=objectKeysInternal,Ie=Ae.concat("length","prototype");fe.f=Object.getOwnPropertyNames||function getOwnPropertyNames(t){return Oe(t,Ie)};var Re={};Re.f=Object.getOwnPropertySymbols;var _e=fe,je=Re,xe=anObject$B,De=getBuiltIn$f("Reflect","ownKeys")||function ownKeys(t){var e=_e.f(xe(t)),r=je.f;return r?e.concat(r(t)):e},Pe=Y,Ne=De,Ce=r,Me=gt,Ue=fails$9,Fe=/#|\.prototype\./,isForced$1=function(t,e){var r=Ve[Be(t)];return r==Ye||r!=ke&&("function"==typeof e?Ue(e):!!e)},Be=isForced$1.normalize=function(t){return String(t).replace(Fe,".").toLowerCase()},Ve=isForced$1.data={},ke=isForced$1.NATIVE="N",Ye=isForced$1.POLYFILL="P",Le=isForced$1,Ge=e,We=r.f,qe=Ot,Qe=It.exports,$e=setGlobal$3,copyConstructorProperties=function(t,e){for(var r=Ne(e),n=Me.f,o=Ce.f,i=0;i<r.length;i++){var a=r[i];Pe(t,a)||n(t,a,o(e,a))}},Ze=Le,_export=function(t,e){var r,n,o,i,a,u=t.target,f=t.global,c=t.stat;if(r=f?Ge:c?Ge[u]||$e(u,{}):(Ge[u]||{}).prototype)for(n in e){if(i=e[n],o=t.noTargetGet?(a=We(r,n))&&a.value:r[n],!Ze(f?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;copyConstructorProperties(i,o)}(t.sham||o&&o.sham)&&qe(i,"sham",!0),Qe(r,n,i,t)}},aFunction$l=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},ze=anObject$B,Ke=aFunction$l,collectionAddAll=function(){for(var t=ze(this),e=Ke(t.add),r=0,n=arguments.length;r<n;r++)e.call(t,arguments[r]);return t};_export({target:"Set",proto:!0,real:!0,forced:false},{addAll:function addAll(){return collectionAddAll.apply(this,arguments)}});var Xe=anObject$B,He=aFunction$l,collectionDeleteAll$2=function(){for(var t,e=Xe(this),r=He(e.delete),n=!0,o=0,i=arguments.length;o<i;o++)t=r.call(e,arguments[o]),n=n&&t;return!!n},Je=collectionDeleteAll$2;_export({target:"Set",proto:!0,real:!0,forced:false},{deleteAll:function deleteAll(){return Je.apply(this,arguments)}});var tr=anObject$B,er=aFunction$l,rr=wellKnownSymbol$b("species"),speciesConstructor$9=function(t,e){var r,n=tr(t).constructor;return void 0===n||null==(r=tr(n)[rr])?e:er(r)},nr={},or=nr,ir=wellKnownSymbol$b("iterator"),ar=Array.prototype,isArrayIteratorMethod$2=function(t){return void 0!==t&&(or.Array===t||ar[ir]===t)},ur=aFunction$l,functionBindContext=function(t,e,r){if(ur(t),void 0===e)return t;switch(r){case 0:return function(){return t.call(e)};case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,o){return t.call(e,r,n,o)}}return function(){return t.apply(e,arguments)}},fr={};fr[wellKnownSymbol$b("toStringTag")]="z";var cr="[object z]"===String(fr),sr=classofRaw$1,lr=wellKnownSymbol$b("toStringTag"),pr="Arguments"==sr(function(){return arguments}()),yr=cr?sr:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),lr))?r:pr?sr(e):"Object"==(n=sr(e))&&"function"==typeof e.callee?"Arguments":n},dr=yr,hr=nr,gr=wellKnownSymbol$b("iterator"),getIteratorMethod$3=function(t){if(null!=t)return t[gr]||t["@@iterator"]||hr[dr(t)]},mr=anObject$B,vr=anObject$B,wr=isArrayIteratorMethod$2,Er=toLength$9,br=functionBindContext,Sr=getIteratorMethod$3,iteratorClose=function(t){var e=t.return;if(void 0!==e)return mr(e.call(t)).value},Result=function(t,e){this.stopped=t,this.result=e},iterate$p=function(t,e,r){var n,o,i,a,u,f,c,s=r&&r.that,l=!(!r||!r.AS_ENTRIES),p=!(!r||!r.IS_ITERATOR),y=!(!r||!r.INTERRUPTED),d=br(e,s,1+l+y),stop=function(t){return n&&iteratorClose(n),new Result(!0,t)},callFn=function(t){return l?(vr(t),y?d(t[0],t[1],stop):d(t[0],t[1])):y?d(t,stop):d(t)};if(p)n=t;else{if("function"!=typeof(o=Sr(t)))throw TypeError("Target is not iterable");if(wr(o)){for(i=0,a=Er(t.length);a>i;i++)if((u=callFn(t[i]))&&u instanceof Result)return u;return new Result(!1)}n=o.call(t)}for(f=n.next;!(c=f.call(n)).done;){try{u=callFn(c.value)}catch(t){throw iteratorClose(n),t}if("object"==typeof u&&u&&u instanceof Result)return u}return new Result(!1)},Tr=getBuiltIn$f,Ar=anObject$B,Or=aFunction$l,Ir=speciesConstructor$9,Rr=iterate$p;_export({target:"Set",proto:!0,real:!0,forced:false},{difference:function difference(t){var e=Ar(this),r=new(Ir(e,Tr("Set")))(e),n=Or(r.delete);return Rr(t,(function(t){n.call(r,t)})),r}});var getSetIterator$7=function(t){return Set.prototype.values.call(t)},_r=anObject$B,jr=functionBindContext,xr=getSetIterator$7,Dr=iterate$p;_export({target:"Set",proto:!0,real:!0,forced:false},{every:function every(t){var e=_r(this),r=xr(e),n=jr(t,arguments.length>1?arguments[1]:void 0,3);return!Dr(r,(function(t,r){if(!n(t,t,e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Pr=getBuiltIn$f,Nr=anObject$B,Cr=aFunction$l,Mr=functionBindContext,Ur=speciesConstructor$9,Fr=getSetIterator$7,Br=iterate$p;_export({target:"Set",proto:!0,real:!0,forced:false},{filter:function filter(t){var e=Nr(this),r=Fr(e),n=Mr(t,arguments.length>1?arguments[1]:void 0,3),o=new(Ur(e,Pr("Set"))),i=Cr(o.add);return Br(r,(function(t){n(t,t,e)&&i.call(o,t)}),{IS_ITERATOR:!0}),o}});var Vr=anObject$B,kr=functionBindContext,Yr=getSetIterator$7,Lr=iterate$p;_export({target:"Set",proto:!0,real:!0,forced:false},{find:function find(t){var e=Vr(this),r=Yr(e),n=kr(t,arguments.length>1?arguments[1]:void 0,3);return Lr(r,(function(t,r){if(n(t,t,e))return r(t)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Gr=getBuiltIn$f,Wr=anObject$B,qr=aFunction$l,Qr=speciesConstructor$9,$r=iterate$p;_export({target:"Set",proto:!0,real:!0,forced:false},{intersection:function intersection(t){var e=Wr(this),r=new(Qr(e,Gr("Set"))),n=qr(e.has),o=qr(r.add);return $r(t,(function(t){n.call(e,t)&&o.call(r,t)})),r}});var Zr=anObject$B,zr=aFunction$l,Kr=iterate$p;_export({target:"Set",proto:!0,real:!0,forced:false},{isDisjointFrom:function isDisjointFrom(t){var e=Zr(this),r=zr(e.has);return!Kr(t,(function(t,n){if(!0===r.call(e,t))return n()}),{INTERRUPTED:!0}).stopped}});var Xr=anObject$B,Hr=getIteratorMethod$3,Jr=getBuiltIn$f,tn=anObject$B,en=aFunction$l,getIterator=function(t){var e=Hr(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return Xr(e.call(t))},rn=iterate$p;_export({target:"Set",proto:!0,real:!0,forced:false},{isSubsetOf:function isSubsetOf(t){var e=getIterator(this),r=tn(t),n=r.has;return"function"!=typeof n&&(r=new(Jr("Set"))(t),n=en(r.has)),!rn(e,(function(t,e){if(!1===n.call(r,t))return e()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var nn=anObject$B,on=aFunction$l,an=iterate$p;_export({target:"Set",proto:!0,real:!0,forced:false},{isSupersetOf:function isSupersetOf(t){var e=nn(this),r=on(e.has);return!an(t,(function(t,n){if(!1===r.call(e,t))return n()}),{INTERRUPTED:!0}).stopped}});var un=anObject$B,fn=getSetIterator$7,cn=iterate$p;_export({target:"Set",proto:!0,real:!0,forced:false},{join:function join(t){var e=un(this),r=fn(e),n=void 0===t?",":String(t),o=[];return cn(r,o.push,{that:o,IS_ITERATOR:!0}),o.join(n)}});var sn=getBuiltIn$f,ln=anObject$B,pn=aFunction$l,yn=functionBindContext,dn=speciesConstructor$9,hn=getSetIterator$7,gn=iterate$p;_export({target:"Set",proto:!0,real:!0,forced:false},{map:function map(t){var e=ln(this),r=hn(e),n=yn(t,arguments.length>1?arguments[1]:void 0,3),o=new(dn(e,sn("Set"))),i=pn(o.add);return gn(r,(function(t){i.call(o,n(t,t,e))}),{IS_ITERATOR:!0}),o}});var mn=anObject$B,vn=aFunction$l,wn=getSetIterator$7,En=iterate$p;_export({target:"Set",proto:!0,real:!0,forced:false},{reduce:function reduce(t){var e=mn(this),r=wn(e),n=arguments.length<2,o=n?void 0:arguments[1];if(vn(t),En(r,(function(r){n?(n=!1,o=r):o=t(o,r,r,e)}),{IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty set with no initial value");return o}});var bn=anObject$B,Sn=functionBindContext,Tn=getSetIterator$7,An=iterate$p;_export({target:"Set",proto:!0,real:!0,forced:false},{some:function some(t){var e=bn(this),r=Tn(e),n=Sn(t,arguments.length>1?arguments[1]:void 0,3);return An(r,(function(t,r){if(n(t,t,e))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var On=getBuiltIn$f,In=anObject$B,Rn=aFunction$l,_n=speciesConstructor$9,jn=iterate$p;_export({target:"Set",proto:!0,real:!0,forced:false},{symmetricDifference:function symmetricDifference(t){var e=In(this),r=new(_n(e,On("Set")))(e),n=Rn(r.delete),o=Rn(r.add);return jn(t,(function(t){n.call(r,t)||o.call(r,t)})),r}});var xn=getBuiltIn$f,Dn=anObject$B,Pn=aFunction$l,Nn=speciesConstructor$9,Cn=iterate$p;_export({target:"Set",proto:!0,real:!0,forced:false},{union:function union(t){var e=Dn(this),r=new(Nn(e,xn("Set")))(e);return Cn(t,Pn(r.add),{that:r}),r}});var Mn={exports:{}},Un=wellKnownSymbol$b("iterator"),Fn=!1;try{var Bn=0,Vn={next:function(){return{done:!!Bn++}},return:function(){Fn=!0}};Vn[Un]=function(){return this},Array.from(Vn,(function(){throw 2}))}catch(t){}var kn,Yn,Ln,Gn="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Wn=!fails$9((function(){function F(){}return F.prototype.constructor=null,Object.getPrototypeOf(new F)!==F.prototype})),qn=Y,Qn=toObject$5,$n=Wn,Zn=sharedKey$3("IE_PROTO"),zn=Object.prototype,Kn=$n?Object.getPrototypeOf:function(t){return t=Qn(t),qn(t,Zn)?t[Zn]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?zn:null},Xn=isObject$c,Hn=anObject$B,aPossiblePrototype=function(t){if(!Xn(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t},Jn=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),e=r instanceof Array}catch(t){}return function setPrototypeOf(r,n){return Hn(r),aPossiblePrototype(n),e?t.call(r,n):r.__proto__=n,r}}():void 0),to=Gn,eo=n,ro=e,no=isObject$c,oo=Y,io=yr,ao=Ot,uo=It.exports,fo=gt.f,co=Kn,so=Jn,lo=wellKnownSymbol$b,po=uid$3,yo=ro.Int8Array,ho=yo&&yo.prototype,go=ro.Uint8ClampedArray,mo=go&&go.prototype,vo=yo&&co(yo),wo=ho&&co(ho),Eo=Object.prototype,bo=Eo.isPrototypeOf,So=lo("toStringTag"),To=po("TYPED_ARRAY_TAG"),Ao=po("TYPED_ARRAY_CONSTRUCTOR"),Oo=to&&!!so&&"Opera"!==io(ro.opera),Io=!1,Ro={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},_o={BigInt64Array:8,BigUint64Array:8},isTypedArray$2=function(t){if(!no(t))return!1;var e=io(t);return oo(Ro,e)||oo(_o,e)};for(kn in Ro)(Ln=(Yn=ro[kn])&&Yn.prototype)?ao(Ln,Ao,Yn):Oo=!1;for(kn in _o)(Ln=(Yn=ro[kn])&&Yn.prototype)&&ao(Ln,Ao,Yn);if((!Oo||"function"!=typeof vo||vo===Function.prototype)&&(vo=function TypedArray(){throw TypeError("Incorrect invocation")},Oo))for(kn in Ro)ro[kn]&&so(ro[kn],vo);if((!Oo||!wo||wo===Eo)&&(wo=vo.prototype,Oo))for(kn in Ro)ro[kn]&&so(ro[kn].prototype,wo);if(Oo&&co(mo)!==wo&&so(mo,wo),eo&&!oo(wo,So))for(kn in Io=!0,fo(wo,So,{get:function(){return no(this)?this[To]:void 0}}),Ro)ro[kn]&&ao(ro[kn],To,kn);var jo={NATIVE_ARRAY_BUFFER_VIEWS:Oo,TYPED_ARRAY_CONSTRUCTOR:Ao,TYPED_ARRAY_TAG:Io&&To,aTypedArray:function(t){if(isTypedArray$2(t))return t;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(t){if(so&&!bo.call(vo,t))throw TypeError("Target is not a typed array constructor");return t},exportTypedArrayMethod:function(t,e,r){if(eo){if(r)for(var n in Ro){var o=ro[n];if(o&&oo(o.prototype,t))try{delete o.prototype[t]}catch(t){}}wo[t]&&!r||uo(wo,t,r?e:Oo&&ho[t]||e)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(eo){if(so){if(r)for(n in Ro)if((o=ro[n])&&oo(o,t))try{delete o[t]}catch(t){}if(vo[t]&&!r)return;try{return uo(vo,t,r?e:Oo&&vo[t]||e)}catch(t){}}for(n in Ro)!(o=ro[n])||o[t]&&!r||uo(o,t,e)}},isView:function isView(t){if(!no(t))return!1;var e=io(t);return"DataView"===e||oo(Ro,e)||oo(_o,e)},isTypedArray:isTypedArray$2,TypedArray:vo,TypedArrayPrototype:wo},xo=e,Do=fails$9,checkCorrectnessOfIteration=function(t,e){if(!e&&!Fn)return!1;var r=!1;try{var n={};n[Un]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Po=jo.NATIVE_ARRAY_BUFFER_VIEWS,No=xo.ArrayBuffer,Co=xo.Int8Array,Mo=!Po||!Do((function(){Co(1)}))||!Do((function(){new Co(-1)}))||!checkCorrectnessOfIteration((function(t){new Co,new Co(null),new Co(1.5),new Co(t)}),!0)||Do((function(){return 1!==new Co(new No(2),1,void 0).length})),Uo=It.exports,anInstance$2=function(t,e,r){if(!(t instanceof e))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return t},Fo=toInteger$5,Bo=toLength$9,toIndex$2=function(t){if(void 0===t)return 0;var e=Fo(t),r=Bo(e);if(e!==r)throw RangeError("Wrong length or index");return r},Vo=Math.abs,ko=Math.pow,Yo=Math.floor,Lo=Math.log,Go=Math.LN2,Wo={pack:function(t,e,r){var n,o,i,a=new Array(r),u=8*r-e-1,f=(1<<u)-1,c=f>>1,s=23===e?ko(2,-24)-ko(2,-77):0,l=t<0||0===t&&1/t<0?1:0,p=0;for((t=Vo(t))!=t||t===1/0?(o=t!=t?1:0,n=f):(n=Yo(Lo(t)/Go),t*(i=ko(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?s/i:s*ko(2,1-c))*i>=2&&(n++,i/=2),n+c>=f?(o=0,n=f):n+c>=1?(o=(t*i-1)*ko(2,e),n+=c):(o=t*ko(2,c-1)*ko(2,e),n=0));e>=8;a[p++]=255&o,o/=256,e-=8);for(n=n<<e|o,u+=e;u>0;a[p++]=255&n,n/=256,u-=8);return a[--p]|=128*l,a},unpack:function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,f=n-1,c=t[f--],s=127&c;for(c>>=7;u>0;s=256*s+t[f],f--,u-=8);for(r=s&(1<<-u)-1,s>>=-u,u+=e;u>0;r=256*r+t[f],f--,u-=8);if(0===s)s=1-a;else{if(s===i)return r?NaN:c?-1/0:1/0;r+=ko(2,e),s-=a}return(c?-1:1)*r*ko(2,s-e)}},qo=toObject$5,Qo=toAbsoluteIndex$2,$o=toLength$9,Zo=gt.f,zo=Y,Ko=wellKnownSymbol$b("toStringTag"),Xo=e,Ho=n,Jo=Gn,ti=Ot,redefineAll=function(t,e,r){for(var n in e)Uo(t,n,e[n],r);return t},ei=fails$9,ri=anInstance$2,ni=toInteger$5,oi=toLength$9,ii=toIndex$2,ai=Wo,ui=Kn,fi=Jn,ci=fe.f,si=gt.f,li=function fill(t){for(var e=qo(this),r=$o(e.length),n=arguments.length,o=Qo(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Qo(i,r);a>o;)e[o++]=t;return e},setToStringTag=function(t,e,r){t&&!zo(t=r?t:t.prototype,Ko)&&Zo(t,Ko,{configurable:!0,value:e})},pi=Jt.get,yi=Jt.set,di=Xo.ArrayBuffer,hi=di,gi=Xo.DataView,mi=gi&&gi.prototype,vi=Object.prototype,wi=Xo.RangeError,Ei=ai.pack,bi=ai.unpack,packInt8=function(t){return[255&t]},packInt16=function(t){return[255&t,t>>8&255]},packInt32=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},unpackInt32=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},packFloat32=function(t){return Ei(t,23,4)},packFloat64=function(t){return Ei(t,52,8)},addGetter$1=function(t,e){si(t.prototype,e,{get:function(){return pi(this)[e]}})},get=function(t,e,r,n){var o=ii(r),i=pi(t);if(o+e>i.byteLength)throw wi("Wrong index");var a=pi(i.buffer).bytes,u=o+i.byteOffset,f=a.slice(u,u+e);return n?f:f.reverse()},set=function(t,e,r,n,o,i){var a=ii(r),u=pi(t);if(a+e>u.byteLength)throw wi("Wrong index");for(var f=pi(u.buffer).bytes,c=a+u.byteOffset,s=n(+o),l=0;l<e;l++)f[c+l]=s[i?l:e-l-1]};if(Jo){if(!ei((function(){di(1)}))||!ei((function(){new di(-1)}))||ei((function(){return new di,new di(1.5),new di(NaN),"ArrayBuffer"!=di.name}))){for(var Si,Ti=(hi=function ArrayBuffer(t){return ri(this,hi),new di(ii(t))}).prototype=di.prototype,Ai=ci(di),Oi=0;Ai.length>Oi;)(Si=Ai[Oi++])in hi||ti(hi,Si,di[Si]);Ti.constructor=hi}fi&&ui(mi)!==vi&&fi(mi,vi);var Ii=new gi(new hi(2)),Ri=mi.setInt8;Ii.setInt8(0,2147483648),Ii.setInt8(1,2147483649),!Ii.getInt8(0)&&Ii.getInt8(1)||redefineAll(mi,{setInt8:function setInt8(t,e){Ri.call(this,t,e<<24>>24)},setUint8:function setUint8(t,e){Ri.call(this,t,e<<24>>24)}},{unsafe:!0})}else hi=function ArrayBuffer(t){ri(this,hi,"ArrayBuffer");var e=ii(t);yi(this,{bytes:li.call(new Array(e),0),byteLength:e}),Ho||(this.byteLength=e)},gi=function DataView(t,e,r){ri(this,gi,"DataView"),ri(t,hi,"DataView");var n=pi(t).byteLength,o=ni(e);if(o<0||o>n)throw wi("Wrong offset");if(o+(r=void 0===r?n-o:oi(r))>n)throw wi("Wrong length");yi(this,{buffer:t,byteLength:r,byteOffset:o}),Ho||(this.buffer=t,this.byteLength=r,this.byteOffset=o)},Ho&&(addGetter$1(hi,"byteLength"),addGetter$1(gi,"buffer"),addGetter$1(gi,"byteLength"),addGetter$1(gi,"byteOffset")),redefineAll(gi.prototype,{getInt8:function getInt8(t){return get(this,1,t)[0]<<24>>24},getUint8:function getUint8(t){return get(this,1,t)[0]},getInt16:function getInt16(t){var e=get(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function getUint16(t){var e=get(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function getInt32(t){return unpackInt32(get(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function getUint32(t){return unpackInt32(get(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function getFloat32(t){return bi(get(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function getFloat64(t){return bi(get(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function setInt8(t,e){set(this,1,t,packInt8,e)},setUint8:function setUint8(t,e){set(this,1,t,packInt8,e)},setInt16:function setInt16(t,e){set(this,2,t,packInt16,e,arguments.length>2?arguments[2]:void 0)},setUint16:function setUint16(t,e){set(this,2,t,packInt16,e,arguments.length>2?arguments[2]:void 0)},setInt32:function setInt32(t,e){set(this,4,t,packInt32,e,arguments.length>2?arguments[2]:void 0)},setUint32:function setUint32(t,e){set(this,4,t,packInt32,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function setFloat32(t,e){set(this,4,t,packFloat32,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function setFloat64(t,e){set(this,8,t,packFloat64,e,arguments.length>2?arguments[2]:void 0)}});setToStringTag(hi,"ArrayBuffer"),setToStringTag(gi,"DataView");var _i,ji={ArrayBuffer:hi,DataView:gi},xi=isObject$c,Di=Math.floor,Pi=toInteger$5,toPositiveInteger=function(t){var e=Pi(t);if(e<0)throw RangeError("The argument can't be less than 0");return e},Ni=objectKeysInternal,Ci=Ae,Mi=Object.keys||function keys(t){return Ni(t,Ci)},Ui=gt,Fi=anObject$B,Bi=Mi,Vi=n?Object.defineProperties:function defineProperties(t,e){Fi(t);for(var r,n=Bi(e),o=n.length,i=0;o>i;)Ui.f(t,r=n[i++],e[r]);return t},ki=getBuiltIn$f("document","documentElement"),Yi=anObject$B,Li=Vi,Gi=Ae,Wi=Vt,qi=ki,Qi=documentCreateElement$1,$i=sharedKey$3("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(t){return"<script>"+t+"<\/script>"},NullProtoObjectViaActiveX=function(t){t.write(scriptTag("")),t.close();var e=t.parentWindow.Object;return t=null,e},NullProtoObject=function(){try{_i=new ActiveXObject("htmlfile")}catch(t){}NullProtoObject=document.domain&&_i?NullProtoObjectViaActiveX(_i):function(){var t,e=Qi("iframe");if(e.style)return e.style.display="none",qi.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(scriptTag("document.F=Object")),t.close(),t.F}()||NullProtoObjectViaActiveX(_i);for(var t=Gi.length;t--;)delete NullProtoObject.prototype[Gi[t]];return NullProtoObject()};Wi[$i]=!0;var Zi=Object.create||function create(t,e){var r;return null!==t?(EmptyConstructor.prototype=Yi(t),r=new EmptyConstructor,EmptyConstructor.prototype=null,r[$i]=t):r=NullProtoObject(),void 0===e?r:Li(r,e)},zi=toObject$5,Ki=toLength$9,Xi=getIteratorMethod$3,Hi=isArrayIteratorMethod$2,Ji=functionBindContext,ta=jo.aTypedArrayConstructor,ea=classofRaw$1,ra=Array.isArray||function isArray(t){return"Array"==ea(t)},na=isObject$c,oa=ra,ia=wellKnownSymbol$b("species"),arraySpeciesConstructor=function(t){var e;return oa(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!oa(e.prototype)?na(e)&&null===(e=e[ia])&&(e=void 0):e=void 0),void 0===e?Array:e},aa=functionBindContext,ua=y,fa=toObject$5,ca=toLength$9,arraySpeciesCreate=function(t,e){return new(arraySpeciesConstructor(t))(0===e?0:e)},sa=[].push,createMethod=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(f,c,s,l){for(var p,y,d=fa(f),h=ua(d),g=aa(c,s,3),m=ca(h.length),v=0,w=l||arraySpeciesCreate,E=e?w(f,m):r||a?w(f,0):void 0;m>v;v++)if((u||v in h)&&(y=g(p=h[v],v,d),t))if(e)E[v]=y;else if(y)switch(t){case 3:return!0;case 5:return p;case 6:return v;case 2:sa.call(E,p)}else switch(t){case 4:return!1;case 7:sa.call(E,p)}return i?-1:n||o?o:E}},la={forEach:createMethod(0),map:createMethod(1),filter:createMethod(2),some:createMethod(3),every:createMethod(4),find:createMethod(5),findIndex:createMethod(6),filterReject:createMethod(7)},pa=getBuiltIn$f,ya=gt,da=n,ha=wellKnownSymbol$b("species"),ga=isObject$c,ma=Jn,va=_export,wa=e,Ea=n,ba=Mo,Sa=jo,Ta=ji,Aa=anInstance$2,Oa=createPropertyDescriptor$3,Ia=Ot,Ra=function isInteger(t){return!xi(t)&&isFinite(t)&&Di(t)===t},_a=toLength$9,ja=toIndex$2,toOffset=function(t,e){var r=toPositiveInteger(t);if(r%e)throw RangeError("Wrong offset");return r},xa=toPropertyKey$3,Da=Y,Pa=yr,Na=isObject$c,Ca=x,Ma=Zi,Ua=Jn,Fa=fe.f,Ba=function from(t){var e,r,n,o,i,a,u=zi(t),f=arguments.length,c=f>1?arguments[1]:void 0,s=void 0!==c,l=Xi(u);if(null!=l&&!Hi(l))for(a=(i=l.call(u)).next,u=[];!(o=a.call(i)).done;)u.push(o.value);for(s&&f>2&&(c=Ji(c,arguments[2],2)),r=Ki(u.length),n=new(ta(this))(r),e=0;r>e;e++)n[e]=s?c(u[e],e):u[e];return n},Va=la.forEach,setSpecies=function(t){var e=pa(t),r=ya.f;da&&e&&!e[ha]&&r(e,ha,{configurable:!0,get:function(){return this}})},ka=gt,Ya=r,inheritIfRequired=function(t,e,r){var n,o;return ma&&"function"==typeof(n=e.constructor)&&n!==r&&ga(o=n.prototype)&&o!==r.prototype&&ma(t,o),t},La=Jt.get,Ga=Jt.set,Wa=ka.f,qa=Ya.f,Qa=Math.round,$a=wa.RangeError,Za=Ta.ArrayBuffer,za=Ta.DataView,Ka=Sa.NATIVE_ARRAY_BUFFER_VIEWS,Xa=Sa.TYPED_ARRAY_CONSTRUCTOR,Ha=Sa.TYPED_ARRAY_TAG,Ja=Sa.TypedArray,tu=Sa.TypedArrayPrototype,eu=Sa.aTypedArrayConstructor,ru=Sa.isTypedArray,fromList=function(t,e){for(var r=0,n=e.length,o=new(eu(t))(n);n>r;)o[r]=e[r++];return o},addGetter=function(t,e){Wa(t,e,{get:function(){return La(this)[e]}})},isArrayBuffer=function(t){var e;return t instanceof Za||"ArrayBuffer"==(e=Pa(t))||"SharedArrayBuffer"==e},isTypedArrayIndex=function(t,e){return ru(t)&&!Ca(e)&&e in t&&Ra(+e)&&e>=0},nu=function getOwnPropertyDescriptor(t,e){return e=xa(e),isTypedArrayIndex(t,e)?Oa(2,t[e]):qa(t,e)},ou=function defineProperty(t,e,r){return e=xa(e),!(isTypedArrayIndex(t,e)&&Na(r)&&Da(r,"value"))||Da(r,"get")||Da(r,"set")||r.configurable||Da(r,"writable")&&!r.writable||Da(r,"enumerable")&&!r.enumerable?Wa(t,e,r):(t[e]=r.value,t)};Ea?(Ka||(Ya.f=nu,ka.f=ou,addGetter(tu,"buffer"),addGetter(tu,"byteOffset"),addGetter(tu,"byteLength"),addGetter(tu,"length")),va({target:"Object",stat:!0,forced:!Ka},{getOwnPropertyDescriptor:nu,defineProperty:ou}),Mn.exports=function(t,e,r){var n=t.match(/\d+$/)[0]/8,o=t+(r?"Clamped":"")+"Array",i="get"+t,a="set"+t,u=wa[o],f=u,c=f&&f.prototype,s={},addElement=function(t,e){Wa(t,e,{get:function(){return function(t,e){var r=La(t);return r.view[i](e*n+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,o){var i=La(t);r&&(o=(o=Qa(o))<0?0:o>255?255:255&o),i.view[a](e*n+i.byteOffset,o,!0)}(this,e,t)},enumerable:!0})};Ka?ba&&(f=e((function(t,e,r,i){return Aa(t,f,o),inheritIfRequired(Na(e)?isArrayBuffer(e)?void 0!==i?new u(e,toOffset(r,n),i):void 0!==r?new u(e,toOffset(r,n)):new u(e):ru(e)?fromList(f,e):Ba.call(f,e):new u(ja(e)),t,f)})),Ua&&Ua(f,Ja),Va(Fa(u),(function(t){t in f||Ia(f,t,u[t])})),f.prototype=c):(f=e((function(t,e,r,i){Aa(t,f,o);var a,u,c,s=0,l=0;if(Na(e)){if(!isArrayBuffer(e))return ru(e)?fromList(f,e):Ba.call(f,e);a=e,l=toOffset(r,n);var p=e.byteLength;if(void 0===i){if(p%n)throw $a("Wrong length");if((u=p-l)<0)throw $a("Wrong length")}else if((u=_a(i)*n)+l>p)throw $a("Wrong length");c=u/n}else c=ja(e),a=new Za(u=c*n);for(Ga(t,{buffer:a,byteOffset:l,byteLength:u,length:c,view:new za(a)});s<c;)addElement(t,s++)})),Ua&&Ua(f,Ja),c=f.prototype=Ma(tu)),c.constructor!==f&&Ia(c,"constructor",f),Ia(c,Xa,f),Ha&&Ia(c,Ha,o),s[o]=f,va({global:!0,forced:f!=u,sham:!Ka},s),"BYTES_PER_ELEMENT"in f||Ia(f,"BYTES_PER_ELEMENT",n),"BYTES_PER_ELEMENT"in c||Ia(c,"BYTES_PER_ELEMENT",n),setSpecies(o)}):Mn.exports=function(){},(0,Mn.exports)("Uint32",(function(t){return function Uint32Array(e,r,n){return t(this,e,r,n)}}));var iu=Math.floor,mergeSort=function(t,e){var r=t.length,n=iu(r/2);return r<8?insertionSort(t,e):merge(mergeSort(t.slice(0,n),e),mergeSort(t.slice(n),e),e)},insertionSort=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},merge=function(t,e,r){for(var n=t.length,o=e.length,i=0,a=0,u=[];i<n||a<o;)i<n&&a<o?u.push(r(t[i],e[a])<=0?t[i++]:e[a++]):u.push(i<n?t[i++]:e[a++]);return u},au=mergeSort,uu=m.match(/firefox\/(\d+)/i),fu=!!uu&&+uu[1],cu=/MSIE|Trident/.test(m),su=m.match(/AppleWebKit\/(\d+)\./),lu=!!su&&+su[1],pu=fails$9,yu=aFunction$l,du=toLength$9,hu=au,gu=fu,mu=cu,vu=A,wu=lu,Eu=jo.aTypedArray,bu=jo.exportTypedArrayMethod,Su=e.Uint16Array,Tu=Su&&Su.prototype.sort,Au=!!Tu&&!pu((function(){var t=new Su(2);t.sort(null),t.sort({})})),Ou=!!Tu&&!pu((function(){if(vu)return vu<74;if(gu)return gu<67;if(mu)return!0;if(wu)return wu<602;var t,e,r=new Su(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(r.sort((function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));function getMaxBit(t){return 32*t.length}function setBitOn(t,e){if(!function isValidBit(t,e){return!(e<0||e>getMaxBit(t))}(t,e))throw new SyntaxError(`Bit ${e} does not exist on mask.`);return t[Math.floor(e/32)]|=1<<e%32,t}function getMaskId(t){const e=getMaxBit(t);let r=0;for(let n=0,o=t.length;n<o;n++)r+=(t[n]^e)+n%32;return parseInt(Math.abs(r).toString(8),8)}function createBitmaskFromComponents(t,...e){const r=function createBitmask(t=32){return new Uint32Array(Math.ceil(t/32))}(t.spec.maxComponents||32);if(!e.length)return r;for(let n=0,o=e.length;n<o;n++){const o=e[n];if(o.world.id!==t.id)throw new Error("Components are not from the same world.");setBitOn(r,o.id)}return r}function spliceOne(t,e){const r=t.length;if(!r)return t;for(;e<r;)t[e]=t[e+1],e++;return t.length=t.length-1,t}function isObject(t){return Boolean("object"==typeof t&&!Array.isArray(t))}function systemNoop(t){}bu("sort",(function sort(t){var e=this;if(void 0!==t&&yu(t),Ou)return Tu.call(e,t);Eu(e);var r,n=du(e.length),o=Array(n);for(r=0;r<n;r++)o[r]=e[r];for(o=hu(e,function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t)),r=0;r<n;r++)e[r]=o[r];return e}),!Ou||Au);const Iu=/^(?![0-9])[a-zA-Z0-9$_]+$/;function isValidName(t){return"string"==typeof t&&((t=t.trim()).length>0&&Iu.test(t)&&!Ru.has(t))}const Ru=new Set(["entities","id","instances","name","schema","world","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","prototype","toLocaleString","toString","valueOf","__defineGetter__","__defineSetter__","__lookupGetter__","__lookupGetter__","__proto__"]);function createQuery(t){if(!t)throw new Error("Query spec object required.");const{all:e=[],any:r=[],none:n=[]}=t;if(![...e,...r,...n].every(isValidComponent))throw new Error("Spec arrays must contain only Components.");return{instances:[],all:[...e],any:[...r],none:[...n]}}function isQueryCandidate(t,e){for(let r=0,n=t.and.length;r<n;r++){const n=e.mask[r];if(0!=(t.not[r]&n))return!1;if((t.and[r]&n)!==t.and[r])return!1;if((t.or[r]&n)>0)return!1}return!0}function addArchetypeToQuery(t,e){return-1!==t.archetypes.indexOf(e)||t.archetypes.push(e),t}function removeArchetypeFromQuery(t,e){const r=t.archetypes.indexOf(e);return-1===r||spliceOne(t.archetypes,r),t}function getComponentsFromQuery(t){return t.components}function _getEntities(t){return[...t.entities]}function getEntitiesFromQuery(t){return t.archetypes.flatMap(_getEntities)}var _u;!function(t){t[t.EMPTY=-1]="EMPTY",t[t.DESTROYED=-2]="DESTROYED"}(_u||(_u={}));const ju=128,xu=1e4,Du=Symbol(),Pu=Symbol();function updateEntityArchetype(t,e,r,n=!1){const{archetypes:o,entities:i}=t;let a=[];const u=i[e];if(void 0===u||u<-1)throw new Error("Entity is not available!");if(u>-1){const r=o.get(u);r&&(a=[...r.components],r.entities.delete(e),0===r.entities.size&&function deleteArchetype(t,e){const{archetypes:r,queries:n}=t,{id:o}=e;if(r.get(o)!==e)throw new Error("Archetype not found in world.");const i=[...n.values()];for(let t=0,r=i.length;t<r;t++)removeArchetypeFromQuery(i[t],e);return r.delete(o),e}(t,r))}if(r)if(!1===n)a.push(r);else{const t=a.indexOf(r);t>-1&&spliceOne(a,t)}if(0===a.length)return i[e]=_u.EMPTY,null;const f=function createArchetype(t,...e){const r=createBitmaskFromComponents(t,...e);return{components:new Set(e),entities:new Set,mask:r,id:getMaskId(r)}}(t,...a),{id:c}=f,s=o.get(c);if(void 0===s){const r=[...t.queries.values()];for(let t=0,e=r.length;t<e;t++){const e=r[t];isQueryCandidate(e,f)&&addArchetypeToQuery(e,f)}return i[e]=c,f.entities.add(e),o.set(c,f),f}return i[e]=s.id,s.entities.add(e),s}function isValidSchema(t){if(!t)return!1;if(!isObject(t))return!1;if(Object.hasOwnProperty.call(t,"schema")&&!isObject(t=t.schema))return!1;const e=Object.values(t);return 0!==e.length&&e.every((t=>!0===t[Pu]))}function resetDataInStore(t,e){const{initial:r,isTypedArray:n,prefill:o}=t;if(e<0||e>t.length)throw new SyntaxError("Entity is out of range.");try{delete t[e]}catch(r){if(!n)throw new Error(r);t[e]=0}return!0===o&&(t[e]=r()),t}function getDataFromStore(t,e){return t[e]}function setDataInStore(t,e,r){if(e<0||e>t.length)throw new SyntaxError("Entity is out of range.");if(!t.guard(r))throw new TypeError("Value is not correct type.");return t[e]=r,t}function defineDataStore(t){const{name:e,initial:r,guard:n,arrayType:o=Array,prefill:i=!1}=t;if(!e||!n)throw new SyntaxError("Invalid datastore spec - mandatory properties missing.");if(!isValidName(e))throw new Error("Invalid name.");const a=r();if(!n(a))throw new TypeError("Initial property is of invalid type. Make sure guard(initial()) returns true.");const u=new o,f=function isTypedArray(t){return Boolean(ArrayBuffer.isView(t)&&!(t instanceof DataView))}(u);if(f&&("number"!=typeof a||isNaN(a)))throw new TypeError(`Initial property for typed array type must be a number. Found ${typeof a}.`);return Object.create(Object.getPrototypeOf(u),{getProp:{value:function(t){return this[t]},enumerable:!0},setProp:{value:function(t,e){if(t<0||t>this.length)throw new SyntaxError("Entity is out of range.");if(!this.guard(e))throw new TypeError("Property is not correct type.");return this[t]=e,this},enumerable:!0},arrayType:{value:o,enumerable:!0},guard:{value:n,enumerable:!0},initial:{value:r,enumerable:!0},isTypedArray:{value:f,enumerable:!0},name:{value:e,enumerable:!0},prefill:{value:i,enumerable:!0},[Pu]:{value:!0,enumerable:!0}})}function createDataStorage(t,e){const{arrayType:r,initial:n,prefill:o}=e,i=new r(t.spec.maxEntities);return Object.setPrototypeOf(i,e),!0===o&&i.fill(n()),i.world=t,i}function isValidComponent(t){return isObject(t)&&Object.prototype.hasOwnProperty.call(t,Du)}function createComponent(t){if(!t)throw new SyntaxError("Component creation requires a specification object.");const{name:e,schema:r}=t;if(!isValidName(e))throw new SyntaxError("Component name is invalid.");if(!isValidSchema(r))throw new SyntaxError("Component schema is invalid.");return{[Du]:!0,instances:[],name:e,schema:r}}function registerComponent(t,e){if(!t)throw new SyntaxError("Component registration requires a World object.");if(!e)throw new SyntaxError("Component registration requires a Component object.");const{instances:r,name:n,schema:o}=e,{components:i}=t;if(n in i)throw new Error(`Component with name "${n}" is already registered.`);const a=function indexOf(t,e){for(let r=0,n=t.length;r!=n;r++)if(t[r]===e)return r;return-1}(i,void 0);if(-1===a)throw new Error("Maximum components reached.");const u=Object.create(e,{entities:{value:new Set,enumerable:!0},id:{value:a,configurable:!1,enumerable:!0,writeable:!1},world:{value:t,configurable:!1,enumerable:!0,writeable:!1}}),f=Object.entries(o);for(let e=0,r=f.length;e<r;e++){const[r,n]=f[e];if(!isValidName(r))throw new SyntaxError(`Property name "${String(r)}" is invalid or forbidden.`);Object.defineProperty(u,r,{value:createDataStorage(t,n),configurable:!1,enumerable:!0,writable:!1})}return r.push(u),i[a]=u,u}function unregisterComponent(t){if(!t)throw new SyntaxError("Component instance required.");const{id:e,name:r,world:n}=t,{components:o}=n,i=o[e];if(!i||t!==i)throw new Error(`Component "${r}" does not exist in this world.`);const a=[...i.entities];for(let t=0,e=a.length;t<e;t++)removeComponentFromEntity(i,a[t]);return delete o[e],n}function addComponentToEntity(t,e,r){if(!t)throw new SyntaxError("Component instance required.");if(isNaN(e))throw new SyntaxError("Invalid or undefined entity provided.");const{id:n,name:o,schema:i,world:a}=t,{spec:u,components:f}=a;if(e<0||e>u.maxEntities)throw new Error(`Invalid entity provided: "${e}".`);const c=f[n];if(!c||t!==c)throw new Error(`Component "${o}" does not exist in this world.`);if(c.entities.has(e))throw new Error(`Entity "${e}" already has component "${o}".`);if(r){const t=Object.keys(i);for(let n=0,o=t.length;n<o;n++){const o=t[n];setDataInStore(c[o],e,r[o])}}return c.entities.add(e),updateEntityArchetype(a,e,c,!1),t}function removeComponentFromEntity(t,e){if(!t)throw new SyntaxError("Component instance required.");if(isNaN(e))throw new SyntaxError("Invalid or undefined entity provided.");const{id:r,name:n,schema:o,world:i}=t,{spec:a,components:u}=i;if(e<0||e>a.maxEntities)throw new Error(`Invalid entity provided: "${e}".`);const f=u[r];if(void 0===f||t!==f)throw new Error(`Component "${n}" does not exist in this world.`);if(!f.entities.has(e))throw new Error(`Entity "${e}" does not have component "${n}" to remove.`);const c=Object.keys(o);for(let t=0,r=c.length;t<r;t++){resetDataInStore(f[c[t]],e)}return f.entities.delete(e),updateEntityArchetype(i,e,t,!0),t}function createEntityArray(t){if(isNaN(t))throw new TypeError("Array length must be a number.");const e=new Int16Array(t).fill(_u.DESTROYED),r=t-1,n=Array.from({length:t},((t,e)=>r-e));return Object.assign(e,{available:n})}function createEntity(t){if(!t)throw new SyntaxError("Entity creation requires a World object.");const e=t.entities.available.pop();if(void 0!==e)return t.entities[e]=_u.EMPTY,updateEntityArchetype(t,e),e}function destroyEntity(t,e){if(!t)throw new SyntaxError("Entity destruction requires a World object.");if(isNaN(e))throw new SyntaxError("Invalid or undefined entity provided.");const{components:r,entities:n,spec:o}=t,{available:i}=n,{maxEntities:a}=o;if(e<0||e>a)throw new Error("Entity is out of range.");if(i.includes(e))return!1;for(let t=0,n=r.length;t<n;t++){const n=r[t];n&&(n.entities.has(e)&&removeComponentFromEntity(n,e))}return updateEntityArchetype(t,e),i.push(e),n[e]=_u.DESTROYED,!0}function runPreSystems(t){const{systems:e}=t;for(let t=0,r=e.length;t<r;t++){const r=e[t];r.enabled&&r.pre(getEntitiesFromQuery(r.query))}}function runPostSystems(t,e=1){const{systems:r}=t;for(let t=0,n=r.length;t<n;t++){const n=r[t];n.enabled&&n.post(getEntitiesFromQuery(n.query),getComponentsFromQuery(n.query),e)}}function runUpdateSystems(t,e=0){const{systems:r}=t;for(let t=0,n=r.length;t<n;t++){const n=r[t];n.enabled&&n.update(getEntitiesFromQuery(n.query),getComponentsFromQuery(n.query),e)}}function createSystem(t){const{name:e,pre:r=systemNoop,post:n=systemNoop,update:o=systemNoop}=t;if(!isValidName(e))throw new SyntaxError("System name is invalid.");return{instances:[],name:e,post:n,pre:r,update:o}}function registerSystem(t,e,r){const{systems:n}=t,o=function createQueryInstance(t,e){const{queries:r}=t;if(r.has(e))return r.get(e);const _sameWorld=e=>e.world===t,_getInstance=t=>t.instances.filter(_sameWorld),n=e.all.flatMap(_getInstance),o=e.any.flatMap(_getInstance),i=e.none.flatMap(_getInstance),a=createBitmaskFromComponents(t,...n),u=createBitmaskFromComponents(t,...o),f=createBitmaskFromComponents(t,...i),c={archetypes:[],components:Object.freeze([...n,...o].reduce(((t,e)=>(t[e.name]=e,t)),{})),and:a,or:u,not:f,world:t};r.set(e,c);const s=[...t.archetypes.values()];for(let t=0,e=s.length;t<e;t++){const e=s[t];isQueryCandidate(c,e)&&addArchetypeToQuery(c,e)}return c}(t,r);let i=!1;const a=Object.create(e,{enabled:{get:()=>i,set(t){i=t},configurable:!1,enumerable:!0},query:{value:o,configurable:!1,enumerable:!0,writeable:!1},world:{value:t,configurable:!1,enumerable:!0,writeable:!1}});return e.instances.push(a),n.push(a),a}function unregisterSystem(t){const{world:e}=t,{systems:r}=e,n=r.indexOf(t);return void 0===n||spliceOne(r,n),e}function enableSystem(t){return t.enabled=!0,t}function disableSystem(t){return t.enabled=!1,t}function isSystemEnabled(t){return t.enabled}function numberGuard(t){return"number"==typeof t&&!isNaN(t)}function initToZero(){return 0}(0,Mn.exports)("Int16",(function(t){return function Int16Array(e,r,n){return t(this,e,r,n)}})),(0,Mn.exports)("Int8",(function(t){return function Int8Array(e,r,n){return t(this,e,r,n)}})),(0,Mn.exports)("Uint8",(function(t){return function Uint8Array(e,r,n){return t(this,e,r,n)}})),(0,Mn.exports)("Uint8",(function(t){return function Uint8ClampedArray(e,r,n){return t(this,e,r,n)}}),!0),(0,Mn.exports)("Uint16",(function(t){return function Uint16Array(e,r,n){return t(this,e,r,n)}})),(0,Mn.exports)("Int32",(function(t){return function Int32Array(e,r,n){return t(this,e,r,n)}})),(0,Mn.exports)("Float32",(function(t){return function Float32Array(e,r,n){return t(this,e,r,n)}}));const Nu=defineDataStore({guard:t=>!0,initial:()=>{},name:"any"}),Cu=defineDataStore({arrayType:Int8Array,guard:numberGuard,initial:initToZero,name:"i8"}),Mu=defineDataStore({arrayType:Uint8Array,guard:numberGuard,initial:initToZero,name:"ui8"}),Uu=defineDataStore({arrayType:Uint8ClampedArray,guard:numberGuard,initial:initToZero,name:"ui8c"}),Fu=defineDataStore({arrayType:Int16Array,guard:numberGuard,initial:initToZero,name:"i16"}),Bu=defineDataStore({arrayType:Uint16Array,guard:numberGuard,initial:initToZero,name:"ui16"}),Vu=defineDataStore({arrayType:Int32Array,guard:numberGuard,initial:initToZero,name:"i32"}),ku=defineDataStore({arrayType:Uint32Array,guard:numberGuard,initial:initToZero,name:"ui32"}),Yu=defineDataStore({arrayType:BigInt64Array,guard:numberGuard,initial:initToZero,name:"i64"}),Lu=defineDataStore({arrayType:BigUint64Array,guard:numberGuard,initial:initToZero,name:"ui64"}),Gu=defineDataStore({arrayType:Float32Array,guard:numberGuard,initial:initToZero,name:"f32"}),Wu=defineDataStore({arrayType:Int32Array,guard:numberGuard,initial:initToZero,name:"f64"}),qu=defineDataStore({guard:t=>Array.isArray(t),initial:()=>[],name:"array"}),Qu=defineDataStore({guard:t=>"boolean"==typeof t,initial:()=>!1,name:"boolean"}),$u=defineDataStore({guard:t=>"function"==typeof t,initial:()=>()=>{},name:"function"}),Zu=defineDataStore({guard:numberGuard,initial:initToZero,name:"number"}),zu=defineDataStore({guard:t=>isObject(t),initial:()=>({}),name:"object"}),Ku=defineDataStore({guard:t=>"string"==typeof t,initial:()=>"",name:"string"});var Xu=collectionDeleteAll$2;_export({target:"Map",proto:!0,real:!0,forced:false},{deleteAll:function deleteAll(){return Xu.apply(this,arguments)}});var getMapIterator$a=function(t){return Map.prototype.entries.call(t)},Hu=anObject$B,Ju=functionBindContext,tf=getMapIterator$a,ef=iterate$p;_export({target:"Map",proto:!0,real:!0,forced:false},{every:function every(t){var e=Hu(this),r=tf(e),n=Ju(t,arguments.length>1?arguments[1]:void 0,3);return!ef(r,(function(t,r,o){if(!n(r,t,e))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var rf=getBuiltIn$f,nf=anObject$B,of=aFunction$l,af=functionBindContext,uf=speciesConstructor$9,ff=getMapIterator$a,cf=iterate$p;_export({target:"Map",proto:!0,real:!0,forced:false},{filter:function filter(t){var e=nf(this),r=ff(e),n=af(t,arguments.length>1?arguments[1]:void 0,3),o=new(uf(e,rf("Map"))),i=of(o.set);return cf(r,(function(t,r){n(r,t,e)&&i.call(o,t,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var sf=anObject$B,lf=functionBindContext,pf=getMapIterator$a,yf=iterate$p;_export({target:"Map",proto:!0,real:!0,forced:false},{find:function find(t){var e=sf(this),r=pf(e),n=lf(t,arguments.length>1?arguments[1]:void 0,3);return yf(r,(function(t,r,o){if(n(r,t,e))return o(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var df=anObject$B,hf=functionBindContext,gf=getMapIterator$a,mf=iterate$p;_export({target:"Map",proto:!0,real:!0,forced:false},{findKey:function findKey(t){var e=df(this),r=gf(e),n=hf(t,arguments.length>1?arguments[1]:void 0,3);return mf(r,(function(t,r,o){if(n(r,t,e))return o(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var vf=anObject$B,wf=getMapIterator$a,sameValueZero=function(t,e){return t===e||t!=t&&e!=e},Ef=iterate$p;_export({target:"Map",proto:!0,real:!0,forced:false},{includes:function includes(t){return Ef(wf(vf(this)),(function(e,r,n){if(sameValueZero(r,t))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var bf=anObject$B,Sf=getMapIterator$a,Tf=iterate$p;_export({target:"Map",proto:!0,real:!0,forced:false},{keyOf:function keyOf(t){return Tf(Sf(bf(this)),(function(e,r,n){if(r===t)return n(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Af=getBuiltIn$f,Of=anObject$B,If=aFunction$l,Rf=functionBindContext,_f=speciesConstructor$9,jf=getMapIterator$a,xf=iterate$p;_export({target:"Map",proto:!0,real:!0,forced:false},{mapKeys:function mapKeys(t){var e=Of(this),r=jf(e),n=Rf(t,arguments.length>1?arguments[1]:void 0,3),o=new(_f(e,Af("Map"))),i=If(o.set);return xf(r,(function(t,r){i.call(o,n(r,t,e),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var Df=getBuiltIn$f,Pf=anObject$B,Nf=aFunction$l,Cf=functionBindContext,Mf=speciesConstructor$9,Uf=getMapIterator$a,Ff=iterate$p;_export({target:"Map",proto:!0,real:!0,forced:false},{mapValues:function mapValues(t){var e=Pf(this),r=Uf(e),n=Cf(t,arguments.length>1?arguments[1]:void 0,3),o=new(Mf(e,Df("Map"))),i=Nf(o.set);return Ff(r,(function(t,r){i.call(o,t,n(r,t,e))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var Bf=anObject$B,Vf=aFunction$l,kf=iterate$p;_export({target:"Map",proto:!0,real:!0,forced:false},{merge:function merge(t){for(var e=Bf(this),r=Vf(e.set),n=arguments.length,o=0;o<n;)kf(arguments[o++],r,{that:e,AS_ENTRIES:!0});return e}});var Yf=anObject$B,Lf=aFunction$l,Gf=getMapIterator$a,Wf=iterate$p;_export({target:"Map",proto:!0,real:!0,forced:false},{reduce:function reduce(t){var e=Yf(this),r=Gf(e),n=arguments.length<2,o=n?void 0:arguments[1];if(Lf(t),Wf(r,(function(r,i){n?(n=!1,o=i):o=t(o,i,r,e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty map with no initial value");return o}});var qf=anObject$B,Qf=functionBindContext,$f=getMapIterator$a,Zf=iterate$p;_export({target:"Map",proto:!0,real:!0,forced:false},{some:function some(t){var e=qf(this),r=$f(e),n=Qf(t,arguments.length>1?arguments[1]:void 0,3);return Zf(r,(function(t,r,o){if(n(r,t,e))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var zf=anObject$B,Kf=aFunction$l;_export({target:"Map",proto:!0,real:!0,forced:false},{update:function update(t,e){var r=zf(this),n=arguments.length;Kf(e);var o=r.has(t);if(!o&&n<3)throw TypeError("Updating absent value");var i=o?r.get(t):Kf(n>2?arguments[2]:void 0)(t,r);return r.set(t,e(i,t,r)),r}});const Xf={maxComponents:ju,maxEntities:xu};function createWorld(t=Xf){const{maxComponents:e=ju,maxEntities:r=xu}=t;return{archetypes:new Map,components:new Array(e),entities:createEntityArray(r),id:`${Date.now().toString(36)}_${Math.random().toString(36).substr(2,9)}`,queries:new Map,spec:Object.freeze({maxComponents:e,maxEntities:r}),systems:[]}}export{addComponentToEntity,Nu as any,qu as array,Qu as boolean,createComponent,createEntity,createQuery,createSystem,createWorld,defineDataStore,destroyEntity,disableSystem,enableSystem,Gu as f32,Wu as f64,$u as fnc,getDataFromStore,Fu as i16,Vu as i32,Yu as i64,Cu as i8,initToZero,isSystemEnabled,isValidComponent,isValidName,isValidSchema,Zu as number,numberGuard,zu as object,registerComponent,registerSystem,removeComponentFromEntity,runPostSystems,runPreSystems,runUpdateSystems,setDataInStore,Ku as string,Bu as ui16,ku as ui32,Lu as ui64,Mu as ui8,Uu as ui8c,unregisterComponent,unregisterSystem};
//# sourceMappingURL=index.min.js.map
