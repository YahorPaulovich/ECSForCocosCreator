/*! *****************************************************************************
 *
 * miski
 * v0.2.0
 *
 * MIT License
 * 
 * Copyright (C) 2021 Peter Hughes<https://www.phugh.es>, all rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
***************************************************************************** */
var miski=function(e){"use strict";function createMask(e=0n){"number"==typeof e&&(e=BigInt(e));let t=1n<<e;const off=e=>("number"==typeof e&&(e=BigInt(e)),t&=~(1n<<e),t),on=e=>("number"==typeof e&&(e=BigInt(e)),t|=1n<<e,t);return Object.freeze({clear:()=>{t=1n<<0n},has:function(e){return"number"==typeof e&&(e=BigInt(e)),(t&e)===t},on:on,off:off,set:(e,t)=>!0===t?on(e):off(e),isOn:e=>("number"==typeof e&&(e=BigInt(e)),0n!==(t&1n<<e)),toggle:e=>("number"==typeof e&&(e=BigInt(e)),t^=1n<<e,t),toArray:()=>t.toString(2).split("").map((e=>parseInt(e,10))),toString:()=>t.toString(2),toNumber:()=>Number(t),value:()=>t})}function deepAssign(e,...t){const n=t.length;if(!t||!n)return e;const r={};for(let e=0;e<n;e++){const n=t[e],o=Object.keys(n),i=o.length;for(let e=0;e<i;e++){const t=o[e],i=Object.getOwnPropertyDescriptor(n,t);i&&i.enumerable&&(r[t]=i)}const a=Object.getOwnPropertySymbols(n);for(let e=0;e<a.length;e++){const t=a[e],o=Object.getOwnPropertyDescriptor(n,t);o&&o.enumerable&&(r[t]=o)}}return Object.defineProperties(e,r),e}function createComponentManager(e){const{maxComponents:t}={...e},n={},r=[];let o=0,i=0;for(let e=t;e>=0;e--)r[e]=i++;return Object.freeze({registerComponent:e=>{if(o>=t)throw new Error("maximum components reached!");if(e.name in n)throw new Error(`component with name "${e.name}" already registered!`);const i=r.pop();if(void 0===i)throw new Error("no available ids!");const a=function createComponent(e){const{entityLimit:t=null,id:n,name:r,properties:o,removable:i=!0}={...e};if(!r||!o||"object"!=typeof o||null==n)throw new Error("malformed component.");return deepAssign(o,e.properties),Object.seal(o),Object.freeze(Object.create(null,{entityLimit:{value:t,enumerable:!0},id:{value:n,enumerable:!0},name:{value:r,enumerable:!0},properties:{value:o,enumerable:!0},removable:{value:i,enumerable:!0}}))}({...e,id:i});return n[a.name]=a,o++,a},unregisterComponent:e=>{if(!(e.name in n))throw new Error(`component "${e.name}" is not registered.`);delete n[e.name],r.unshift(e.id);const t=Object.create(e);return delete t.id,o--,t},isComponentRegistered:e=>e.name in n,getComponentByName:e=>n[e],getComponentById:e=>("number"==typeof e&&(e=BigInt(e)),Object.values(n).find((t=>t.id===e))),getComponents:()=>Object.values(n)})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e){var t={exports:{}};return e(t,t.exports),t.exports}var check=function(e){return e&&e.Math==Math&&e},n=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof t&&t)||function(){return this}()||Function("return this")(),fails=function(e){try{return!!e()}catch(e){return!0}},r=!fails((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),o={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,a={f:i&&!o.call({1:2},1)?function propertyIsEnumerable(e){var t=i(this,e);return!!t&&t.enumerable}:o},createPropertyDescriptor=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},u={}.toString,classofRaw=function(e){return u.call(e).slice(8,-1)},c="".split,l=fails((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==classofRaw(e)?c.call(e,""):Object(e)}:Object,requireObjectCoercible=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},toIndexedObject=function(e){return l(requireObjectCoercible(e))},isObject=function(e){return"object"==typeof e?null!==e:"function"==typeof e},toPrimitive=function(e,t){if(!isObject(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!isObject(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!isObject(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!isObject(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},f={}.hasOwnProperty,has=function(e,t){return f.call(e,t)},s=n.document,p=isObject(s)&&isObject(s.createElement),d=!r&&!fails((function(){return 7!=Object.defineProperty((e="div",p?s.createElement(e):{}),"a",{get:function(){return 7}}).a;var e})),g=Object.getOwnPropertyDescriptor,m={f:r?g:function getOwnPropertyDescriptor(e,t){if(e=toIndexedObject(e),t=toPrimitive(t,!0),d)try{return g(e,t)}catch(e){}if(has(e,t))return createPropertyDescriptor(!a.f.call(e,t),e[t])}},anObject=function(e){if(!isObject(e))throw TypeError(String(e)+" is not an object");return e},y=Object.defineProperty,h={f:r?y:function defineProperty(e,t,n){if(anObject(e),t=toPrimitive(t,!0),anObject(n),d)try{return y(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},v=r?function(e,t,n){return h.f(e,t,createPropertyDescriptor(1,n))}:function(e,t,n){return e[t]=n,e},setGlobal=function(e,t){try{v(n,e,t)}catch(r){n[e]=t}return t},S="__core-js_shared__",E=n[S]||setGlobal(S,{}),b=Function.toString;"function"!=typeof E.inspectSource&&(E.inspectSource=function(e){return b.call(e)});var T,w,R,I,O=E.inspectSource,A=n.WeakMap,j="function"==typeof A&&/native code/.test(O(A)),C=!1,M=createCommonjsModule((function(e){(e.exports=function(e,t){return E[e]||(E[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.8.3",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})})),P=0,N=Math.random(),uid=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++P+N).toString(36)},_=M("keys"),x={},B=n.WeakMap;if(j){var D=E.state||(E.state=new B),U=D.get,k=D.has,z=D.set;T=function(e,t){return t.facade=e,z.call(D,e,t),t},w=function(e){return U.call(D,e)||{}},R=function(e){return k.call(D,e)}}else{var $=_[I="state"]||(_[I]=uid(I));x[$]=!0,T=function(e,t){return t.facade=e,v(e,$,t),t},w=function(e){return has(e,$)?e[$]:{}},R=function(e){return has(e,$)}}var F={set:T,get:w,has:R,enforce:function(e){return R(e)?w(e):T(e,{})},getterFor:function(e){return function(t){var n;if(!isObject(t)||(n=w(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},L=createCommonjsModule((function(e){var t=F.get,r=F.enforce,o=String(String).split("String");(e.exports=function(e,t,i,a){var u,c=!!a&&!!a.unsafe,l=!!a&&!!a.enumerable,f=!!a&&!!a.noTargetGet;"function"==typeof i&&("string"!=typeof t||has(i,"name")||v(i,"name",t),(u=r(i)).source||(u.source=o.join("string"==typeof t?t:""))),e!==n?(c?!f&&e[t]&&(l=!0):delete e[t],l?e[t]=i:v(e,t,i)):l?e[t]=i:setGlobal(t,i)})(Function.prototype,"toString",(function toString(){return"function"==typeof this&&t(this).source||O(this)}))})),K=n,aFunction=function(e){return"function"==typeof e?e:void 0},getBuiltIn=function(e,t){return arguments.length<2?aFunction(K[e])||aFunction(n[e]):K[e]&&K[e][t]||n[e]&&n[e][t]},W=Math.ceil,V=Math.floor,toInteger=function(e){return isNaN(e=+e)?0:(e>0?V:W)(e)},G=Math.min,toLength=function(e){return e>0?G(toInteger(e),9007199254740991):0},q=Math.max,Y=Math.min,createMethod=function(e){return function(t,n,r){var o,i=toIndexedObject(t),a=toLength(i.length),u=function(e,t){var n=toInteger(e);return n<0?q(n+t,0):Y(n,t)}(r,a);if(e&&n!=n){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((e||u in i)&&i[u]===n)return e||u||0;return!e&&-1}},H={includes:createMethod(!0),indexOf:createMethod(!1)}.indexOf,J=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype"),Q={f:Object.getOwnPropertyNames||function getOwnPropertyNames(e){return function(e,t){var n,r=toIndexedObject(e),o=0,i=[];for(n in r)!has(x,n)&&has(r,n)&&i.push(n);for(;t.length>o;)has(r,n=t[o++])&&(~H(i,n)||i.push(n));return i}(e,J)}},X={f:Object.getOwnPropertySymbols},Z=getBuiltIn("Reflect","ownKeys")||function ownKeys(e){var t=Q.f(anObject(e)),n=X.f;return n?t.concat(n(e)):t},copyConstructorProperties=function(e,t){for(var n=Z(t),r=h.f,o=m.f,i=0;i<n.length;i++){var a=n[i];has(e,a)||r(e,a,o(t,a))}},ee=/#|\.prototype\./,isForced=function(e,t){var n=ne[te(e)];return n==oe||n!=re&&("function"==typeof t?fails(t):!!t)},te=isForced.normalize=function(e){return String(e).replace(ee,".").toLowerCase()},ne=isForced.data={},re=isForced.NATIVE="N",oe=isForced.POLYFILL="P",ie=isForced,ae=m.f,_export=function(e,t){var r,o,i,a,u,c=e.target,l=e.global,f=e.stat;if(r=l?n:f?n[c]||setGlobal(c,{}):(n[c]||{}).prototype)for(o in t){if(a=t[o],i=e.noTargetGet?(u=ae(r,o))&&u.value:r[o],!ie(l?o:c+(f?".":"#")+o,e.forced)&&void 0!==i){if(typeof a==typeof i)continue;copyConstructorProperties(a,i)}(e.sham||i&&i.sham)&&v(a,"sham",!0),L(r,o,a,e)}},aFunction$1=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},collectionDeleteAll=function(){for(var e,t=anObject(this),n=aFunction$1(t.delete),r=!0,o=0,i=arguments.length;o<i;o++)e=n.call(t,arguments[o]),r=r&&e;return!!r};_export({target:"Map",proto:!0,real:!0,forced:C},{deleteAll:function deleteAll(){return collectionDeleteAll.apply(this,arguments)}});var functionBindContext=function(e,t,n){if(aFunction$1(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}},ue=!!Object.getOwnPropertySymbols&&!fails((function(){return!String(Symbol())})),ce=ue&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,le=M("wks"),fe=n.Symbol,se=ce?fe:fe&&fe.withoutSetter||uid,wellKnownSymbol=function(e){return has(le,e)||(ue&&has(fe,e)?le[e]=fe[e]:le[e]=se("Symbol."+e)),le[e]},pe={};pe[wellKnownSymbol("toStringTag")]="z";var de="[object z]"===String(pe),ge=wellKnownSymbol("toStringTag"),me="Arguments"==classofRaw(function(){return arguments}()),ye=de?classofRaw:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),ge))?n:me?classofRaw(t):"Object"==(r=classofRaw(t))&&"function"==typeof t.callee?"Arguments":r},he={},ve=wellKnownSymbol("iterator"),getIteratorMethod=function(e){if(null!=e)return e[ve]||e["@@iterator"]||he[ye(e)]},getMapIterator=function(e){return Map.prototype.entries.call(e)},Se=wellKnownSymbol("iterator"),Ee=Array.prototype,iteratorClose=function(e){var t=e.return;if(void 0!==t)return anObject(t.call(e)).value},Result=function(e,t){this.stopped=e,this.result=t},iterate=function(e,t,n){var r,o,i,a,u,c,l,f,s=n&&n.that,p=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),g=!(!n||!n.INTERRUPTED),m=functionBindContext(t,s,1+p+g),stop=function(e){return r&&iteratorClose(r),new Result(!0,e)},callFn=function(e){return p?(anObject(e),g?m(e[0],e[1],stop):m(e[0],e[1])):g?m(e,stop):m(e)};if(d)r=e;else{if("function"!=typeof(o=getIteratorMethod(e)))throw TypeError("Target is not iterable");if(void 0!==(f=o)&&(he.Array===f||Ee[Se]===f)){for(i=0,a=toLength(e.length);a>i;i++)if((u=callFn(e[i]))&&u instanceof Result)return u;return new Result(!1)}r=o.call(e)}for(c=r.next;!(l=c.call(r)).done;){try{u=callFn(l.value)}catch(e){throw iteratorClose(r),e}if("object"==typeof u&&u&&u instanceof Result)return u}return new Result(!1)};_export({target:"Map",proto:!0,real:!0,forced:C},{every:function every(e){var t=anObject(this),n=getMapIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3);return!iterate(n,(function(e,n,o){if(!r(n,e,t))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var be=wellKnownSymbol("species"),speciesConstructor=function(e,t){var n,r=anObject(e).constructor;return void 0===r||null==(n=anObject(r)[be])?t:aFunction$1(n)};_export({target:"Map",proto:!0,real:!0,forced:C},{filter:function filter(e){var t=anObject(this),n=getMapIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3),o=new(speciesConstructor(t,getBuiltIn("Map"))),i=aFunction$1(o.set);return iterate(n,(function(e,n){r(n,e,t)&&i.call(o,e,n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}}),_export({target:"Map",proto:!0,real:!0,forced:C},{find:function find(e){var t=anObject(this),n=getMapIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3);return iterate(n,(function(e,n,o){if(r(n,e,t))return o(n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:C},{findKey:function findKey(e){var t=anObject(this),n=getMapIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3);return iterate(n,(function(e,n,o){if(r(n,e,t))return o(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});_export({target:"Map",proto:!0,real:!0,forced:C},{includes:function includes(e){return iterate(getMapIterator(anObject(this)),(function(t,n,r){if((o=n)===(i=e)||o!=o&&i!=i)return r();var o,i}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",proto:!0,real:!0,forced:C},{keyOf:function keyOf(e){return iterate(getMapIterator(anObject(this)),(function(t,n,r){if(n===e)return r(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:C},{mapKeys:function mapKeys(e){var t=anObject(this),n=getMapIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3),o=new(speciesConstructor(t,getBuiltIn("Map"))),i=aFunction$1(o.set);return iterate(n,(function(e,n){i.call(o,r(n,e,t),n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}}),_export({target:"Map",proto:!0,real:!0,forced:C},{mapValues:function mapValues(e){var t=anObject(this),n=getMapIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3),o=new(speciesConstructor(t,getBuiltIn("Map"))),i=aFunction$1(o.set);return iterate(n,(function(e,n){i.call(o,e,r(n,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}}),_export({target:"Map",proto:!0,real:!0,forced:C},{merge:function merge(e){for(var t=anObject(this),n=aFunction$1(t.set),r=0;r<arguments.length;)iterate(arguments[r++],n,{that:t,AS_ENTRIES:!0});return t}}),_export({target:"Map",proto:!0,real:!0,forced:C},{reduce:function reduce(e){var t=anObject(this),n=getMapIterator(t),r=arguments.length<2,o=r?void 0:arguments[1];if(aFunction$1(e),iterate(n,(function(n,i){r?(r=!1,o=i):o=e(o,i,n,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),r)throw TypeError("Reduce of empty map with no initial value");return o}}),_export({target:"Map",proto:!0,real:!0,forced:C},{some:function some(e){var t=anObject(this),n=getMapIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3);return iterate(n,(function(e,n,o){if(r(n,e,t))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",proto:!0,real:!0,forced:C},{update:function update(e,t){var n=anObject(this),r=arguments.length;aFunction$1(t);var o=n.has(e);if(!o&&r<3)throw TypeError("Updating absent value");var i=o?n.get(e):aFunction$1(r>2?arguments[2]:void 0)(e,n);return n.set(e,t(i,e,n)),n}});var collectionAddAll=function(){for(var e=anObject(this),t=aFunction$1(e.add),n=0,r=arguments.length;n<r;n++)t.call(e,arguments[n]);return e};_export({target:"Set",proto:!0,real:!0,forced:C},{addAll:function addAll(){return collectionAddAll.apply(this,arguments)}}),_export({target:"Set",proto:!0,real:!0,forced:C},{deleteAll:function deleteAll(){return collectionDeleteAll.apply(this,arguments)}}),_export({target:"Set",proto:!0,real:!0,forced:C},{difference:function difference(e){var t=anObject(this),n=new(speciesConstructor(t,getBuiltIn("Set")))(t),r=aFunction$1(n.delete);return iterate(e,(function(e){r.call(n,e)})),n}});var getSetIterator=function(e){return Set.prototype.values.call(e)};function createEntity(){const e=createMask(),t=Date.now().toString(36)+"_"+Math.random().toString(36).substr(2,9),n={};let r=!0,o=null;const i=Object.create({},{_:{value:n,enumerable:!0},addComponent:{value:r=>{if(r.name in n)return console.warn(`Entity "${t}" already has component "${r.name}".`),!1;try{n[r.name]=deepAssign({},r.properties),e.on(r.id)}catch(e){return console.warn(`Error adding component "${r.name}" to entity "${t}".`,e),!1}return!0}},getArchetype:{value:()=>e.value()},hasComponent:{value:e=>{var t;return null!==(t="string"==typeof e?e in n:e.name in n)&&void 0!==t&&t}},isAwake:{value:()=>r},id:{value:t,enumerable:!0},next:{value:e=>(void 0!==e&&(o=e),o)},purge:{value:()=>{!function clearObject(e){return Object.keys(e).forEach((t=>delete e[t])),e}(n),e.clear()}},removeComponent:{value:t=>t.name in n&&(delete n[t.name],e.off(t.id),!0)},sleep:{value:()=>r=!1},wake:{value:()=>r=!0}});return Object.freeze(i)}function createPool(e){const{initialPoolSize:t,maxEntities:n}={...e},r=[];let o;const _create=(e=1)=>{for(let t=e;t>=0;t--){if(r.length>=n)throw new Error("The entity pool is full.");const e=createEntity();e.next(o),o=e,r.push(e)}},flush=()=>{r.length=0,o=null,_create(t)};return flush(),Object.freeze({flush:flush,get:()=>{o||_create(.25*t);const e=o;return o=e.next(),e},release:e=>{e.purge(),e.next(o),o=e}})}function createEntityManager(e){const{initialPoolSize:t,maxEntities:n}={...e},r=createPool({initialPoolSize:t,maxEntities:n}),o={},i=new Map;let a=!0;const getEntities=()=>Object.values(o),getEntitiesByMask=(e,t=!1)=>{var n;if(t)return Array.from(null!==(n=i.get(e))&&void 0!==n?n:[]);{const t=new Set;return i.forEach(((n,r)=>{(r&e)===e&&n.forEach((e=>t.add(e)))})),[...t]}},updateArchetype=(e,t)=>{var n;null!=t&&(null===(n=i.get(t))||void 0===n||n.delete(e));const r=e.getArchetype();var o;i.has(r)?null===(o=i.get(r))||void 0===o||o.add(e):(i.set(r,new Set([e])),a=!0);return e};return Object.freeze({createEntity:()=>{const e=r.get();if(!e)throw new Error("no entities left!");return o[e.id]=e,updateArchetype(e),e},destroyEntity:e=>{const t=e.id in o;if(!0===t){var n,u;delete o[e.id];const t=e.getArchetype();null===(n=i.get(t))||void 0===n||n.delete(e),0===(null===(u=i.get(t))||void 0===u?void 0:u.size)&&(i.delete(t),a=!0),r.release(e)}return t},getEntityById:e=>o[e],getEntities:getEntities,getEntitiesByComponents:(...e)=>{const t=function componentsToArchetype(...e){const t=createMask();return e.forEach((e=>t.on(e.id))),t.value()}(...e);return getEntitiesByMask(t)},getEntitiesByMask:getEntitiesByMask,rebuildArchetypes:()=>{i.clear();const e=getEntities();for(let t=0;t<e.length;t++)updateArchetype(e[t]);a=!1},updateArchetype:updateArchetype,areArchetypesDirty:()=>a,cleanedArchetypes:()=>a=!1})}_export({target:"Set",proto:!0,real:!0,forced:C},{every:function every(e){var t=anObject(this),n=getSetIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3);return!iterate(n,(function(e,n){if(!r(e,e,t))return n()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:C},{filter:function filter(e){var t=anObject(this),n=getSetIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3),o=new(speciesConstructor(t,getBuiltIn("Set"))),i=aFunction$1(o.add);return iterate(n,(function(e){r(e,e,t)&&i.call(o,e)}),{IS_ITERATOR:!0}),o}}),_export({target:"Set",proto:!0,real:!0,forced:C},{find:function find(e){var t=anObject(this),n=getSetIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3);return iterate(n,(function(e,n){if(r(e,e,t))return n(e)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Set",proto:!0,real:!0,forced:C},{intersection:function intersection(e){var t=anObject(this),n=new(speciesConstructor(t,getBuiltIn("Set"))),r=aFunction$1(t.has),o=aFunction$1(n.add);return iterate(e,(function(e){r.call(t,e)&&o.call(n,e)})),n}}),_export({target:"Set",proto:!0,real:!0,forced:C},{isDisjointFrom:function isDisjointFrom(e){var t=anObject(this),n=aFunction$1(t.has);return!iterate(e,(function(e,r){if(!0===n.call(t,e))return r()}),{INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:C},{isSubsetOf:function isSubsetOf(e){var t=function(e){var t=getIteratorMethod(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return anObject(t.call(e))}(this),n=anObject(e),r=n.has;return"function"!=typeof r&&(n=new(getBuiltIn("Set"))(e),r=aFunction$1(n.has)),!iterate(t,(function(e,t){if(!1===r.call(n,e))return t()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:C},{isSupersetOf:function isSupersetOf(e){var t=anObject(this),n=aFunction$1(t.has);return!iterate(e,(function(e,r){if(!1===n.call(t,e))return r()}),{INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:C},{join:function join(e){var t=anObject(this),n=getSetIterator(t),r=void 0===e?",":String(e),o=[];return iterate(n,o.push,{that:o,IS_ITERATOR:!0}),o.join(r)}}),_export({target:"Set",proto:!0,real:!0,forced:C},{map:function map(e){var t=anObject(this),n=getSetIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3),o=new(speciesConstructor(t,getBuiltIn("Set"))),i=aFunction$1(o.add);return iterate(n,(function(e){i.call(o,r(e,e,t))}),{IS_ITERATOR:!0}),o}}),_export({target:"Set",proto:!0,real:!0,forced:C},{reduce:function reduce(e){var t=anObject(this),n=getSetIterator(t),r=arguments.length<2,o=r?void 0:arguments[1];if(aFunction$1(e),iterate(n,(function(n){r?(r=!1,o=n):o=e(o,n,n,t)}),{IS_ITERATOR:!0}),r)throw TypeError("Reduce of empty set with no initial value");return o}}),_export({target:"Set",proto:!0,real:!0,forced:C},{some:function some(e){var t=anObject(this),n=getSetIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3);return iterate(n,(function(e,n){if(r(e,e,t))return n()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:C},{symmetricDifference:function symmetricDifference(e){var t=anObject(this),n=new(speciesConstructor(t,getBuiltIn("Set")))(t),r=aFunction$1(n.delete),o=aFunction$1(n.add);return iterate(e,(function(e){r.call(n,e)||o.call(n,e)})),n}}),_export({target:"Set",proto:!0,real:!0,forced:C},{union:function union(e){var t=anObject(this),n=new(speciesConstructor(t,getBuiltIn("Set")))(t);return iterate(e,aFunction$1(n.add),{that:n}),n}});var Te,we,createMethod$1=function(e){return function(t,n,r,o){aFunction$1(n);var i=Object(requireObjectCoercible(t)),a=l(i),u=toLength(i.length),c=e?u-1:0,f=e?-1:1;if(r<2)for(;;){if(c in a){o=a[c],c+=f;break}if(c+=f,e?c<0:u<=c)throw TypeError("Reduce of empty array with no initial value")}for(;e?c>=0:u>c;c+=f)c in a&&(o=n(o,a[c],c,i));return o}},Re={left:createMethod$1(!1),right:createMethod$1(!0)},Ie=Object.defineProperty,Oe={},thrower=function(e){throw e},Ae=getBuiltIn("navigator","userAgent")||"",je=n.process,Ce=je&&je.versions,Me=Ce&&Ce.v8;Me?we=(Te=Me.split("."))[0]+Te[1]:Ae&&(!(Te=Ae.match(/Edge\/(\d+)/))||Te[1]>=74)&&(Te=Ae.match(/Chrome\/(\d+)/))&&(we=Te[1]);var Pe,Ne,_e=we&&+we,xe="process"==classofRaw(n.process),Be=Re.left,De=!!(Ne=[]["reduce"])&&fails((function(){Ne.call(null,Pe||function(){throw 1},1)})),Ue=function(e,t){if(has(Oe,e))return Oe[e];t||(t={});var n=[][e],o=!!has(t,"ACCESSORS")&&t.ACCESSORS,i=has(t,0)?t[0]:thrower,a=has(t,1)?t[1]:void 0;return Oe[e]=!!n&&!fails((function(){if(o&&!r)return!0;var e={length:-1};o?Ie(e,1,{enumerable:!0,get:thrower}):e[1]=1,n.call(e,i,a)}))}("reduce",{1:0});function createSystemManager(){const e={},t=[];return Object.freeze({registerSystem:(n,r)=>{if(n.name in e)throw new Error(`system "${n.name}" is already registered!`);const o=function createSystem(e){const{components:t,exclusive:n=!1,name:r,update:o=(()=>{}),postUpdate:i=(()=>{}),preUpdate:a=(()=>{})}={...e},u=t.reduce(((e,t)=>(e.on(t.id),e)),createMask()).value();let c=!1;return Object.freeze({archetype:u,exclusive:n,name:r,get enabled(){return c},disable:()=>{c=!1},enable:()=>{c=!0},preUpdate:a,update:o,postUpdate:i})}({...n});return void 0!==r?t.splice(r,0,o):t.push(o),e[o.name]=o,o},unregisterSystem:n=>{if(!(n.name in e))throw new Error(`system "${n.name}" is not registered!`);delete e[n.name],t.splice(t.indexOf(n),1)},moveSystem:(e,n)=>{const r=t.indexOf(e);return-1!==r&&(t.splice(r,1),t.splice(n,0,e),!0)},isSystemRegistered:t=>t.name in e,getSystemByName:t=>e[t],getSystemByIndex:e=>{var n;return null!==(n=t[e])&&void 0!==n?n:void 0},getSystems:()=>[...t]})}return _export({target:"Array",proto:!0,forced:!De||!Ue||!xe&&_e>79&&_e<83},{reduce:function reduce(e){return Be(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}}),e.createWorld=function createWorld(e){const{initialPoolSize:t=64,maxComponents:n=1024,maxEntities:r=1e5}={...e},{createEntity:o,destroyEntity:i,getEntityById:a,getEntities:u,getEntitiesByMask:c,getEntitiesByComponents:l,rebuildArchetypes:f,updateArchetype:s,areArchetypesDirty:p,cleanedArchetypes:d}=createEntityManager({initialPoolSize:t,maxEntities:r}),{registerComponent:g,unregisterComponent:m,isComponentRegistered:y,getComponentByName:h,getComponentById:v,getComponents:S}=createComponentManager({maxComponents:n}),{registerSystem:E,unregisterSystem:b,getSystemByName:T,getSystemByIndex:w,getSystems:R,moveSystem:I,isSystemRegistered:O}=createSystemManager(),A=o(),j=g({name:"world",properties:{isWorld:!0},entityLimit:1,removable:!1}),C={},addComponentsToEntity=(e,...t)=>{if(!e)throw new Error("no entity provided.");if(null==t||!t.length)throw new Error("no components provided.");const n=t.length;let r;for(r=0;r<n;r++){let n;if(n="string"==typeof t[r]?h(t[r]):t[r],!n)throw new Error(`component ${t[r]} is not registered!.`);if(!e.hasComponent(n)){const t=e.getArchetype();e.addComponent(n),s(e,t)}}return e};return addComponentsToEntity(A,j),f(),Object.freeze({entity:A,getComponents:S,getEntities:u,getSystems:R,createEntity:o,destroyEntity:i,addComponentsToEntity:addComponentsToEntity,removeComponentsFromEntity:(e,...t)=>{if(!e)throw new Error("no entity provided.");if(null==t||!t.length)throw new Error("no components provided.");const n=t.length;let r;for(r=0;r<n;r++){let n;if(n="string"==typeof t[r]?h(t[r]):t[r],!n)throw new Error(`component ${t[r]}  is not registered.`);if(e.hasComponent(n)){const t=e.getArchetype();e.removeComponent(n),s(e,t)}}return e},getComponentById:v,getComponentByName:h,getEntitiesByComponents:l,getEntityById:a,getEntitiesByMask:c,getSystemByIndex:w,getSystemByName:T,isComponentRegistered:y,isSystemRegistered:O,moveSystem:I,registerComponent:g,registerSystem:E,unregisterComponent:m,unregisterSystem:b,preUpdate:()=>{const e=R();for(let t=0;t<e.length;t++){const n=e[t];if(!1!==n.enabled)if(!0===p()){const e=c(n.archetype,n.exclusive);C[n.name]=e,n.preUpdate(e,n)}else n.preUpdate(C[n.name],n)}d()},update:e=>{const t=R();for(let n=0;n<t.length;n++){const r=t[n];if(!1!==r.enabled)if(!0===p()){const t=c(r.archetype,r.exclusive);C[r.name]=t,r.update(e,t,r)}else r.update(e,C[r.name],r)}d()},postUpdate:e=>{const t=R();for(let n=0;n<t.length;n++){const r=t[n];if(!1!==r.enabled)if(!0===p()){const t=c(r.archetype,r.exclusive);C[r.name]=t,r.postUpdate(e,t,r)}else r.postUpdate(e,C[r.name],r)}d()}})},e}({});
//# sourceMappingURL=index.min.js.map
