/*! *****************************************************************************
 *
 * miski
 * v0.2.2
 *
 * MIT License
 * 
 * Copyright (C) 2021 Peter Hughes<https://www.phugh.es>, all rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
***************************************************************************** */
var miski=function(e){"use strict";function createMask(e=0n){"number"==typeof e&&(e=BigInt(e));let t=1n<<e;const off=e=>("number"==typeof e&&(e=BigInt(e)),t&=~(1n<<e),t),on=e=>("number"==typeof e&&(e=BigInt(e)),t|=1n<<e,t);return Object.freeze({clear:()=>t=1n<<0n,has:function(e){return"number"==typeof e&&(e=BigInt(e)),(t&e)===t},isOn:e=>("number"==typeof e&&(e=BigInt(e)),0n!==(t&1n<<e)),off:off,on:on,set:(e,t)=>!0===t?on(e):off(e),toArray:()=>t.toString(2).split("").map((e=>parseInt(e,10))),toggle:e=>("number"==typeof e&&(e=BigInt(e)),t^=1n<<e,t),toNumber:()=>Number(t),toString:()=>t.toString(2),value:()=>t})}function deepAssign(e,...t){const n=t.length;if(!t||!n)return e;const r={};for(let e=0;e<n;e++){const n=t[e],o=Object.keys(n),i=o.length;for(let e=0;e<i;e++){const t=o[e],i=Object.getOwnPropertyDescriptor(n,t);i&&i.enumerable&&(r[t]=i)}const a=Object.getOwnPropertySymbols(n);for(let e=0;e<a.length;e++){const t=a[e],o=Object.getOwnPropertyDescriptor(n,t);o&&o.enumerable&&(r[t]=o)}}return Object.defineProperties(e,r),e}function createComponentManager(e){const{maxComponents:t}={...e},n={},r=[];let o=0,i=0;for(let e=t;e>=0;e--)r[e]=i++;return Object.freeze({getComponentById:e=>("number"==typeof e&&(e=BigInt(e)),Object.values(n).find((t=>t.id===e))),getComponentByName:e=>n[e],getComponents:()=>Object.values(n),isComponentRegistered:e=>e.name in n,registerComponent:e=>{if(o>=t)throw new Error("maximum components reached!");if(e.name in n)throw new Error(`component with name "${e.name}" already registered!`);const i=r.pop();if(void 0===i)throw new Error("no available ids!");const a=function createComponent(e){const{entityLimit:t=null,id:n,name:r,properties:o,removable:i=!0}={...e};if(!r||!o||"object"!=typeof o||null==n)throw new Error("malformed component.");return deepAssign(o,e.properties),Object.seal(o),Object.freeze(Object.create({},{entityLimit:{value:t,enumerable:!0},id:{value:n,enumerable:!0},name:{value:r,enumerable:!0},properties:{value:o,enumerable:!0},removable:{value:i,enumerable:!0}}))}({...e,id:i});return n[a.name]=a,o++,a},unregisterComponent:e=>{if(!(e.name in n))throw new Error(`component "${e.name}" is not registered.`);delete n[e.name],r.unshift(e.id);const t=Object.create(e);return delete t.id,o--,t}})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e){var t={exports:{}};return e(t,t.exports),t.exports}var check=function(e){return e&&e.Math==Math&&e},n=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof t&&t)||function(){return this}()||Function("return this")(),fails=function(e){try{return!!e()}catch(e){return!0}},r=!fails((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),o={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,a={f:i&&!o.call({1:2},1)?function propertyIsEnumerable(e){var t=i(this,e);return!!t&&t.enumerable}:o},createPropertyDescriptor=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},c={}.toString,classofRaw=function(e){return c.call(e).slice(8,-1)},u="".split,s=fails((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==classofRaw(e)?u.call(e,""):Object(e)}:Object,requireObjectCoercible=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},toIndexedObject=function(e){return s(requireObjectCoercible(e))},isObject=function(e){return"object"==typeof e?null!==e:"function"==typeof e},toPrimitive=function(e,t){if(!isObject(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!isObject(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!isObject(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!isObject(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},l={}.hasOwnProperty,has$1=function(e,t){return l.call(e,t)},f=n.document,p=isObject(f)&&isObject(f.createElement),d=!r&&!fails((function(){return 7!=Object.defineProperty((e="div",p?f.createElement(e):{}),"a",{get:function(){return 7}}).a;var e})),g=Object.getOwnPropertyDescriptor,m={f:r?g:function getOwnPropertyDescriptor(e,t){if(e=toIndexedObject(e),t=toPrimitive(t,!0),d)try{return g(e,t)}catch(e){}if(has$1(e,t))return createPropertyDescriptor(!a.f.call(e,t),e[t])}},anObject=function(e){if(!isObject(e))throw TypeError(String(e)+" is not an object");return e},y=Object.defineProperty,h={f:r?y:function defineProperty(e,t,n){if(anObject(e),t=toPrimitive(t,!0),anObject(n),d)try{return y(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},v=r?function(e,t,n){return h.f(e,t,createPropertyDescriptor(1,n))}:function(e,t,n){return e[t]=n,e},setGlobal=function(e,t){try{v(n,e,t)}catch(r){n[e]=t}return t},S="__core-js_shared__",E=n[S]||setGlobal(S,{}),b=Function.toString;"function"!=typeof E.inspectSource&&(E.inspectSource=function(e){return b.call(e)});var T,w,I,R,O=E.inspectSource,A=n.WeakMap,j="function"==typeof A&&/native code/.test(O(A)),M=!1,C=createCommonjsModule((function(e){(e.exports=function(e,t){return E[e]||(E[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.9.1",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})})),P=0,N=Math.random(),uid=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++P+N).toString(36)},_=C("keys"),x={},B=n.WeakMap;if(j){var D=E.state||(E.state=new B),U=D.get,k=D.has,z=D.set;T=function(e,t){return t.facade=e,z.call(D,e,t),t},w=function(e){return U.call(D,e)||{}},I=function(e){return k.call(D,e)}}else{var $=_[R="state"]||(_[R]=uid(R));x[$]=!0,T=function(e,t){return t.facade=e,v(e,$,t),t},w=function(e){return has$1(e,$)?e[$]:{}},I=function(e){return has$1(e,$)}}var F={set:T,get:w,has:I,enforce:function(e){return I(e)?w(e):T(e,{})},getterFor:function(e){return function(t){var n;if(!isObject(t)||(n=w(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},L=createCommonjsModule((function(e){var t=F.get,r=F.enforce,o=String(String).split("String");(e.exports=function(e,t,i,a){var c,u=!!a&&!!a.unsafe,s=!!a&&!!a.enumerable,l=!!a&&!!a.noTargetGet;"function"==typeof i&&("string"!=typeof t||has$1(i,"name")||v(i,"name",t),(c=r(i)).source||(c.source=o.join("string"==typeof t?t:""))),e!==n?(u?!l&&e[t]&&(s=!0):delete e[t],s?e[t]=i:v(e,t,i)):s?e[t]=i:setGlobal(t,i)})(Function.prototype,"toString",(function toString(){return"function"==typeof this&&t(this).source||O(this)}))})),K=n,aFunction$1=function(e){return"function"==typeof e?e:void 0},getBuiltIn=function(e,t){return arguments.length<2?aFunction$1(K[e])||aFunction$1(n[e]):K[e]&&K[e][t]||n[e]&&n[e][t]},W=Math.ceil,V=Math.floor,toInteger=function(e){return isNaN(e=+e)?0:(e>0?V:W)(e)},G=Math.min,toLength=function(e){return e>0?G(toInteger(e),9007199254740991):0},q=Math.max,Y=Math.min,createMethod$1=function(e){return function(t,n,r){var o,i=toIndexedObject(t),a=toLength(i.length),c=function(e,t){var n=toInteger(e);return n<0?q(n+t,0):Y(n,t)}(r,a);if(e&&n!=n){for(;a>c;)if((o=i[c++])!=o)return!0}else for(;a>c;c++)if((e||c in i)&&i[c]===n)return e||c||0;return!e&&-1}},H={includes:createMethod$1(!0),indexOf:createMethod$1(!1)}.indexOf,J=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype"),Q={f:Object.getOwnPropertyNames||function getOwnPropertyNames(e){return function(e,t){var n,r=toIndexedObject(e),o=0,i=[];for(n in r)!has$1(x,n)&&has$1(r,n)&&i.push(n);for(;t.length>o;)has$1(r,n=t[o++])&&(~H(i,n)||i.push(n));return i}(e,J)}},X={f:Object.getOwnPropertySymbols},Z=getBuiltIn("Reflect","ownKeys")||function ownKeys(e){var t=Q.f(anObject(e)),n=X.f;return n?t.concat(n(e)):t},copyConstructorProperties=function(e,t){for(var n=Z(t),r=h.f,o=m.f,i=0;i<n.length;i++){var a=n[i];has$1(e,a)||r(e,a,o(t,a))}},ee=/#|\.prototype\./,isForced=function(e,t){var n=ne[te(e)];return n==oe||n!=re&&("function"==typeof t?fails(t):!!t)},te=isForced.normalize=function(e){return String(e).replace(ee,".").toLowerCase()},ne=isForced.data={},re=isForced.NATIVE="N",oe=isForced.POLYFILL="P",ie=isForced,ae=m.f,_export=function(e,t){var r,o,i,a,c,u=e.target,s=e.global,l=e.stat;if(r=s?n:l?n[u]||setGlobal(u,{}):(n[u]||{}).prototype)for(o in t){if(a=t[o],i=e.noTargetGet?(c=ae(r,o))&&c.value:r[o],!ie(s?o:u+(l?".":"#")+o,e.forced)&&void 0!==i){if(typeof a==typeof i)continue;copyConstructorProperties(a,i)}(e.sham||i&&i.sham)&&v(a,"sham",!0),L(r,o,a,e)}},aFunction=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},collectionDeleteAll=function(){for(var e,t=anObject(this),n=aFunction(t.delete),r=!0,o=0,i=arguments.length;o<i;o++)e=n.call(t,arguments[o]),r=r&&e;return!!r};_export({target:"Map",proto:!0,real:!0,forced:M},{deleteAll:function deleteAll(){return collectionDeleteAll.apply(this,arguments)}});var ce,ue,functionBindContext=function(e,t,n){if(aFunction(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}},se="process"==classofRaw(n.process),le=getBuiltIn("navigator","userAgent")||"",fe=n.process,pe=fe&&fe.versions,de=pe&&pe.v8;de?ue=(ce=de.split("."))[0]+ce[1]:le&&(!(ce=le.match(/Edge\/(\d+)/))||ce[1]>=74)&&(ce=le.match(/Chrome\/(\d+)/))&&(ue=ce[1]);var ge=ue&&+ue,me=!!Object.getOwnPropertySymbols&&!fails((function(){return!Symbol.sham&&(se?38===ge:ge>37&&ge<41)})),ye=me&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,he=C("wks"),ve=n.Symbol,Se=ye?ve:ve&&ve.withoutSetter||uid,wellKnownSymbol=function(e){return has$1(he,e)&&(me||"string"==typeof he[e])||(me&&has$1(ve,e)?he[e]=ve[e]:he[e]=Se("Symbol."+e)),he[e]},Ee={};Ee[wellKnownSymbol("toStringTag")]="z";var be="[object z]"===String(Ee),Te=wellKnownSymbol("toStringTag"),we="Arguments"==classofRaw(function(){return arguments}()),Ie=be?classofRaw:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Te))?n:we?classofRaw(t):"Object"==(r=classofRaw(t))&&"function"==typeof t.callee?"Arguments":r},Re={},Oe=wellKnownSymbol("iterator"),getIteratorMethod=function(e){if(null!=e)return e[Oe]||e["@@iterator"]||Re[Ie(e)]},getMapIterator=function(e){return Map.prototype.entries.call(e)},Ae=wellKnownSymbol("iterator"),je=Array.prototype,iteratorClose=function(e){var t=e.return;if(void 0!==t)return anObject(t.call(e)).value},Result=function(e,t){this.stopped=e,this.result=t},iterate=function(e,t,n){var r,o,i,a,c,u,s,l,f=n&&n.that,p=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),g=!(!n||!n.INTERRUPTED),m=functionBindContext(t,f,1+p+g),stop=function(e){return r&&iteratorClose(r),new Result(!0,e)},callFn=function(e){return p?(anObject(e),g?m(e[0],e[1],stop):m(e[0],e[1])):g?m(e,stop):m(e)};if(d)r=e;else{if("function"!=typeof(o=getIteratorMethod(e)))throw TypeError("Target is not iterable");if(void 0!==(l=o)&&(Re.Array===l||je[Ae]===l)){for(i=0,a=toLength(e.length);a>i;i++)if((c=callFn(e[i]))&&c instanceof Result)return c;return new Result(!1)}r=o.call(e)}for(u=r.next;!(s=u.call(r)).done;){try{c=callFn(s.value)}catch(e){throw iteratorClose(r),e}if("object"==typeof c&&c&&c instanceof Result)return c}return new Result(!1)};_export({target:"Map",proto:!0,real:!0,forced:M},{every:function every(e){var t=anObject(this),n=getMapIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3);return!iterate(n,(function(e,n,o){if(!r(n,e,t))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Me=wellKnownSymbol("species"),speciesConstructor=function(e,t){var n,r=anObject(e).constructor;return void 0===r||null==(n=anObject(r)[Me])?t:aFunction(n)};_export({target:"Map",proto:!0,real:!0,forced:M},{filter:function filter(e){var t=anObject(this),n=getMapIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3),o=new(speciesConstructor(t,getBuiltIn("Map"))),i=aFunction(o.set);return iterate(n,(function(e,n){r(n,e,t)&&i.call(o,e,n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}}),_export({target:"Map",proto:!0,real:!0,forced:M},{find:function find(e){var t=anObject(this),n=getMapIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3);return iterate(n,(function(e,n,o){if(r(n,e,t))return o(n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:M},{findKey:function findKey(e){var t=anObject(this),n=getMapIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3);return iterate(n,(function(e,n,o){if(r(n,e,t))return o(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});_export({target:"Map",proto:!0,real:!0,forced:M},{includes:function includes(e){return iterate(getMapIterator(anObject(this)),(function(t,n,r){if((o=n)===(i=e)||o!=o&&i!=i)return r();var o,i}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",proto:!0,real:!0,forced:M},{keyOf:function keyOf(e){return iterate(getMapIterator(anObject(this)),(function(t,n,r){if(n===e)return r(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:M},{mapKeys:function mapKeys(e){var t=anObject(this),n=getMapIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3),o=new(speciesConstructor(t,getBuiltIn("Map"))),i=aFunction(o.set);return iterate(n,(function(e,n){i.call(o,r(n,e,t),n)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}}),_export({target:"Map",proto:!0,real:!0,forced:M},{mapValues:function mapValues(e){var t=anObject(this),n=getMapIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3),o=new(speciesConstructor(t,getBuiltIn("Map"))),i=aFunction(o.set);return iterate(n,(function(e,n){i.call(o,e,r(n,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}}),_export({target:"Map",proto:!0,real:!0,forced:M},{merge:function merge(e){for(var t=anObject(this),n=aFunction(t.set),r=0;r<arguments.length;)iterate(arguments[r++],n,{that:t,AS_ENTRIES:!0});return t}}),_export({target:"Map",proto:!0,real:!0,forced:M},{reduce:function reduce(e){var t=anObject(this),n=getMapIterator(t),r=arguments.length<2,o=r?void 0:arguments[1];if(aFunction(e),iterate(n,(function(n,i){r?(r=!1,o=i):o=e(o,i,n,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),r)throw TypeError("Reduce of empty map with no initial value");return o}}),_export({target:"Map",proto:!0,real:!0,forced:M},{some:function some(e){var t=anObject(this),n=getMapIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3);return iterate(n,(function(e,n,o){if(r(n,e,t))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",proto:!0,real:!0,forced:M},{update:function update(e,t){var n=anObject(this),r=arguments.length;aFunction(t);var o=n.has(e);if(!o&&r<3)throw TypeError("Updating absent value");var i=o?n.get(e):aFunction(r>2?arguments[2]:void 0)(e,n);return n.set(e,t(i,e,n)),n}});var Ce,Pe,createMethod=function(e){return function(t,n,r,o){aFunction(n);var i=Object(requireObjectCoercible(t)),a=s(i),c=toLength(i.length),u=e?c-1:0,l=e?-1:1;if(r<2)for(;;){if(u in a){o=a[u],u+=l;break}if(u+=l,e?u<0:c<=u)throw TypeError("Reduce of empty array with no initial value")}for(;e?u>=0:c>u;u+=l)u in a&&(o=n(o,a[u],u,i));return o}},Ne={left:createMethod(!1),right:createMethod(!0)}.left;_export({target:"Array",proto:!0,forced:!(!!(Pe=[]["reduce"])&&fails((function(){Pe.call(null,Ce||function(){throw 1},1)})))||!se&&ge>79&&ge<83},{reduce:function reduce(e){return Ne(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}});var collectionAddAll=function(){for(var e=anObject(this),t=aFunction(e.add),n=0,r=arguments.length;n<r;n++)t.call(e,arguments[n]);return e};_export({target:"Set",proto:!0,real:!0,forced:M},{addAll:function addAll(){return collectionAddAll.apply(this,arguments)}}),_export({target:"Set",proto:!0,real:!0,forced:M},{deleteAll:function deleteAll(){return collectionDeleteAll.apply(this,arguments)}}),_export({target:"Set",proto:!0,real:!0,forced:M},{difference:function difference(e){var t=anObject(this),n=new(speciesConstructor(t,getBuiltIn("Set")))(t),r=aFunction(n.delete);return iterate(e,(function(e){r.call(n,e)})),n}});var getSetIterator=function(e){return Set.prototype.values.call(e)};function createEntity(){const e=createMask(),t=`${Date.now().toString(36)}_${Math.random().toString(36).substr(2,9)}`,n={};let r=!0,o=null;const i=Object.create({},{_:{value:n,enumerable:!0},addComponent:{value:r=>{if(r.name in n)return console.warn(`Entity "${t}" already has component "${r.name}".`),!1;try{n[r.name]=deepAssign({},r.properties),e.on(r.id)}catch(e){return console.warn(`Error adding component "${r.name}" to entity "${t}".`,e),!1}return!0}},getArchetype:{value:()=>e.value()},hasComponent:{value:e=>{var t;return null!==(t="string"==typeof e?e in n:e.name in n)&&void 0!==t&&t}},isAwake:{value:()=>r},id:{value:t,enumerable:!0},next:{value:e=>(void 0!==e&&(o=e),o)},purge:{value:()=>{!function clearObject(e){return Object.keys(e).forEach((t=>delete e[t])),e}(n),e.clear()}},removeComponent:{value:t=>t.name in n&&(delete n[t.name],e.off(t.id),!0)},sleep:{value:()=>r=!1},wake:{value:()=>r=!0}});return Object.freeze(i)}function createPool(e){const{initialPoolSize:t,maxEntities:n}={...e},r=[];let o;const _create=(e=1)=>{for(let t=0;t<e;t++){if(r.length>=n)throw new Error("The entity pool is full.");const e=createEntity();e.next(o),o=e,r.push(e)}},flush=()=>{r.length=0,o=null,_create(t)};return flush(),Object.freeze({flush:flush,get:()=>{o||_create(.25*t);const e=o;return o=e.next(),e},release:e=>{e.purge(),e.next(o),o=e}})}function createEntityManager(e){const{initialPoolSize:t,maxEntities:n}={...e},r=createPool({initialPoolSize:t,maxEntities:n}),o={},i=new Map;let a=!0;const getEntities=()=>Object.values(o),getEntitiesByMask=(e,t=!1)=>{if(t){var n;const t=null!==(n=i.get(e))&&void 0!==n?n:[];return[[e],[...t]]}{const t=new Set,n=new Set;return i.forEach(((r,o)=>{(o&e)===e&&(r.forEach((e=>t.add(e))),n.add(e))})),[[...n],[...t]]}},updateArchetype=(e,t)=>{var n;null!=t&&(null===(n=i.get(t))||void 0===n||n.delete(e));const r=e.getArchetype();var o;i.has(r)?null===(o=i.get(r))||void 0===o||o.add(e):(i.set(r,new Set([e])),a=!0);return e};return Object.freeze({areArchetypesDirty:()=>a,cleanedArchetypes:()=>a=!1,createEntity:()=>{const e=r.get();if(!e)throw new Error("no entities left!");return o[e.id]=e,updateArchetype(e),e},destroyEntity:e=>{const t=e.id in o;if(!0===t){var n,c;delete o[e.id];const t=e.getArchetype();null===(n=i.get(t))||void 0===n||n.delete(e),0===(null===(c=i.get(t))||void 0===c?void 0:c.size)&&(i.delete(t),a=!0),r.release(e)}return t},getEntities:getEntities,getEntitiesByComponents:(...e)=>{const t=function componentsToArchetype(...e){const t=createMask();return e.forEach((e=>t.on(e.id))),t.value()}(...e);return getEntitiesByMask(t)[1]},getEntitiesByMask:getEntitiesByMask,getEntitiesFromMasks:e=>e.reduce(((e,t)=>{var n;const r=null!==(n=i.get(t))&&void 0!==n?n:[];return e.push(...r),e}),[]),getEntityById:e=>o[e],rebuildArchetypes:()=>{i.clear();const e=getEntities();for(let t=0;t<e.length;t++)updateArchetype(e[t]);a=!1},updateArchetype:updateArchetype})}_export({target:"Set",proto:!0,real:!0,forced:M},{every:function every(e){var t=anObject(this),n=getSetIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3);return!iterate(n,(function(e,n){if(!r(e,e,t))return n()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:M},{filter:function filter(e){var t=anObject(this),n=getSetIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3),o=new(speciesConstructor(t,getBuiltIn("Set"))),i=aFunction(o.add);return iterate(n,(function(e){r(e,e,t)&&i.call(o,e)}),{IS_ITERATOR:!0}),o}}),_export({target:"Set",proto:!0,real:!0,forced:M},{find:function find(e){var t=anObject(this),n=getSetIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3);return iterate(n,(function(e,n){if(r(e,e,t))return n(e)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Set",proto:!0,real:!0,forced:M},{intersection:function intersection(e){var t=anObject(this),n=new(speciesConstructor(t,getBuiltIn("Set"))),r=aFunction(t.has),o=aFunction(n.add);return iterate(e,(function(e){r.call(t,e)&&o.call(n,e)})),n}}),_export({target:"Set",proto:!0,real:!0,forced:M},{isDisjointFrom:function isDisjointFrom(e){var t=anObject(this),n=aFunction(t.has);return!iterate(e,(function(e,r){if(!0===n.call(t,e))return r()}),{INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:M},{isSubsetOf:function isSubsetOf(e){var t=function(e){var t=getIteratorMethod(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return anObject(t.call(e))}(this),n=anObject(e),r=n.has;return"function"!=typeof r&&(n=new(getBuiltIn("Set"))(e),r=aFunction(n.has)),!iterate(t,(function(e,t){if(!1===r.call(n,e))return t()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:M},{isSupersetOf:function isSupersetOf(e){var t=anObject(this),n=aFunction(t.has);return!iterate(e,(function(e,r){if(!1===n.call(t,e))return r()}),{INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:M},{join:function join(e){var t=anObject(this),n=getSetIterator(t),r=void 0===e?",":String(e),o=[];return iterate(n,o.push,{that:o,IS_ITERATOR:!0}),o.join(r)}}),_export({target:"Set",proto:!0,real:!0,forced:M},{map:function map(e){var t=anObject(this),n=getSetIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3),o=new(speciesConstructor(t,getBuiltIn("Set"))),i=aFunction(o.add);return iterate(n,(function(e){i.call(o,r(e,e,t))}),{IS_ITERATOR:!0}),o}}),_export({target:"Set",proto:!0,real:!0,forced:M},{reduce:function reduce(e){var t=anObject(this),n=getSetIterator(t),r=arguments.length<2,o=r?void 0:arguments[1];if(aFunction(e),iterate(n,(function(n){r?(r=!1,o=n):o=e(o,n,n,t)}),{IS_ITERATOR:!0}),r)throw TypeError("Reduce of empty set with no initial value");return o}}),_export({target:"Set",proto:!0,real:!0,forced:M},{some:function some(e){var t=anObject(this),n=getSetIterator(t),r=functionBindContext(e,arguments.length>1?arguments[1]:void 0,3);return iterate(n,(function(e,n){if(r(e,e,t))return n()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Set",proto:!0,real:!0,forced:M},{symmetricDifference:function symmetricDifference(e){var t=anObject(this),n=new(speciesConstructor(t,getBuiltIn("Set")))(t),r=aFunction(n.delete),o=aFunction(n.add);return iterate(e,(function(e){r.call(n,e)||o.call(n,e)})),n}}),_export({target:"Set",proto:!0,real:!0,forced:M},{union:function union(e){var t=anObject(this),n=new(speciesConstructor(t,getBuiltIn("Set")))(t);return iterate(e,aFunction(n.add),{that:n}),n}});const _noop=function(){};function createSystemManager(){const e={},t=[];return Object.freeze({getSystemByIndex:e=>{var n;return null!==(n=t[e])&&void 0!==n?n:void 0},getSystemByName:t=>e[t],getSystems:()=>[...t],isSystemRegistered:t=>t.name in e,moveSystem:(e,n)=>{const r=t.indexOf(e);return-1!==r&&(t.splice(r,1),t.splice(n,0,e),!0)},registerSystem:(n,r)=>{if(n.name in e)throw new Error(`system "${n.name}" is already registered!`);const o=function createSystem(e){const{components:t,exclusive:n=!1,name:r,postUpdate:o=_noop,preUpdate:i=_noop,update:a=_noop}={...e},c=t.reduce(((e,t)=>(e.on(t.id),e)),createMask()).value();let u=!1;return Object.freeze({get enabled(){return u},archetype:c,disable:()=>u=!1,enable:()=>u=!0,exclusive:n,name:r,postUpdate:o,preUpdate:i,update:a})}({...n});return void 0!==r?t.splice(r,0,o):t.push(o),e[o.name]=o,o},unregisterSystem:n=>{if(!(n.name in e))throw new Error(`system "${n.name}" is not registered!`);delete e[n.name],t.splice(t.indexOf(n),1)}})}return e.createWorld=function createWorld(e){const{initialPoolSize:t=64,maxComponents:n=1024,maxEntities:r=1e5}={...e},{areArchetypesDirty:o,cleanedArchetypes:i,createEntity:a,destroyEntity:c,getEntities:u,getEntitiesByComponents:s,getEntitiesByMask:l,getEntitiesFromMasks:f,getEntityById:p,rebuildArchetypes:d,updateArchetype:g}=createEntityManager({initialPoolSize:t,maxEntities:r}),{getComponentById:m,getComponentByName:y,getComponents:h,isComponentRegistered:v,registerComponent:S,unregisterComponent:E}=createComponentManager({maxComponents:n}),{getSystemByIndex:b,getSystemByName:T,getSystems:w,isSystemRegistered:I,moveSystem:R,registerSystem:O,unregisterSystem:A}=createSystemManager(),j=a(),M=S({name:"world",properties:{isWorld:!0},entityLimit:1,removable:!1}),C={},addComponentsToEntity=(e,...t)=>{if(!e)throw new Error("no entity provided.");if(null==t||!t.length)throw new Error("no components provided.");const n=t.length;let r;for(r=0;r<n;r++){let n;if(n="string"==typeof t[r]?y(t[r]):t[r],!n)throw new Error(`component ${t[r]} is not registered!.`);if(!e.hasComponent(n)){const t=e.getArchetype();e.addComponent(n),g(e,t)}}return e};return addComponentsToEntity(j,M),Object.freeze({addComponentsToEntity:addComponentsToEntity,createEntity:a,destroyEntity:c,entity:j,getComponentById:m,getComponentByName:y,getComponents:h,getEntities:u,getEntitiesByComponents:s,getEntitiesByMask:l,getEntityById:p,getSystemByIndex:b,getSystemByName:T,getSystems:w,isComponentRegistered:v,isSystemRegistered:I,moveSystem:R,postUpdate:e=>{const t=w();for(let n=0;n<t.length;n++){const r=t[n];if(!1!==r.enabled)if(!0!==o()&&r.name in C){const t=C[r.name],n=f(t);r.postUpdate(e,n,r)}else{const[t,n]=l(r.archetype,r.exclusive);C[r.name]=t,r.postUpdate(e,n,r),i()}}},preUpdate:()=>{const e=w();for(let t=0;t<e.length;t++){const n=e[t];if(!1!==n.enabled)if(!0!==o()&&n.name in C){const e=C[n.name],t=f(e);n.preUpdate(t,n)}else{const[e,t]=l(n.archetype,n.exclusive);C[n.name]=e,n.preUpdate(t,n),i()}}},registerComponent:S,registerSystem:O,removeComponentsFromEntity:(e,...t)=>{if(!e)throw new Error("no entity provided.");if(null==t||!t.length)throw new Error("no components provided.");const n=t.length;let r;for(r=0;r<n;r++){let n;if(n="string"==typeof t[r]?y(t[r]):t[r],!n)throw new Error(`component ${t[r]}  is not registered.`);if(e.hasComponent(n)){const t=e.getArchetype();e.removeComponent(n),g(e,t)}}return e},unregisterComponent:E,unregisterSystem:A,update:e=>{const t=w();for(let n=0;n<t.length;n++){const r=t[n];if(!1!==r.enabled)if(!0!==o()&&r.name in C){const t=C[r.name],n=f(t);r.update(e,n,r)}else{const[t,n]=l(r.archetype,r.exclusive);C[r.name]=t,r.update(e,n,r),i()}}}})},e}({});
//# sourceMappingURL=index.min.js.map
