/*! *****************************************************************************
 *
 * miski
 * v0.4.0
 *
 * MIT License
 * 
 * Copyright (C) 2021 Peter Hughes<https://www.phugh.es>, all rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
***************************************************************************** */
var miski=function(e){"use strict";function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function r(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?t(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,a=function(e){try{return!!e()}catch(e){return!0}},u=!a((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),c=function(e){return e&&e.Math==Math&&e},f=c("object"==typeof globalThis&&globalThis)||c("object"==typeof window&&window)||c("object"==typeof self&&self)||c("object"==typeof o&&o)||function(){return this}()||Function("return this")(),s=function(e){return"object"==typeof e?null!==e:"function"==typeof e},l=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},p=l,y=function(e){return Object(p(e))},d=y,h={}.hasOwnProperty,m=Object.hasOwn||function(e,t){return h.call(d(e),t)},g={exports:{}},v={},b=s,w=f.document,E=b(w)&&b(w.createElement),S=function(e){return E?w.createElement(e):{}},T=!u&&!a((function(){return 7!=Object.defineProperty(S("div"),"a",{get:function(){return 7}}).a})),O=s,A=function(e){if(!O(e))throw TypeError(String(e)+" is not an object");return e},j=s,I=function(e,t){if(!j(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!j(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!j(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!j(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")},R=u,_=T,P=A,M=I,x=Object.defineProperty;v.f=R?x:function(e,t,r){if(P(e),t=M(t,!0),P(r),_)try{return x(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var C=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},N=v,U=C,D=u?function(e,t,r){return N.f(e,t,U(1,r))}:function(e,t,r){return e[t]=r,e},$=f,B=D,k=function(e,t){try{B($,e,t)}catch(r){$[e]=t}return t},F=k,Q="__core-js_shared__",q=f[Q]||F(Q,{}),L=q;(g.exports=function(e,t){return L[e]||(L[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.15.2",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var Y,z,V=0,G=Math.random(),W=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++V+G).toString(36)},K=f,H=f,J=function(e){return"function"==typeof e?e:void 0},Z=function(e,t){return arguments.length<2?J(K[e])||J(H[e]):K[e]&&K[e][t]||H[e]&&H[e][t]},X=Z("navigator","userAgent")||"",ee=X,te=f.process,re=te&&te.versions,ne=re&&re.v8;ne?z=(Y=ne.split("."))[0]<4?1:Y[0]+Y[1]:ee&&(!(Y=ee.match(/Edge\/(\d+)/))||Y[1]>=74)&&(Y=ee.match(/Chrome\/(\d+)/))&&(z=Y[1]);var oe=z&&+z,ie=oe,ae=a,ue=!!Object.getOwnPropertySymbols&&!ae((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ie&&ie<41})),ce=ue&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,fe=f,se=g.exports,le=m,pe=W,ye=ue,de=ce,he=se("wks"),me=fe.Symbol,ge=de?me:me&&me.withoutSetter||pe,ve=function(e){return le(he,e)&&(ye||"string"==typeof he[e])||(ye&&le(me,e)?he[e]=me[e]:he[e]=ge("Symbol."+e)),he[e]},be={};be[ve("toStringTag")]="z";var we="[object z]"===String(be),Ee={}.toString,Se=function(e){return Ee.call(e).slice(8,-1)},Te=we,Oe=Se,Ae=ve("toStringTag"),je="Arguments"==Oe(function(){return arguments}()),Ie=Te?Oe:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Ae))?r:je?Oe(t):"Object"==(n=Oe(t))&&"function"==typeof t.callee?"Arguments":n},Re={exports:{}},_e=q,Pe=Function.toString;"function"!=typeof _e.inspectSource&&(_e.inspectSource=function(e){return Pe.call(e)});var Me,xe,Ce,Ne=_e.inspectSource,Ue=Ne,De=f.WeakMap,$e="function"==typeof De&&/native code/.test(Ue(De)),Be=g.exports,ke=W,Fe=Be("keys"),Qe=function(e){return Fe[e]||(Fe[e]=ke(e))},qe={},Le=$e,Ye=s,ze=D,Ve=m,Ge=q,We=Qe,Ke=qe,He="Object already initialized",Je=f.WeakMap;if(Le||Ge.state){var Ze=Ge.state||(Ge.state=new Je),Xe=Ze.get,et=Ze.has,tt=Ze.set;Me=function(e,t){if(et.call(Ze,e))throw new TypeError(He);return t.facade=e,tt.call(Ze,e,t),t},xe=function(e){return Xe.call(Ze,e)||{}},Ce=function(e){return et.call(Ze,e)}}else{var rt=We("state");Ke[rt]=!0,Me=function(e,t){if(Ve(e,rt))throw new TypeError(He);return t.facade=e,ze(e,rt,t),t},xe=function(e){return Ve(e,rt)?e[rt]:{}},Ce=function(e){return Ve(e,rt)}}var nt={set:Me,get:xe,has:Ce,enforce:function(e){return Ce(e)?xe(e):Me(e,{})},getterFor:function(e){return function(t){var r;if(!Ye(t)||(r=xe(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}},ot=f,it=D,at=m,ut=k,ct=Ne,ft=nt.get,st=nt.enforce,lt=String(String).split("String");(Re.exports=function(e,t,r,n){var o,i=!!n&&!!n.unsafe,a=!!n&&!!n.enumerable,u=!!n&&!!n.noTargetGet;"function"==typeof r&&("string"!=typeof t||at(r,"name")||it(r,"name",t),(o=st(r)).source||(o.source=lt.join("string"==typeof t?t:""))),e!==ot?(i?!u&&e[t]&&(a=!0):delete e[t],a?e[t]=r:it(e,t,r)):a?e[t]=r:ut(t,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&ft(this).source||ct(this)}));var pt,yt=!a((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),dt=m,ht=y,mt=yt,gt=Qe("IE_PROTO"),vt=Object.prototype,bt=mt?Object.getPrototypeOf:function(e){return e=ht(e),dt(e,gt)?e[gt]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?vt:null},wt=s,Et=A,St=function(e){if(!wt(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e},Tt=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return Et(r),St(n),t?e.call(r,n):r.__proto__=n,r}}():void 0),Ot=i,At=u,jt=f,It=s,Rt=m,_t=Ie,Pt=D,Mt=Re.exports,xt=v.f,Ct=bt,Nt=Tt,Ut=ve,Dt=W,$t=jt.Int8Array,Bt=$t&&$t.prototype,kt=jt.Uint8ClampedArray,Ft=kt&&kt.prototype,Qt=$t&&Ct($t),qt=Bt&&Ct(Bt),Lt=Object.prototype,Yt=Lt.isPrototypeOf,zt=Ut("toStringTag"),Vt=Dt("TYPED_ARRAY_TAG"),Gt=Ot&&!!Nt&&"Opera"!==_t(jt.opera),Wt=!1,Kt={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ht={BigInt64Array:8,BigUint64Array:8},Jt=function(e){if(!It(e))return!1;var t=_t(e);return Rt(Kt,t)||Rt(Ht,t)};for(pt in Kt)jt[pt]||(Gt=!1);if((!Gt||"function"!=typeof Qt||Qt===Function.prototype)&&(Qt=function(){throw TypeError("Incorrect invocation")},Gt))for(pt in Kt)jt[pt]&&Nt(jt[pt],Qt);if((!Gt||!qt||qt===Lt)&&(qt=Qt.prototype,Gt))for(pt in Kt)jt[pt]&&Nt(jt[pt].prototype,qt);if(Gt&&Ct(Ft)!==qt&&Nt(Ft,qt),At&&!Rt(qt,zt))for(pt in Wt=!0,xt(qt,zt,{get:function(){return It(this)?this[Vt]:void 0}}),Kt)jt[pt]&&Pt(jt[pt],Vt,pt);var Zt={NATIVE_ARRAY_BUFFER_VIEWS:Gt,TYPED_ARRAY_TAG:Wt&&Vt,aTypedArray:function(e){if(Jt(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(Nt){if(Yt.call(Qt,e))return e}else for(var t in Kt)if(Rt(Kt,pt)){var r=jt[t];if(r&&(e===r||Yt.call(r,e)))return e}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r){if(At){if(r)for(var n in Kt){var o=jt[n];if(o&&Rt(o.prototype,e))try{delete o.prototype[e]}catch(e){}}qt[e]&&!r||Mt(qt,e,r?t:Gt&&Bt[e]||t)}},exportTypedArrayStaticMethod:function(e,t,r){var n,o;if(At){if(Nt){if(r)for(n in Kt)if((o=jt[n])&&Rt(o,e))try{delete o[e]}catch(e){}if(Qt[e]&&!r)return;try{return Mt(Qt,e,r?t:Gt&&Qt[e]||t)}catch(e){}}for(n in Kt)!(o=jt[n])||o[e]&&!r||Mt(o,e,t)}},isView:function(e){if(!It(e))return!1;var t=_t(e);return"DataView"===t||Rt(Kt,t)||Rt(Ht,t)},isTypedArray:Jt,TypedArray:Qt,TypedArrayPrototype:qt},Xt=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},er=Math.ceil,tr=Math.floor,rr=function(e){return isNaN(e=+e)?0:(e>0?tr:er)(e)},nr=rr,or=Math.min,ir=function(e){return e>0?or(nr(e),9007199254740991):0},ar=Math.floor,ur=function(e,t){var r=e.length,n=ar(r/2);return r<8?cr(e,t):fr(ur(e.slice(0,n),t),ur(e.slice(n),t),t)},cr=function(e,t){for(var r,n,o=e.length,i=1;i<o;){for(n=i,r=e[i];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==i++&&(e[n]=r)}return e},fr=function(e,t,r){for(var n=e.length,o=t.length,i=0,a=0,u=[];i<n||a<o;)i<n&&a<o?u.push(r(e[i],t[a])<=0?e[i++]:t[a++]):u.push(i<n?e[i++]:t[a++]);return u},sr=ur,lr=X.match(/firefox\/(\d+)/i),pr=!!lr&&+lr[1],yr=/MSIE|Trident/.test(X),dr=X.match(/AppleWebKit\/(\d+)\./),hr=!!dr&&+dr[1],mr=a,gr=Xt,vr=ir,br=sr,wr=pr,Er=yr,Sr=oe,Tr=hr,Or=Zt.aTypedArray,Ar=Zt.exportTypedArrayMethod,jr=f.Uint16Array,Ir=jr&&jr.prototype.sort,Rr=!!Ir&&!mr((function(){var e=new jr(2);e.sort(null),e.sort({})})),_r=!!Ir&&!mr((function(){if(Sr)return Sr<74;if(wr)return wr<67;if(Er)return!0;if(Tr)return Tr<602;var e,t,r=new jr(516),n=Array(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,n[e]=e-2*t+3;for(r.sort((function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==n[e])return!0}));
/**
   * @name        Bitmask
   * @description Utilities for handling and manipulating bitmask arrays
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   */
function Pr(e,t){const r=8*e.BYTES_PER_ELEMENT;return e[Math.floor(t/r)]|=1<<t%r,e}function Mr(e,t){const r=8*e.BYTES_PER_ELEMENT;return e[Math.floor(t/r)]&=~(1<<t%r),e}function xr(e,t){const r=8*e.BYTES_PER_ELEMENT;return Boolean(e[Math.floor(t/r)]&1<<t%r)}function Cr(e){const t=function(e){return e.BYTES_PER_ELEMENT*e.length*8}(e);for(let r=0;r<t;r++)if(!xr(e,r))return r}function Nr(e=32){return new Uint32Array(e/32)}
/**
   * @description Utilities for handling and manipulating objects
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   */function Ur(e){return Boolean(null!=e&&"object"==typeof e&&!Array.isArray(e))}function Dr(e,...t){if(!t||!t.length)return e;const r=t.shift(),n=Object.getOwnPropertyDescriptors(r);return Object.entries(n).forEach((([t,r])=>{void 0!==r.value&&(Ur(r.value)?r.value=Dr({},r.value):Array.isArray(r.value)&&(r.value=r.value.slice())),Object.defineProperty(e,t,r)})),Dr(e,...t)}
/**
   * @description Utilities for handling and manipulating strings
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   */Ar("sort",(function(e){var t=this;if(void 0!==e&&gr(e),_r)return Ir.call(t,e);Or(t);var r,n=vr(t.length),o=Array(n);for(r=0;r<n;r++)o[r]=t[r];for(o=br(t,function(e){return function(t,r){return void 0!==e?+e(t,r)||0:r!=r?-1:t!=t?1:0===t&&0===r?1/t>0&&1/r<0?1:-1:t>r}}(e)),r=0;r<n;r++)t[r]=o[r];return t}),!_r||Rr);const $r=["defaults","id","name","entities","schema","world","constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","prototype","toLocaleString","toString","valueOf","__defineGetter__","__defineSetter__","__lookupGetter__","__lookupGetter__","__proto__"];function Br(e){if("string"!=typeof e)throw new TypeError(`Expected name to be of type "string", found ${typeof e}.`);return(e=e.trim()).length>0&&/^(?![0-9])[a-zA-Z0-9$_]+$/.test(e)&&!$r.includes(e)}var kr={},Fr={},Qr={}.propertyIsEnumerable,qr=Object.getOwnPropertyDescriptor,Lr=qr&&!Qr.call({1:2},1);Fr.f=Lr?function(e){var t=qr(this,e);return!!t&&t.enumerable}:Qr;var Yr=Se,zr="".split,Vr=a((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==Yr(e)?zr.call(e,""):Object(e)}:Object,Gr=l,Wr=function(e){return Vr(Gr(e))},Kr=u,Hr=Fr,Jr=C,Zr=Wr,Xr=I,en=m,tn=T,rn=Object.getOwnPropertyDescriptor;kr.f=Kr?rn:function(e,t){if(e=Zr(e),t=Xr(t,!0),tn)try{return rn(e,t)}catch(e){}if(en(e,t))return Jr(!Hr.f.call(e,t),e[t])};var nn={},on=rr,an=Math.max,un=Math.min,cn=Wr,fn=ir,sn=function(e,t){var r=on(e);return r<0?an(r+t,0):un(r,t)},ln=function(e){return function(t,r,n){var o,i=cn(t),a=fn(i.length),u=sn(n,a);if(e&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((e||u in i)&&i[u]===r)return e||u||0;return!e&&-1}},pn={includes:ln(!0),indexOf:ln(!1)},yn=m,dn=Wr,hn=pn.indexOf,mn=qe,gn=function(e,t){var r,n=dn(e),o=0,i=[];for(r in n)!yn(mn,r)&&yn(n,r)&&i.push(r);for(;t.length>o;)yn(n,r=t[o++])&&(~hn(i,r)||i.push(r));return i},vn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype");nn.f=Object.getOwnPropertyNames||function(e){return gn(e,vn)};var bn={};bn.f=Object.getOwnPropertySymbols;var wn=nn,En=bn,Sn=A,Tn=Z("Reflect","ownKeys")||function(e){var t=wn.f(Sn(e)),r=En.f;return r?t.concat(r(e)):t},On=m,An=Tn,jn=kr,In=v,Rn=a,_n=/#|\.prototype\./,Pn=function(e,t){var r=xn[Mn(e)];return r==Nn||r!=Cn&&("function"==typeof t?Rn(t):!!t)},Mn=Pn.normalize=function(e){return String(e).replace(_n,".").toLowerCase()},xn=Pn.data={},Cn=Pn.NATIVE="N",Nn=Pn.POLYFILL="P",Un=Pn,Dn=f,$n=kr.f,Bn=D,kn=Re.exports,Fn=k,Qn=function(e,t){for(var r=An(t),n=In.f,o=jn.f,i=0;i<r.length;i++){var a=r[i];On(e,a)||n(e,a,o(t,a))}},qn=Un,Ln=function(e,t){var r,n,o,i,a,u=e.target,c=e.global,f=e.stat;if(r=c?Dn:f?Dn[u]||Fn(u,{}):(Dn[u]||{}).prototype)for(n in t){if(i=t[n],o=e.noTargetGet?(a=$n(r,n))&&a.value:r[n],!qn(c?n:u+(f?".":"#")+n,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;Qn(i,o)}(e.sham||o&&o.sham)&&Bn(i,"sham",!0),kn(r,n,i,e)}},Yn=A,zn=Xt,Vn=function(){for(var e,t=Yn(this),r=zn(t.delete),n=!0,o=0,i=arguments.length;o<i;o++)e=r.call(t,arguments[o]),n=n&&e;return!!n},Gn=Vn;Ln({target:"Map",proto:!0,real:!0,forced:false},{deleteAll:function(){return Gn.apply(this,arguments)}});var Wn=Xt,Kn=function(e,t,r){if(Wn(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,o){return e.call(t,r,n,o)}}return function(){return e.apply(t,arguments)}},Hn={},Jn=Ie,Zn=Hn,Xn=ve("iterator"),eo=function(e){if(null!=e)return e[Xn]||e["@@iterator"]||Zn[Jn(e)]},to=A,ro=eo,no=function(e){return Map.prototype.entries.call(e)},oo=Hn,io=ve("iterator"),ao=Array.prototype,uo=A,co=A,fo=function(e){return void 0!==e&&(oo.Array===e||ao[io]===e)},so=ir,lo=Kn,po=eo,yo=function(e){var t=e.return;if(void 0!==t)return uo(t.call(e)).value},ho=function(e,t){this.stopped=e,this.result=t},mo=function(e,t,r){var n,o,i,a,u,c,f,s=r&&r.that,l=!(!r||!r.AS_ENTRIES),p=!(!r||!r.IS_ITERATOR),y=!(!r||!r.INTERRUPTED),d=lo(t,s,1+l+y),h=function(e){return n&&yo(n),new ho(!0,e)},m=function(e){return l?(co(e),y?d(e[0],e[1],h):d(e[0],e[1])):y?d(e,h):d(e)};if(p)n=e;else{if("function"!=typeof(o=po(e)))throw TypeError("Target is not iterable");if(fo(o)){for(i=0,a=so(e.length);a>i;i++)if((u=m(e[i]))&&u instanceof ho)return u;return new ho(!1)}n=o.call(e)}for(c=n.next;!(f=c.call(n)).done;){try{u=m(f.value)}catch(e){throw yo(n),e}if("object"==typeof u&&u&&u instanceof ho)return u}return new ho(!1)},go=A,vo=Kn,bo=no,wo=mo;Ln({target:"Map",proto:!0,real:!0,forced:false},{every:function(e){var t=go(this),r=bo(t),n=vo(e,arguments.length>1?arguments[1]:void 0,3);return!wo(r,(function(e,r,o){if(!n(r,e,t))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Eo=A,So=Xt,To=ve("species"),Oo=function(e,t){var r,n=Eo(e).constructor;return void 0===n||null==(r=Eo(n)[To])?t:So(r)},Ao=Z,jo=A,Io=Xt,Ro=Kn,_o=Oo,Po=no,Mo=mo;Ln({target:"Map",proto:!0,real:!0,forced:false},{filter:function(e){var t=jo(this),r=Po(t),n=Ro(e,arguments.length>1?arguments[1]:void 0,3),o=new(_o(t,Ao("Map"))),i=Io(o.set);return Mo(r,(function(e,r){n(r,e,t)&&i.call(o,e,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var xo=A,Co=Kn,No=no,Uo=mo;Ln({target:"Map",proto:!0,real:!0,forced:false},{find:function(e){var t=xo(this),r=No(t),n=Co(e,arguments.length>1?arguments[1]:void 0,3);return Uo(r,(function(e,r,o){if(n(r,e,t))return o(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Do=A,$o=Kn,Bo=no,ko=mo;Ln({target:"Map",proto:!0,real:!0,forced:false},{findKey:function(e){var t=Do(this),r=Bo(t),n=$o(e,arguments.length>1?arguments[1]:void 0,3);return ko(r,(function(e,r,o){if(n(r,e,t))return o(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Fo=A,Qo=no,qo=function(e,t){return e===t||e!=e&&t!=t},Lo=mo;Ln({target:"Map",proto:!0,real:!0,forced:false},{includes:function(e){return Lo(Qo(Fo(this)),(function(t,r,n){if(qo(r,e))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Yo=A,zo=no,Vo=mo;Ln({target:"Map",proto:!0,real:!0,forced:false},{keyOf:function(e){return Vo(zo(Yo(this)),(function(t,r,n){if(r===e)return n(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Go=Z,Wo=A,Ko=Xt,Ho=Kn,Jo=Oo,Zo=no,Xo=mo;Ln({target:"Map",proto:!0,real:!0,forced:false},{mapKeys:function(e){var t=Wo(this),r=Zo(t),n=Ho(e,arguments.length>1?arguments[1]:void 0,3),o=new(Jo(t,Go("Map"))),i=Ko(o.set);return Xo(r,(function(e,r){i.call(o,n(r,e,t),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var ei=Z,ti=A,ri=Xt,ni=Kn,oi=Oo,ii=no,ai=mo;Ln({target:"Map",proto:!0,real:!0,forced:false},{mapValues:function(e){var t=ti(this),r=ii(t),n=ni(e,arguments.length>1?arguments[1]:void 0,3),o=new(oi(t,ei("Map"))),i=ri(o.set);return ai(r,(function(e,r){i.call(o,e,n(r,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),o}});var ui=A,ci=Xt,fi=mo;Ln({target:"Map",proto:!0,real:!0,forced:false},{merge:function(e){for(var t=ui(this),r=ci(t.set),n=0;n<arguments.length;)fi(arguments[n++],r,{that:t,AS_ENTRIES:!0});return t}});var si=A,li=Xt,pi=no,yi=mo;Ln({target:"Map",proto:!0,real:!0,forced:false},{reduce:function(e){var t=si(this),r=pi(t),n=arguments.length<2,o=n?void 0:arguments[1];if(li(e),yi(r,(function(r,i){n?(n=!1,o=i):o=e(o,i,r,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty map with no initial value");return o}});var di=A,hi=Kn,mi=no,gi=mo;Ln({target:"Map",proto:!0,real:!0,forced:false},{some:function(e){var t=di(this),r=mi(t),n=hi(e,arguments.length>1?arguments[1]:void 0,3);return gi(r,(function(e,r,o){if(n(r,e,t))return o()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var vi=A,bi=Xt;Ln({target:"Map",proto:!0,real:!0,forced:false},{update:function(e,t){var r=vi(this),n=arguments.length;bi(t);var o=r.has(e);if(!o&&n<3)throw TypeError("Updating absent value");var i=o?r.get(e):bi(n>2?arguments[2]:void 0)(e,r);return r.set(e,t(i,e,r)),r}});var wi=A,Ei=Xt,Si=function(){for(var e=wi(this),t=Ei(e.add),r=0,n=arguments.length;r<n;r++)t.call(e,arguments[r]);return e};Ln({target:"Set",proto:!0,real:!0,forced:false},{addAll:function(){return Si.apply(this,arguments)}});var Ti=Vn;Ln({target:"Set",proto:!0,real:!0,forced:false},{deleteAll:function(){return Ti.apply(this,arguments)}});var Oi=Z,Ai=A,ji=Xt,Ii=Oo,Ri=mo;Ln({target:"Set",proto:!0,real:!0,forced:false},{difference:function(e){var t=Ai(this),r=new(Ii(t,Oi("Set")))(t),n=ji(r.delete);return Ri(e,(function(e){n.call(r,e)})),r}});var _i=function(e){return Set.prototype.values.call(e)},Pi=A,Mi=Kn,xi=_i,Ci=mo;Ln({target:"Set",proto:!0,real:!0,forced:false},{every:function(e){var t=Pi(this),r=xi(t),n=Mi(e,arguments.length>1?arguments[1]:void 0,3);return!Ci(r,(function(e,r){if(!n(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Ni=Z,Ui=A,Di=Xt,$i=Kn,Bi=Oo,ki=_i,Fi=mo;Ln({target:"Set",proto:!0,real:!0,forced:false},{filter:function(e){var t=Ui(this),r=ki(t),n=$i(e,arguments.length>1?arguments[1]:void 0,3),o=new(Bi(t,Ni("Set"))),i=Di(o.add);return Fi(r,(function(e){n(e,e,t)&&i.call(o,e)}),{IS_ITERATOR:!0}),o}});var Qi=A,qi=Kn,Li=_i,Yi=mo;Ln({target:"Set",proto:!0,real:!0,forced:false},{find:function(e){var t=Qi(this),r=Li(t),n=qi(e,arguments.length>1?arguments[1]:void 0,3);return Yi(r,(function(e,r){if(n(e,e,t))return r(e)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var zi=Z,Vi=A,Gi=Xt,Wi=Oo,Ki=mo;Ln({target:"Set",proto:!0,real:!0,forced:false},{intersection:function(e){var t=Vi(this),r=new(Wi(t,zi("Set"))),n=Gi(t.has),o=Gi(r.add);return Ki(e,(function(e){n.call(t,e)&&o.call(r,e)})),r}});var Hi=A,Ji=Xt,Zi=mo;Ln({target:"Set",proto:!0,real:!0,forced:false},{isDisjointFrom:function(e){var t=Hi(this),r=Ji(t.has);return!Zi(e,(function(e,n){if(!0===r.call(t,e))return n()}),{INTERRUPTED:!0}).stopped}});var Xi=Z,ea=A,ta=Xt,ra=function(e){var t=ro(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return to(t.call(e))},na=mo;Ln({target:"Set",proto:!0,real:!0,forced:false},{isSubsetOf:function(e){var t=ra(this),r=ea(e),n=r.has;return"function"!=typeof n&&(r=new(Xi("Set"))(e),n=ta(r.has)),!na(t,(function(e,t){if(!1===n.call(r,e))return t()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var oa=A,ia=Xt,aa=mo;Ln({target:"Set",proto:!0,real:!0,forced:false},{isSupersetOf:function(e){var t=oa(this),r=ia(t.has);return!aa(e,(function(e,n){if(!1===r.call(t,e))return n()}),{INTERRUPTED:!0}).stopped}});var ua=A,ca=_i,fa=mo;Ln({target:"Set",proto:!0,real:!0,forced:false},{join:function(e){var t=ua(this),r=ca(t),n=void 0===e?",":String(e),o=[];return fa(r,o.push,{that:o,IS_ITERATOR:!0}),o.join(n)}});var sa=Z,la=A,pa=Xt,ya=Kn,da=Oo,ha=_i,ma=mo;Ln({target:"Set",proto:!0,real:!0,forced:false},{map:function(e){var t=la(this),r=ha(t),n=ya(e,arguments.length>1?arguments[1]:void 0,3),o=new(da(t,sa("Set"))),i=pa(o.add);return ma(r,(function(e){i.call(o,n(e,e,t))}),{IS_ITERATOR:!0}),o}});var ga=A,va=Xt,ba=_i,wa=mo;Ln({target:"Set",proto:!0,real:!0,forced:false},{reduce:function(e){var t=ga(this),r=ba(t),n=arguments.length<2,o=n?void 0:arguments[1];if(va(e),wa(r,(function(r){n?(n=!1,o=r):o=e(o,r,r,t)}),{IS_ITERATOR:!0}),n)throw TypeError("Reduce of empty set with no initial value");return o}});var Ea=A,Sa=Kn,Ta=_i,Oa=mo;Ln({target:"Set",proto:!0,real:!0,forced:false},{some:function(e){var t=Ea(this),r=Ta(t),n=Sa(e,arguments.length>1?arguments[1]:void 0,3);return Oa(r,(function(e,r){if(n(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Aa=Z,ja=A,Ia=Xt,Ra=Oo,_a=mo;Ln({target:"Set",proto:!0,real:!0,forced:false},{symmetricDifference:function(e){var t=ja(this),r=new(Ra(t,Aa("Set")))(t),n=Ia(r.delete),o=Ia(r.add);return _a(e,(function(e){n.call(r,e)||o.call(r,e)})),r}});var Pa=Z,Ma=A,xa=Xt,Ca=Oo,Na=mo;
/**
   * @description Utilities for handling and manipulating schema types
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   *
   * Heavily inspired by ECSY
   */
function Ua(e){return Boolean(e&&ArrayBuffer.isView(e)&&!(e instanceof DataView))}function Da(e,t){return e}function $a(e){return e}function Ba(e,t){if(!1===Ur(e))throw new TypeError(`copyObject: Invalid source object, found ${typeof e}.`);if(!1===Ur(t))throw new TypeError(`copyObject: Invalid destination object, found ${typeof t}.`);return Dr(t,e),t}function ka(e,t,r=0){if(!1===Ua(e))throw new TypeError("copyTypedArray: Expected source to be a typed array.");if(!1===Ua(t))throw new TypeError("copyTypedArray: Expected destination to be a typed array.");if(isNaN(r)||r<0)throw new TypeError("copyTypedArray: Offset must be a positive integer of type Number.");return t.set(e,r),t}function Fa(e){if(!1===Ua(e))throw new TypeError("cloneTypedArray: Expected source to be a typed array.");return e.slice()}
/**
   * @name        Schema
   * @description Schemas determine the acceptable shape of component properties
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   * @example
   *              import { Schema, Types } from './schema';
   *
   *              // first, define the shape of the schema:
   *
   *              interface Point {
   *                x: Int32Array,
   *                y: Int32Array,
   *              }
   *
   *              // then, define the schema object:
   *
   *              const Vec2: Schema<Point> = {
   *                // properties can be a SchemaProperty object from the `Types` object:
   *                x: Types.i32,
   *
   *                // or properties can p
   *                x: {
   *                  type: Types.i32,  // get the type from the Types object to avoid undefined behavior
   *                  init: 0,       // define a default property to initialize entities with,
   *                                    // if no default is provided, the default from the type is used
   *                },
   *              }
   *
   *              // the schema can then be used in component creation:
   *
   *              const position = createComponent({
   *                name: "position",
   *                schema: Vec2,
   *              });
   *
   *              const velocity = createComponent({
   *                name: "velocity",
   *                schema: Vec2,
   *              });
   */Ln({target:"Set",proto:!0,real:!0,forced:false},{union:function(e){var t=Ma(this),r=new(Ca(t,Pa("Set")))(t);return Na(e,xa(r.add),{that:r}),r}});const Qa={Array:{copy:function(e,t){if(!Array.isArray(e))throw new TypeError(`copyArray: Source must be an array, found ${typeof e}.`);if(!Array.isArray(t))throw new TypeError(`copyArray: Destination must be an array, found ${typeof t}.`);return t.length=0,e.forEach((e=>t.push(e))),t},clone:function(e){if(!Array.isArray(e))throw new TypeError(`cloneArray: Source must be an array, found ${typeof e}.`);return[...e]},init:[],create:function(e){return new Array(e)}},Boolean:{copy:Da,clone:$a,init:!1,create:function(e){return Boolean(e)}},JSON:{copy:Da,clone:$a,init:null,create:function(e,t){return JSON.parse(e,t)}},Map:{copy:function(e,t){if(!(e instanceof Map))throw new TypeError("copyMap: Expected source to be a Map object.");if(!(t instanceof Map))throw new TypeError("copyMap: Expected destination to be a Map object.");return t.clear(),e.forEach(((e,r)=>t.set(r,e))),t},clone:function(e){if(!(e instanceof Map))throw new TypeError("cloneMap: Expected source to be a Map object.");return new Map(e.entries())},init:new Map,create:function(e){return new Map(e)}},Number:{copy:Da,clone:$a,init:0,create:function(e){return Number(e||this.init)}},Object:{copy:Ba,clone:function(e){return Ba(e,{})},init:{},create:function(e=Object.prototype,t){return Object.create(e,t??{})}},Ref:{copy:Da,clone:$a,init:void 0,create:function(e){return e}},Set:{copy:function(e,t){if(!(e instanceof Set))throw new TypeError("copySet: Expected source to be a Set object.");if(!(t instanceof Set))throw new TypeError("copySet: Expected destination to be a Set object.");return t.clear(),e.forEach((e=>t.add(e))),t},clone:function(e){if(!(e instanceof Set))throw new TypeError("cloneSet: Expected source to be a Set object.");return new Set(e)},init:new Set,create:function(e){return new Set(e)}},String:{copy:Da,clone:$a,init:"",create:function(e){return String(e)}},i8:{copy:ka,clone:Fa,init:new Int8Array,create:function(e,t,r){return new Int8Array(e,t,r)}},u8:{copy:ka,clone:Fa,init:new Uint8Array,create:function(e,t,r){return new Uint8Array(e,t,r)}},u8c:{copy:ka,clone:Fa,init:new Uint8ClampedArray,create:function(e,t,r){return new Uint8ClampedArray(e,t,r)}},i16:{copy:ka,clone:Fa,init:new Int16Array,create:function(e,t,r){return new Int16Array(e,t,r)}},u16:{copy:ka,clone:Fa,init:new Uint16Array,create:function(e,t,r){return new Uint16Array(e,t,r)}},i32:{copy:ka,clone:Fa,init:new Int32Array,create:function(e,t,r){return new Int32Array(e,t,r)}},u32:{copy:ka,clone:Fa,init:new Uint32Array,create:function(e,t,r){return new Uint32Array(e,t,r)}},f32:{copy:ka,clone:Fa,init:new Float32Array,create:function(e,t,r){return new Float32Array(e,t,r)}},f64:{copy:ka,clone:Fa,init:new Float64Array,create:function(e,t,r){return new Float64Array(e,t,r)}},i64:{copy:ka,clone:Fa,init:new BigInt64Array,create:function(e,t,r){return new BigInt64Array(e,t,r)}},u64:{copy:ka,clone:Fa,init:new BigUint64Array,create:function(e,t,r){return new BigUint64Array(e,t,r)}}},qa=Symbol(),La=Symbol(),Ya=Object.create(Object.prototype,{[qa]:{value:!0,enumerable:!0,configurable:!1,writable:!1}}),za={[La]:{value:!0,enumerable:!0,configurable:!1,writable:!1}};function Va(e){return Ur(e)&&Object.is(Ya,Object.getPrototypeOf(e))}function Ga(e){return Ur(e)&&!0===e[La]}
/**
   * @name        Archetype
   * @description Archetypes are unique groups of components
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   */
const Wa=Symbol(),Ka={add:function(e){return this.has(e)||(this.entities.add(e),this[Wa]=!0),this},has:function(e){return this.entities.has(e)},remove:function(e){return this.has(e)?(this.entities.delete(e),this[Wa]=!0,this):this},reset:function(){return this.entities.clear(),this[Wa]=!0,this}};function Ha(e){return Object.create(Ka,{[Wa]:{value:!0,configurable:!1,enumerable:!0,writable:!0},entities:{value:new Set,configurable:!1,enumerable:!0,writable:!1},mask:{value:e,configurable:!1,enumerable:!0,writable:!1},name:{value:e.toString(),configurable:!1,enumerable:!0,writable:!1}})}
/**
   * @name        ArchetypeManager
   * @description The archetype manager creates, destroys & assigns archetypes
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   */function Ja(e,t,r){return function(n){const o=t[n];return void 0!==o&&(o.remove(n),0===o.entities.size&&delete e[o.name]),r.add(n),t[n]=r,r}}function Za(e,t,r){return function(n,o){const i=t[n];if(void 0!==i&&(i.remove(n),0===i.entities.size&&(r.getQueries().forEach((e=>e.remove(i))),delete e[i.name])),void 0===o?.id)throw new TypeError("updateEntityArchetype: Expected component to be an instance!");const a=t[n]?.mask??Nr(r.config.maxComponents);!function(e,t){xr(e,t)?Mr(e,t):Pr(e,t)}(a,o.id);const u=a.toString();let c;return u in e?c=e[u]:(c=Ha(a),r.getQueries().forEach((e=>e.isMatch(c))),e[u]=c),c.add(n),t[n]=c,c}}
/**
   * @name        ComponentManager
   * @description The component manager brokers the relationship between components and entities.
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   */
function Xa(e,...t){if(!e)throw new SyntaxError("componentsToMask: a world object is required.");const r=Nr(e.config.maxComponents);return t&&t.length?(t.forEach((t=>{if(t.world.id!==e.id)throw new SyntaxError("componentsToMask: all components must be from the same world.");Pr(r,t.id)})),r):r}function eu(e,t,r){return function(n){if(Object.keys(t).length>=r.config.maxComponents)throw new Error("registerComponent: maximum components reached.");if(!1===Va(n))throw new TypeError(`registerComponent: expected Component, found "${typeof n}".`);if(n.name in t)throw new Error(`registerComponent: component "${n.name}" is already registered.`);const o=Cr(e);if(void 0===o)throw new Error("registerComponent: no ids available!");const i=function(e,t){if(!1===Va(e))throw new TypeError("createComponentInstance: Invalid component provided.");const{schema:r}=e,{id:n,world:o}=t,i=Object.create(e,za),a=Object.create(i,{entities:{value:Nr(o.config.maxEntities),enumerable:!0,configurable:!1,writable:!1},id:{value:n,enumerable:!0,writable:!1,configurable:!1},world:{value:o,enumerable:!0,writable:!1,configurable:!1},getPropertyArrays:{value:function(){const e=Object.keys(this.schema);return Object.entries(this).filter((([t,r])=>e.includes(t)))},enumerable:!0,writable:!1,configurable:!1}});return Object.entries(r).forEach((([e,t])=>{const{clone:r,create:n,init:i}=t;let u;u=Ua(i)?n(new ArrayBuffer(i.BYTES_PER_ELEMENT*o.config.maxEntities)):new Array(o.config.maxEntities).fill(r(i)),Object.defineProperty(a,e,{value:u,enumerable:!0,configurable:!1,writable:!1})})),a}(n,{id:o,world:r});return Pr(e,o),t[n.name]=i,i}}function tu(e,t,r){return function(n,o=!1){if(!Va(n))throw new TypeError(`unregisterComponent: expected Component, found "${typeof n}".`);const i=t[n.name];if(!i)throw new Error(`unregisterComponent: component "${n.name}" is not registered.`);const a=i.entities;return!1!==o&&0!==a.length||(a.forEach((e=>r.removeComponentFromEntity(e,n))),Mr(e,i.id),delete t[n.name]),r}}function ru(e,t){return function(r,n,o){if(1!==t.getEntityState(r))throw new Error(`addComponentToEntity: Entity "${r}" does not exist in this world.`);if(!1===Va(n)&&!1===Ga(n)&&"string"!=typeof n)throw new TypeError("addComponentToEntity: Invalid component provided.");const i="string"==typeof n?n:n.name,a=e[i];if(!a)throw new Error(`addComponentToEntity: Component "${i}" is not registered in this world.`);if(xr(a.entities,r))throw new Error(`addComponentToEntity: Entity "${r}" already has component "${i}".`);return void 0!==o&&Ur(o)&&Object.keys(o).forEach((e=>{e in a?a[e][r]=o[e]:console.warn(`addComponentToEntity: Key "${e}" does not exist in component "${a.name}".`)})),Pr(a.entities,r),t.updateEntityArchetype(r,a),t}}function nu(e,t){return function(r,n){if(!t.getEntityState(r))throw new Error(`removeComponentFromEntity: entity "${r}" is not active in this world.`);if(!1===Va(n)&&!1===Ga(n)&&"string"!=typeof n)throw new TypeError("removeComponentFromEntity: invalid component provided.");const o="string"==typeof n?n:n.name,i=e[o];if(!i)throw new Error(`removeComponentFromEntity: component "${o}" is not registered in this world.`);if(!1===xr(i.entities,r))throw new Error(`removeComponentFromEntity: entity "${r}" does not have component "${o}" to remove.`);return Mr(i.entities,r),t.updateEntityArchetype(r,i),t}}function ou(e){return function(t,r){const n="string"==typeof r?r:r.name,o=e[n];return void 0!==o&&xr(o.entities,t)}}function iu(e){return function(t,r){const n=e["string"==typeof r?r:r.name];if(void 0===n)throw new Error("getProperty: component not registered.");if(!1!==xr(n.entities,t))return n.getPropertyArrays().reduce(((e,[r,n])=>(e[r]=n[t],e)),{})}}function au(e){return function(t){return[...Object.values(e)].find((e=>e.id===t))}}function uu(e){return function(t){return e[t]}}function cu(e){return function(){return[...Object.values(e)]}}function fu(e){return function(t){return("string"==typeof t?t:t.name)in e}}function su(e){return function(t){const r=e["string"==typeof t?t:t.name];return r?[...r.entities]:[]}}function lu(e){const t=iu(e);return function(r){return Object.keys(e).reduce(((e,n)=>(e[n]=t(r,n),e)),{})}}function pu(e){return function(t){return e["string"==typeof t?t:t.name]?.id}}function yu(e,t){return function(r){t.resetEntityArchetype(r),Object.values(e).forEach((e=>Mr(e.entities,r)))}}
/**
   * @name        EntityManager
   * @description The entity manager creates, destroys and manages the state of entities in the world.
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   */
function du(e){return function(){const t=Cr(e);if(void 0===t)throw new Error("createEntity: No available entities. Maximum entities reached.");return Pr(e,t),t}}function hu(e,t){return function(r){return xr(e,r)&&(t.stripEntity(r),Mr(e,r)),t}}function mu(e){return function(t){return xr(e,t)}}function gu(e){return function(t){return!0===xr(e,t)?1:0}}const vu=Object.create(Object.prototype,{add:{value:function(e){return this.archetypes.includes(e)||this.archetypes.push(e),this},configurable:!1,enumerable:!0,writable:!1},getEntities:{value:function(){if(!Object.keys(this.archetypes)?.length)return[];const e=Object.values(this.archetypes).flatMap((e=>[...e.entities]));return[...new Set(e)]},configurable:!1,enumerable:!0,writable:!1},isMatch:{value:function(e){if(!this.query||!e)return!1;const t=
/**
   * @name        Query
   * @description Queries group Archetypes
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   */
function(e,t){const{mask:r}=t;if(!r)return!1;const n=e[0],o=e[1],i=e[2];for(let e=0,t=i.length;e<t;e++)if(0!=(i[e]&r[e]))return!1;for(let e=0,t=n.length;e<t;e++)if((n[e]&r[e])!==r[e])return!1;for(let e=0,t=o.length;e<t;e++)if((o[e]&r[e])>0)return!1;return!0}(this.query,e);return t&&this.add(e),t},configurable:!1,enumerable:!0,writable:!1},isQuery:{value:!0,configurable:!1,enumerable:!0,writable:!1},remove:{value:function(e){return this.archetypes.includes(e)?(this.archetypes.splice(this.archetypes.indexOf(e),1),this):this},configurable:!1,enumerable:!0,writable:!1}});
/**
   * @name        QueryManager
   * @description Handles the creation, destruction of Queries
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   */
function bu(e){return function(){return[...Object.values(e)]}}function wu(e){return function(t){return Boolean(t.name in e)}}function Eu(e,t){const r=Su(t);return function(n){if(!Br(n.name))throw new Error("Invalid name provided for query.");if(n.name in e)throw new Error(`Query with name "${n.name}" is already registered in this world.`);const o=function(e,t){const{all:r=[],any:n=[],none:o=[],name:i}=t,a=r.every((e=>void 0!==e.id)),u=n.every((e=>void 0!==e.id)),c=o.every((e=>void 0!==e.id));if(!a||!u||!c)throw new TypeError("createQuery: query spec must contain component instances only, not components or strings.");const f=Xa(e,...r),s=Xa(e,...n),l=Xa(e,...o);return Object.create(vu,{archetypes:{value:[],configurable:!1,enumerable:!0,writable:!1},name:{value:i,configurable:!1,enumerable:!0,writable:!1},query:{value:[f,s,l],configurable:!1,enumerable:!0,writable:!1}})}(t,n);return e[o.name]=o,r(o),o}}function Su(e){return function(t){if(!("archetypes"in t))throw new TypeError("invalid query provided.");return e.getArchetypes().forEach((e=>{!0===e[Wa]&&t.isMatch(e)})),t}}function Tu(e,t){const r=Su(t);return function(){return Object.values(e).forEach((e=>r(e))),t.getArchetypes().forEach((e=>e[Wa]=!1)),t}}function Ou(e,t){return function(r){return delete e[r.name],t}}
/**
   * @name        StepManager
   * @description Manages the game loop/time step functions
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   */
function Au(e){return function(){return e.getPreSystems().forEach((e=>e.pre(e.entities))),e}}function ju(e){return function(t=0){return e.getPostSystems().forEach((e=>e.post(e.entities,t))),e.refreshQueries(),e}}function Iu(e,t,r){let n=0,o=null,i=0;const a=Au(r),u=ju(r),c=Ru(r);return function(r=0,f=t){if(null!==o)for(n+=.001*(r-o),i=0,a();n>f;){if(i>=e){n=1;break}c(f),n-=f,i++}o=r,u(n/t)}}function Ru(e){return function(t=0){return e.getUpdateSystems().forEach((e=>e.update(e.entities,t))),e}}
/**
   * @description Utilities for handling and manipulating number types
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   */
function _u(e,t,r){return null!=t&&e<t?t:null!=r&&e>r?r:e}
/**
   * @name        System
   * @description Systems provide the functionality for sets of archetypes
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   */const Pu=Object.create(Object.prototype,{isSystem:{value:!0,enumerable:!0,configurable:!1,writable:!1},enabled:{value:!1,enumerable:!0,configurable:!1,writable:!0},disable:{value:function(){return!1===this.enabled},enumerable:!0,configurable:!1,writable:!1},enable:{value:function(){return!0===this.enabled},enumerable:!0,configurable:!1,writable:!1},pre:{value:function(e){},enumerable:!0,configurable:!1,writable:!0},post:{value:function(e,t){},enumerable:!0,configurable:!1,writable:!0},update:{value:function(e,t){},enumerable:!0,configurable:!1,writable:!0}});
/**
   * @name        SystemManager
   * @description Manages the creation, destruction of Systems
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   */
function Mu(e){return function(){return[...e]}}function xu(e){return function(){return e.filter((e=>"post"in e))}}function Cu(e){return function(){return e.filter((e=>"pre"in e))}}function Nu(e){return function(){return e.filter((e=>"update"in e))}}function Uu(e){return function(t){return e[t]}}function Du(e){return function(t){return e[t]}}function $u(e){return function(t){return t.name in e}}function Bu(e){return function(t,r){const n=e.indexOf(t);if(-1===n)return-1;const o=_u(r,0,e.length);return e.splice(o,1),e.splice(n,0,t),o}}function ku(e,t){return function(r,n){if(!Br(r.name))throw new SyntaxError(`"${r.name}" is not a valid system name.`);if(r.name in t)throw new Error(`System "${r.name}" is already registered!`);if(!r.pre&&!r.post&&!r.update)throw new SyntaxError('No functions provided for system. Please provide a "pre"');const o=function(e){const{name:t,query:r,pre:n,post:o,update:i}=e,a=Object.create(Pu,{name:{value:t,enumerable:!0,configurable:!1,writable:!1},query:{value:r,enumerable:!0,configurable:!1,writable:!1},entities:{get(){return this.query?.getEntities()??[]},enumerable:!0,configurable:!1}});return n&&(a.pre=n),o&&(a.post=o),i&&(a.update=i),a}(r);return void 0!==n?e.splice(_u(n,0,e.length),0,o):e.push(o),t[o.name]=o,o}}function Fu(e,t,r){return function(n){if(!(n.name in t))throw new Error(`System "${n.name}" is not registered!`);delete t[n.name];const o=e.indexOf(n);return o>-1&&e.splice(o,1),r}}return e.Types=Qa,e.createComponent=function(e){const{name:t,schema:n}=e;if(!Br(t))throw new SyntaxError("createComponent: supplied name is invalid.");if(!function(e){return Boolean(Ur(e)&&Object.keys(e).length>0)}(n))throw new TypeError(`createComponent: Schema for "${t}" is invalid.`);return Object.create(Ya,{name:{value:t,enumerable:!0,configurable:!1,writable:!1},schema:{value:r({},n),enumerable:!0,configurable:!1,writable:!1}})},e.createWorld=
/**
   * @name        World
   * @description The primary context for the ECS.
   * @author      P. Hughes <peter@phugh.es> (https://www.phugh.es)
   * @copyright   2021 P. Hughes. All rights reserved.
   * @license     MIT
   */
function(e={}){const{maxComponents:t=256,maxEntities:r=1e5,maxUpdates:n=240,tempo:o=1/60}=e,i={config:Object.freeze({maxComponents:t,maxEntities:r,maxUpdates:n,tempo:o}),id:`${Date.now().toString(36)}_${Math.random().toString(36).substr(2,9)}`};return Object.assign(i,function(e){const{maxComponents:t,maxEntities:r}=e.config,n=Ha(Nr(t)),o={},i=new Array(r).fill(n);return{archetypeHasComponent:function(e,t){return xr(e.mask,t.id)},getArchetypes:(u=o,function(){return[...Object.values(u)]}),getEntityArchetype:(a=i,function(e){return a[e]}),resetEntityArchetype:Ja(o,i,n),updateEntityArchetype:Za(o,i,e)};var a,u}(i),function(e){const{maxComponents:t}=e.config,r=Nr(t),n={};return{addComponentToEntity:ru(n,e),collateEntityProperties:lu(n),entityHasComponent:ou(n),getComponentById:au(n),getComponentByName:uu(n),getComponentId:pu(n),getComponents:cu(n),getEntitiesWithComponent:su(n),getProperties:iu(n),isComponentRegistered:fu(n),registerComponent:eu(r,n,e),removeComponentFromEntity:nu(n,e),stripEntity:yu(n,e),unregisterComponent:tu(r,n,e)}}(i),function(e){const{maxEntities:t}=e.config,r=Nr(t);return{createEntity:du(r),destroyEntity:hu(r,e),getEntityState:gu(r),isEntityRegistered:mu(r)}}(i),function(e){const t={};return{getQueries:bu(t),isQueryRegistered:wu(t),registerQuery:Eu(t,e),refreshQuery:Su(e),refreshQueries:Tu(t,e),unregisterQuery:Ou(t,e)}}(i),function(e){const{maxUpdates:t,tempo:r}=e.config;return{pre:Au(e),post:ju(e),step:Iu(t,r,e),update:Ru(e)}}(i),function(e){const t=[],r={};return{getSystems:Mu(t),getPostSystems:xu(t),getPreSystems:Cu(t),getUpdateSystems:Nu(t),getSystemByIdx:Uu(t),getSystemByName:Du(r),isSystemRegistered:$u(r),moveSystem:Bu(t),registerSystem:ku(t,r),unregisterSystem:Fu(t,r,e)}}(i)),i},e}({});
//# sourceMappingURL=index.min.js.map
